-- ============================================================================
-- Cte - GoogleSQL/BigQuery
-- ============================================================================
-- Source: Migrated from insert_enhancements_comprehensive_tdd.rs, tablesample_comprehensive_tdd.rs
-- Description: Common Table Expressions (WITH clause) for query organization
--
-- PostgreSQL: Limited or no support
-- BigQuery: Full support
-- SQL Standard: GoogleSQL/BigQuery specific
-- ============================================================================

DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, name STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, name STRING);
INSERT INTO source VALUES (1, 'Alice');
INSERT INTO source VALUES (2, 'Bob');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, 100), (2, 50), (3, 200);
INSERT INTO dest SELECT * FROM source WHERE value > 75;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (doubled INT64, message STRING);
INSERT INTO source VALUES (5), (10), (15);
INSERT INTO dest SELECT value * 2, CONCAT('Value: ', CAST(value AS STRING)) FROM source;
DROP TABLE IF EXISTS users;
CREATE TABLE users (user_id INT64, name STRING);
DROP TABLE IF EXISTS scores;
CREATE TABLE scores (user_id INT64, score INT64);
DROP TABLE IF EXISTS results;
CREATE TABLE results (name STRING, score INT64);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO scores VALUES (1, 95), (2, 87);
INSERT INTO results SELECT u.name, s.score FROM users u JOIN scores s ON u.user_id = s.user_id;
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (product STRING, amount INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (product STRING, total INT64);
INSERT INTO sales VALUES ('A', 100), ('B', 200), ('A', 150), ('B', 50);
INSERT INTO summary SELECT product, SUM(amount) FROM sales GROUP BY product;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO dest SELECT * FROM source WHERE id > 1000;
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Carol');
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, value INT64);
INSERT INTO t VALUES (1, 100), (2, NULL), (3, 300);
DROP TABLE IF EXISTS t;
CREATE TABLE t (i INT64, f FLOAT64, s STRING, b BOOL);
INSERT INTO t VALUES (1, 3.14, 'test', TRUE), (2, 2.71, 'data', FALSE);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (NULL, NULL), (NULL, NULL);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING, age INT64);
INSERT INTO t (name, id) VALUES ('Alice', 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING, age INT64);
INSERT INTO t (id, name) VALUES (1, 'Bob');
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t (c, b, a) VALUES (3, 2, 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t (name, id) VALUES ('Alice', 1), ('Bob', 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64, y INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (10, 20);
INSERT INTO dest (b, a) SELECT x, y FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t DEFAULT VALUES;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, name STRING);
INSERT INTO source VALUES (1);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES ('not_a_number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2), (3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2, 3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64);
INSERT INTO t (a, b) VALUES (1, 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64);
INSERT INTO source VALUES (1);
INSERT INTO dest (a, b) SELECT x FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, NULL), (2, 20);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT * FROM dest ORDER BY id;
SELECT doubled FROM dest ORDER BY doubled;
SELECT value FROM t WHERE id = 2;
SELECT id, name FROM t;
SELECT age FROM t;
SELECT a, b, c FROM t;
SELECT a, b FROM dest;
SELECT * FROM t;
SELECT value FROM dest WHERE id = 1;
SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_select_with_where
-- Source: insert_enhancements_comprehensive_tdd.rs:88
-- ============================================================================
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, 100), (2, 50), (3, 200);
INSERT INTO dest SELECT * FROM source WHERE value > 75;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (doubled INT64, message STRING);
INSERT INTO source VALUES (5), (10), (15);
INSERT INTO dest SELECT value * 2, CONCAT('Value: ', CAST(value AS STRING)) FROM source;
DROP TABLE IF EXISTS users;
CREATE TABLE users (user_id INT64, name STRING);
DROP TABLE IF EXISTS scores;
CREATE TABLE scores (user_id INT64, score INT64);
DROP TABLE IF EXISTS results;
CREATE TABLE results (name STRING, score INT64);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO scores VALUES (1, 95), (2, 87);
INSERT INTO results SELECT u.name, s.score FROM users u JOIN scores s ON u.user_id = s.user_id;
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (product STRING, amount INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (product STRING, total INT64);
INSERT INTO sales VALUES ('A', 100), ('B', 200), ('A', 150), ('B', 50);
INSERT INTO summary SELECT product, SUM(amount) FROM sales GROUP BY product;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO dest SELECT * FROM source WHERE id > 1000;
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Carol');
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, value INT64);
INSERT INTO t VALUES (1, 100), (2, NULL), (3, 300);
DROP TABLE IF EXISTS t;
CREATE TABLE t (i INT64, f FLOAT64, s STRING, b BOOL);
INSERT INTO t VALUES (1, 3.14, 'test', TRUE), (2, 2.71, 'data', FALSE);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (NULL, NULL), (NULL, NULL);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING, age INT64);
INSERT INTO t (name, id) VALUES ('Alice', 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING, age INT64);
INSERT INTO t (id, name) VALUES (1, 'Bob');
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t (c, b, a) VALUES (3, 2, 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t (name, id) VALUES ('Alice', 1), ('Bob', 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64, y INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (10, 20);
INSERT INTO dest (b, a) SELECT x, y FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t DEFAULT VALUES;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, name STRING);
INSERT INTO source VALUES (1);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES ('not_a_number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2), (3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2, 3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64);
INSERT INTO t (a, b) VALUES (1, 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64);
INSERT INTO source VALUES (1);
INSERT INTO dest (a, b) SELECT x FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, NULL), (2, 20);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT doubled FROM dest ORDER BY doubled;
SELECT value FROM t WHERE id = 2;
SELECT id, name FROM t;
SELECT age FROM t;
SELECT a, b, c FROM t;
SELECT a, b FROM dest;
SELECT * FROM t;
SELECT value FROM dest WHERE id = 1;
SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_select_with_expressions
-- Source: insert_enhancements_comprehensive_tdd.rs:116
-- ============================================================================
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (doubled INT64, message STRING);
INSERT INTO source VALUES (5), (10), (15);
INSERT INTO dest SELECT value * 2, CONCAT('Value: ', CAST(value AS STRING)) FROM source;
DROP TABLE IF EXISTS users;
CREATE TABLE users (user_id INT64, name STRING);
DROP TABLE IF EXISTS scores;
CREATE TABLE scores (user_id INT64, score INT64);
DROP TABLE IF EXISTS results;
CREATE TABLE results (name STRING, score INT64);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO scores VALUES (1, 95), (2, 87);
INSERT INTO results SELECT u.name, s.score FROM users u JOIN scores s ON u.user_id = s.user_id;
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (product STRING, amount INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (product STRING, total INT64);
INSERT INTO sales VALUES ('A', 100), ('B', 200), ('A', 150), ('B', 50);
INSERT INTO summary SELECT product, SUM(amount) FROM sales GROUP BY product;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO dest SELECT * FROM source WHERE id > 1000;
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Carol');
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, value INT64);
INSERT INTO t VALUES (1, 100), (2, NULL), (3, 300);
DROP TABLE IF EXISTS t;
CREATE TABLE t (i INT64, f FLOAT64, s STRING, b BOOL);
INSERT INTO t VALUES (1, 3.14, 'test', TRUE), (2, 2.71, 'data', FALSE);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (NULL, NULL), (NULL, NULL);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING, age INT64);
INSERT INTO t (name, id) VALUES ('Alice', 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING, age INT64);
INSERT INTO t (id, name) VALUES (1, 'Bob');
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t (c, b, a) VALUES (3, 2, 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t (name, id) VALUES ('Alice', 1), ('Bob', 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64, y INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (10, 20);
INSERT INTO dest (b, a) SELECT x, y FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t DEFAULT VALUES;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, name STRING);
INSERT INTO source VALUES (1);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES ('not_a_number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2), (3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2, 3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64);
INSERT INTO t (a, b) VALUES (1, 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64);
INSERT INTO source VALUES (1);
INSERT INTO dest (a, b) SELECT x FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, NULL), (2, 20);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT doubled FROM dest ORDER BY doubled;
SELECT value FROM t WHERE id = 2;
SELECT id, name FROM t;
SELECT age FROM t;
SELECT a, b, c FROM t;
SELECT a, b FROM dest;
SELECT * FROM t;
SELECT value FROM dest WHERE id = 1;
SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_select_from_join
-- Source: insert_enhancements_comprehensive_tdd.rs:147
-- ============================================================================
DROP TABLE IF EXISTS users;
CREATE TABLE users (user_id INT64, name STRING);
DROP TABLE IF EXISTS scores;
CREATE TABLE scores (user_id INT64, score INT64);
DROP TABLE IF EXISTS results;
CREATE TABLE results (name STRING, score INT64);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO scores VALUES (1, 95), (2, 87);
INSERT INTO results SELECT u.name, s.score FROM users u JOIN scores s ON u.user_id = s.user_id;
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (product STRING, amount INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (product STRING, total INT64);
INSERT INTO sales VALUES ('A', 100), ('B', 200), ('A', 150), ('B', 50);
INSERT INTO summary SELECT product, SUM(amount) FROM sales GROUP BY product;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO dest SELECT * FROM source WHERE id > 1000;
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Carol');
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, value INT64);
INSERT INTO t VALUES (1, 100), (2, NULL), (3, 300);
DROP TABLE IF EXISTS t;
CREATE TABLE t (i INT64, f FLOAT64, s STRING, b BOOL);
INSERT INTO t VALUES (1, 3.14, 'test', TRUE), (2, 2.71, 'data', FALSE);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (NULL, NULL), (NULL, NULL);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING, age INT64);
INSERT INTO t (name, id) VALUES ('Alice', 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING, age INT64);
INSERT INTO t (id, name) VALUES (1, 'Bob');
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t (c, b, a) VALUES (3, 2, 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t (name, id) VALUES ('Alice', 1), ('Bob', 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64, y INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (10, 20);
INSERT INTO dest (b, a) SELECT x, y FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t DEFAULT VALUES;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, name STRING);
INSERT INTO source VALUES (1);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES ('not_a_number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2), (3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2, 3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64);
INSERT INTO t (a, b) VALUES (1, 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64);
INSERT INTO source VALUES (1);
INSERT INTO dest (a, b) SELECT x FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, NULL), (2, 20);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT value FROM t WHERE id = 2;
SELECT id, name FROM t;
SELECT age FROM t;
SELECT a, b, c FROM t;
SELECT a, b FROM dest;
SELECT * FROM t;
SELECT value FROM dest WHERE id = 1;
SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_select_with_aggregates
-- Source: insert_enhancements_comprehensive_tdd.rs:181
-- ============================================================================
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (product STRING, amount INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (product STRING, total INT64);
INSERT INTO sales VALUES ('A', 100), ('B', 200), ('A', 150), ('B', 50);
INSERT INTO summary SELECT product, SUM(amount) FROM sales GROUP BY product;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO dest SELECT * FROM source WHERE id > 1000;
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Carol');
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, value INT64);
INSERT INTO t VALUES (1, 100), (2, NULL), (3, 300);
DROP TABLE IF EXISTS t;
CREATE TABLE t (i INT64, f FLOAT64, s STRING, b BOOL);
INSERT INTO t VALUES (1, 3.14, 'test', TRUE), (2, 2.71, 'data', FALSE);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (NULL, NULL), (NULL, NULL);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING, age INT64);
INSERT INTO t (name, id) VALUES ('Alice', 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING, age INT64);
INSERT INTO t (id, name) VALUES (1, 'Bob');
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t (c, b, a) VALUES (3, 2, 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t (name, id) VALUES ('Alice', 1), ('Bob', 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64, y INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (10, 20);
INSERT INTO dest (b, a) SELECT x, y FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t DEFAULT VALUES;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, name STRING);
INSERT INTO source VALUES (1);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES ('not_a_number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2), (3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2, 3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64);
INSERT INTO t (a, b) VALUES (1, 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64);
INSERT INTO source VALUES (1);
INSERT INTO dest (a, b) SELECT x FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, NULL), (2, 20);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT value FROM t WHERE id = 2;
SELECT id, name FROM t;
SELECT age FROM t;
SELECT a, b, c FROM t;
SELECT a, b FROM dest;
SELECT * FROM t;
SELECT value FROM dest WHERE id = 1;
SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_select_empty_result
-- Source: insert_enhancements_comprehensive_tdd.rs:208
-- ============================================================================
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO dest SELECT * FROM source WHERE id > 1000;
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Carol');
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, value INT64);
INSERT INTO t VALUES (1, 100), (2, NULL), (3, 300);
DROP TABLE IF EXISTS t;
CREATE TABLE t (i INT64, f FLOAT64, s STRING, b BOOL);
INSERT INTO t VALUES (1, 3.14, 'test', TRUE), (2, 2.71, 'data', FALSE);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (NULL, NULL), (NULL, NULL);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING, age INT64);
INSERT INTO t (name, id) VALUES ('Alice', 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING, age INT64);
INSERT INTO t (id, name) VALUES (1, 'Bob');
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t (c, b, a) VALUES (3, 2, 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t (name, id) VALUES ('Alice', 1), ('Bob', 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64, y INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (10, 20);
INSERT INTO dest (b, a) SELECT x, y FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t DEFAULT VALUES;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, name STRING);
INSERT INTO source VALUES (1);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES ('not_a_number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2), (3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2, 3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64);
INSERT INTO t (a, b) VALUES (1, 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64);
INSERT INTO source VALUES (1);
INSERT INTO dest (a, b) SELECT x FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, NULL), (2, 20);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT value FROM t WHERE id = 2;
SELECT id, name FROM t;
SELECT age FROM t;
SELECT a, b, c FROM t;
SELECT a, b FROM dest;
SELECT * FROM t;
SELECT value FROM dest WHERE id = 1;
SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_multi_row_basic
-- Source: insert_enhancements_comprehensive_tdd.rs:236
-- ============================================================================
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Carol');
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, value INT64);
INSERT INTO t VALUES (1, 100), (2, NULL), (3, 300);
DROP TABLE IF EXISTS t;
CREATE TABLE t (i INT64, f FLOAT64, s STRING, b BOOL);
INSERT INTO t VALUES (1, 3.14, 'test', TRUE), (2, 2.71, 'data', FALSE);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (NULL, NULL), (NULL, NULL);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING, age INT64);
INSERT INTO t (name, id) VALUES ('Alice', 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING, age INT64);
INSERT INTO t (id, name) VALUES (1, 'Bob');
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t (c, b, a) VALUES (3, 2, 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t (name, id) VALUES ('Alice', 1), ('Bob', 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64, y INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (10, 20);
INSERT INTO dest (b, a) SELECT x, y FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t DEFAULT VALUES;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, name STRING);
INSERT INTO source VALUES (1);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES ('not_a_number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2), (3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2, 3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64);
INSERT INTO t (a, b) VALUES (1, 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64);
INSERT INTO source VALUES (1);
INSERT INTO dest (a, b) SELECT x FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, NULL), (2, 20);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT value FROM t WHERE id = 2;
SELECT id, name FROM t;
SELECT age FROM t;
SELECT a, b, c FROM t;
SELECT a, b FROM dest;
SELECT * FROM t;
SELECT value FROM dest WHERE id = 1;
SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_multi_row_with_nulls
-- Source: insert_enhancements_comprehensive_tdd.rs:257
-- ============================================================================
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, value INT64);
INSERT INTO t VALUES (1, 100), (2, NULL), (3, 300);
DROP TABLE IF EXISTS t;
CREATE TABLE t (i INT64, f FLOAT64, s STRING, b BOOL);
INSERT INTO t VALUES (1, 3.14, 'test', TRUE), (2, 2.71, 'data', FALSE);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (NULL, NULL), (NULL, NULL);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING, age INT64);
INSERT INTO t (name, id) VALUES ('Alice', 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING, age INT64);
INSERT INTO t (id, name) VALUES (1, 'Bob');
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t (c, b, a) VALUES (3, 2, 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t (name, id) VALUES ('Alice', 1), ('Bob', 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64, y INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (10, 20);
INSERT INTO dest (b, a) SELECT x, y FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t DEFAULT VALUES;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, name STRING);
INSERT INTO source VALUES (1);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES ('not_a_number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2), (3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2, 3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64);
INSERT INTO t (a, b) VALUES (1, 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64);
INSERT INTO source VALUES (1);
INSERT INTO dest (a, b) SELECT x FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, NULL), (2, 20);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT value FROM t WHERE id = 2;
SELECT id, name FROM t;
SELECT age FROM t;
SELECT a, b, c FROM t;
SELECT a, b FROM dest;
SELECT * FROM t;
SELECT value FROM dest WHERE id = 1;
SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_multi_row_mixed_types
-- Source: insert_enhancements_comprehensive_tdd.rs:276
-- ============================================================================
DROP TABLE IF EXISTS t;
CREATE TABLE t (i INT64, f FLOAT64, s STRING, b BOOL);
INSERT INTO t VALUES (1, 3.14, 'test', TRUE), (2, 2.71, 'data', FALSE);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (NULL, NULL), (NULL, NULL);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING, age INT64);
INSERT INTO t (name, id) VALUES ('Alice', 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING, age INT64);
INSERT INTO t (id, name) VALUES (1, 'Bob');
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t (c, b, a) VALUES (3, 2, 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t (name, id) VALUES ('Alice', 1), ('Bob', 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64, y INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (10, 20);
INSERT INTO dest (b, a) SELECT x, y FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t DEFAULT VALUES;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, name STRING);
INSERT INTO source VALUES (1);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES ('not_a_number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2), (3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2, 3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64);
INSERT INTO t (a, b) VALUES (1, 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64);
INSERT INTO source VALUES (1);
INSERT INTO dest (a, b) SELECT x FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, NULL), (2, 20);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT id, name FROM t;
SELECT age FROM t;
SELECT a, b, c FROM t;
SELECT a, b FROM dest;
SELECT * FROM t;
SELECT value FROM dest WHERE id = 1;
SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_multi_row_large_batch
-- Source: insert_enhancements_comprehensive_tdd.rs:296
-- ============================================================================
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (NULL, NULL), (NULL, NULL);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING, age INT64);
INSERT INTO t (name, id) VALUES ('Alice', 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING, age INT64);
INSERT INTO t (id, name) VALUES (1, 'Bob');
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t (c, b, a) VALUES (3, 2, 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t (name, id) VALUES ('Alice', 1), ('Bob', 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64, y INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (10, 20);
INSERT INTO dest (b, a) SELECT x, y FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t DEFAULT VALUES;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, name STRING);
INSERT INTO source VALUES (1);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES ('not_a_number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2), (3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2, 3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64);
INSERT INTO t (a, b) VALUES (1, 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64);
INSERT INTO source VALUES (1);
INSERT INTO dest (a, b) SELECT x FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, NULL), (2, 20);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT id, name FROM t;
SELECT age FROM t;
SELECT a, b, c FROM t;
SELECT a, b FROM dest;
SELECT * FROM t;
SELECT value FROM dest WHERE id = 1;
SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_multi_row_all_nulls
-- Source: insert_enhancements_comprehensive_tdd.rs:313
-- ============================================================================
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (NULL, NULL), (NULL, NULL);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING, age INT64);
INSERT INTO t (name, id) VALUES ('Alice', 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING, age INT64);
INSERT INTO t (id, name) VALUES (1, 'Bob');
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t (c, b, a) VALUES (3, 2, 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t (name, id) VALUES ('Alice', 1), ('Bob', 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64, y INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (10, 20);
INSERT INTO dest (b, a) SELECT x, y FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t DEFAULT VALUES;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, name STRING);
INSERT INTO source VALUES (1);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES ('not_a_number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2), (3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2, 3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64);
INSERT INTO t (a, b) VALUES (1, 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64);
INSERT INTO source VALUES (1);
INSERT INTO dest (a, b) SELECT x FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, NULL), (2, 20);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT id, name FROM t;
SELECT age FROM t;
SELECT a, b, c FROM t;
SELECT a, b FROM dest;
SELECT * FROM t;
SELECT value FROM dest WHERE id = 1;
SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_with_column_list_basic
-- Source: insert_enhancements_comprehensive_tdd.rs:332
-- ============================================================================
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING, age INT64);
INSERT INTO t (name, id) VALUES ('Alice', 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING, age INT64);
INSERT INTO t (id, name) VALUES (1, 'Bob');
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t (c, b, a) VALUES (3, 2, 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t (name, id) VALUES ('Alice', 1), ('Bob', 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64, y INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (10, 20);
INSERT INTO dest (b, a) SELECT x, y FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t DEFAULT VALUES;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, name STRING);
INSERT INTO source VALUES (1);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES ('not_a_number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2), (3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2, 3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64);
INSERT INTO t (a, b) VALUES (1, 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64);
INSERT INTO source VALUES (1);
INSERT INTO dest (a, b) SELECT x FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, NULL), (2, 20);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT id, name FROM t;
SELECT age FROM t;
SELECT a, b, c FROM t;
SELECT a, b FROM dest;
SELECT * FROM t;
SELECT value FROM dest WHERE id = 1;
SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_with_column_list_partial
-- Source: insert_enhancements_comprehensive_tdd.rs:355
-- ============================================================================
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING, age INT64);
INSERT INTO t (id, name) VALUES (1, 'Bob');
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t (c, b, a) VALUES (3, 2, 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t (name, id) VALUES ('Alice', 1), ('Bob', 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64, y INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (10, 20);
INSERT INTO dest (b, a) SELECT x, y FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t DEFAULT VALUES;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, name STRING);
INSERT INTO source VALUES (1);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES ('not_a_number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2), (3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2, 3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64);
INSERT INTO t (a, b) VALUES (1, 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64);
INSERT INTO source VALUES (1);
INSERT INTO dest (a, b) SELECT x FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, NULL), (2, 20);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT age FROM t;
SELECT a, b, c FROM t;
SELECT a, b FROM dest;
SELECT * FROM t;
SELECT value FROM dest WHERE id = 1;
SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_with_column_list_reordered
-- Source: insert_enhancements_comprehensive_tdd.rs:373
-- ============================================================================
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t (c, b, a) VALUES (3, 2, 1);
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t (name, id) VALUES ('Alice', 1), ('Bob', 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64, y INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (10, 20);
INSERT INTO dest (b, a) SELECT x, y FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t DEFAULT VALUES;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, name STRING);
INSERT INTO source VALUES (1);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES ('not_a_number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2), (3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2, 3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64);
INSERT INTO t (a, b) VALUES (1, 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64);
INSERT INTO source VALUES (1);
INSERT INTO dest (a, b) SELECT x FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, NULL), (2, 20);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT a, b, c FROM t;
SELECT a, b FROM dest;
SELECT * FROM t;
SELECT value FROM dest WHERE id = 1;
SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_with_column_list_multi_row
-- Source: insert_enhancements_comprehensive_tdd.rs:393
-- ============================================================================
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t (name, id) VALUES ('Alice', 1), ('Bob', 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64, y INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (10, 20);
INSERT INTO dest (b, a) SELECT x, y FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t DEFAULT VALUES;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, name STRING);
INSERT INTO source VALUES (1);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES ('not_a_number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2), (3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2, 3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64);
INSERT INTO t (a, b) VALUES (1, 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64);
INSERT INTO source VALUES (1);
INSERT INTO dest (a, b) SELECT x FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, NULL), (2, 20);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT a, b FROM dest;
SELECT * FROM t;
SELECT value FROM dest WHERE id = 1;
SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_with_column_list_select
-- Source: insert_enhancements_comprehensive_tdd.rs:413
-- ============================================================================
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64, y INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (10, 20);
INSERT INTO dest (b, a) SELECT x, y FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t DEFAULT VALUES;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, name STRING);
INSERT INTO source VALUES (1);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES ('not_a_number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2), (3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2, 3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64);
INSERT INTO t (a, b) VALUES (1, 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64);
INSERT INTO source VALUES (1);
INSERT INTO dest (a, b) SELECT x FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, NULL), (2, 20);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT a, b FROM dest;
SELECT * FROM t;
SELECT value FROM dest WHERE id = 1;
SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_default_values
-- Source: insert_enhancements_comprehensive_tdd.rs:443
-- ============================================================================
DROP TABLE IF EXISTS t;
CREATE TABLE t (id INT64, name STRING);
INSERT INTO t DEFAULT VALUES;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, name STRING);
INSERT INTO source VALUES (1);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES ('not_a_number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2), (3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2, 3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64);
INSERT INTO t (a, b) VALUES (1, 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64);
INSERT INTO source VALUES (1);
INSERT INTO dest (a, b) SELECT x FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, NULL), (2, 20);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT * FROM t;
SELECT value FROM dest WHERE id = 1;
SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_select_schema_mismatch_should_error
-- Source: insert_enhancements_comprehensive_tdd.rs:470
-- ============================================================================
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, name STRING);
INSERT INTO source VALUES (1);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES ('not_a_number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2), (3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2, 3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64);
INSERT INTO t (a, b) VALUES (1, 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64);
INSERT INTO source VALUES (1);
INSERT INTO dest (a, b) SELECT x FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, NULL), (2, 20);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT value FROM dest WHERE id = 1;
SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_select_type_mismatch_should_error
-- Source: insert_enhancements_comprehensive_tdd.rs:491
-- ============================================================================
DROP TABLE IF EXISTS source;
CREATE TABLE source (value STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES ('not_a_number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2), (3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2, 3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64);
INSERT INTO t (a, b) VALUES (1, 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64);
INSERT INTO source VALUES (1);
INSERT INTO dest (a, b) SELECT x FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, NULL), (2, 20);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT value FROM dest WHERE id = 1;
SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_multi_row_inconsistent_column_count_should_error
-- Source: insert_enhancements_comprehensive_tdd.rs:513
-- ============================================================================
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2), (3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2, 3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64);
INSERT INTO t (a, b) VALUES (1, 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64);
INSERT INTO source VALUES (1);
INSERT INTO dest (a, b) SELECT x FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, NULL), (2, 20);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT value FROM dest WHERE id = 1;
SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_wrong_column_count_should_error
-- Source: insert_enhancements_comprehensive_tdd.rs:527
-- ============================================================================
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t VALUES (1, 2, 3);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64);
INSERT INTO t (a, b) VALUES (1, 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64);
INSERT INTO source VALUES (1);
INSERT INTO dest (a, b) SELECT x FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, NULL), (2, 20);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT value FROM dest WHERE id = 1;
SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_with_column_list_duplicate_column_should_error
-- Source: insert_enhancements_comprehensive_tdd.rs:541
-- ============================================================================
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64);
INSERT INTO t (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64);
INSERT INTO t (a, b) VALUES (1, 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64);
INSERT INTO source VALUES (1);
INSERT INTO dest (a, b) SELECT x FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, NULL), (2, 20);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT value FROM dest WHERE id = 1;
SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_with_column_list_nonexistent_column_should_error
-- Source: insert_enhancements_comprehensive_tdd.rs:555
-- ============================================================================
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64);
INSERT INTO t (a, b) VALUES (1, 2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64);
INSERT INTO source VALUES (1);
INSERT INTO dest (a, b) SELECT x FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, NULL), (2, 20);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT value FROM dest WHERE id = 1;
SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_select_with_column_list_count_mismatch_should_error
-- Source: insert_enhancements_comprehensive_tdd.rs:567
-- ============================================================================
DROP TABLE IF EXISTS source;
CREATE TABLE source (x INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (a INT64, b INT64);
INSERT INTO source VALUES (1);
INSERT INTO dest (a, b) SELECT x FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, NULL), (2, 20);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT value FROM dest WHERE id = 1;
SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_select_preserves_nulls
-- Source: insert_enhancements_comprehensive_tdd.rs:592
-- ============================================================================
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO source VALUES (1, NULL), (2, 20);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT value FROM dest WHERE id = 1;
SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_multi_row_all_columns_nullable
-- Source: insert_enhancements_comprehensive_tdd.rs:618
-- ============================================================================
DROP TABLE IF EXISTS t;
CREATE TABLE t (a INT64, b INT64, c INT64);
INSERT INTO t VALUES (NULL, NULL, NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_select_with_type_coercion
-- Source: insert_enhancements_comprehensive_tdd.rs:642
-- ============================================================================
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value FLOAT64);
INSERT INTO source VALUES (42);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT value FROM dest;
SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_multi_row_with_mixed_numeric_types
-- Source: insert_enhancements_comprehensive_tdd.rs:672
-- ============================================================================
DROP TABLE IF EXISTS t;
CREATE TABLE t (value FLOAT64);
INSERT INTO t VALUES (42), (3.14), (100);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_select_with_order_by
-- Source: insert_enhancements_comprehensive_tdd.rs:697
-- ============================================================================
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (30), (10), (20);
INSERT INTO dest SELECT value FROM source ORDER BY value;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_select_with_limit
-- Source: insert_enhancements_comprehensive_tdd.rs:725
-- ============================================================================
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3), (4), (5);
INSERT INTO dest SELECT * FROM source LIMIT 2;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_select_from_subquery
-- Source: insert_enhancements_comprehensive_tdd.rs:753
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (total INT64);
INSERT INTO data VALUES (10), (20), (30);
INSERT INTO summary SELECT SUM(value) FROM (SELECT value FROM data WHERE value > 15) AS subq;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_select_very_large_dataset
-- Source: insert_enhancements_comprehensive_tdd.rs:784
-- ============================================================================
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, value INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_multi_row_maximum_batch_size
-- Source: insert_enhancements_comprehensive_tdd.rs:811
-- ============================================================================
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_with_int64_boundary_values
-- Source: insert_enhancements_comprehensive_tdd.rs:837
-- ============================================================================
DROP TABLE IF EXISTS test;
CREATE TABLE test (value INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT value FROM test ORDER BY value;
SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_with_empty_string_values
-- Source: insert_enhancements_comprehensive_tdd.rs:865
-- ============================================================================
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, text STRING);
INSERT INTO test VALUES (1, ''), (2, 'not empty'), (3, '');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_select_with_zero_rows
-- Source: insert_enhancements_comprehensive_tdd.rs:882
-- ============================================================================
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO source VALUES (1), (2), (3);
INSERT INTO dest SELECT * FROM source WHERE 1 = 0;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_select_with_self_reference
-- Source: insert_enhancements_comprehensive_tdd.rs:915
-- ============================================================================
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 100), (2, 200);
INSERT INTO test SELECT id + 10, value * 2 FROM test WHERE id <= 2;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_multi_row_with_expressions_in_values
-- Source: insert_enhancements_comprehensive_tdd.rs:936
-- ============================================================================
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, computed INT64);
INSERT INTO test VALUES (1, 5 + 5), (2, 10 * 2), (3, 100 - 40);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT computed FROM test ORDER BY id;
SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_with_column_list_and_computed_values
-- Source: insert_enhancements_comprehensive_tdd.rs:959
-- ============================================================================
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64, z INT64);
INSERT INTO source VALUES (5, 10);
INSERT INTO dest (y, x) SELECT a + b, a * b FROM source;
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT x, y, z FROM dest;
SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_select_with_union
-- Source: insert_enhancements_comprehensive_tdd.rs:993
-- ============================================================================
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
INSERT INTO table1 VALUES (1), (2);
INSERT INTO table2 VALUES (3), (4);
INSERT INTO dest SELECT id FROM table1 UNION SELECT id FROM table2;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_insert_select_with_cte
-- Source: insert_enhancements_comprehensive_tdd.rs:1028
-- ============================================================================
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result INT64);
INSERT INTO source VALUES (10), (20), (30);
INSERT INTO dest WITH doubled AS (SELECT value * 2 AS v FROM source) SELECT v FROM doubled;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b STRING, c FLOAT64);
INSERT INTO test VALUES (NULL, NULL, NULL), (1, 'x', 1.5);
DROP TABLE IF EXISTS source;
CREATE TABLE source (score INT64);
DROP TABLE IF EXISTS graded;
CREATE TABLE graded (grade STRING);
INSERT INTO source VALUES (95), (75), (55);
INSERT INTO graded SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 70 THEN 'B' ELSE 'C' END FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (name STRING);
DROP TABLE IF EXISTS processed;
CREATE TABLE processed (upper_name STRING, len INT64);
INSERT INTO source VALUES ('alice'), ('bob'), ('charlie');
INSERT INTO processed SELECT UPPER(name), LENGTH(name) FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, safe_value INT64);
INSERT INTO source VALUES (1, 100), (2, NULL), (3, 300);
INSERT INTO dest SELECT id, CASE WHEN value IS NULL THEN 0 ELSE value END FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (value FLOAT64);
INSERT INTO test VALUES (1.0), (-1.0), (0.0);
DROP TABLE IF EXISTS source;
CREATE TABLE source (value INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value INT64);
INSERT INTO source VALUES (1), (2), (2), (3), (3), (3);
INSERT INTO dest SELECT DISTINCT value FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, name STRING, age INT64, active BOOL);
INSERT INTO test (id, name) VALUES (1, 'Alice'), (2, 'Bob');
INSERT INTO nonexistent VALUES (1);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (x INT64, y INT64);
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (text STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (num INT64);
INSERT INTO source VALUES ('not a number');
INSERT INTO dest SELECT * FROM source;
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test VALUES (1, 2), (3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64, c INT64);
INSERT INTO test (a, b) VALUES (1, 2, 3);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, z) VALUES (1, 2);
DROP TABLE IF EXISTS test;
CREATE TABLE test (a INT64, b INT64);
INSERT INTO test (a, a) VALUES (1, 2);
DROP TABLE IF EXISTS raw_events;
CREATE TABLE raw_events ( event_id INT64, event_type STRING, value INT64, timestamp INT64 );
DROP TABLE IF EXISTS processed_events;
CREATE TABLE processed_events ( id INT64, category STRING, amount INT64 );
INSERT INTO raw_events VALUES (1, 'purchase', 100, 1000), (2, 'refund', -50, 1001), (3, 'purchase', 200, 1002);
INSERT INTO processed_events SELECT event_id, UPPER(event_type), value FROM raw_events WHERE event_type = 'purchase' AND value > 0;
DROP TABLE IF EXISTS users_old;
CREATE TABLE users_old ( user_id INT64, first_name STRING, last_name STRING );
DROP TABLE IF EXISTS users_new;
CREATE TABLE users_new ( id INT64, full_name STRING );
INSERT INTO users_old VALUES (1, 'John', 'Doe'), (2, 'Jane', 'Smith');
INSERT INTO users_new SELECT user_id, CONCAT(first_name, ' ', last_name) FROM users_old;
DROP TABLE IF EXISTS products;
CREATE TABLE products ( id INT64, name STRING, price FLOAT64, in_stock BOOL );
INSERT INTO products VALUES (1, 'Widget', 19.99, true), (2, 'Gadget', 29.99, true), (3, 'Doohickey', 9.99, false), (4, 'Thingamajig', 39.99, true);
DROP TABLE IF EXISTS staging;
CREATE TABLE staging (id INT64, version INT64, data STRING);
DROP TABLE IF EXISTS production;
CREATE TABLE production (id INT64, version INT64, data STRING);
INSERT INTO production VALUES (1, 1, 'v1'), (2, 1, 'v1');
INSERT INTO staging VALUES (1, 2, 'v2'), (2, 1, 'v1'), (3, 1, 'new');
INSERT INTO production SELECT s.id, s.version, s.data FROM staging s WHERE NOT EXISTS ( SELECT 1 FROM production p WHERE p.id = s.id AND p.version >= s.version );
DROP TABLE IF EXISTS config;
CREATE TABLE config ( key STRING, value STRING, updated_at INT64 );
INSERT INTO config VALUES ('theme', 'dark', 1000);
INSERT INTO config (key, value) VALUES ('language', 'en');

SELECT result FROM dest ORDER BY result;
SELECT * FROM test;
SELECT grade FROM graded ORDER BY grade;
SELECT age, active FROM test WHERE id = 1;
SELECT updated_at FROM config WHERE key = 'language';

-- ============================================================================
-- Test: test_tablesample_system_basic
-- Source: tablesample_comprehensive_tdd.rs:84
-- ============================================================================
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
INSERT INTO data VALUES (1), (2), (3), (4), (5);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
INSERT INTO data VALUES (1), (2), (3), (4), (5);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS small;
CREATE TABLE small (id INT64);
INSERT INTO small VALUES (1), (2), (3), (4), (5), (6), (7), (8), (9), (10);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, category STRING);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (customer_id INT64, name STRING);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (product STRING, amount INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
DROP TABLE IF EXISTS empty_table;
CREATE TABLE empty_table (id INT64);
DROP TABLE IF EXISTS single;
CREATE TABLE single (id INT64);
INSERT INTO single VALUES (1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS large;
CREATE TABLE large (id INT64, data STRING);

SELECT * FROM large_table TABLESAMPLE SYSTEM (10);
SELECT * FROM data TABLESAMPLE SYSTEM (0);
SELECT * FROM data TABLESAMPLE SYSTEM (100);
SELECT * FROM data TABLESAMPLE BERNOULLI (10);
SELECT * FROM small TABLESAMPLE BERNOULLI (50);
SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (42) ORDER BY id;
SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (42) ORDER BY id;
SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (42) ORDER BY id;
SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (123) ORDER BY id;
SELECT * FROM data TABLESAMPLE SYSTEM (10) WHERE category = 'even';
SELECT c.name, COUNT(*) as order_count FROM orders TABLESAMPLE SYSTEM (10) o JOIN customers c ON o.customer_id = c.customer_id GROUP BY c.name;
SELECT product, COUNT(*) as sample_count FROM sales TABLESAMPLE BERNOULLI (10) GROUP BY product ORDER BY product;
SELECT * FROM data TABLESAMPLE SYSTEM (20) ORDER BY value DESC LIMIT 5;
SELECT * FROM empty_table TABLESAMPLE SYSTEM (50);
SELECT * FROM single TABLESAMPLE BERNOULLI (100) REPEATABLE (42);
SELECT * FROM data TABLESAMPLE SYSTEM (-10);
SELECT * FROM data TABLESAMPLE SYSTEM (150);
SELECT * FROM data TABLESAMPLE INVALID (10);
WITH sample AS ( SELECT * FROM data TABLESAMPLE SYSTEM (10) REPEATABLE (42) ) SELECT COUNT(*) FROM sample;
SELECT id FROM table1 TABLESAMPLE SYSTEM (20) REPEATABLE (1) UNION ALL SELECT id FROM table2 TABLESAMPLE SYSTEM (20) REPEATABLE (2);
SELECT COUNT(*) FROM large TABLESAMPLE SYSTEM (1);

-- ============================================================================
-- Test: test_tablesample_system_zero_percent
-- Source: tablesample_comprehensive_tdd.rs:124
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
INSERT INTO data VALUES (1), (2), (3), (4), (5);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
INSERT INTO data VALUES (1), (2), (3), (4), (5);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS small;
CREATE TABLE small (id INT64);
INSERT INTO small VALUES (1), (2), (3), (4), (5), (6), (7), (8), (9), (10);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, category STRING);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (customer_id INT64, name STRING);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (product STRING, amount INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
DROP TABLE IF EXISTS empty_table;
CREATE TABLE empty_table (id INT64);
DROP TABLE IF EXISTS single;
CREATE TABLE single (id INT64);
INSERT INTO single VALUES (1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS large;
CREATE TABLE large (id INT64, data STRING);

SELECT * FROM data TABLESAMPLE SYSTEM (0);
SELECT * FROM data TABLESAMPLE SYSTEM (100);
SELECT * FROM data TABLESAMPLE BERNOULLI (10);
SELECT * FROM small TABLESAMPLE BERNOULLI (50);
SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (42) ORDER BY id;
SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (42) ORDER BY id;
SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (42) ORDER BY id;
SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (123) ORDER BY id;
SELECT * FROM data TABLESAMPLE SYSTEM (10) WHERE category = 'even';
SELECT c.name, COUNT(*) as order_count FROM orders TABLESAMPLE SYSTEM (10) o JOIN customers c ON o.customer_id = c.customer_id GROUP BY c.name;
SELECT product, COUNT(*) as sample_count FROM sales TABLESAMPLE BERNOULLI (10) GROUP BY product ORDER BY product;
SELECT * FROM data TABLESAMPLE SYSTEM (20) ORDER BY value DESC LIMIT 5;
SELECT * FROM empty_table TABLESAMPLE SYSTEM (50);
SELECT * FROM single TABLESAMPLE BERNOULLI (100) REPEATABLE (42);
SELECT * FROM data TABLESAMPLE SYSTEM (-10);
SELECT * FROM data TABLESAMPLE SYSTEM (150);
SELECT * FROM data TABLESAMPLE INVALID (10);
WITH sample AS ( SELECT * FROM data TABLESAMPLE SYSTEM (10) REPEATABLE (42) ) SELECT COUNT(*) FROM sample;
SELECT id FROM table1 TABLESAMPLE SYSTEM (20) REPEATABLE (1) UNION ALL SELECT id FROM table2 TABLESAMPLE SYSTEM (20) REPEATABLE (2);
SELECT COUNT(*) FROM large TABLESAMPLE SYSTEM (1);

-- ============================================================================
-- Test: test_tablesample_system_hundred_percent
-- Source: tablesample_comprehensive_tdd.rs:148
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
INSERT INTO data VALUES (1), (2), (3), (4), (5);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS small;
CREATE TABLE small (id INT64);
INSERT INTO small VALUES (1), (2), (3), (4), (5), (6), (7), (8), (9), (10);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, category STRING);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (customer_id INT64, name STRING);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (product STRING, amount INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
DROP TABLE IF EXISTS empty_table;
CREATE TABLE empty_table (id INT64);
DROP TABLE IF EXISTS single;
CREATE TABLE single (id INT64);
INSERT INTO single VALUES (1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS large;
CREATE TABLE large (id INT64, data STRING);

SELECT * FROM data TABLESAMPLE SYSTEM (100);
SELECT * FROM data TABLESAMPLE BERNOULLI (10);
SELECT * FROM small TABLESAMPLE BERNOULLI (50);
SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (42) ORDER BY id;
SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (42) ORDER BY id;
SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (42) ORDER BY id;
SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (123) ORDER BY id;
SELECT * FROM data TABLESAMPLE SYSTEM (10) WHERE category = 'even';
SELECT c.name, COUNT(*) as order_count FROM orders TABLESAMPLE SYSTEM (10) o JOIN customers c ON o.customer_id = c.customer_id GROUP BY c.name;
SELECT product, COUNT(*) as sample_count FROM sales TABLESAMPLE BERNOULLI (10) GROUP BY product ORDER BY product;
SELECT * FROM data TABLESAMPLE SYSTEM (20) ORDER BY value DESC LIMIT 5;
SELECT * FROM empty_table TABLESAMPLE SYSTEM (50);
SELECT * FROM single TABLESAMPLE BERNOULLI (100) REPEATABLE (42);
SELECT * FROM data TABLESAMPLE SYSTEM (-10);
SELECT * FROM data TABLESAMPLE SYSTEM (150);
SELECT * FROM data TABLESAMPLE INVALID (10);
WITH sample AS ( SELECT * FROM data TABLESAMPLE SYSTEM (10) REPEATABLE (42) ) SELECT COUNT(*) FROM sample;
SELECT id FROM table1 TABLESAMPLE SYSTEM (20) REPEATABLE (1) UNION ALL SELECT id FROM table2 TABLESAMPLE SYSTEM (20) REPEATABLE (2);
SELECT COUNT(*) FROM large TABLESAMPLE SYSTEM (1);

-- ============================================================================
-- Test: test_tablesample_bernoulli_basic
-- Source: tablesample_comprehensive_tdd.rs:176
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS small;
CREATE TABLE small (id INT64);
INSERT INTO small VALUES (1), (2), (3), (4), (5), (6), (7), (8), (9), (10);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, category STRING);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (customer_id INT64, name STRING);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (product STRING, amount INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
DROP TABLE IF EXISTS empty_table;
CREATE TABLE empty_table (id INT64);
DROP TABLE IF EXISTS single;
CREATE TABLE single (id INT64);
INSERT INTO single VALUES (1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS large;
CREATE TABLE large (id INT64, data STRING);

SELECT * FROM data TABLESAMPLE BERNOULLI (10);
SELECT * FROM small TABLESAMPLE BERNOULLI (50);
SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (42) ORDER BY id;
SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (42) ORDER BY id;
SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (42) ORDER BY id;
SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (123) ORDER BY id;
SELECT * FROM data TABLESAMPLE SYSTEM (10) WHERE category = 'even';
SELECT c.name, COUNT(*) as order_count FROM orders TABLESAMPLE SYSTEM (10) o JOIN customers c ON o.customer_id = c.customer_id GROUP BY c.name;
SELECT product, COUNT(*) as sample_count FROM sales TABLESAMPLE BERNOULLI (10) GROUP BY product ORDER BY product;
SELECT * FROM data TABLESAMPLE SYSTEM (20) ORDER BY value DESC LIMIT 5;
SELECT * FROM empty_table TABLESAMPLE SYSTEM (50);
SELECT * FROM single TABLESAMPLE BERNOULLI (100) REPEATABLE (42);
SELECT * FROM data TABLESAMPLE SYSTEM (-10);
SELECT * FROM data TABLESAMPLE SYSTEM (150);
SELECT * FROM data TABLESAMPLE INVALID (10);
WITH sample AS ( SELECT * FROM data TABLESAMPLE SYSTEM (10) REPEATABLE (42) ) SELECT COUNT(*) FROM sample;
SELECT id FROM table1 TABLESAMPLE SYSTEM (20) REPEATABLE (1) UNION ALL SELECT id FROM table2 TABLESAMPLE SYSTEM (20) REPEATABLE (2);
SELECT COUNT(*) FROM large TABLESAMPLE SYSTEM (1);

-- ============================================================================
-- Test: test_tablesample_bernoulli_small_table
-- Source: tablesample_comprehensive_tdd.rs:213
-- ============================================================================
DROP TABLE IF EXISTS small;
CREATE TABLE small (id INT64);
INSERT INTO small VALUES (1), (2), (3), (4), (5), (6), (7), (8), (9), (10);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, category STRING);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (customer_id INT64, name STRING);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (product STRING, amount INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
DROP TABLE IF EXISTS empty_table;
CREATE TABLE empty_table (id INT64);
DROP TABLE IF EXISTS single;
CREATE TABLE single (id INT64);
INSERT INTO single VALUES (1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS large;
CREATE TABLE large (id INT64, data STRING);

SELECT * FROM small TABLESAMPLE BERNOULLI (50);
SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (42) ORDER BY id;
SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (42) ORDER BY id;
SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (42) ORDER BY id;
SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (123) ORDER BY id;
SELECT * FROM data TABLESAMPLE SYSTEM (10) WHERE category = 'even';
SELECT c.name, COUNT(*) as order_count FROM orders TABLESAMPLE SYSTEM (10) o JOIN customers c ON o.customer_id = c.customer_id GROUP BY c.name;
SELECT product, COUNT(*) as sample_count FROM sales TABLESAMPLE BERNOULLI (10) GROUP BY product ORDER BY product;
SELECT * FROM data TABLESAMPLE SYSTEM (20) ORDER BY value DESC LIMIT 5;
SELECT * FROM empty_table TABLESAMPLE SYSTEM (50);
SELECT * FROM single TABLESAMPLE BERNOULLI (100) REPEATABLE (42);
SELECT * FROM data TABLESAMPLE SYSTEM (-10);
SELECT * FROM data TABLESAMPLE SYSTEM (150);
SELECT * FROM data TABLESAMPLE INVALID (10);
WITH sample AS ( SELECT * FROM data TABLESAMPLE SYSTEM (10) REPEATABLE (42) ) SELECT COUNT(*) FROM sample;
SELECT id FROM table1 TABLESAMPLE SYSTEM (20) REPEATABLE (1) UNION ALL SELECT id FROM table2 TABLESAMPLE SYSTEM (20) REPEATABLE (2);
SELECT COUNT(*) FROM large TABLESAMPLE SYSTEM (1);

-- ============================================================================
-- Test: test_tablesample_repeatable_deterministic
-- Source: tablesample_comprehensive_tdd.rs:249
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, category STRING);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (customer_id INT64, name STRING);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (product STRING, amount INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
DROP TABLE IF EXISTS empty_table;
CREATE TABLE empty_table (id INT64);
DROP TABLE IF EXISTS single;
CREATE TABLE single (id INT64);
INSERT INTO single VALUES (1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS large;
CREATE TABLE large (id INT64, data STRING);

SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (42) ORDER BY id;
SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (42) ORDER BY id;
SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (42) ORDER BY id;
SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (123) ORDER BY id;
SELECT * FROM data TABLESAMPLE SYSTEM (10) WHERE category = 'even';
SELECT c.name, COUNT(*) as order_count FROM orders TABLESAMPLE SYSTEM (10) o JOIN customers c ON o.customer_id = c.customer_id GROUP BY c.name;
SELECT product, COUNT(*) as sample_count FROM sales TABLESAMPLE BERNOULLI (10) GROUP BY product ORDER BY product;
SELECT * FROM data TABLESAMPLE SYSTEM (20) ORDER BY value DESC LIMIT 5;
SELECT * FROM empty_table TABLESAMPLE SYSTEM (50);
SELECT * FROM single TABLESAMPLE BERNOULLI (100) REPEATABLE (42);
SELECT * FROM data TABLESAMPLE SYSTEM (-10);
SELECT * FROM data TABLESAMPLE SYSTEM (150);
SELECT * FROM data TABLESAMPLE INVALID (10);
WITH sample AS ( SELECT * FROM data TABLESAMPLE SYSTEM (10) REPEATABLE (42) ) SELECT COUNT(*) FROM sample;
SELECT id FROM table1 TABLESAMPLE SYSTEM (20) REPEATABLE (1) UNION ALL SELECT id FROM table2 TABLESAMPLE SYSTEM (20) REPEATABLE (2);
SELECT COUNT(*) FROM large TABLESAMPLE SYSTEM (1);

-- ============================================================================
-- Test: test_tablesample_repeatable_different_seeds
-- Source: tablesample_comprehensive_tdd.rs:299
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, category STRING);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (customer_id INT64, name STRING);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (product STRING, amount INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
DROP TABLE IF EXISTS empty_table;
CREATE TABLE empty_table (id INT64);
DROP TABLE IF EXISTS single;
CREATE TABLE single (id INT64);
INSERT INTO single VALUES (1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS large;
CREATE TABLE large (id INT64, data STRING);

SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (42) ORDER BY id;
SELECT id FROM data TABLESAMPLE SYSTEM (20) REPEATABLE (123) ORDER BY id;
SELECT * FROM data TABLESAMPLE SYSTEM (10) WHERE category = 'even';
SELECT c.name, COUNT(*) as order_count FROM orders TABLESAMPLE SYSTEM (10) o JOIN customers c ON o.customer_id = c.customer_id GROUP BY c.name;
SELECT product, COUNT(*) as sample_count FROM sales TABLESAMPLE BERNOULLI (10) GROUP BY product ORDER BY product;
SELECT * FROM data TABLESAMPLE SYSTEM (20) ORDER BY value DESC LIMIT 5;
SELECT * FROM empty_table TABLESAMPLE SYSTEM (50);
SELECT * FROM single TABLESAMPLE BERNOULLI (100) REPEATABLE (42);
SELECT * FROM data TABLESAMPLE SYSTEM (-10);
SELECT * FROM data TABLESAMPLE SYSTEM (150);
SELECT * FROM data TABLESAMPLE INVALID (10);
WITH sample AS ( SELECT * FROM data TABLESAMPLE SYSTEM (10) REPEATABLE (42) ) SELECT COUNT(*) FROM sample;
SELECT id FROM table1 TABLESAMPLE SYSTEM (20) REPEATABLE (1) UNION ALL SELECT id FROM table2 TABLESAMPLE SYSTEM (20) REPEATABLE (2);
SELECT COUNT(*) FROM large TABLESAMPLE SYSTEM (1);

-- ============================================================================
-- Test: test_tablesample_with_where_clause
-- Source: tablesample_comprehensive_tdd.rs:356
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, category STRING);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (customer_id INT64, name STRING);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (product STRING, amount INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
DROP TABLE IF EXISTS empty_table;
CREATE TABLE empty_table (id INT64);
DROP TABLE IF EXISTS single;
CREATE TABLE single (id INT64);
INSERT INTO single VALUES (1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS large;
CREATE TABLE large (id INT64, data STRING);

SELECT * FROM data TABLESAMPLE SYSTEM (10) WHERE category = 'even';
SELECT c.name, COUNT(*) as order_count FROM orders TABLESAMPLE SYSTEM (10) o JOIN customers c ON o.customer_id = c.customer_id GROUP BY c.name;
SELECT product, COUNT(*) as sample_count FROM sales TABLESAMPLE BERNOULLI (10) GROUP BY product ORDER BY product;
SELECT * FROM data TABLESAMPLE SYSTEM (20) ORDER BY value DESC LIMIT 5;
SELECT * FROM empty_table TABLESAMPLE SYSTEM (50);
SELECT * FROM single TABLESAMPLE BERNOULLI (100) REPEATABLE (42);
SELECT * FROM data TABLESAMPLE SYSTEM (-10);
SELECT * FROM data TABLESAMPLE SYSTEM (150);
SELECT * FROM data TABLESAMPLE INVALID (10);
WITH sample AS ( SELECT * FROM data TABLESAMPLE SYSTEM (10) REPEATABLE (42) ) SELECT COUNT(*) FROM sample;
SELECT id FROM table1 TABLESAMPLE SYSTEM (20) REPEATABLE (1) UNION ALL SELECT id FROM table2 TABLESAMPLE SYSTEM (20) REPEATABLE (2);
SELECT COUNT(*) FROM large TABLESAMPLE SYSTEM (1);

-- ============================================================================
-- Test: test_tablesample_with_join
-- Source: tablesample_comprehensive_tdd.rs:401
-- ============================================================================
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (customer_id INT64, name STRING);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (product STRING, amount INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
DROP TABLE IF EXISTS empty_table;
CREATE TABLE empty_table (id INT64);
DROP TABLE IF EXISTS single;
CREATE TABLE single (id INT64);
INSERT INTO single VALUES (1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS large;
CREATE TABLE large (id INT64, data STRING);

SELECT c.name, COUNT(*) as order_count FROM orders TABLESAMPLE SYSTEM (10) o JOIN customers c ON o.customer_id = c.customer_id GROUP BY c.name;
SELECT product, COUNT(*) as sample_count FROM sales TABLESAMPLE BERNOULLI (10) GROUP BY product ORDER BY product;
SELECT * FROM data TABLESAMPLE SYSTEM (20) ORDER BY value DESC LIMIT 5;
SELECT * FROM empty_table TABLESAMPLE SYSTEM (50);
SELECT * FROM single TABLESAMPLE BERNOULLI (100) REPEATABLE (42);
SELECT * FROM data TABLESAMPLE SYSTEM (-10);
SELECT * FROM data TABLESAMPLE SYSTEM (150);
SELECT * FROM data TABLESAMPLE INVALID (10);
WITH sample AS ( SELECT * FROM data TABLESAMPLE SYSTEM (10) REPEATABLE (42) ) SELECT COUNT(*) FROM sample;
SELECT id FROM table1 TABLESAMPLE SYSTEM (20) REPEATABLE (1) UNION ALL SELECT id FROM table2 TABLESAMPLE SYSTEM (20) REPEATABLE (2);
SELECT COUNT(*) FROM large TABLESAMPLE SYSTEM (1);

-- ============================================================================
-- Test: test_tablesample_with_aggregation
-- Source: tablesample_comprehensive_tdd.rs:454
-- ============================================================================
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (product STRING, amount INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
DROP TABLE IF EXISTS empty_table;
CREATE TABLE empty_table (id INT64);
DROP TABLE IF EXISTS single;
CREATE TABLE single (id INT64);
INSERT INTO single VALUES (1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS large;
CREATE TABLE large (id INT64, data STRING);

SELECT product, COUNT(*) as sample_count FROM sales TABLESAMPLE BERNOULLI (10) GROUP BY product ORDER BY product;
SELECT * FROM data TABLESAMPLE SYSTEM (20) ORDER BY value DESC LIMIT 5;
SELECT * FROM empty_table TABLESAMPLE SYSTEM (50);
SELECT * FROM single TABLESAMPLE BERNOULLI (100) REPEATABLE (42);
SELECT * FROM data TABLESAMPLE SYSTEM (-10);
SELECT * FROM data TABLESAMPLE SYSTEM (150);
SELECT * FROM data TABLESAMPLE INVALID (10);
WITH sample AS ( SELECT * FROM data TABLESAMPLE SYSTEM (10) REPEATABLE (42) ) SELECT COUNT(*) FROM sample;
SELECT id FROM table1 TABLESAMPLE SYSTEM (20) REPEATABLE (1) UNION ALL SELECT id FROM table2 TABLESAMPLE SYSTEM (20) REPEATABLE (2);
SELECT COUNT(*) FROM large TABLESAMPLE SYSTEM (1);

-- ============================================================================
-- Test: test_tablesample_with_order_by_limit
-- Source: tablesample_comprehensive_tdd.rs:513
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
DROP TABLE IF EXISTS empty_table;
CREATE TABLE empty_table (id INT64);
DROP TABLE IF EXISTS single;
CREATE TABLE single (id INT64);
INSERT INTO single VALUES (1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS large;
CREATE TABLE large (id INT64, data STRING);

SELECT * FROM data TABLESAMPLE SYSTEM (20) ORDER BY value DESC LIMIT 5;
SELECT * FROM empty_table TABLESAMPLE SYSTEM (50);
SELECT * FROM single TABLESAMPLE BERNOULLI (100) REPEATABLE (42);
SELECT * FROM data TABLESAMPLE SYSTEM (-10);
SELECT * FROM data TABLESAMPLE SYSTEM (150);
SELECT * FROM data TABLESAMPLE INVALID (10);
WITH sample AS ( SELECT * FROM data TABLESAMPLE SYSTEM (10) REPEATABLE (42) ) SELECT COUNT(*) FROM sample;
SELECT id FROM table1 TABLESAMPLE SYSTEM (20) REPEATABLE (1) UNION ALL SELECT id FROM table2 TABLESAMPLE SYSTEM (20) REPEATABLE (2);
SELECT COUNT(*) FROM large TABLESAMPLE SYSTEM (1);

-- ============================================================================
-- Test: test_tablesample_empty_table
-- Source: tablesample_comprehensive_tdd.rs:560
-- ============================================================================
DROP TABLE IF EXISTS empty_table;
CREATE TABLE empty_table (id INT64);
DROP TABLE IF EXISTS single;
CREATE TABLE single (id INT64);
INSERT INTO single VALUES (1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS large;
CREATE TABLE large (id INT64, data STRING);

SELECT * FROM empty_table TABLESAMPLE SYSTEM (50);
SELECT * FROM single TABLESAMPLE BERNOULLI (100) REPEATABLE (42);
SELECT * FROM data TABLESAMPLE SYSTEM (-10);
SELECT * FROM data TABLESAMPLE SYSTEM (150);
SELECT * FROM data TABLESAMPLE INVALID (10);
WITH sample AS ( SELECT * FROM data TABLESAMPLE SYSTEM (10) REPEATABLE (42) ) SELECT COUNT(*) FROM sample;
SELECT id FROM table1 TABLESAMPLE SYSTEM (20) REPEATABLE (1) UNION ALL SELECT id FROM table2 TABLESAMPLE SYSTEM (20) REPEATABLE (2);
SELECT COUNT(*) FROM large TABLESAMPLE SYSTEM (1);

-- ============================================================================
-- Test: test_tablesample_single_row
-- Source: tablesample_comprehensive_tdd.rs:581
-- ============================================================================
DROP TABLE IF EXISTS single;
CREATE TABLE single (id INT64);
INSERT INTO single VALUES (1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS large;
CREATE TABLE large (id INT64, data STRING);

SELECT * FROM single TABLESAMPLE BERNOULLI (100) REPEATABLE (42);
SELECT * FROM data TABLESAMPLE SYSTEM (-10);
SELECT * FROM data TABLESAMPLE SYSTEM (150);
SELECT * FROM data TABLESAMPLE INVALID (10);
WITH sample AS ( SELECT * FROM data TABLESAMPLE SYSTEM (10) REPEATABLE (42) ) SELECT COUNT(*) FROM sample;
SELECT id FROM table1 TABLESAMPLE SYSTEM (20) REPEATABLE (1) UNION ALL SELECT id FROM table2 TABLESAMPLE SYSTEM (20) REPEATABLE (2);
SELECT COUNT(*) FROM large TABLESAMPLE SYSTEM (1);

-- ============================================================================
-- Test: test_tablesample_error_negative_percentage
-- Source: tablesample_comprehensive_tdd.rs:611
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS large;
CREATE TABLE large (id INT64, data STRING);

SELECT * FROM data TABLESAMPLE SYSTEM (-10);
SELECT * FROM data TABLESAMPLE SYSTEM (150);
SELECT * FROM data TABLESAMPLE INVALID (10);
WITH sample AS ( SELECT * FROM data TABLESAMPLE SYSTEM (10) REPEATABLE (42) ) SELECT COUNT(*) FROM sample;
SELECT id FROM table1 TABLESAMPLE SYSTEM (20) REPEATABLE (1) UNION ALL SELECT id FROM table2 TABLESAMPLE SYSTEM (20) REPEATABLE (2);
SELECT COUNT(*) FROM large TABLESAMPLE SYSTEM (1);

-- ============================================================================
-- Test: test_tablesample_error_percentage_over_100
-- Source: tablesample_comprehensive_tdd.rs:634
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS large;
CREATE TABLE large (id INT64, data STRING);

SELECT * FROM data TABLESAMPLE SYSTEM (150);
SELECT * FROM data TABLESAMPLE INVALID (10);
WITH sample AS ( SELECT * FROM data TABLESAMPLE SYSTEM (10) REPEATABLE (42) ) SELECT COUNT(*) FROM sample;
SELECT id FROM table1 TABLESAMPLE SYSTEM (20) REPEATABLE (1) UNION ALL SELECT id FROM table2 TABLESAMPLE SYSTEM (20) REPEATABLE (2);
SELECT COUNT(*) FROM large TABLESAMPLE SYSTEM (1);

-- ============================================================================
-- Test: test_tablesample_error_invalid_method
-- Source: tablesample_comprehensive_tdd.rs:657
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS large;
CREATE TABLE large (id INT64, data STRING);

SELECT * FROM data TABLESAMPLE INVALID (10);
WITH sample AS ( SELECT * FROM data TABLESAMPLE SYSTEM (10) REPEATABLE (42) ) SELECT COUNT(*) FROM sample;
SELECT id FROM table1 TABLESAMPLE SYSTEM (20) REPEATABLE (1) UNION ALL SELECT id FROM table2 TABLESAMPLE SYSTEM (20) REPEATABLE (2);
SELECT COUNT(*) FROM large TABLESAMPLE SYSTEM (1);

-- ============================================================================
-- Test: test_tablesample_with_cte
-- Source: tablesample_comprehensive_tdd.rs:684
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64);
DROP TABLE IF EXISTS large;
CREATE TABLE large (id INT64, data STRING);

WITH sample AS ( SELECT * FROM data TABLESAMPLE SYSTEM (10) REPEATABLE (42) ) SELECT COUNT(*) FROM sample;
SELECT id FROM table1 TABLESAMPLE SYSTEM (20) REPEATABLE (1) UNION ALL SELECT id FROM table2 TABLESAMPLE SYSTEM (20) REPEATABLE (2);
SELECT COUNT(*) FROM large TABLESAMPLE SYSTEM (1);
