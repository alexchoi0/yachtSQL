-- ============================================================================
-- Joins - PostgreSQL 18
-- ============================================================================
-- Source: Migrated from delete_enhancements_advanced_tdd.rs, delete_enhancements_tdd.rs, merge_statement_comprehensive_tdd.rs, p1_features_error_handling_stress_tdd.rs, p1_features_integration_comprehensive_tdd.rs, similar_to_operator_comprehensive_tdd.rs, update_enhancements_advanced_tdd.rs, update_enhancements_tdd.rs
-- Description: JOIN operations including INNER, LEFT, RIGHT, FULL, and CROSS joins
--
-- PostgreSQL: Full support
-- BigQuery: Limited or no support
-- SQL Standard: PostgreSQL 18 specific
-- ============================================================================

DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING, price FLOAT64);
INSERT INTO products VALUES (1, 'Widget', 100.0), (2, 'Gadget', 200.0), (3, 'Gizmo', 300.0);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, name STRING, salary FLOAT64);
INSERT INTO employees VALUES (1, 'Alice', 50000.0), (2, 'Bob', 60000.0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING, price FLOAT64);
INSERT INTO products VALUES (1, 'Widget', 100.0), (2, 'Gadget', 200.0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 100.0);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category_id INT64, name STRING);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, deprecated BOOL);
INSERT INTO items VALUES (1, 1, 'Item1'), (2, 2, 'Item2'), (3, 1, 'Item3');
INSERT INTO categories VALUES (1, TRUE), (2, FALSE);
DROP TABLE IF EXISTS active_orders;
CREATE TABLE active_orders (id INT64, total FLOAT64, created_at INT64);
DROP TABLE IF EXISTS archived_orders;
CREATE TABLE archived_orders (id INT64, total FLOAT64, created_at INT64, deleted_at INT64);
INSERT INTO active_orders VALUES (1, 100.0, 1000), (2, 200.0, 2000);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, customer_id INT64);
DROP TABLE IF EXISTS order_items;
CREATE TABLE order_items (order_id INT64, product_id INT64);
INSERT INTO orders VALUES (1, 1), (2, 2);
INSERT INTO order_items VALUES (1, 100), (1, 200), (2, 300);
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id));
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1);
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees ( id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id) ON DELETE CASCADE );
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1), (2, 1);
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees ( id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id) ON DELETE SET NULL );
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1), (2, 1);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 10.0), (2, 50.0), (3, 100.0), (4, 25.0);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, product_id INT64, amount FLOAT64);
INSERT INTO sales VALUES (1, 1, 100.0), (2, 1, 200.0), (3, 2, 150.0), (4, 2, 300.0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (product_id INT64);
INSERT INTO products VALUES (1, 'Popular'), (2, 'Unpopular'), (3, 'Popular2');
INSERT INTO orders VALUES (1), (1), (3);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept STRING);
DROP TABLE IF EXISTS closed_depts;
CREATE TABLE closed_depts (name STRING);
INSERT INTO employees VALUES (1, 'Sales'), (2, 'Engineering'), (3, 'Marketing');
INSERT INTO closed_depts VALUES ('Sales'), ('Marketing');
DROP TABLE IF EXISTS numbers;
CREATE TABLE numbers (n INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, user_id INT64, level STRING, timestamp INT64);
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, active BOOL);
DROP TABLE IF EXISTS retention_policy;
CREATE TABLE retention_policy (level STRING, days INT64);
INSERT INTO logs VALUES (1, 1, 'DEBUG', 100), (2, 1, 'INFO', 200), (3, 2, 'ERROR', 150);
INSERT INTO users VALUES (1, FALSE), (2, TRUE);
INSERT INTO retention_policy VALUES ('DEBUG', 7), ('INFO', 30), ('ERROR', 90);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
INSERT INTO test VALUES (1), (2), (3);
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64);
INSERT INTO queue VALUES (1, 1), (2, 1), (3, 2), (4, 1);

DELETE FROM products WHERE price > 150.0 RETURNING *;
DELETE FROM employees WHERE id = 1 RETURNING id, name;
DELETE FROM products WHERE id <= 2 RETURNING id, name, price, price * 0.8 as discounted_price;
DELETE FROM products WHERE id = 999 RETURNING *;
DELETE FROM items i USING categories c WHERE i.category_id = c.id AND c.deprecated = TRUE RETURNING i.id, i.name, c.id as category_id;
DELETE FROM active_orders WHERE created_at < 1500 RETURNING id, total, created_at;
DELETE orders, order_items FROM orders JOIN order_items ON orders.id = order_items.order_id WHERE orders.id = 1;
SELECT id FROM orders;
SELECT order_id FROM order_items;
DELETE FROM departments WHERE id = 1;
DELETE FROM departments WHERE id = 1;
SELECT COUNT(*) FROM employees;
DELETE FROM departments WHERE id = 1;
SELECT dept_id FROM employees;
DELETE FROM products WHERE price > (SELECT AVG(price) FROM products);
SELECT id FROM products ORDER BY id;
DELETE FROM sales s1 WHERE amount < ( SELECT AVG(amount) FROM sales s2 WHERE s2.product_id = s1.product_id );
SELECT id FROM sales ORDER BY id;
DELETE FROM products p WHERE NOT EXISTS ( SELECT 1 FROM orders o WHERE o.product_id = p.id );
SELECT id FROM products ORDER BY id;
DELETE FROM employees WHERE dept IN (SELECT name FROM closed_depts);
SELECT id FROM employees;
DELETE FROM numbers WHERE n < 5000;
SELECT COUNT(*) FROM numbers;
DELETE FROM logs l USING users u JOIN retention_policy r ON l.level = r.level WHERE l.user_id = u.id AND u.active = FALSE AND l.timestamp < (300 - r.days) RETURNING l.id, l.level;
DELETE FROM test;
SELECT COUNT(*) FROM test;
DELETE FROM queue WHERE priority = 1 LIMIT 2;
SELECT id FROM queue ORDER BY id;

-- ============================================================================
-- Test: test_delete_returning_specific_columns
-- Source: delete_enhancements_advanced_tdd.rs:266
-- ============================================================================
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, name STRING, salary FLOAT64);
INSERT INTO employees VALUES (1, 'Alice', 50000.0), (2, 'Bob', 60000.0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING, price FLOAT64);
INSERT INTO products VALUES (1, 'Widget', 100.0), (2, 'Gadget', 200.0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 100.0);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category_id INT64, name STRING);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, deprecated BOOL);
INSERT INTO items VALUES (1, 1, 'Item1'), (2, 2, 'Item2'), (3, 1, 'Item3');
INSERT INTO categories VALUES (1, TRUE), (2, FALSE);
DROP TABLE IF EXISTS active_orders;
CREATE TABLE active_orders (id INT64, total FLOAT64, created_at INT64);
DROP TABLE IF EXISTS archived_orders;
CREATE TABLE archived_orders (id INT64, total FLOAT64, created_at INT64, deleted_at INT64);
INSERT INTO active_orders VALUES (1, 100.0, 1000), (2, 200.0, 2000);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, customer_id INT64);
DROP TABLE IF EXISTS order_items;
CREATE TABLE order_items (order_id INT64, product_id INT64);
INSERT INTO orders VALUES (1, 1), (2, 2);
INSERT INTO order_items VALUES (1, 100), (1, 200), (2, 300);
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id));
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1);
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees ( id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id) ON DELETE CASCADE );
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1), (2, 1);
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees ( id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id) ON DELETE SET NULL );
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1), (2, 1);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 10.0), (2, 50.0), (3, 100.0), (4, 25.0);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, product_id INT64, amount FLOAT64);
INSERT INTO sales VALUES (1, 1, 100.0), (2, 1, 200.0), (3, 2, 150.0), (4, 2, 300.0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (product_id INT64);
INSERT INTO products VALUES (1, 'Popular'), (2, 'Unpopular'), (3, 'Popular2');
INSERT INTO orders VALUES (1), (1), (3);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept STRING);
DROP TABLE IF EXISTS closed_depts;
CREATE TABLE closed_depts (name STRING);
INSERT INTO employees VALUES (1, 'Sales'), (2, 'Engineering'), (3, 'Marketing');
INSERT INTO closed_depts VALUES ('Sales'), ('Marketing');
DROP TABLE IF EXISTS numbers;
CREATE TABLE numbers (n INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, user_id INT64, level STRING, timestamp INT64);
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, active BOOL);
DROP TABLE IF EXISTS retention_policy;
CREATE TABLE retention_policy (level STRING, days INT64);
INSERT INTO logs VALUES (1, 1, 'DEBUG', 100), (2, 1, 'INFO', 200), (3, 2, 'ERROR', 150);
INSERT INTO users VALUES (1, FALSE), (2, TRUE);
INSERT INTO retention_policy VALUES ('DEBUG', 7), ('INFO', 30), ('ERROR', 90);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
INSERT INTO test VALUES (1), (2), (3);
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64);
INSERT INTO queue VALUES (1, 1), (2, 1), (3, 2), (4, 1);

DELETE FROM employees WHERE id = 1 RETURNING id, name;
DELETE FROM products WHERE id <= 2 RETURNING id, name, price, price * 0.8 as discounted_price;
DELETE FROM products WHERE id = 999 RETURNING *;
DELETE FROM items i USING categories c WHERE i.category_id = c.id AND c.deprecated = TRUE RETURNING i.id, i.name, c.id as category_id;
DELETE FROM active_orders WHERE created_at < 1500 RETURNING id, total, created_at;
DELETE orders, order_items FROM orders JOIN order_items ON orders.id = order_items.order_id WHERE orders.id = 1;
SELECT id FROM orders;
SELECT order_id FROM order_items;
DELETE FROM departments WHERE id = 1;
DELETE FROM departments WHERE id = 1;
SELECT COUNT(*) FROM employees;
DELETE FROM departments WHERE id = 1;
SELECT dept_id FROM employees;
DELETE FROM products WHERE price > (SELECT AVG(price) FROM products);
SELECT id FROM products ORDER BY id;
DELETE FROM sales s1 WHERE amount < ( SELECT AVG(amount) FROM sales s2 WHERE s2.product_id = s1.product_id );
SELECT id FROM sales ORDER BY id;
DELETE FROM products p WHERE NOT EXISTS ( SELECT 1 FROM orders o WHERE o.product_id = p.id );
SELECT id FROM products ORDER BY id;
DELETE FROM employees WHERE dept IN (SELECT name FROM closed_depts);
SELECT id FROM employees;
DELETE FROM numbers WHERE n < 5000;
SELECT COUNT(*) FROM numbers;
DELETE FROM logs l USING users u JOIN retention_policy r ON l.level = r.level WHERE l.user_id = u.id AND u.active = FALSE AND l.timestamp < (300 - r.days) RETURNING l.id, l.level;
DELETE FROM test;
SELECT COUNT(*) FROM test;
DELETE FROM queue WHERE priority = 1 LIMIT 2;
SELECT id FROM queue ORDER BY id;

-- ============================================================================
-- Test: test_delete_returning_expressions
-- Source: delete_enhancements_advanced_tdd.rs:288
-- ============================================================================
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING, price FLOAT64);
INSERT INTO products VALUES (1, 'Widget', 100.0), (2, 'Gadget', 200.0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 100.0);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category_id INT64, name STRING);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, deprecated BOOL);
INSERT INTO items VALUES (1, 1, 'Item1'), (2, 2, 'Item2'), (3, 1, 'Item3');
INSERT INTO categories VALUES (1, TRUE), (2, FALSE);
DROP TABLE IF EXISTS active_orders;
CREATE TABLE active_orders (id INT64, total FLOAT64, created_at INT64);
DROP TABLE IF EXISTS archived_orders;
CREATE TABLE archived_orders (id INT64, total FLOAT64, created_at INT64, deleted_at INT64);
INSERT INTO active_orders VALUES (1, 100.0, 1000), (2, 200.0, 2000);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, customer_id INT64);
DROP TABLE IF EXISTS order_items;
CREATE TABLE order_items (order_id INT64, product_id INT64);
INSERT INTO orders VALUES (1, 1), (2, 2);
INSERT INTO order_items VALUES (1, 100), (1, 200), (2, 300);
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id));
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1);
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees ( id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id) ON DELETE CASCADE );
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1), (2, 1);
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees ( id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id) ON DELETE SET NULL );
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1), (2, 1);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 10.0), (2, 50.0), (3, 100.0), (4, 25.0);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, product_id INT64, amount FLOAT64);
INSERT INTO sales VALUES (1, 1, 100.0), (2, 1, 200.0), (3, 2, 150.0), (4, 2, 300.0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (product_id INT64);
INSERT INTO products VALUES (1, 'Popular'), (2, 'Unpopular'), (3, 'Popular2');
INSERT INTO orders VALUES (1), (1), (3);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept STRING);
DROP TABLE IF EXISTS closed_depts;
CREATE TABLE closed_depts (name STRING);
INSERT INTO employees VALUES (1, 'Sales'), (2, 'Engineering'), (3, 'Marketing');
INSERT INTO closed_depts VALUES ('Sales'), ('Marketing');
DROP TABLE IF EXISTS numbers;
CREATE TABLE numbers (n INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, user_id INT64, level STRING, timestamp INT64);
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, active BOOL);
DROP TABLE IF EXISTS retention_policy;
CREATE TABLE retention_policy (level STRING, days INT64);
INSERT INTO logs VALUES (1, 1, 'DEBUG', 100), (2, 1, 'INFO', 200), (3, 2, 'ERROR', 150);
INSERT INTO users VALUES (1, FALSE), (2, TRUE);
INSERT INTO retention_policy VALUES ('DEBUG', 7), ('INFO', 30), ('ERROR', 90);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
INSERT INTO test VALUES (1), (2), (3);
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64);
INSERT INTO queue VALUES (1, 1), (2, 1), (3, 2), (4, 1);

DELETE FROM products WHERE id <= 2 RETURNING id, name, price, price * 0.8 as discounted_price;
DELETE FROM products WHERE id = 999 RETURNING *;
DELETE FROM items i USING categories c WHERE i.category_id = c.id AND c.deprecated = TRUE RETURNING i.id, i.name, c.id as category_id;
DELETE FROM active_orders WHERE created_at < 1500 RETURNING id, total, created_at;
DELETE orders, order_items FROM orders JOIN order_items ON orders.id = order_items.order_id WHERE orders.id = 1;
SELECT id FROM orders;
SELECT order_id FROM order_items;
DELETE FROM departments WHERE id = 1;
DELETE FROM departments WHERE id = 1;
SELECT COUNT(*) FROM employees;
DELETE FROM departments WHERE id = 1;
SELECT dept_id FROM employees;
DELETE FROM products WHERE price > (SELECT AVG(price) FROM products);
SELECT id FROM products ORDER BY id;
DELETE FROM sales s1 WHERE amount < ( SELECT AVG(amount) FROM sales s2 WHERE s2.product_id = s1.product_id );
SELECT id FROM sales ORDER BY id;
DELETE FROM products p WHERE NOT EXISTS ( SELECT 1 FROM orders o WHERE o.product_id = p.id );
SELECT id FROM products ORDER BY id;
DELETE FROM employees WHERE dept IN (SELECT name FROM closed_depts);
SELECT id FROM employees;
DELETE FROM numbers WHERE n < 5000;
SELECT COUNT(*) FROM numbers;
DELETE FROM logs l USING users u JOIN retention_policy r ON l.level = r.level WHERE l.user_id = u.id AND u.active = FALSE AND l.timestamp < (300 - r.days) RETURNING l.id, l.level;
DELETE FROM test;
SELECT COUNT(*) FROM test;
DELETE FROM queue WHERE priority = 1 LIMIT 2;
SELECT id FROM queue ORDER BY id;

-- ============================================================================
-- Test: test_delete_returning_no_rows
-- Source: delete_enhancements_advanced_tdd.rs:311
-- ============================================================================
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 100.0);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category_id INT64, name STRING);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, deprecated BOOL);
INSERT INTO items VALUES (1, 1, 'Item1'), (2, 2, 'Item2'), (3, 1, 'Item3');
INSERT INTO categories VALUES (1, TRUE), (2, FALSE);
DROP TABLE IF EXISTS active_orders;
CREATE TABLE active_orders (id INT64, total FLOAT64, created_at INT64);
DROP TABLE IF EXISTS archived_orders;
CREATE TABLE archived_orders (id INT64, total FLOAT64, created_at INT64, deleted_at INT64);
INSERT INTO active_orders VALUES (1, 100.0, 1000), (2, 200.0, 2000);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, customer_id INT64);
DROP TABLE IF EXISTS order_items;
CREATE TABLE order_items (order_id INT64, product_id INT64);
INSERT INTO orders VALUES (1, 1), (2, 2);
INSERT INTO order_items VALUES (1, 100), (1, 200), (2, 300);
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id));
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1);
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees ( id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id) ON DELETE CASCADE );
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1), (2, 1);
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees ( id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id) ON DELETE SET NULL );
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1), (2, 1);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 10.0), (2, 50.0), (3, 100.0), (4, 25.0);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, product_id INT64, amount FLOAT64);
INSERT INTO sales VALUES (1, 1, 100.0), (2, 1, 200.0), (3, 2, 150.0), (4, 2, 300.0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (product_id INT64);
INSERT INTO products VALUES (1, 'Popular'), (2, 'Unpopular'), (3, 'Popular2');
INSERT INTO orders VALUES (1), (1), (3);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept STRING);
DROP TABLE IF EXISTS closed_depts;
CREATE TABLE closed_depts (name STRING);
INSERT INTO employees VALUES (1, 'Sales'), (2, 'Engineering'), (3, 'Marketing');
INSERT INTO closed_depts VALUES ('Sales'), ('Marketing');
DROP TABLE IF EXISTS numbers;
CREATE TABLE numbers (n INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, user_id INT64, level STRING, timestamp INT64);
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, active BOOL);
DROP TABLE IF EXISTS retention_policy;
CREATE TABLE retention_policy (level STRING, days INT64);
INSERT INTO logs VALUES (1, 1, 'DEBUG', 100), (2, 1, 'INFO', 200), (3, 2, 'ERROR', 150);
INSERT INTO users VALUES (1, FALSE), (2, TRUE);
INSERT INTO retention_policy VALUES ('DEBUG', 7), ('INFO', 30), ('ERROR', 90);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
INSERT INTO test VALUES (1), (2), (3);
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64);
INSERT INTO queue VALUES (1, 1), (2, 1), (3, 2), (4, 1);

DELETE FROM products WHERE id = 999 RETURNING *;
DELETE FROM items i USING categories c WHERE i.category_id = c.id AND c.deprecated = TRUE RETURNING i.id, i.name, c.id as category_id;
DELETE FROM active_orders WHERE created_at < 1500 RETURNING id, total, created_at;
DELETE orders, order_items FROM orders JOIN order_items ON orders.id = order_items.order_id WHERE orders.id = 1;
SELECT id FROM orders;
SELECT order_id FROM order_items;
DELETE FROM departments WHERE id = 1;
DELETE FROM departments WHERE id = 1;
SELECT COUNT(*) FROM employees;
DELETE FROM departments WHERE id = 1;
SELECT dept_id FROM employees;
DELETE FROM products WHERE price > (SELECT AVG(price) FROM products);
SELECT id FROM products ORDER BY id;
DELETE FROM sales s1 WHERE amount < ( SELECT AVG(amount) FROM sales s2 WHERE s2.product_id = s1.product_id );
SELECT id FROM sales ORDER BY id;
DELETE FROM products p WHERE NOT EXISTS ( SELECT 1 FROM orders o WHERE o.product_id = p.id );
SELECT id FROM products ORDER BY id;
DELETE FROM employees WHERE dept IN (SELECT name FROM closed_depts);
SELECT id FROM employees;
DELETE FROM numbers WHERE n < 5000;
SELECT COUNT(*) FROM numbers;
DELETE FROM logs l USING users u JOIN retention_policy r ON l.level = r.level WHERE l.user_id = u.id AND u.active = FALSE AND l.timestamp < (300 - r.days) RETURNING l.id, l.level;
DELETE FROM test;
SELECT COUNT(*) FROM test;
DELETE FROM queue WHERE priority = 1 LIMIT 2;
SELECT id FROM queue ORDER BY id;

-- ============================================================================
-- Test: test_delete_returning_with_using
-- Source: delete_enhancements_advanced_tdd.rs:329
-- ============================================================================
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category_id INT64, name STRING);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, deprecated BOOL);
INSERT INTO items VALUES (1, 1, 'Item1'), (2, 2, 'Item2'), (3, 1, 'Item3');
INSERT INTO categories VALUES (1, TRUE), (2, FALSE);
DROP TABLE IF EXISTS active_orders;
CREATE TABLE active_orders (id INT64, total FLOAT64, created_at INT64);
DROP TABLE IF EXISTS archived_orders;
CREATE TABLE archived_orders (id INT64, total FLOAT64, created_at INT64, deleted_at INT64);
INSERT INTO active_orders VALUES (1, 100.0, 1000), (2, 200.0, 2000);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, customer_id INT64);
DROP TABLE IF EXISTS order_items;
CREATE TABLE order_items (order_id INT64, product_id INT64);
INSERT INTO orders VALUES (1, 1), (2, 2);
INSERT INTO order_items VALUES (1, 100), (1, 200), (2, 300);
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id));
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1);
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees ( id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id) ON DELETE CASCADE );
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1), (2, 1);
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees ( id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id) ON DELETE SET NULL );
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1), (2, 1);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 10.0), (2, 50.0), (3, 100.0), (4, 25.0);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, product_id INT64, amount FLOAT64);
INSERT INTO sales VALUES (1, 1, 100.0), (2, 1, 200.0), (3, 2, 150.0), (4, 2, 300.0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (product_id INT64);
INSERT INTO products VALUES (1, 'Popular'), (2, 'Unpopular'), (3, 'Popular2');
INSERT INTO orders VALUES (1), (1), (3);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept STRING);
DROP TABLE IF EXISTS closed_depts;
CREATE TABLE closed_depts (name STRING);
INSERT INTO employees VALUES (1, 'Sales'), (2, 'Engineering'), (3, 'Marketing');
INSERT INTO closed_depts VALUES ('Sales'), ('Marketing');
DROP TABLE IF EXISTS numbers;
CREATE TABLE numbers (n INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, user_id INT64, level STRING, timestamp INT64);
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, active BOOL);
DROP TABLE IF EXISTS retention_policy;
CREATE TABLE retention_policy (level STRING, days INT64);
INSERT INTO logs VALUES (1, 1, 'DEBUG', 100), (2, 1, 'INFO', 200), (3, 2, 'ERROR', 150);
INSERT INTO users VALUES (1, FALSE), (2, TRUE);
INSERT INTO retention_policy VALUES ('DEBUG', 7), ('INFO', 30), ('ERROR', 90);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
INSERT INTO test VALUES (1), (2), (3);
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64);
INSERT INTO queue VALUES (1, 1), (2, 1), (3, 2), (4, 1);

DELETE FROM items i USING categories c WHERE i.category_id = c.id AND c.deprecated = TRUE RETURNING i.id, i.name, c.id as category_id;
DELETE FROM active_orders WHERE created_at < 1500 RETURNING id, total, created_at;
DELETE orders, order_items FROM orders JOIN order_items ON orders.id = order_items.order_id WHERE orders.id = 1;
SELECT id FROM orders;
SELECT order_id FROM order_items;
DELETE FROM departments WHERE id = 1;
DELETE FROM departments WHERE id = 1;
SELECT COUNT(*) FROM employees;
DELETE FROM departments WHERE id = 1;
SELECT dept_id FROM employees;
DELETE FROM products WHERE price > (SELECT AVG(price) FROM products);
SELECT id FROM products ORDER BY id;
DELETE FROM sales s1 WHERE amount < ( SELECT AVG(amount) FROM sales s2 WHERE s2.product_id = s1.product_id );
SELECT id FROM sales ORDER BY id;
DELETE FROM products p WHERE NOT EXISTS ( SELECT 1 FROM orders o WHERE o.product_id = p.id );
SELECT id FROM products ORDER BY id;
DELETE FROM employees WHERE dept IN (SELECT name FROM closed_depts);
SELECT id FROM employees;
DELETE FROM numbers WHERE n < 5000;
SELECT COUNT(*) FROM numbers;
DELETE FROM logs l USING users u JOIN retention_policy r ON l.level = r.level WHERE l.user_id = u.id AND u.active = FALSE AND l.timestamp < (300 - r.days) RETURNING l.id, l.level;
DELETE FROM test;
SELECT COUNT(*) FROM test;
DELETE FROM queue WHERE priority = 1 LIMIT 2;
SELECT id FROM queue ORDER BY id;

-- ============================================================================
-- Test: test_delete_returning_audit
-- Source: delete_enhancements_advanced_tdd.rs:357
-- ============================================================================
DROP TABLE IF EXISTS active_orders;
CREATE TABLE active_orders (id INT64, total FLOAT64, created_at INT64);
DROP TABLE IF EXISTS archived_orders;
CREATE TABLE archived_orders (id INT64, total FLOAT64, created_at INT64, deleted_at INT64);
INSERT INTO active_orders VALUES (1, 100.0, 1000), (2, 200.0, 2000);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, customer_id INT64);
DROP TABLE IF EXISTS order_items;
CREATE TABLE order_items (order_id INT64, product_id INT64);
INSERT INTO orders VALUES (1, 1), (2, 2);
INSERT INTO order_items VALUES (1, 100), (1, 200), (2, 300);
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id));
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1);
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees ( id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id) ON DELETE CASCADE );
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1), (2, 1);
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees ( id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id) ON DELETE SET NULL );
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1), (2, 1);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 10.0), (2, 50.0), (3, 100.0), (4, 25.0);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, product_id INT64, amount FLOAT64);
INSERT INTO sales VALUES (1, 1, 100.0), (2, 1, 200.0), (3, 2, 150.0), (4, 2, 300.0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (product_id INT64);
INSERT INTO products VALUES (1, 'Popular'), (2, 'Unpopular'), (3, 'Popular2');
INSERT INTO orders VALUES (1), (1), (3);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept STRING);
DROP TABLE IF EXISTS closed_depts;
CREATE TABLE closed_depts (name STRING);
INSERT INTO employees VALUES (1, 'Sales'), (2, 'Engineering'), (3, 'Marketing');
INSERT INTO closed_depts VALUES ('Sales'), ('Marketing');
DROP TABLE IF EXISTS numbers;
CREATE TABLE numbers (n INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, user_id INT64, level STRING, timestamp INT64);
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, active BOOL);
DROP TABLE IF EXISTS retention_policy;
CREATE TABLE retention_policy (level STRING, days INT64);
INSERT INTO logs VALUES (1, 1, 'DEBUG', 100), (2, 1, 'INFO', 200), (3, 2, 'ERROR', 150);
INSERT INTO users VALUES (1, FALSE), (2, TRUE);
INSERT INTO retention_policy VALUES ('DEBUG', 7), ('INFO', 30), ('ERROR', 90);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
INSERT INTO test VALUES (1), (2), (3);
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64);
INSERT INTO queue VALUES (1, 1), (2, 1), (3, 2), (4, 1);

DELETE FROM active_orders WHERE created_at < 1500 RETURNING id, total, created_at;
DELETE orders, order_items FROM orders JOIN order_items ON orders.id = order_items.order_id WHERE orders.id = 1;
SELECT id FROM orders;
SELECT order_id FROM order_items;
DELETE FROM departments WHERE id = 1;
DELETE FROM departments WHERE id = 1;
SELECT COUNT(*) FROM employees;
DELETE FROM departments WHERE id = 1;
SELECT dept_id FROM employees;
DELETE FROM products WHERE price > (SELECT AVG(price) FROM products);
SELECT id FROM products ORDER BY id;
DELETE FROM sales s1 WHERE amount < ( SELECT AVG(amount) FROM sales s2 WHERE s2.product_id = s1.product_id );
SELECT id FROM sales ORDER BY id;
DELETE FROM products p WHERE NOT EXISTS ( SELECT 1 FROM orders o WHERE o.product_id = p.id );
SELECT id FROM products ORDER BY id;
DELETE FROM employees WHERE dept IN (SELECT name FROM closed_depts);
SELECT id FROM employees;
DELETE FROM numbers WHERE n < 5000;
SELECT COUNT(*) FROM numbers;
DELETE FROM logs l USING users u JOIN retention_policy r ON l.level = r.level WHERE l.user_id = u.id AND u.active = FALSE AND l.timestamp < (300 - r.days) RETURNING l.id, l.level;
DELETE FROM test;
SELECT COUNT(*) FROM test;
DELETE FROM queue WHERE priority = 1 LIMIT 2;
SELECT id FROM queue ORDER BY id;

-- ============================================================================
-- Test: test_multi_table_delete
-- Source: delete_enhancements_advanced_tdd.rs:386
-- ============================================================================
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, customer_id INT64);
DROP TABLE IF EXISTS order_items;
CREATE TABLE order_items (order_id INT64, product_id INT64);
INSERT INTO orders VALUES (1, 1), (2, 2);
INSERT INTO order_items VALUES (1, 100), (1, 200), (2, 300);
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id));
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1);
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees ( id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id) ON DELETE CASCADE );
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1), (2, 1);
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees ( id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id) ON DELETE SET NULL );
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1), (2, 1);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 10.0), (2, 50.0), (3, 100.0), (4, 25.0);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, product_id INT64, amount FLOAT64);
INSERT INTO sales VALUES (1, 1, 100.0), (2, 1, 200.0), (3, 2, 150.0), (4, 2, 300.0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (product_id INT64);
INSERT INTO products VALUES (1, 'Popular'), (2, 'Unpopular'), (3, 'Popular2');
INSERT INTO orders VALUES (1), (1), (3);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept STRING);
DROP TABLE IF EXISTS closed_depts;
CREATE TABLE closed_depts (name STRING);
INSERT INTO employees VALUES (1, 'Sales'), (2, 'Engineering'), (3, 'Marketing');
INSERT INTO closed_depts VALUES ('Sales'), ('Marketing');
DROP TABLE IF EXISTS numbers;
CREATE TABLE numbers (n INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, user_id INT64, level STRING, timestamp INT64);
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, active BOOL);
DROP TABLE IF EXISTS retention_policy;
CREATE TABLE retention_policy (level STRING, days INT64);
INSERT INTO logs VALUES (1, 1, 'DEBUG', 100), (2, 1, 'INFO', 200), (3, 2, 'ERROR', 150);
INSERT INTO users VALUES (1, FALSE), (2, TRUE);
INSERT INTO retention_policy VALUES ('DEBUG', 7), ('INFO', 30), ('ERROR', 90);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
INSERT INTO test VALUES (1), (2), (3);
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64);
INSERT INTO queue VALUES (1, 1), (2, 1), (3, 2), (4, 1);

DELETE orders, order_items FROM orders JOIN order_items ON orders.id = order_items.order_id WHERE orders.id = 1;
SELECT id FROM orders;
SELECT order_id FROM order_items;
DELETE FROM departments WHERE id = 1;
DELETE FROM departments WHERE id = 1;
SELECT COUNT(*) FROM employees;
DELETE FROM departments WHERE id = 1;
SELECT dept_id FROM employees;
DELETE FROM products WHERE price > (SELECT AVG(price) FROM products);
SELECT id FROM products ORDER BY id;
DELETE FROM sales s1 WHERE amount < ( SELECT AVG(amount) FROM sales s2 WHERE s2.product_id = s1.product_id );
SELECT id FROM sales ORDER BY id;
DELETE FROM products p WHERE NOT EXISTS ( SELECT 1 FROM orders o WHERE o.product_id = p.id );
SELECT id FROM products ORDER BY id;
DELETE FROM employees WHERE dept IN (SELECT name FROM closed_depts);
SELECT id FROM employees;
DELETE FROM numbers WHERE n < 5000;
SELECT COUNT(*) FROM numbers;
DELETE FROM logs l USING users u JOIN retention_policy r ON l.level = r.level WHERE l.user_id = u.id AND u.active = FALSE AND l.timestamp < (300 - r.days) RETURNING l.id, l.level;
DELETE FROM test;
SELECT COUNT(*) FROM test;
DELETE FROM queue WHERE priority = 1 LIMIT 2;
SELECT id FROM queue ORDER BY id;

-- ============================================================================
-- Test: test_delete_foreign_key_violation
-- Source: delete_enhancements_advanced_tdd.rs:426
-- ============================================================================
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id));
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1);
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees ( id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id) ON DELETE CASCADE );
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1), (2, 1);
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees ( id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id) ON DELETE SET NULL );
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1), (2, 1);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 10.0), (2, 50.0), (3, 100.0), (4, 25.0);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, product_id INT64, amount FLOAT64);
INSERT INTO sales VALUES (1, 1, 100.0), (2, 1, 200.0), (3, 2, 150.0), (4, 2, 300.0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (product_id INT64);
INSERT INTO products VALUES (1, 'Popular'), (2, 'Unpopular'), (3, 'Popular2');
INSERT INTO orders VALUES (1), (1), (3);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept STRING);
DROP TABLE IF EXISTS closed_depts;
CREATE TABLE closed_depts (name STRING);
INSERT INTO employees VALUES (1, 'Sales'), (2, 'Engineering'), (3, 'Marketing');
INSERT INTO closed_depts VALUES ('Sales'), ('Marketing');
DROP TABLE IF EXISTS numbers;
CREATE TABLE numbers (n INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, user_id INT64, level STRING, timestamp INT64);
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, active BOOL);
DROP TABLE IF EXISTS retention_policy;
CREATE TABLE retention_policy (level STRING, days INT64);
INSERT INTO logs VALUES (1, 1, 'DEBUG', 100), (2, 1, 'INFO', 200), (3, 2, 'ERROR', 150);
INSERT INTO users VALUES (1, FALSE), (2, TRUE);
INSERT INTO retention_policy VALUES ('DEBUG', 7), ('INFO', 30), ('ERROR', 90);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
INSERT INTO test VALUES (1), (2), (3);
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64);
INSERT INTO queue VALUES (1, 1), (2, 1), (3, 2), (4, 1);

DELETE FROM departments WHERE id = 1;
DELETE FROM departments WHERE id = 1;
SELECT COUNT(*) FROM employees;
DELETE FROM departments WHERE id = 1;
SELECT dept_id FROM employees;
DELETE FROM products WHERE price > (SELECT AVG(price) FROM products);
SELECT id FROM products ORDER BY id;
DELETE FROM sales s1 WHERE amount < ( SELECT AVG(amount) FROM sales s2 WHERE s2.product_id = s1.product_id );
SELECT id FROM sales ORDER BY id;
DELETE FROM products p WHERE NOT EXISTS ( SELECT 1 FROM orders o WHERE o.product_id = p.id );
SELECT id FROM products ORDER BY id;
DELETE FROM employees WHERE dept IN (SELECT name FROM closed_depts);
SELECT id FROM employees;
DELETE FROM numbers WHERE n < 5000;
SELECT COUNT(*) FROM numbers;
DELETE FROM logs l USING users u JOIN retention_policy r ON l.level = r.level WHERE l.user_id = u.id AND u.active = FALSE AND l.timestamp < (300 - r.days) RETURNING l.id, l.level;
DELETE FROM test;
SELECT COUNT(*) FROM test;
DELETE FROM queue WHERE priority = 1 LIMIT 2;
SELECT id FROM queue ORDER BY id;

-- ============================================================================
-- Test: test_delete_cascade
-- Source: delete_enhancements_advanced_tdd.rs:453
-- ============================================================================
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees ( id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id) ON DELETE CASCADE );
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1), (2, 1);
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees ( id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id) ON DELETE SET NULL );
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1), (2, 1);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 10.0), (2, 50.0), (3, 100.0), (4, 25.0);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, product_id INT64, amount FLOAT64);
INSERT INTO sales VALUES (1, 1, 100.0), (2, 1, 200.0), (3, 2, 150.0), (4, 2, 300.0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (product_id INT64);
INSERT INTO products VALUES (1, 'Popular'), (2, 'Unpopular'), (3, 'Popular2');
INSERT INTO orders VALUES (1), (1), (3);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept STRING);
DROP TABLE IF EXISTS closed_depts;
CREATE TABLE closed_depts (name STRING);
INSERT INTO employees VALUES (1, 'Sales'), (2, 'Engineering'), (3, 'Marketing');
INSERT INTO closed_depts VALUES ('Sales'), ('Marketing');
DROP TABLE IF EXISTS numbers;
CREATE TABLE numbers (n INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, user_id INT64, level STRING, timestamp INT64);
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, active BOOL);
DROP TABLE IF EXISTS retention_policy;
CREATE TABLE retention_policy (level STRING, days INT64);
INSERT INTO logs VALUES (1, 1, 'DEBUG', 100), (2, 1, 'INFO', 200), (3, 2, 'ERROR', 150);
INSERT INTO users VALUES (1, FALSE), (2, TRUE);
INSERT INTO retention_policy VALUES ('DEBUG', 7), ('INFO', 30), ('ERROR', 90);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
INSERT INTO test VALUES (1), (2), (3);
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64);
INSERT INTO queue VALUES (1, 1), (2, 1), (3, 2), (4, 1);

DELETE FROM departments WHERE id = 1;
SELECT COUNT(*) FROM employees;
DELETE FROM departments WHERE id = 1;
SELECT dept_id FROM employees;
DELETE FROM products WHERE price > (SELECT AVG(price) FROM products);
SELECT id FROM products ORDER BY id;
DELETE FROM sales s1 WHERE amount < ( SELECT AVG(amount) FROM sales s2 WHERE s2.product_id = s1.product_id );
SELECT id FROM sales ORDER BY id;
DELETE FROM products p WHERE NOT EXISTS ( SELECT 1 FROM orders o WHERE o.product_id = p.id );
SELECT id FROM products ORDER BY id;
DELETE FROM employees WHERE dept IN (SELECT name FROM closed_depts);
SELECT id FROM employees;
DELETE FROM numbers WHERE n < 5000;
SELECT COUNT(*) FROM numbers;
DELETE FROM logs l USING users u JOIN retention_policy r ON l.level = r.level WHERE l.user_id = u.id AND u.active = FALSE AND l.timestamp < (300 - r.days) RETURNING l.id, l.level;
DELETE FROM test;
SELECT COUNT(*) FROM test;
DELETE FROM queue WHERE priority = 1 LIMIT 2;
SELECT id FROM queue ORDER BY id;

-- ============================================================================
-- Test: test_delete_set_null
-- Source: delete_enhancements_advanced_tdd.rs:485
-- ============================================================================
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64 PRIMARY KEY, name STRING);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees ( id INT64, dept_id INT64, FOREIGN KEY (dept_id) REFERENCES departments(id) ON DELETE SET NULL );
INSERT INTO departments VALUES (1, 'Engineering');
INSERT INTO employees VALUES (1, 1), (2, 1);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 10.0), (2, 50.0), (3, 100.0), (4, 25.0);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, product_id INT64, amount FLOAT64);
INSERT INTO sales VALUES (1, 1, 100.0), (2, 1, 200.0), (3, 2, 150.0), (4, 2, 300.0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (product_id INT64);
INSERT INTO products VALUES (1, 'Popular'), (2, 'Unpopular'), (3, 'Popular2');
INSERT INTO orders VALUES (1), (1), (3);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept STRING);
DROP TABLE IF EXISTS closed_depts;
CREATE TABLE closed_depts (name STRING);
INSERT INTO employees VALUES (1, 'Sales'), (2, 'Engineering'), (3, 'Marketing');
INSERT INTO closed_depts VALUES ('Sales'), ('Marketing');
DROP TABLE IF EXISTS numbers;
CREATE TABLE numbers (n INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, user_id INT64, level STRING, timestamp INT64);
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, active BOOL);
DROP TABLE IF EXISTS retention_policy;
CREATE TABLE retention_policy (level STRING, days INT64);
INSERT INTO logs VALUES (1, 1, 'DEBUG', 100), (2, 1, 'INFO', 200), (3, 2, 'ERROR', 150);
INSERT INTO users VALUES (1, FALSE), (2, TRUE);
INSERT INTO retention_policy VALUES ('DEBUG', 7), ('INFO', 30), ('ERROR', 90);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
INSERT INTO test VALUES (1), (2), (3);
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64);
INSERT INTO queue VALUES (1, 1), (2, 1), (3, 2), (4, 1);

DELETE FROM departments WHERE id = 1;
SELECT dept_id FROM employees;
DELETE FROM products WHERE price > (SELECT AVG(price) FROM products);
SELECT id FROM products ORDER BY id;
DELETE FROM sales s1 WHERE amount < ( SELECT AVG(amount) FROM sales s2 WHERE s2.product_id = s1.product_id );
SELECT id FROM sales ORDER BY id;
DELETE FROM products p WHERE NOT EXISTS ( SELECT 1 FROM orders o WHERE o.product_id = p.id );
SELECT id FROM products ORDER BY id;
DELETE FROM employees WHERE dept IN (SELECT name FROM closed_depts);
SELECT id FROM employees;
DELETE FROM numbers WHERE n < 5000;
SELECT COUNT(*) FROM numbers;
DELETE FROM logs l USING users u JOIN retention_policy r ON l.level = r.level WHERE l.user_id = u.id AND u.active = FALSE AND l.timestamp < (300 - r.days) RETURNING l.id, l.level;
DELETE FROM test;
SELECT COUNT(*) FROM test;
DELETE FROM queue WHERE priority = 1 LIMIT 2;
SELECT id FROM queue ORDER BY id;

-- ============================================================================
-- Test: test_delete_with_subquery
-- Source: delete_enhancements_advanced_tdd.rs:522
-- ============================================================================
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 10.0), (2, 50.0), (3, 100.0), (4, 25.0);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, product_id INT64, amount FLOAT64);
INSERT INTO sales VALUES (1, 1, 100.0), (2, 1, 200.0), (3, 2, 150.0), (4, 2, 300.0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (product_id INT64);
INSERT INTO products VALUES (1, 'Popular'), (2, 'Unpopular'), (3, 'Popular2');
INSERT INTO orders VALUES (1), (1), (3);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept STRING);
DROP TABLE IF EXISTS closed_depts;
CREATE TABLE closed_depts (name STRING);
INSERT INTO employees VALUES (1, 'Sales'), (2, 'Engineering'), (3, 'Marketing');
INSERT INTO closed_depts VALUES ('Sales'), ('Marketing');
DROP TABLE IF EXISTS numbers;
CREATE TABLE numbers (n INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, user_id INT64, level STRING, timestamp INT64);
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, active BOOL);
DROP TABLE IF EXISTS retention_policy;
CREATE TABLE retention_policy (level STRING, days INT64);
INSERT INTO logs VALUES (1, 1, 'DEBUG', 100), (2, 1, 'INFO', 200), (3, 2, 'ERROR', 150);
INSERT INTO users VALUES (1, FALSE), (2, TRUE);
INSERT INTO retention_policy VALUES ('DEBUG', 7), ('INFO', 30), ('ERROR', 90);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
INSERT INTO test VALUES (1), (2), (3);
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64);
INSERT INTO queue VALUES (1, 1), (2, 1), (3, 2), (4, 1);

DELETE FROM products WHERE price > (SELECT AVG(price) FROM products);
SELECT id FROM products ORDER BY id;
DELETE FROM sales s1 WHERE amount < ( SELECT AVG(amount) FROM sales s2 WHERE s2.product_id = s1.product_id );
SELECT id FROM sales ORDER BY id;
DELETE FROM products p WHERE NOT EXISTS ( SELECT 1 FROM orders o WHERE o.product_id = p.id );
SELECT id FROM products ORDER BY id;
DELETE FROM employees WHERE dept IN (SELECT name FROM closed_depts);
SELECT id FROM employees;
DELETE FROM numbers WHERE n < 5000;
SELECT COUNT(*) FROM numbers;
DELETE FROM logs l USING users u JOIN retention_policy r ON l.level = r.level WHERE l.user_id = u.id AND u.active = FALSE AND l.timestamp < (300 - r.days) RETURNING l.id, l.level;
DELETE FROM test;
SELECT COUNT(*) FROM test;
DELETE FROM queue WHERE priority = 1 LIMIT 2;
SELECT id FROM queue ORDER BY id;

-- ============================================================================
-- Test: test_delete_with_correlated_subquery
-- Source: delete_enhancements_advanced_tdd.rs:550
-- ============================================================================
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, product_id INT64, amount FLOAT64);
INSERT INTO sales VALUES (1, 1, 100.0), (2, 1, 200.0), (3, 2, 150.0), (4, 2, 300.0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (product_id INT64);
INSERT INTO products VALUES (1, 'Popular'), (2, 'Unpopular'), (3, 'Popular2');
INSERT INTO orders VALUES (1), (1), (3);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept STRING);
DROP TABLE IF EXISTS closed_depts;
CREATE TABLE closed_depts (name STRING);
INSERT INTO employees VALUES (1, 'Sales'), (2, 'Engineering'), (3, 'Marketing');
INSERT INTO closed_depts VALUES ('Sales'), ('Marketing');
DROP TABLE IF EXISTS numbers;
CREATE TABLE numbers (n INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, user_id INT64, level STRING, timestamp INT64);
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, active BOOL);
DROP TABLE IF EXISTS retention_policy;
CREATE TABLE retention_policy (level STRING, days INT64);
INSERT INTO logs VALUES (1, 1, 'DEBUG', 100), (2, 1, 'INFO', 200), (3, 2, 'ERROR', 150);
INSERT INTO users VALUES (1, FALSE), (2, TRUE);
INSERT INTO retention_policy VALUES ('DEBUG', 7), ('INFO', 30), ('ERROR', 90);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
INSERT INTO test VALUES (1), (2), (3);
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64);
INSERT INTO queue VALUES (1, 1), (2, 1), (3, 2), (4, 1);

DELETE FROM sales s1 WHERE amount < ( SELECT AVG(amount) FROM sales s2 WHERE s2.product_id = s1.product_id );
SELECT id FROM sales ORDER BY id;
DELETE FROM products p WHERE NOT EXISTS ( SELECT 1 FROM orders o WHERE o.product_id = p.id );
SELECT id FROM products ORDER BY id;
DELETE FROM employees WHERE dept IN (SELECT name FROM closed_depts);
SELECT id FROM employees;
DELETE FROM numbers WHERE n < 5000;
SELECT COUNT(*) FROM numbers;
DELETE FROM logs l USING users u JOIN retention_policy r ON l.level = r.level WHERE l.user_id = u.id AND u.active = FALSE AND l.timestamp < (300 - r.days) RETURNING l.id, l.level;
DELETE FROM test;
SELECT COUNT(*) FROM test;
DELETE FROM queue WHERE priority = 1 LIMIT 2;
SELECT id FROM queue ORDER BY id;

-- ============================================================================
-- Test: test_delete_with_exists
-- Source: delete_enhancements_advanced_tdd.rs:583
-- ============================================================================
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (product_id INT64);
INSERT INTO products VALUES (1, 'Popular'), (2, 'Unpopular'), (3, 'Popular2');
INSERT INTO orders VALUES (1), (1), (3);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept STRING);
DROP TABLE IF EXISTS closed_depts;
CREATE TABLE closed_depts (name STRING);
INSERT INTO employees VALUES (1, 'Sales'), (2, 'Engineering'), (3, 'Marketing');
INSERT INTO closed_depts VALUES ('Sales'), ('Marketing');
DROP TABLE IF EXISTS numbers;
CREATE TABLE numbers (n INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, user_id INT64, level STRING, timestamp INT64);
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, active BOOL);
DROP TABLE IF EXISTS retention_policy;
CREATE TABLE retention_policy (level STRING, days INT64);
INSERT INTO logs VALUES (1, 1, 'DEBUG', 100), (2, 1, 'INFO', 200), (3, 2, 'ERROR', 150);
INSERT INTO users VALUES (1, FALSE), (2, TRUE);
INSERT INTO retention_policy VALUES ('DEBUG', 7), ('INFO', 30), ('ERROR', 90);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
INSERT INTO test VALUES (1), (2), (3);
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64);
INSERT INTO queue VALUES (1, 1), (2, 1), (3, 2), (4, 1);

DELETE FROM products p WHERE NOT EXISTS ( SELECT 1 FROM orders o WHERE o.product_id = p.id );
SELECT id FROM products ORDER BY id;
DELETE FROM employees WHERE dept IN (SELECT name FROM closed_depts);
SELECT id FROM employees;
DELETE FROM numbers WHERE n < 5000;
SELECT COUNT(*) FROM numbers;
DELETE FROM logs l USING users u JOIN retention_policy r ON l.level = r.level WHERE l.user_id = u.id AND u.active = FALSE AND l.timestamp < (300 - r.days) RETURNING l.id, l.level;
DELETE FROM test;
SELECT COUNT(*) FROM test;
DELETE FROM queue WHERE priority = 1 LIMIT 2;
SELECT id FROM queue ORDER BY id;

-- ============================================================================
-- Test: test_delete_with_in_subquery
-- Source: delete_enhancements_advanced_tdd.rs:615
-- ============================================================================
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept STRING);
DROP TABLE IF EXISTS closed_depts;
CREATE TABLE closed_depts (name STRING);
INSERT INTO employees VALUES (1, 'Sales'), (2, 'Engineering'), (3, 'Marketing');
INSERT INTO closed_depts VALUES ('Sales'), ('Marketing');
DROP TABLE IF EXISTS numbers;
CREATE TABLE numbers (n INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, user_id INT64, level STRING, timestamp INT64);
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, active BOOL);
DROP TABLE IF EXISTS retention_policy;
CREATE TABLE retention_policy (level STRING, days INT64);
INSERT INTO logs VALUES (1, 1, 'DEBUG', 100), (2, 1, 'INFO', 200), (3, 2, 'ERROR', 150);
INSERT INTO users VALUES (1, FALSE), (2, TRUE);
INSERT INTO retention_policy VALUES ('DEBUG', 7), ('INFO', 30), ('ERROR', 90);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
INSERT INTO test VALUES (1), (2), (3);
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64);
INSERT INTO queue VALUES (1, 1), (2, 1), (3, 2), (4, 1);

DELETE FROM employees WHERE dept IN (SELECT name FROM closed_depts);
SELECT id FROM employees;
DELETE FROM numbers WHERE n < 5000;
SELECT COUNT(*) FROM numbers;
DELETE FROM logs l USING users u JOIN retention_policy r ON l.level = r.level WHERE l.user_id = u.id AND u.active = FALSE AND l.timestamp < (300 - r.days) RETURNING l.id, l.level;
DELETE FROM test;
SELECT COUNT(*) FROM test;
DELETE FROM queue WHERE priority = 1 LIMIT 2;
SELECT id FROM queue ORDER BY id;

-- ============================================================================
-- Test: test_delete_large_batch
-- Source: delete_enhancements_advanced_tdd.rs:645
-- ============================================================================
DROP TABLE IF EXISTS numbers;
CREATE TABLE numbers (n INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, user_id INT64, level STRING, timestamp INT64);
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, active BOOL);
DROP TABLE IF EXISTS retention_policy;
CREATE TABLE retention_policy (level STRING, days INT64);
INSERT INTO logs VALUES (1, 1, 'DEBUG', 100), (2, 1, 'INFO', 200), (3, 2, 'ERROR', 150);
INSERT INTO users VALUES (1, FALSE), (2, TRUE);
INSERT INTO retention_policy VALUES ('DEBUG', 7), ('INFO', 30), ('ERROR', 90);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
INSERT INTO test VALUES (1), (2), (3);
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64);
INSERT INTO queue VALUES (1, 1), (2, 1), (3, 2), (4, 1);

DELETE FROM numbers WHERE n < 5000;
SELECT COUNT(*) FROM numbers;
DELETE FROM logs l USING users u JOIN retention_policy r ON l.level = r.level WHERE l.user_id = u.id AND u.active = FALSE AND l.timestamp < (300 - r.days) RETURNING l.id, l.level;
DELETE FROM test;
SELECT COUNT(*) FROM test;
DELETE FROM queue WHERE priority = 1 LIMIT 2;
SELECT id FROM queue ORDER BY id;

-- ============================================================================
-- Test: test_delete_complex_integration
-- Source: delete_enhancements_advanced_tdd.rs:670
-- ============================================================================
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, user_id INT64, level STRING, timestamp INT64);
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, active BOOL);
DROP TABLE IF EXISTS retention_policy;
CREATE TABLE retention_policy (level STRING, days INT64);
INSERT INTO logs VALUES (1, 1, 'DEBUG', 100), (2, 1, 'INFO', 200), (3, 2, 'ERROR', 150);
INSERT INTO users VALUES (1, FALSE), (2, TRUE);
INSERT INTO retention_policy VALUES ('DEBUG', 7), ('INFO', 30), ('ERROR', 90);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
INSERT INTO test VALUES (1), (2), (3);
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64);
INSERT INTO queue VALUES (1, 1), (2, 1), (3, 2), (4, 1);

DELETE FROM logs l USING users u JOIN retention_policy r ON l.level = r.level WHERE l.user_id = u.id AND u.active = FALSE AND l.timestamp < (300 - r.days) RETURNING l.id, l.level;
DELETE FROM test;
SELECT COUNT(*) FROM test;
DELETE FROM queue WHERE priority = 1 LIMIT 2;
SELECT id FROM queue ORDER BY id;

-- ============================================================================
-- Test: test_delete_with_inner_join
-- Source: delete_enhancements_tdd.rs:24
-- ============================================================================
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, customer_id INT64, amount FLOAT64);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (id INT64, status STRING);
INSERT INTO orders VALUES (1, 100, 50.0), (2, 101, 75.0), (3, 100, 30.0);
INSERT INTO customers VALUES (100, 'inactive'), (101, 'active');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, user_id INT64);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Charlie');
INSERT INTO orders VALUES (100, 1), (101, 2);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, name STRING, manager_id INT64);
INSERT INTO employees VALUES (1, 'Alice', NULL), (2, 'Bob', 1), (3, 'Charlie', 2), (4, 'David', 1);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, category_id INT64, price FLOAT64);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, discontinued BOOL);
INSERT INTO products VALUES (1, 10, 100), (2, 20, 200), (3, 10, 150);
INSERT INTO categories VALUES (10, true), (20, false);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, supplier_id INT64, warehouse_id INT64);
DROP TABLE IF EXISTS suppliers;
CREATE TABLE suppliers (id INT64, active BOOL);
DROP TABLE IF EXISTS warehouses;
CREATE TABLE warehouses (id INT64, closed BOOL);
INSERT INTO items VALUES (1, 100, 200), (2, 101, 201), (3, 100, 201);
INSERT INTO suppliers VALUES (100, false), (101, true);
INSERT INTO warehouses VALUES (200, true), (201, false);
DROP TABLE IF EXISTS transactions;
CREATE TABLE transactions (id INT64, account_id INT64, amount FLOAT64);
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (id INT64, balance FLOAT64);
INSERT INTO transactions VALUES (1, 100, 50), (2, 100, 1000), (3, 101, 25);
INSERT INTO accounts VALUES (100, 100), (101, 1000);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, level STRING, message STRING);
INSERT INTO logs VALUES (1, 'DEBUG', 'msg1'), (2, 'ERROR', 'msg2'), (3, 'DEBUG', 'msg3');
DROP TABLE IF EXISTS archive;
CREATE TABLE archive (id INT64, data STRING, created_at INT64);
INSERT INTO archive VALUES (1, 'old', 100), (2, 'old', 200), (3, 'new', 300);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, amount FLOAT64, tax_rate FLOAT64);
INSERT INTO sales VALUES (1, 100, 0.1), (2, 200, 0.1), (3, 50, 0.05);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, status STRING);
INSERT INTO items VALUES (1, 'active'), (2, 'active');
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64, task STRING);
INSERT INTO queue VALUES (1, 10, 'low'), (2, 100, 'high'), (3, 50, 'med');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, customer_id INT64);
DROP TABLE IF EXISTS order_items;
CREATE TABLE order_items (order_id INT64, product_id INT64);
INSERT INTO orders VALUES (1, 100), (2, 101);
INSERT INTO order_items VALUES (1, 200), (1, 201), (2, 202);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category_id INT64);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, deleted BOOL);
INSERT INTO items VALUES (1, 10), (2, NULL), (3, 20);
INSERT INTO categories VALUES (10, true), (20, false);
DROP TABLE IF EXISTS temp;
CREATE TABLE temp (id INT64, value STRING);
INSERT INTO temp VALUES (1, 'a'), (2, 'b'), (3, 'c');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, type STRING, timestamp INT64, processed BOOL);
INSERT INTO events VALUES (1, 'A', 100, true), (2, 'B', 200, false), (3, 'A', 150, true), (4, 'A', 180, false);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 100), (2, 200), (3, 150), (4, 180);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, level STRING);
INSERT INTO logs VALUES (1, 'DEBUG'), (2, 'DEBUG'), (3, 'DEBUG'), (4, 'ERROR');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS parents;
CREATE TABLE parents (id INT64 PRIMARY KEY);
DROP TABLE IF EXISTS children;
CREATE TABLE children (id INT64, parent_id INT64, FOREIGN KEY (parent_id) REFERENCES parents(id) ON DELETE CASCADE);
INSERT INTO parents VALUES (1), (2);
INSERT INTO children VALUES (10, 1), (11, 1), (12, 2);

DELETE o FROM orders o INNER JOIN customers c ON o.customer_id = c.id WHERE c.status = 'inactive';
SELECT id FROM orders ORDER BY id;
DELETE u FROM users u LEFT JOIN orders o ON u.id = o.user_id WHERE o.id IS NULL;
SELECT name FROM users ORDER BY id;
DELETE e FROM employees e INNER JOIN employees m ON e.manager_id = m.id WHERE m.name = 'Bob';
SELECT name FROM employees ORDER BY id;
DELETE FROM products USING categories WHERE products.category_id = categories.id AND categories.discontinued = true;
SELECT id FROM products ORDER BY id;
DELETE FROM items USING suppliers, warehouses WHERE items.supplier_id = suppliers.id AND items.warehouse_id = warehouses.id AND (suppliers.active = false OR warehouses.closed = true);
SELECT id FROM items ORDER BY id;
DELETE FROM transactions USING (SELECT id, balance FROM accounts) a WHERE transactions.account_id = a.id AND transactions.amount > a.balance;
SELECT id FROM transactions ORDER BY id;
DELETE FROM logs WHERE level = 'DEBUG' RETURNING *;
SELECT COUNT(*) FROM logs;
DELETE FROM archive WHERE data = 'old' RETURNING id, data;
DELETE FROM sales WHERE amount < 100 RETURNING id, amount * (1 + tax_rate) AS total;
DELETE FROM items WHERE status = 'deleted' RETURNING *;
SELECT COUNT(*) FROM items;
DELETE FROM queue WHERE priority >= 50 RETURNING id, task ORDER BY priority DESC LIMIT 1;
DELETE orders, order_items FROM orders INNER JOIN order_items ON orders.id = order_items.order_id WHERE orders.customer_id = 100;
SELECT id FROM orders ORDER BY id;
SELECT order_id FROM order_items ORDER BY order_id;
DELETE i FROM items i INNER JOIN categories c ON i.category_id = c.id WHERE c.deleted = true;
SELECT id FROM items ORDER BY id;
DELETE FROM temp;
SELECT COUNT(*) FROM temp;
DELETE FROM events WHERE type = 'A' AND timestamp < 150 AND processed = true;
SELECT id FROM events ORDER BY id;
DELETE FROM products WHERE price < (SELECT AVG(price) FROM products);
SELECT id FROM products ORDER BY id;
DELETE FROM nonexistent_table WHERE id = 1;
DELETE FROM test WHERE nonexistent_column = 1;
DELETE FROM logs WHERE level = 'DEBUG' LIMIT 2;
SELECT COUNT(*) FROM logs WHERE level = 'DEBUG';
DELETE FROM data WHERE id > 1000;
SELECT COUNT(*) FROM data;
DELETE FROM parents WHERE id = 1;
SELECT id FROM children ORDER BY id;

-- ============================================================================
-- Test: test_delete_with_left_join
-- Source: delete_enhancements_tdd.rs:63
-- ============================================================================
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, user_id INT64);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Charlie');
INSERT INTO orders VALUES (100, 1), (101, 2);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, name STRING, manager_id INT64);
INSERT INTO employees VALUES (1, 'Alice', NULL), (2, 'Bob', 1), (3, 'Charlie', 2), (4, 'David', 1);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, category_id INT64, price FLOAT64);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, discontinued BOOL);
INSERT INTO products VALUES (1, 10, 100), (2, 20, 200), (3, 10, 150);
INSERT INTO categories VALUES (10, true), (20, false);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, supplier_id INT64, warehouse_id INT64);
DROP TABLE IF EXISTS suppliers;
CREATE TABLE suppliers (id INT64, active BOOL);
DROP TABLE IF EXISTS warehouses;
CREATE TABLE warehouses (id INT64, closed BOOL);
INSERT INTO items VALUES (1, 100, 200), (2, 101, 201), (3, 100, 201);
INSERT INTO suppliers VALUES (100, false), (101, true);
INSERT INTO warehouses VALUES (200, true), (201, false);
DROP TABLE IF EXISTS transactions;
CREATE TABLE transactions (id INT64, account_id INT64, amount FLOAT64);
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (id INT64, balance FLOAT64);
INSERT INTO transactions VALUES (1, 100, 50), (2, 100, 1000), (3, 101, 25);
INSERT INTO accounts VALUES (100, 100), (101, 1000);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, level STRING, message STRING);
INSERT INTO logs VALUES (1, 'DEBUG', 'msg1'), (2, 'ERROR', 'msg2'), (3, 'DEBUG', 'msg3');
DROP TABLE IF EXISTS archive;
CREATE TABLE archive (id INT64, data STRING, created_at INT64);
INSERT INTO archive VALUES (1, 'old', 100), (2, 'old', 200), (3, 'new', 300);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, amount FLOAT64, tax_rate FLOAT64);
INSERT INTO sales VALUES (1, 100, 0.1), (2, 200, 0.1), (3, 50, 0.05);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, status STRING);
INSERT INTO items VALUES (1, 'active'), (2, 'active');
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64, task STRING);
INSERT INTO queue VALUES (1, 10, 'low'), (2, 100, 'high'), (3, 50, 'med');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, customer_id INT64);
DROP TABLE IF EXISTS order_items;
CREATE TABLE order_items (order_id INT64, product_id INT64);
INSERT INTO orders VALUES (1, 100), (2, 101);
INSERT INTO order_items VALUES (1, 200), (1, 201), (2, 202);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category_id INT64);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, deleted BOOL);
INSERT INTO items VALUES (1, 10), (2, NULL), (3, 20);
INSERT INTO categories VALUES (10, true), (20, false);
DROP TABLE IF EXISTS temp;
CREATE TABLE temp (id INT64, value STRING);
INSERT INTO temp VALUES (1, 'a'), (2, 'b'), (3, 'c');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, type STRING, timestamp INT64, processed BOOL);
INSERT INTO events VALUES (1, 'A', 100, true), (2, 'B', 200, false), (3, 'A', 150, true), (4, 'A', 180, false);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 100), (2, 200), (3, 150), (4, 180);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, level STRING);
INSERT INTO logs VALUES (1, 'DEBUG'), (2, 'DEBUG'), (3, 'DEBUG'), (4, 'ERROR');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS parents;
CREATE TABLE parents (id INT64 PRIMARY KEY);
DROP TABLE IF EXISTS children;
CREATE TABLE children (id INT64, parent_id INT64, FOREIGN KEY (parent_id) REFERENCES parents(id) ON DELETE CASCADE);
INSERT INTO parents VALUES (1), (2);
INSERT INTO children VALUES (10, 1), (11, 1), (12, 2);

DELETE u FROM users u LEFT JOIN orders o ON u.id = o.user_id WHERE o.id IS NULL;
SELECT name FROM users ORDER BY id;
DELETE e FROM employees e INNER JOIN employees m ON e.manager_id = m.id WHERE m.name = 'Bob';
SELECT name FROM employees ORDER BY id;
DELETE FROM products USING categories WHERE products.category_id = categories.id AND categories.discontinued = true;
SELECT id FROM products ORDER BY id;
DELETE FROM items USING suppliers, warehouses WHERE items.supplier_id = suppliers.id AND items.warehouse_id = warehouses.id AND (suppliers.active = false OR warehouses.closed = true);
SELECT id FROM items ORDER BY id;
DELETE FROM transactions USING (SELECT id, balance FROM accounts) a WHERE transactions.account_id = a.id AND transactions.amount > a.balance;
SELECT id FROM transactions ORDER BY id;
DELETE FROM logs WHERE level = 'DEBUG' RETURNING *;
SELECT COUNT(*) FROM logs;
DELETE FROM archive WHERE data = 'old' RETURNING id, data;
DELETE FROM sales WHERE amount < 100 RETURNING id, amount * (1 + tax_rate) AS total;
DELETE FROM items WHERE status = 'deleted' RETURNING *;
SELECT COUNT(*) FROM items;
DELETE FROM queue WHERE priority >= 50 RETURNING id, task ORDER BY priority DESC LIMIT 1;
DELETE orders, order_items FROM orders INNER JOIN order_items ON orders.id = order_items.order_id WHERE orders.customer_id = 100;
SELECT id FROM orders ORDER BY id;
SELECT order_id FROM order_items ORDER BY order_id;
DELETE i FROM items i INNER JOIN categories c ON i.category_id = c.id WHERE c.deleted = true;
SELECT id FROM items ORDER BY id;
DELETE FROM temp;
SELECT COUNT(*) FROM temp;
DELETE FROM events WHERE type = 'A' AND timestamp < 150 AND processed = true;
SELECT id FROM events ORDER BY id;
DELETE FROM products WHERE price < (SELECT AVG(price) FROM products);
SELECT id FROM products ORDER BY id;
DELETE FROM nonexistent_table WHERE id = 1;
DELETE FROM test WHERE nonexistent_column = 1;
DELETE FROM logs WHERE level = 'DEBUG' LIMIT 2;
SELECT COUNT(*) FROM logs WHERE level = 'DEBUG';
DELETE FROM data WHERE id > 1000;
SELECT COUNT(*) FROM data;
DELETE FROM parents WHERE id = 1;
SELECT id FROM children ORDER BY id;

-- ============================================================================
-- Test: test_delete_with_self_join
-- Source: delete_enhancements_tdd.rs:106
-- ============================================================================
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, name STRING, manager_id INT64);
INSERT INTO employees VALUES (1, 'Alice', NULL), (2, 'Bob', 1), (3, 'Charlie', 2), (4, 'David', 1);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, category_id INT64, price FLOAT64);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, discontinued BOOL);
INSERT INTO products VALUES (1, 10, 100), (2, 20, 200), (3, 10, 150);
INSERT INTO categories VALUES (10, true), (20, false);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, supplier_id INT64, warehouse_id INT64);
DROP TABLE IF EXISTS suppliers;
CREATE TABLE suppliers (id INT64, active BOOL);
DROP TABLE IF EXISTS warehouses;
CREATE TABLE warehouses (id INT64, closed BOOL);
INSERT INTO items VALUES (1, 100, 200), (2, 101, 201), (3, 100, 201);
INSERT INTO suppliers VALUES (100, false), (101, true);
INSERT INTO warehouses VALUES (200, true), (201, false);
DROP TABLE IF EXISTS transactions;
CREATE TABLE transactions (id INT64, account_id INT64, amount FLOAT64);
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (id INT64, balance FLOAT64);
INSERT INTO transactions VALUES (1, 100, 50), (2, 100, 1000), (3, 101, 25);
INSERT INTO accounts VALUES (100, 100), (101, 1000);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, level STRING, message STRING);
INSERT INTO logs VALUES (1, 'DEBUG', 'msg1'), (2, 'ERROR', 'msg2'), (3, 'DEBUG', 'msg3');
DROP TABLE IF EXISTS archive;
CREATE TABLE archive (id INT64, data STRING, created_at INT64);
INSERT INTO archive VALUES (1, 'old', 100), (2, 'old', 200), (3, 'new', 300);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, amount FLOAT64, tax_rate FLOAT64);
INSERT INTO sales VALUES (1, 100, 0.1), (2, 200, 0.1), (3, 50, 0.05);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, status STRING);
INSERT INTO items VALUES (1, 'active'), (2, 'active');
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64, task STRING);
INSERT INTO queue VALUES (1, 10, 'low'), (2, 100, 'high'), (3, 50, 'med');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, customer_id INT64);
DROP TABLE IF EXISTS order_items;
CREATE TABLE order_items (order_id INT64, product_id INT64);
INSERT INTO orders VALUES (1, 100), (2, 101);
INSERT INTO order_items VALUES (1, 200), (1, 201), (2, 202);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category_id INT64);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, deleted BOOL);
INSERT INTO items VALUES (1, 10), (2, NULL), (3, 20);
INSERT INTO categories VALUES (10, true), (20, false);
DROP TABLE IF EXISTS temp;
CREATE TABLE temp (id INT64, value STRING);
INSERT INTO temp VALUES (1, 'a'), (2, 'b'), (3, 'c');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, type STRING, timestamp INT64, processed BOOL);
INSERT INTO events VALUES (1, 'A', 100, true), (2, 'B', 200, false), (3, 'A', 150, true), (4, 'A', 180, false);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 100), (2, 200), (3, 150), (4, 180);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, level STRING);
INSERT INTO logs VALUES (1, 'DEBUG'), (2, 'DEBUG'), (3, 'DEBUG'), (4, 'ERROR');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS parents;
CREATE TABLE parents (id INT64 PRIMARY KEY);
DROP TABLE IF EXISTS children;
CREATE TABLE children (id INT64, parent_id INT64, FOREIGN KEY (parent_id) REFERENCES parents(id) ON DELETE CASCADE);
INSERT INTO parents VALUES (1), (2);
INSERT INTO children VALUES (10, 1), (11, 1), (12, 2);

DELETE e FROM employees e INNER JOIN employees m ON e.manager_id = m.id WHERE m.name = 'Bob';
SELECT name FROM employees ORDER BY id;
DELETE FROM products USING categories WHERE products.category_id = categories.id AND categories.discontinued = true;
SELECT id FROM products ORDER BY id;
DELETE FROM items USING suppliers, warehouses WHERE items.supplier_id = suppliers.id AND items.warehouse_id = warehouses.id AND (suppliers.active = false OR warehouses.closed = true);
SELECT id FROM items ORDER BY id;
DELETE FROM transactions USING (SELECT id, balance FROM accounts) a WHERE transactions.account_id = a.id AND transactions.amount > a.balance;
SELECT id FROM transactions ORDER BY id;
DELETE FROM logs WHERE level = 'DEBUG' RETURNING *;
SELECT COUNT(*) FROM logs;
DELETE FROM archive WHERE data = 'old' RETURNING id, data;
DELETE FROM sales WHERE amount < 100 RETURNING id, amount * (1 + tax_rate) AS total;
DELETE FROM items WHERE status = 'deleted' RETURNING *;
SELECT COUNT(*) FROM items;
DELETE FROM queue WHERE priority >= 50 RETURNING id, task ORDER BY priority DESC LIMIT 1;
DELETE orders, order_items FROM orders INNER JOIN order_items ON orders.id = order_items.order_id WHERE orders.customer_id = 100;
SELECT id FROM orders ORDER BY id;
SELECT order_id FROM order_items ORDER BY order_id;
DELETE i FROM items i INNER JOIN categories c ON i.category_id = c.id WHERE c.deleted = true;
SELECT id FROM items ORDER BY id;
DELETE FROM temp;
SELECT COUNT(*) FROM temp;
DELETE FROM events WHERE type = 'A' AND timestamp < 150 AND processed = true;
SELECT id FROM events ORDER BY id;
DELETE FROM products WHERE price < (SELECT AVG(price) FROM products);
SELECT id FROM products ORDER BY id;
DELETE FROM nonexistent_table WHERE id = 1;
DELETE FROM test WHERE nonexistent_column = 1;
DELETE FROM logs WHERE level = 'DEBUG' LIMIT 2;
SELECT COUNT(*) FROM logs WHERE level = 'DEBUG';
DELETE FROM data WHERE id > 1000;
SELECT COUNT(*) FROM data;
DELETE FROM parents WHERE id = 1;
SELECT id FROM children ORDER BY id;

-- ============================================================================
-- Test: test_delete_using_basic
-- Source: delete_enhancements_tdd.rs:152
-- ============================================================================
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, category_id INT64, price FLOAT64);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, discontinued BOOL);
INSERT INTO products VALUES (1, 10, 100), (2, 20, 200), (3, 10, 150);
INSERT INTO categories VALUES (10, true), (20, false);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, supplier_id INT64, warehouse_id INT64);
DROP TABLE IF EXISTS suppliers;
CREATE TABLE suppliers (id INT64, active BOOL);
DROP TABLE IF EXISTS warehouses;
CREATE TABLE warehouses (id INT64, closed BOOL);
INSERT INTO items VALUES (1, 100, 200), (2, 101, 201), (3, 100, 201);
INSERT INTO suppliers VALUES (100, false), (101, true);
INSERT INTO warehouses VALUES (200, true), (201, false);
DROP TABLE IF EXISTS transactions;
CREATE TABLE transactions (id INT64, account_id INT64, amount FLOAT64);
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (id INT64, balance FLOAT64);
INSERT INTO transactions VALUES (1, 100, 50), (2, 100, 1000), (3, 101, 25);
INSERT INTO accounts VALUES (100, 100), (101, 1000);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, level STRING, message STRING);
INSERT INTO logs VALUES (1, 'DEBUG', 'msg1'), (2, 'ERROR', 'msg2'), (3, 'DEBUG', 'msg3');
DROP TABLE IF EXISTS archive;
CREATE TABLE archive (id INT64, data STRING, created_at INT64);
INSERT INTO archive VALUES (1, 'old', 100), (2, 'old', 200), (3, 'new', 300);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, amount FLOAT64, tax_rate FLOAT64);
INSERT INTO sales VALUES (1, 100, 0.1), (2, 200, 0.1), (3, 50, 0.05);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, status STRING);
INSERT INTO items VALUES (1, 'active'), (2, 'active');
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64, task STRING);
INSERT INTO queue VALUES (1, 10, 'low'), (2, 100, 'high'), (3, 50, 'med');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, customer_id INT64);
DROP TABLE IF EXISTS order_items;
CREATE TABLE order_items (order_id INT64, product_id INT64);
INSERT INTO orders VALUES (1, 100), (2, 101);
INSERT INTO order_items VALUES (1, 200), (1, 201), (2, 202);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category_id INT64);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, deleted BOOL);
INSERT INTO items VALUES (1, 10), (2, NULL), (3, 20);
INSERT INTO categories VALUES (10, true), (20, false);
DROP TABLE IF EXISTS temp;
CREATE TABLE temp (id INT64, value STRING);
INSERT INTO temp VALUES (1, 'a'), (2, 'b'), (3, 'c');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, type STRING, timestamp INT64, processed BOOL);
INSERT INTO events VALUES (1, 'A', 100, true), (2, 'B', 200, false), (3, 'A', 150, true), (4, 'A', 180, false);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 100), (2, 200), (3, 150), (4, 180);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, level STRING);
INSERT INTO logs VALUES (1, 'DEBUG'), (2, 'DEBUG'), (3, 'DEBUG'), (4, 'ERROR');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS parents;
CREATE TABLE parents (id INT64 PRIMARY KEY);
DROP TABLE IF EXISTS children;
CREATE TABLE children (id INT64, parent_id INT64, FOREIGN KEY (parent_id) REFERENCES parents(id) ON DELETE CASCADE);
INSERT INTO parents VALUES (1), (2);
INSERT INTO children VALUES (10, 1), (11, 1), (12, 2);

DELETE FROM products USING categories WHERE products.category_id = categories.id AND categories.discontinued = true;
SELECT id FROM products ORDER BY id;
DELETE FROM items USING suppliers, warehouses WHERE items.supplier_id = suppliers.id AND items.warehouse_id = warehouses.id AND (suppliers.active = false OR warehouses.closed = true);
SELECT id FROM items ORDER BY id;
DELETE FROM transactions USING (SELECT id, balance FROM accounts) a WHERE transactions.account_id = a.id AND transactions.amount > a.balance;
SELECT id FROM transactions ORDER BY id;
DELETE FROM logs WHERE level = 'DEBUG' RETURNING *;
SELECT COUNT(*) FROM logs;
DELETE FROM archive WHERE data = 'old' RETURNING id, data;
DELETE FROM sales WHERE amount < 100 RETURNING id, amount * (1 + tax_rate) AS total;
DELETE FROM items WHERE status = 'deleted' RETURNING *;
SELECT COUNT(*) FROM items;
DELETE FROM queue WHERE priority >= 50 RETURNING id, task ORDER BY priority DESC LIMIT 1;
DELETE orders, order_items FROM orders INNER JOIN order_items ON orders.id = order_items.order_id WHERE orders.customer_id = 100;
SELECT id FROM orders ORDER BY id;
SELECT order_id FROM order_items ORDER BY order_id;
DELETE i FROM items i INNER JOIN categories c ON i.category_id = c.id WHERE c.deleted = true;
SELECT id FROM items ORDER BY id;
DELETE FROM temp;
SELECT COUNT(*) FROM temp;
DELETE FROM events WHERE type = 'A' AND timestamp < 150 AND processed = true;
SELECT id FROM events ORDER BY id;
DELETE FROM products WHERE price < (SELECT AVG(price) FROM products);
SELECT id FROM products ORDER BY id;
DELETE FROM nonexistent_table WHERE id = 1;
DELETE FROM test WHERE nonexistent_column = 1;
DELETE FROM logs WHERE level = 'DEBUG' LIMIT 2;
SELECT COUNT(*) FROM logs WHERE level = 'DEBUG';
DELETE FROM data WHERE id > 1000;
SELECT COUNT(*) FROM data;
DELETE FROM parents WHERE id = 1;
SELECT id FROM children ORDER BY id;

-- ============================================================================
-- Test: test_delete_using_multiple_tables
-- Source: delete_enhancements_tdd.rs:192
-- ============================================================================
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, supplier_id INT64, warehouse_id INT64);
DROP TABLE IF EXISTS suppliers;
CREATE TABLE suppliers (id INT64, active BOOL);
DROP TABLE IF EXISTS warehouses;
CREATE TABLE warehouses (id INT64, closed BOOL);
INSERT INTO items VALUES (1, 100, 200), (2, 101, 201), (3, 100, 201);
INSERT INTO suppliers VALUES (100, false), (101, true);
INSERT INTO warehouses VALUES (200, true), (201, false);
DROP TABLE IF EXISTS transactions;
CREATE TABLE transactions (id INT64, account_id INT64, amount FLOAT64);
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (id INT64, balance FLOAT64);
INSERT INTO transactions VALUES (1, 100, 50), (2, 100, 1000), (3, 101, 25);
INSERT INTO accounts VALUES (100, 100), (101, 1000);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, level STRING, message STRING);
INSERT INTO logs VALUES (1, 'DEBUG', 'msg1'), (2, 'ERROR', 'msg2'), (3, 'DEBUG', 'msg3');
DROP TABLE IF EXISTS archive;
CREATE TABLE archive (id INT64, data STRING, created_at INT64);
INSERT INTO archive VALUES (1, 'old', 100), (2, 'old', 200), (3, 'new', 300);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, amount FLOAT64, tax_rate FLOAT64);
INSERT INTO sales VALUES (1, 100, 0.1), (2, 200, 0.1), (3, 50, 0.05);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, status STRING);
INSERT INTO items VALUES (1, 'active'), (2, 'active');
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64, task STRING);
INSERT INTO queue VALUES (1, 10, 'low'), (2, 100, 'high'), (3, 50, 'med');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, customer_id INT64);
DROP TABLE IF EXISTS order_items;
CREATE TABLE order_items (order_id INT64, product_id INT64);
INSERT INTO orders VALUES (1, 100), (2, 101);
INSERT INTO order_items VALUES (1, 200), (1, 201), (2, 202);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category_id INT64);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, deleted BOOL);
INSERT INTO items VALUES (1, 10), (2, NULL), (3, 20);
INSERT INTO categories VALUES (10, true), (20, false);
DROP TABLE IF EXISTS temp;
CREATE TABLE temp (id INT64, value STRING);
INSERT INTO temp VALUES (1, 'a'), (2, 'b'), (3, 'c');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, type STRING, timestamp INT64, processed BOOL);
INSERT INTO events VALUES (1, 'A', 100, true), (2, 'B', 200, false), (3, 'A', 150, true), (4, 'A', 180, false);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 100), (2, 200), (3, 150), (4, 180);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, level STRING);
INSERT INTO logs VALUES (1, 'DEBUG'), (2, 'DEBUG'), (3, 'DEBUG'), (4, 'ERROR');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS parents;
CREATE TABLE parents (id INT64 PRIMARY KEY);
DROP TABLE IF EXISTS children;
CREATE TABLE children (id INT64, parent_id INT64, FOREIGN KEY (parent_id) REFERENCES parents(id) ON DELETE CASCADE);
INSERT INTO parents VALUES (1), (2);
INSERT INTO children VALUES (10, 1), (11, 1), (12, 2);

DELETE FROM items USING suppliers, warehouses WHERE items.supplier_id = suppliers.id AND items.warehouse_id = warehouses.id AND (suppliers.active = false OR warehouses.closed = true);
SELECT id FROM items ORDER BY id;
DELETE FROM transactions USING (SELECT id, balance FROM accounts) a WHERE transactions.account_id = a.id AND transactions.amount > a.balance;
SELECT id FROM transactions ORDER BY id;
DELETE FROM logs WHERE level = 'DEBUG' RETURNING *;
SELECT COUNT(*) FROM logs;
DELETE FROM archive WHERE data = 'old' RETURNING id, data;
DELETE FROM sales WHERE amount < 100 RETURNING id, amount * (1 + tax_rate) AS total;
DELETE FROM items WHERE status = 'deleted' RETURNING *;
SELECT COUNT(*) FROM items;
DELETE FROM queue WHERE priority >= 50 RETURNING id, task ORDER BY priority DESC LIMIT 1;
DELETE orders, order_items FROM orders INNER JOIN order_items ON orders.id = order_items.order_id WHERE orders.customer_id = 100;
SELECT id FROM orders ORDER BY id;
SELECT order_id FROM order_items ORDER BY order_id;
DELETE i FROM items i INNER JOIN categories c ON i.category_id = c.id WHERE c.deleted = true;
SELECT id FROM items ORDER BY id;
DELETE FROM temp;
SELECT COUNT(*) FROM temp;
DELETE FROM events WHERE type = 'A' AND timestamp < 150 AND processed = true;
SELECT id FROM events ORDER BY id;
DELETE FROM products WHERE price < (SELECT AVG(price) FROM products);
SELECT id FROM products ORDER BY id;
DELETE FROM nonexistent_table WHERE id = 1;
DELETE FROM test WHERE nonexistent_column = 1;
DELETE FROM logs WHERE level = 'DEBUG' LIMIT 2;
SELECT COUNT(*) FROM logs WHERE level = 'DEBUG';
DELETE FROM data WHERE id > 1000;
SELECT COUNT(*) FROM data;
DELETE FROM parents WHERE id = 1;
SELECT id FROM children ORDER BY id;

-- ============================================================================
-- Test: test_delete_using_with_subquery
-- Source: delete_enhancements_tdd.rs:239
-- ============================================================================
DROP TABLE IF EXISTS transactions;
CREATE TABLE transactions (id INT64, account_id INT64, amount FLOAT64);
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (id INT64, balance FLOAT64);
INSERT INTO transactions VALUES (1, 100, 50), (2, 100, 1000), (3, 101, 25);
INSERT INTO accounts VALUES (100, 100), (101, 1000);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, level STRING, message STRING);
INSERT INTO logs VALUES (1, 'DEBUG', 'msg1'), (2, 'ERROR', 'msg2'), (3, 'DEBUG', 'msg3');
DROP TABLE IF EXISTS archive;
CREATE TABLE archive (id INT64, data STRING, created_at INT64);
INSERT INTO archive VALUES (1, 'old', 100), (2, 'old', 200), (3, 'new', 300);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, amount FLOAT64, tax_rate FLOAT64);
INSERT INTO sales VALUES (1, 100, 0.1), (2, 200, 0.1), (3, 50, 0.05);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, status STRING);
INSERT INTO items VALUES (1, 'active'), (2, 'active');
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64, task STRING);
INSERT INTO queue VALUES (1, 10, 'low'), (2, 100, 'high'), (3, 50, 'med');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, customer_id INT64);
DROP TABLE IF EXISTS order_items;
CREATE TABLE order_items (order_id INT64, product_id INT64);
INSERT INTO orders VALUES (1, 100), (2, 101);
INSERT INTO order_items VALUES (1, 200), (1, 201), (2, 202);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category_id INT64);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, deleted BOOL);
INSERT INTO items VALUES (1, 10), (2, NULL), (3, 20);
INSERT INTO categories VALUES (10, true), (20, false);
DROP TABLE IF EXISTS temp;
CREATE TABLE temp (id INT64, value STRING);
INSERT INTO temp VALUES (1, 'a'), (2, 'b'), (3, 'c');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, type STRING, timestamp INT64, processed BOOL);
INSERT INTO events VALUES (1, 'A', 100, true), (2, 'B', 200, false), (3, 'A', 150, true), (4, 'A', 180, false);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 100), (2, 200), (3, 150), (4, 180);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, level STRING);
INSERT INTO logs VALUES (1, 'DEBUG'), (2, 'DEBUG'), (3, 'DEBUG'), (4, 'ERROR');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS parents;
CREATE TABLE parents (id INT64 PRIMARY KEY);
DROP TABLE IF EXISTS children;
CREATE TABLE children (id INT64, parent_id INT64, FOREIGN KEY (parent_id) REFERENCES parents(id) ON DELETE CASCADE);
INSERT INTO parents VALUES (1), (2);
INSERT INTO children VALUES (10, 1), (11, 1), (12, 2);

DELETE FROM transactions USING (SELECT id, balance FROM accounts) a WHERE transactions.account_id = a.id AND transactions.amount > a.balance;
SELECT id FROM transactions ORDER BY id;
DELETE FROM logs WHERE level = 'DEBUG' RETURNING *;
SELECT COUNT(*) FROM logs;
DELETE FROM archive WHERE data = 'old' RETURNING id, data;
DELETE FROM sales WHERE amount < 100 RETURNING id, amount * (1 + tax_rate) AS total;
DELETE FROM items WHERE status = 'deleted' RETURNING *;
SELECT COUNT(*) FROM items;
DELETE FROM queue WHERE priority >= 50 RETURNING id, task ORDER BY priority DESC LIMIT 1;
DELETE orders, order_items FROM orders INNER JOIN order_items ON orders.id = order_items.order_id WHERE orders.customer_id = 100;
SELECT id FROM orders ORDER BY id;
SELECT order_id FROM order_items ORDER BY order_id;
DELETE i FROM items i INNER JOIN categories c ON i.category_id = c.id WHERE c.deleted = true;
SELECT id FROM items ORDER BY id;
DELETE FROM temp;
SELECT COUNT(*) FROM temp;
DELETE FROM events WHERE type = 'A' AND timestamp < 150 AND processed = true;
SELECT id FROM events ORDER BY id;
DELETE FROM products WHERE price < (SELECT AVG(price) FROM products);
SELECT id FROM products ORDER BY id;
DELETE FROM nonexistent_table WHERE id = 1;
DELETE FROM test WHERE nonexistent_column = 1;
DELETE FROM logs WHERE level = 'DEBUG' LIMIT 2;
SELECT COUNT(*) FROM logs WHERE level = 'DEBUG';
DELETE FROM data WHERE id > 1000;
SELECT COUNT(*) FROM data;
DELETE FROM parents WHERE id = 1;
SELECT id FROM children ORDER BY id;

-- ============================================================================
-- Test: test_delete_returning_all_columns
-- Source: delete_enhancements_tdd.rs:287
-- ============================================================================
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, level STRING, message STRING);
INSERT INTO logs VALUES (1, 'DEBUG', 'msg1'), (2, 'ERROR', 'msg2'), (3, 'DEBUG', 'msg3');
DROP TABLE IF EXISTS archive;
CREATE TABLE archive (id INT64, data STRING, created_at INT64);
INSERT INTO archive VALUES (1, 'old', 100), (2, 'old', 200), (3, 'new', 300);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, amount FLOAT64, tax_rate FLOAT64);
INSERT INTO sales VALUES (1, 100, 0.1), (2, 200, 0.1), (3, 50, 0.05);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, status STRING);
INSERT INTO items VALUES (1, 'active'), (2, 'active');
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64, task STRING);
INSERT INTO queue VALUES (1, 10, 'low'), (2, 100, 'high'), (3, 50, 'med');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, customer_id INT64);
DROP TABLE IF EXISTS order_items;
CREATE TABLE order_items (order_id INT64, product_id INT64);
INSERT INTO orders VALUES (1, 100), (2, 101);
INSERT INTO order_items VALUES (1, 200), (1, 201), (2, 202);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category_id INT64);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, deleted BOOL);
INSERT INTO items VALUES (1, 10), (2, NULL), (3, 20);
INSERT INTO categories VALUES (10, true), (20, false);
DROP TABLE IF EXISTS temp;
CREATE TABLE temp (id INT64, value STRING);
INSERT INTO temp VALUES (1, 'a'), (2, 'b'), (3, 'c');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, type STRING, timestamp INT64, processed BOOL);
INSERT INTO events VALUES (1, 'A', 100, true), (2, 'B', 200, false), (3, 'A', 150, true), (4, 'A', 180, false);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 100), (2, 200), (3, 150), (4, 180);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, level STRING);
INSERT INTO logs VALUES (1, 'DEBUG'), (2, 'DEBUG'), (3, 'DEBUG'), (4, 'ERROR');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS parents;
CREATE TABLE parents (id INT64 PRIMARY KEY);
DROP TABLE IF EXISTS children;
CREATE TABLE children (id INT64, parent_id INT64, FOREIGN KEY (parent_id) REFERENCES parents(id) ON DELETE CASCADE);
INSERT INTO parents VALUES (1), (2);
INSERT INTO children VALUES (10, 1), (11, 1), (12, 2);

DELETE FROM logs WHERE level = 'DEBUG' RETURNING *;
SELECT COUNT(*) FROM logs;
DELETE FROM archive WHERE data = 'old' RETURNING id, data;
DELETE FROM sales WHERE amount < 100 RETURNING id, amount * (1 + tax_rate) AS total;
DELETE FROM items WHERE status = 'deleted' RETURNING *;
SELECT COUNT(*) FROM items;
DELETE FROM queue WHERE priority >= 50 RETURNING id, task ORDER BY priority DESC LIMIT 1;
DELETE orders, order_items FROM orders INNER JOIN order_items ON orders.id = order_items.order_id WHERE orders.customer_id = 100;
SELECT id FROM orders ORDER BY id;
SELECT order_id FROM order_items ORDER BY order_id;
DELETE i FROM items i INNER JOIN categories c ON i.category_id = c.id WHERE c.deleted = true;
SELECT id FROM items ORDER BY id;
DELETE FROM temp;
SELECT COUNT(*) FROM temp;
DELETE FROM events WHERE type = 'A' AND timestamp < 150 AND processed = true;
SELECT id FROM events ORDER BY id;
DELETE FROM products WHERE price < (SELECT AVG(price) FROM products);
SELECT id FROM products ORDER BY id;
DELETE FROM nonexistent_table WHERE id = 1;
DELETE FROM test WHERE nonexistent_column = 1;
DELETE FROM logs WHERE level = 'DEBUG' LIMIT 2;
SELECT COUNT(*) FROM logs WHERE level = 'DEBUG';
DELETE FROM data WHERE id > 1000;
SELECT COUNT(*) FROM data;
DELETE FROM parents WHERE id = 1;
SELECT id FROM children ORDER BY id;

-- ============================================================================
-- Test: test_delete_returning_specific_columns
-- Source: delete_enhancements_tdd.rs:326
-- ============================================================================
DROP TABLE IF EXISTS archive;
CREATE TABLE archive (id INT64, data STRING, created_at INT64);
INSERT INTO archive VALUES (1, 'old', 100), (2, 'old', 200), (3, 'new', 300);
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, amount FLOAT64, tax_rate FLOAT64);
INSERT INTO sales VALUES (1, 100, 0.1), (2, 200, 0.1), (3, 50, 0.05);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, status STRING);
INSERT INTO items VALUES (1, 'active'), (2, 'active');
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64, task STRING);
INSERT INTO queue VALUES (1, 10, 'low'), (2, 100, 'high'), (3, 50, 'med');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, customer_id INT64);
DROP TABLE IF EXISTS order_items;
CREATE TABLE order_items (order_id INT64, product_id INT64);
INSERT INTO orders VALUES (1, 100), (2, 101);
INSERT INTO order_items VALUES (1, 200), (1, 201), (2, 202);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category_id INT64);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, deleted BOOL);
INSERT INTO items VALUES (1, 10), (2, NULL), (3, 20);
INSERT INTO categories VALUES (10, true), (20, false);
DROP TABLE IF EXISTS temp;
CREATE TABLE temp (id INT64, value STRING);
INSERT INTO temp VALUES (1, 'a'), (2, 'b'), (3, 'c');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, type STRING, timestamp INT64, processed BOOL);
INSERT INTO events VALUES (1, 'A', 100, true), (2, 'B', 200, false), (3, 'A', 150, true), (4, 'A', 180, false);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 100), (2, 200), (3, 150), (4, 180);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, level STRING);
INSERT INTO logs VALUES (1, 'DEBUG'), (2, 'DEBUG'), (3, 'DEBUG'), (4, 'ERROR');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS parents;
CREATE TABLE parents (id INT64 PRIMARY KEY);
DROP TABLE IF EXISTS children;
CREATE TABLE children (id INT64, parent_id INT64, FOREIGN KEY (parent_id) REFERENCES parents(id) ON DELETE CASCADE);
INSERT INTO parents VALUES (1), (2);
INSERT INTO children VALUES (10, 1), (11, 1), (12, 2);

DELETE FROM archive WHERE data = 'old' RETURNING id, data;
DELETE FROM sales WHERE amount < 100 RETURNING id, amount * (1 + tax_rate) AS total;
DELETE FROM items WHERE status = 'deleted' RETURNING *;
SELECT COUNT(*) FROM items;
DELETE FROM queue WHERE priority >= 50 RETURNING id, task ORDER BY priority DESC LIMIT 1;
DELETE orders, order_items FROM orders INNER JOIN order_items ON orders.id = order_items.order_id WHERE orders.customer_id = 100;
SELECT id FROM orders ORDER BY id;
SELECT order_id FROM order_items ORDER BY order_id;
DELETE i FROM items i INNER JOIN categories c ON i.category_id = c.id WHERE c.deleted = true;
SELECT id FROM items ORDER BY id;
DELETE FROM temp;
SELECT COUNT(*) FROM temp;
DELETE FROM events WHERE type = 'A' AND timestamp < 150 AND processed = true;
SELECT id FROM events ORDER BY id;
DELETE FROM products WHERE price < (SELECT AVG(price) FROM products);
SELECT id FROM products ORDER BY id;
DELETE FROM nonexistent_table WHERE id = 1;
DELETE FROM test WHERE nonexistent_column = 1;
DELETE FROM logs WHERE level = 'DEBUG' LIMIT 2;
SELECT COUNT(*) FROM logs WHERE level = 'DEBUG';
DELETE FROM data WHERE id > 1000;
SELECT COUNT(*) FROM data;
DELETE FROM parents WHERE id = 1;
SELECT id FROM children ORDER BY id;

-- ============================================================================
-- Test: test_delete_returning_computed_expression
-- Source: delete_enhancements_tdd.rs:357
-- ============================================================================
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, amount FLOAT64, tax_rate FLOAT64);
INSERT INTO sales VALUES (1, 100, 0.1), (2, 200, 0.1), (3, 50, 0.05);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, status STRING);
INSERT INTO items VALUES (1, 'active'), (2, 'active');
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64, task STRING);
INSERT INTO queue VALUES (1, 10, 'low'), (2, 100, 'high'), (3, 50, 'med');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, customer_id INT64);
DROP TABLE IF EXISTS order_items;
CREATE TABLE order_items (order_id INT64, product_id INT64);
INSERT INTO orders VALUES (1, 100), (2, 101);
INSERT INTO order_items VALUES (1, 200), (1, 201), (2, 202);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category_id INT64);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, deleted BOOL);
INSERT INTO items VALUES (1, 10), (2, NULL), (3, 20);
INSERT INTO categories VALUES (10, true), (20, false);
DROP TABLE IF EXISTS temp;
CREATE TABLE temp (id INT64, value STRING);
INSERT INTO temp VALUES (1, 'a'), (2, 'b'), (3, 'c');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, type STRING, timestamp INT64, processed BOOL);
INSERT INTO events VALUES (1, 'A', 100, true), (2, 'B', 200, false), (3, 'A', 150, true), (4, 'A', 180, false);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 100), (2, 200), (3, 150), (4, 180);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, level STRING);
INSERT INTO logs VALUES (1, 'DEBUG'), (2, 'DEBUG'), (3, 'DEBUG'), (4, 'ERROR');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS parents;
CREATE TABLE parents (id INT64 PRIMARY KEY);
DROP TABLE IF EXISTS children;
CREATE TABLE children (id INT64, parent_id INT64, FOREIGN KEY (parent_id) REFERENCES parents(id) ON DELETE CASCADE);
INSERT INTO parents VALUES (1), (2);
INSERT INTO children VALUES (10, 1), (11, 1), (12, 2);

DELETE FROM sales WHERE amount < 100 RETURNING id, amount * (1 + tax_rate) AS total;
DELETE FROM items WHERE status = 'deleted' RETURNING *;
SELECT COUNT(*) FROM items;
DELETE FROM queue WHERE priority >= 50 RETURNING id, task ORDER BY priority DESC LIMIT 1;
DELETE orders, order_items FROM orders INNER JOIN order_items ON orders.id = order_items.order_id WHERE orders.customer_id = 100;
SELECT id FROM orders ORDER BY id;
SELECT order_id FROM order_items ORDER BY order_id;
DELETE i FROM items i INNER JOIN categories c ON i.category_id = c.id WHERE c.deleted = true;
SELECT id FROM items ORDER BY id;
DELETE FROM temp;
SELECT COUNT(*) FROM temp;
DELETE FROM events WHERE type = 'A' AND timestamp < 150 AND processed = true;
SELECT id FROM events ORDER BY id;
DELETE FROM products WHERE price < (SELECT AVG(price) FROM products);
SELECT id FROM products ORDER BY id;
DELETE FROM nonexistent_table WHERE id = 1;
DELETE FROM test WHERE nonexistent_column = 1;
DELETE FROM logs WHERE level = 'DEBUG' LIMIT 2;
SELECT COUNT(*) FROM logs WHERE level = 'DEBUG';
DELETE FROM data WHERE id > 1000;
SELECT COUNT(*) FROM data;
DELETE FROM parents WHERE id = 1;
SELECT id FROM children ORDER BY id;

-- ============================================================================
-- Test: test_delete_returning_no_rows_deleted
-- Source: delete_enhancements_tdd.rs:383
-- ============================================================================
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, status STRING);
INSERT INTO items VALUES (1, 'active'), (2, 'active');
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64, task STRING);
INSERT INTO queue VALUES (1, 10, 'low'), (2, 100, 'high'), (3, 50, 'med');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, customer_id INT64);
DROP TABLE IF EXISTS order_items;
CREATE TABLE order_items (order_id INT64, product_id INT64);
INSERT INTO orders VALUES (1, 100), (2, 101);
INSERT INTO order_items VALUES (1, 200), (1, 201), (2, 202);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category_id INT64);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, deleted BOOL);
INSERT INTO items VALUES (1, 10), (2, NULL), (3, 20);
INSERT INTO categories VALUES (10, true), (20, false);
DROP TABLE IF EXISTS temp;
CREATE TABLE temp (id INT64, value STRING);
INSERT INTO temp VALUES (1, 'a'), (2, 'b'), (3, 'c');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, type STRING, timestamp INT64, processed BOOL);
INSERT INTO events VALUES (1, 'A', 100, true), (2, 'B', 200, false), (3, 'A', 150, true), (4, 'A', 180, false);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 100), (2, 200), (3, 150), (4, 180);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, level STRING);
INSERT INTO logs VALUES (1, 'DEBUG'), (2, 'DEBUG'), (3, 'DEBUG'), (4, 'ERROR');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS parents;
CREATE TABLE parents (id INT64 PRIMARY KEY);
DROP TABLE IF EXISTS children;
CREATE TABLE children (id INT64, parent_id INT64, FOREIGN KEY (parent_id) REFERENCES parents(id) ON DELETE CASCADE);
INSERT INTO parents VALUES (1), (2);
INSERT INTO children VALUES (10, 1), (11, 1), (12, 2);

DELETE FROM items WHERE status = 'deleted' RETURNING *;
SELECT COUNT(*) FROM items;
DELETE FROM queue WHERE priority >= 50 RETURNING id, task ORDER BY priority DESC LIMIT 1;
DELETE orders, order_items FROM orders INNER JOIN order_items ON orders.id = order_items.order_id WHERE orders.customer_id = 100;
SELECT id FROM orders ORDER BY id;
SELECT order_id FROM order_items ORDER BY order_id;
DELETE i FROM items i INNER JOIN categories c ON i.category_id = c.id WHERE c.deleted = true;
SELECT id FROM items ORDER BY id;
DELETE FROM temp;
SELECT COUNT(*) FROM temp;
DELETE FROM events WHERE type = 'A' AND timestamp < 150 AND processed = true;
SELECT id FROM events ORDER BY id;
DELETE FROM products WHERE price < (SELECT AVG(price) FROM products);
SELECT id FROM products ORDER BY id;
DELETE FROM nonexistent_table WHERE id = 1;
DELETE FROM test WHERE nonexistent_column = 1;
DELETE FROM logs WHERE level = 'DEBUG' LIMIT 2;
SELECT COUNT(*) FROM logs WHERE level = 'DEBUG';
DELETE FROM data WHERE id > 1000;
SELECT COUNT(*) FROM data;
DELETE FROM parents WHERE id = 1;
SELECT id FROM children ORDER BY id;

-- ============================================================================
-- Test: test_delete_returning_with_order_by
-- Source: delete_enhancements_tdd.rs:420
-- ============================================================================
DROP TABLE IF EXISTS queue;
CREATE TABLE queue (id INT64, priority INT64, task STRING);
INSERT INTO queue VALUES (1, 10, 'low'), (2, 100, 'high'), (3, 50, 'med');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, customer_id INT64);
DROP TABLE IF EXISTS order_items;
CREATE TABLE order_items (order_id INT64, product_id INT64);
INSERT INTO orders VALUES (1, 100), (2, 101);
INSERT INTO order_items VALUES (1, 200), (1, 201), (2, 202);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category_id INT64);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, deleted BOOL);
INSERT INTO items VALUES (1, 10), (2, NULL), (3, 20);
INSERT INTO categories VALUES (10, true), (20, false);
DROP TABLE IF EXISTS temp;
CREATE TABLE temp (id INT64, value STRING);
INSERT INTO temp VALUES (1, 'a'), (2, 'b'), (3, 'c');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, type STRING, timestamp INT64, processed BOOL);
INSERT INTO events VALUES (1, 'A', 100, true), (2, 'B', 200, false), (3, 'A', 150, true), (4, 'A', 180, false);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 100), (2, 200), (3, 150), (4, 180);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, level STRING);
INSERT INTO logs VALUES (1, 'DEBUG'), (2, 'DEBUG'), (3, 'DEBUG'), (4, 'ERROR');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS parents;
CREATE TABLE parents (id INT64 PRIMARY KEY);
DROP TABLE IF EXISTS children;
CREATE TABLE children (id INT64, parent_id INT64, FOREIGN KEY (parent_id) REFERENCES parents(id) ON DELETE CASCADE);
INSERT INTO parents VALUES (1), (2);
INSERT INTO children VALUES (10, 1), (11, 1), (12, 2);

DELETE FROM queue WHERE priority >= 50 RETURNING id, task ORDER BY priority DESC LIMIT 1;
DELETE orders, order_items FROM orders INNER JOIN order_items ON orders.id = order_items.order_id WHERE orders.customer_id = 100;
SELECT id FROM orders ORDER BY id;
SELECT order_id FROM order_items ORDER BY order_id;
DELETE i FROM items i INNER JOIN categories c ON i.category_id = c.id WHERE c.deleted = true;
SELECT id FROM items ORDER BY id;
DELETE FROM temp;
SELECT COUNT(*) FROM temp;
DELETE FROM events WHERE type = 'A' AND timestamp < 150 AND processed = true;
SELECT id FROM events ORDER BY id;
DELETE FROM products WHERE price < (SELECT AVG(price) FROM products);
SELECT id FROM products ORDER BY id;
DELETE FROM nonexistent_table WHERE id = 1;
DELETE FROM test WHERE nonexistent_column = 1;
DELETE FROM logs WHERE level = 'DEBUG' LIMIT 2;
SELECT COUNT(*) FROM logs WHERE level = 'DEBUG';
DELETE FROM data WHERE id > 1000;
SELECT COUNT(*) FROM data;
DELETE FROM parents WHERE id = 1;
SELECT id FROM children ORDER BY id;

-- ============================================================================
-- Test: test_merge_with_join_source
-- Source: merge_statement_comprehensive_tdd.rs:595
-- ============================================================================
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING, category_id INT64);
INSERT INTO products VALUES (1, 'Widget', 1);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, name STRING);
INSERT INTO categories VALUES (1, 'Hardware'), (2, 'Software');
DROP TABLE IF EXISTS product_details;
CREATE TABLE product_details (id INT64, category_name STRING);
DROP TABLE IF EXISTS target;
CREATE TABLE target (id INT64, value STRING);
INSERT INTO target VALUES (1, 'one'), (NULL, 'null_target');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value STRING);
INSERT INTO source VALUES (1, 'updated'), (NULL, 'null_source');
DROP TABLE IF EXISTS target;
CREATE TABLE target (id INT64);
INSERT INTO target VALUES (1), (2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS target;
CREATE TABLE target (id INT64);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
INSERT INTO source VALUES (1), (2);
DROP TABLE IF EXISTS target;
CREATE TABLE target (id INT64, value STRING);
INSERT INTO target VALUES (1, 'original');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value STRING);
INSERT INTO source VALUES (1, 'update1'), (1, 'update2');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS target;
CREATE TABLE target (id INT64);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id STRING);
DROP TABLE IF EXISTS target;
CREATE TABLE target (id INT64);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64);
DROP TABLE IF EXISTS target;
CREATE TABLE target (id INT64 PRIMARY KEY, value INT64);
INSERT INTO target VALUES (1, 10);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
INSERT INTO source VALUES (1, 20), (2, 30), (2, 40);
DROP TABLE IF EXISTS target;
CREATE TABLE target (id INT64, value INT64);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
DROP TABLE IF EXISTS target;
CREATE TABLE target (id INT64, value INT64);
INSERT INTO target VALUES (1, 10);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value INT64);
INSERT INTO source VALUES (1, 20), (2, 30);

MERGE INTO product_details pd USING ( SELECT p.id, c.name as category_name FROM products p JOIN categories c ON p.category_id = c.id ) src ON pd.id = src.id WHEN MATCHED THEN UPDATE SET pd.category_name = src.category_name WHEN NOT MATCHED THEN INSERT (id, category_name) VALUES (src.id, src.category_name);
SELECT * FROM product_details;
MERGE INTO target t USING source s ON t.id = s.id WHEN MATCHED THEN UPDATE SET t.value = s.value WHEN NOT MATCHED THEN INSERT (id, value) VALUES (s.id, s.value);
SELECT * FROM target WHERE id IS NOT NULL ORDER BY id;
MERGE INTO target t USING source s ON t.id = s.id WHEN MATCHED THEN UPDATE SET t.id = s.id WHEN NOT MATCHED BY SOURCE THEN DELETE;
MERGE INTO target t USING source s ON t.id = s.id WHEN NOT MATCHED THEN INSERT (id) VALUES (s.id);
MERGE INTO target t USING source s ON t.id = s.id WHEN MATCHED THEN UPDATE SET t.value = s.value;
MERGE INTO nonexistent t USING source s ON t.id = s.id WHEN MATCHED THEN UPDATE SET t.id = s.id;
MERGE INTO target t USING source s ON t.id = s.id WHEN MATCHED THEN UPDATE SET t.id = 1;
MERGE INTO target t USING source s ON t.id = s.id WHEN MATCHED THEN UPDATE SET t.nonexistent = 1;
MERGE INTO target t USING source s ON t.id = s.id WHEN MATCHED THEN UPDATE SET t.value = s.value WHEN NOT MATCHED THEN INSERT (id, value) VALUES (s.id, s.value);
SELECT value FROM target WHERE id = 1;
MERGE INTO target t USING source s ON t.id = s.id WHEN MATCHED THEN UPDATE SET t.value = s.value WHEN NOT MATCHED THEN INSERT (id, value) VALUES (s.id, s.value);
MERGE INTO target t USING source s ON t.id = s.id WHEN MATCHED THEN UPDATE SET t.value = s.value WHEN NOT MATCHED THEN INSERT (id, value) VALUES (s.id, s.value) RETURNING t.id, t.value;

-- ============================================================================
-- Test: test_insert_select_extremely_large_dataset
-- Source: p1_features_error_handling_stress_tdd.rs:24
-- ============================================================================
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, data STRING);
DROP TABLE IF EXISTS destination;
CREATE TABLE destination (id INT64, data STRING);
INSERT INTO destination SELECT id, data FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, long_text STRING);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value STRING);
INSERT INTO source VALUES (1, 'valid');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64 PRIMARY KEY, value STRING);
INSERT INTO dest VALUES (1, 'existing');
INSERT INTO dest SELECT id, value FROM source;
INSERT INTO dest VALUES (2, 'new');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY, value INT64);
INSERT INTO data VALUES (1, 100);
INSERT INTO data VALUES \ (2, 200), \ (3, 300), \ (4, 400), \ (5, 500), \ (1, 600);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY, value STRING);
INSERT INTO data VALUES (1, 'test');
ALTER TABLE data ADD COLUMN id INT64;
DROP TABLE IF EXISTS outer_table;
CREATE TABLE outer_table (id INT64, name STRING);
INSERT INTO outer_table VALUES (1, 'Alice');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE, amount FLOAT64);
INSERT INTO events VALUES (1, DATE '2024-01-01', 100.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (1), (2), (3);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (1, 2, 3), (4, 5, 6);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result FLOAT64);
INSERT INTO dest \ SELECT CAST(((a + b) * c) / CAST(a AS FLOAT64) + SQRT(CAST(b * c AS FLOAT64)) AS FLOAT64) \ FROM source;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64, amount FLOAT64);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (customer_id INT64, name STRING, region STRING);
DROP TABLE IF EXISTS regions;
CREATE TABLE regions (region STRING, tax_rate FLOAT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (customer_name STRING, total_with_tax FLOAT64);
INSERT INTO orders VALUES (1, 1, 100.0), (2, 1, 150.0), (3, 2, 200.0);
INSERT INTO customers VALUES (1, 'Alice', 'East'), (2, 'Bob', 'West');
INSERT INTO regions VALUES ('East', 0.05), ('West', 0.08);
INSERT INTO summary \ SELECT c.name, SUM(o.amount * (1 + r.tax_rate)) \ FROM orders o \ JOIN customers c ON o.customer_id = c.customer_id \ JOIN regions r ON c.region = r.region \ GROUP BY c.name;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, text_value STRING);
INSERT INTO source VALUES (1, 'not_a_number');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, numeric_value INT64);
INSERT INTO dest SELECT id, text_value FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value NUMERIC(18, 8));
INSERT INTO source VALUES (CAST(3.14159265 AS NUMERIC(18, 8)));
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value NUMERIC(10, 2));
INSERT INTO dest SELECT CAST(value AS NUMERIC(10, 2)) FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value FLOAT64);
INSERT INTO data VALUES (1e308), (1e308), (1e308);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, required STRING NOT NULL);
INSERT INTO data (id) VALUES (1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (2), (3), (1), (4);
DROP TABLE IF EXISTS outer_t;
CREATE TABLE outer_t (id INT64, num_value INT64);
INSERT INTO outer_t VALUES (1, 10);
DROP TABLE IF EXISTS inner_t;
CREATE TABLE inner_t (id INT64, str_value STRING);
INSERT INTO inner_t VALUES (1, 'text');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, DATE '2024-01-01');
DROP TABLE IF EXISTS evolving;
CREATE TABLE evolving (id INT64, name STRING);
INSERT INTO evolving VALUES (1, 'test');
ALTER TABLE evolving ADD COLUMN age INT64 DEFAULT 0;
ALTER TABLE evolving ADD COLUMN email STRING;
INSERT INTO evolving (id, name, age, email) VALUES (2, 'new', 25, 'test@example.com');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, name STRING);
INSERT INTO source VALUES (1, 'Alice');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
ALTER TABLE dest ADD COLUMN name STRING;
INSERT INTO dest SELECT id, name FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, nullable_col STRING);
INSERT INTO source VALUES (1, NULL), (2, NULL), (3, NULL);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, nullable_col STRING);
INSERT INTO dest SELECT id, nullable_col FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, a NUMERIC(10, 2), b NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.5, NULL);
DROP TABLE IF EXISTS result;
CREATE TABLE result (id INT64, sum NUMERIC(10, 2));
INSERT INTO result SELECT id, a + b FROM data;
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, NULL), (3, 20), (4, NULL);

SELECT COUNT(*) FROM destination;
SELECT COUNT(*) FROM data;
SELECT COUNT(*) FROM dest;
SELECT COUNT(*) FROM data;
SELECT value FROM data WHERE id = 1;
SELECT id, value FROM data;
SELECT id, value, id FROM data;
SELECT name FROM outer_table WHERE EXISTS (SELECT 1 FROM non_existent_table);
SELECT EXTRACT(INVALID_PART FROM event_date) as part, SUM(amount) \ FROM events \ GROUP BY part;
SELECT COUNT(*) FROM dest;
SELECT COUNT(*) FROM summary;
SELECT value FROM dest;
SELECT SUM(value) as total FROM data;
SELECT id FROM outer_t WHERE num_value = ANY (SELECT str_value FROM inner_t);
SELECT EXTRACT(MILLISECOND FROM event_date) FROM events;
SELECT age FROM evolving WHERE id = 1;
SELECT COUNT(*) FROM data;
SELECT id, name FROM dest;
SELECT COUNT(*) FROM dest WHERE nullable_col IS NULL;
SELECT sum FROM result;
SELECT DATE_ADD(event_date, INTERVAL 7 DAY) as future_date FROM events;
SELECT COUNT(*) as count_all, COUNT(value) as count_non_null, SUM(value) as sum FROM data;

-- ============================================================================
-- Test: test_multi_row_insert_maximum_rows_single_statement
-- Source: p1_features_error_handling_stress_tdd.rs:63
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, long_text STRING);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value STRING);
INSERT INTO source VALUES (1, 'valid');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64 PRIMARY KEY, value STRING);
INSERT INTO dest VALUES (1, 'existing');
INSERT INTO dest SELECT id, value FROM source;
INSERT INTO dest VALUES (2, 'new');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY, value INT64);
INSERT INTO data VALUES (1, 100);
INSERT INTO data VALUES \ (2, 200), \ (3, 300), \ (4, 400), \ (5, 500), \ (1, 600);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY, value STRING);
INSERT INTO data VALUES (1, 'test');
ALTER TABLE data ADD COLUMN id INT64;
DROP TABLE IF EXISTS outer_table;
CREATE TABLE outer_table (id INT64, name STRING);
INSERT INTO outer_table VALUES (1, 'Alice');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE, amount FLOAT64);
INSERT INTO events VALUES (1, DATE '2024-01-01', 100.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (1), (2), (3);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (1, 2, 3), (4, 5, 6);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result FLOAT64);
INSERT INTO dest \ SELECT CAST(((a + b) * c) / CAST(a AS FLOAT64) + SQRT(CAST(b * c AS FLOAT64)) AS FLOAT64) \ FROM source;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64, amount FLOAT64);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (customer_id INT64, name STRING, region STRING);
DROP TABLE IF EXISTS regions;
CREATE TABLE regions (region STRING, tax_rate FLOAT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (customer_name STRING, total_with_tax FLOAT64);
INSERT INTO orders VALUES (1, 1, 100.0), (2, 1, 150.0), (3, 2, 200.0);
INSERT INTO customers VALUES (1, 'Alice', 'East'), (2, 'Bob', 'West');
INSERT INTO regions VALUES ('East', 0.05), ('West', 0.08);
INSERT INTO summary \ SELECT c.name, SUM(o.amount * (1 + r.tax_rate)) \ FROM orders o \ JOIN customers c ON o.customer_id = c.customer_id \ JOIN regions r ON c.region = r.region \ GROUP BY c.name;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, text_value STRING);
INSERT INTO source VALUES (1, 'not_a_number');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, numeric_value INT64);
INSERT INTO dest SELECT id, text_value FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value NUMERIC(18, 8));
INSERT INTO source VALUES (CAST(3.14159265 AS NUMERIC(18, 8)));
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value NUMERIC(10, 2));
INSERT INTO dest SELECT CAST(value AS NUMERIC(10, 2)) FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value FLOAT64);
INSERT INTO data VALUES (1e308), (1e308), (1e308);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, required STRING NOT NULL);
INSERT INTO data (id) VALUES (1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (2), (3), (1), (4);
DROP TABLE IF EXISTS outer_t;
CREATE TABLE outer_t (id INT64, num_value INT64);
INSERT INTO outer_t VALUES (1, 10);
DROP TABLE IF EXISTS inner_t;
CREATE TABLE inner_t (id INT64, str_value STRING);
INSERT INTO inner_t VALUES (1, 'text');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, DATE '2024-01-01');
DROP TABLE IF EXISTS evolving;
CREATE TABLE evolving (id INT64, name STRING);
INSERT INTO evolving VALUES (1, 'test');
ALTER TABLE evolving ADD COLUMN age INT64 DEFAULT 0;
ALTER TABLE evolving ADD COLUMN email STRING;
INSERT INTO evolving (id, name, age, email) VALUES (2, 'new', 25, 'test@example.com');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, name STRING);
INSERT INTO source VALUES (1, 'Alice');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
ALTER TABLE dest ADD COLUMN name STRING;
INSERT INTO dest SELECT id, name FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, nullable_col STRING);
INSERT INTO source VALUES (1, NULL), (2, NULL), (3, NULL);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, nullable_col STRING);
INSERT INTO dest SELECT id, nullable_col FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, a NUMERIC(10, 2), b NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.5, NULL);
DROP TABLE IF EXISTS result;
CREATE TABLE result (id INT64, sum NUMERIC(10, 2));
INSERT INTO result SELECT id, a + b FROM data;
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, NULL), (3, 20), (4, NULL);

SELECT COUNT(*) FROM data;
SELECT COUNT(*) FROM dest;
SELECT COUNT(*) FROM data;
SELECT value FROM data WHERE id = 1;
SELECT id, value FROM data;
SELECT id, value, id FROM data;
SELECT name FROM outer_table WHERE EXISTS (SELECT 1 FROM non_existent_table);
SELECT EXTRACT(INVALID_PART FROM event_date) as part, SUM(amount) \ FROM events \ GROUP BY part;
SELECT COUNT(*) FROM dest;
SELECT COUNT(*) FROM summary;
SELECT value FROM dest;
SELECT SUM(value) as total FROM data;
SELECT id FROM outer_t WHERE num_value = ANY (SELECT str_value FROM inner_t);
SELECT EXTRACT(MILLISECOND FROM event_date) FROM events;
SELECT age FROM evolving WHERE id = 1;
SELECT COUNT(*) FROM data;
SELECT id, name FROM dest;
SELECT COUNT(*) FROM dest WHERE nullable_col IS NULL;
SELECT sum FROM result;
SELECT DATE_ADD(event_date, INTERVAL 7 DAY) as future_date FROM events;
SELECT COUNT(*) as count_all, COUNT(value) as count_non_null, SUM(value) as sum FROM data;

-- ============================================================================
-- Test: test_insert_select_with_extremely_wide_rows
-- Source: p1_features_error_handling_stress_tdd.rs:90
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, long_text STRING);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value STRING);
INSERT INTO source VALUES (1, 'valid');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64 PRIMARY KEY, value STRING);
INSERT INTO dest VALUES (1, 'existing');
INSERT INTO dest SELECT id, value FROM source;
INSERT INTO dest VALUES (2, 'new');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY, value INT64);
INSERT INTO data VALUES (1, 100);
INSERT INTO data VALUES \ (2, 200), \ (3, 300), \ (4, 400), \ (5, 500), \ (1, 600);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY, value STRING);
INSERT INTO data VALUES (1, 'test');
ALTER TABLE data ADD COLUMN id INT64;
DROP TABLE IF EXISTS outer_table;
CREATE TABLE outer_table (id INT64, name STRING);
INSERT INTO outer_table VALUES (1, 'Alice');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE, amount FLOAT64);
INSERT INTO events VALUES (1, DATE '2024-01-01', 100.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (1), (2), (3);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (1, 2, 3), (4, 5, 6);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result FLOAT64);
INSERT INTO dest \ SELECT CAST(((a + b) * c) / CAST(a AS FLOAT64) + SQRT(CAST(b * c AS FLOAT64)) AS FLOAT64) \ FROM source;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64, amount FLOAT64);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (customer_id INT64, name STRING, region STRING);
DROP TABLE IF EXISTS regions;
CREATE TABLE regions (region STRING, tax_rate FLOAT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (customer_name STRING, total_with_tax FLOAT64);
INSERT INTO orders VALUES (1, 1, 100.0), (2, 1, 150.0), (3, 2, 200.0);
INSERT INTO customers VALUES (1, 'Alice', 'East'), (2, 'Bob', 'West');
INSERT INTO regions VALUES ('East', 0.05), ('West', 0.08);
INSERT INTO summary \ SELECT c.name, SUM(o.amount * (1 + r.tax_rate)) \ FROM orders o \ JOIN customers c ON o.customer_id = c.customer_id \ JOIN regions r ON c.region = r.region \ GROUP BY c.name;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, text_value STRING);
INSERT INTO source VALUES (1, 'not_a_number');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, numeric_value INT64);
INSERT INTO dest SELECT id, text_value FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value NUMERIC(18, 8));
INSERT INTO source VALUES (CAST(3.14159265 AS NUMERIC(18, 8)));
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value NUMERIC(10, 2));
INSERT INTO dest SELECT CAST(value AS NUMERIC(10, 2)) FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value FLOAT64);
INSERT INTO data VALUES (1e308), (1e308), (1e308);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, required STRING NOT NULL);
INSERT INTO data (id) VALUES (1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (2), (3), (1), (4);
DROP TABLE IF EXISTS outer_t;
CREATE TABLE outer_t (id INT64, num_value INT64);
INSERT INTO outer_t VALUES (1, 10);
DROP TABLE IF EXISTS inner_t;
CREATE TABLE inner_t (id INT64, str_value STRING);
INSERT INTO inner_t VALUES (1, 'text');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, DATE '2024-01-01');
DROP TABLE IF EXISTS evolving;
CREATE TABLE evolving (id INT64, name STRING);
INSERT INTO evolving VALUES (1, 'test');
ALTER TABLE evolving ADD COLUMN age INT64 DEFAULT 0;
ALTER TABLE evolving ADD COLUMN email STRING;
INSERT INTO evolving (id, name, age, email) VALUES (2, 'new', 25, 'test@example.com');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, name STRING);
INSERT INTO source VALUES (1, 'Alice');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
ALTER TABLE dest ADD COLUMN name STRING;
INSERT INTO dest SELECT id, name FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, nullable_col STRING);
INSERT INTO source VALUES (1, NULL), (2, NULL), (3, NULL);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, nullable_col STRING);
INSERT INTO dest SELECT id, nullable_col FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, a NUMERIC(10, 2), b NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.5, NULL);
DROP TABLE IF EXISTS result;
CREATE TABLE result (id INT64, sum NUMERIC(10, 2));
INSERT INTO result SELECT id, a + b FROM data;
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, NULL), (3, 20), (4, NULL);

SELECT COUNT(*) FROM dest;
SELECT COUNT(*) FROM data;
SELECT value FROM data WHERE id = 1;
SELECT id, value FROM data;
SELECT id, value, id FROM data;
SELECT name FROM outer_table WHERE EXISTS (SELECT 1 FROM non_existent_table);
SELECT EXTRACT(INVALID_PART FROM event_date) as part, SUM(amount) \ FROM events \ GROUP BY part;
SELECT COUNT(*) FROM dest;
SELECT COUNT(*) FROM summary;
SELECT value FROM dest;
SELECT SUM(value) as total FROM data;
SELECT id FROM outer_t WHERE num_value = ANY (SELECT str_value FROM inner_t);
SELECT EXTRACT(MILLISECOND FROM event_date) FROM events;
SELECT age FROM evolving WHERE id = 1;
SELECT COUNT(*) FROM data;
SELECT id, name FROM dest;
SELECT COUNT(*) FROM dest WHERE nullable_col IS NULL;
SELECT sum FROM result;
SELECT DATE_ADD(event_date, INTERVAL 7 DAY) as future_date FROM events;
SELECT COUNT(*) as count_all, COUNT(value) as count_non_null, SUM(value) as sum FROM data;

-- ============================================================================
-- Test: test_insert_with_extremely_long_string
-- Source: p1_features_error_handling_stress_tdd.rs:126
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, long_text STRING);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value STRING);
INSERT INTO source VALUES (1, 'valid');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64 PRIMARY KEY, value STRING);
INSERT INTO dest VALUES (1, 'existing');
INSERT INTO dest SELECT id, value FROM source;
INSERT INTO dest VALUES (2, 'new');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY, value INT64);
INSERT INTO data VALUES (1, 100);
INSERT INTO data VALUES \ (2, 200), \ (3, 300), \ (4, 400), \ (5, 500), \ (1, 600);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY, value STRING);
INSERT INTO data VALUES (1, 'test');
ALTER TABLE data ADD COLUMN id INT64;
DROP TABLE IF EXISTS outer_table;
CREATE TABLE outer_table (id INT64, name STRING);
INSERT INTO outer_table VALUES (1, 'Alice');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE, amount FLOAT64);
INSERT INTO events VALUES (1, DATE '2024-01-01', 100.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (1), (2), (3);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (1, 2, 3), (4, 5, 6);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result FLOAT64);
INSERT INTO dest \ SELECT CAST(((a + b) * c) / CAST(a AS FLOAT64) + SQRT(CAST(b * c AS FLOAT64)) AS FLOAT64) \ FROM source;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64, amount FLOAT64);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (customer_id INT64, name STRING, region STRING);
DROP TABLE IF EXISTS regions;
CREATE TABLE regions (region STRING, tax_rate FLOAT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (customer_name STRING, total_with_tax FLOAT64);
INSERT INTO orders VALUES (1, 1, 100.0), (2, 1, 150.0), (3, 2, 200.0);
INSERT INTO customers VALUES (1, 'Alice', 'East'), (2, 'Bob', 'West');
INSERT INTO regions VALUES ('East', 0.05), ('West', 0.08);
INSERT INTO summary \ SELECT c.name, SUM(o.amount * (1 + r.tax_rate)) \ FROM orders o \ JOIN customers c ON o.customer_id = c.customer_id \ JOIN regions r ON c.region = r.region \ GROUP BY c.name;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, text_value STRING);
INSERT INTO source VALUES (1, 'not_a_number');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, numeric_value INT64);
INSERT INTO dest SELECT id, text_value FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value NUMERIC(18, 8));
INSERT INTO source VALUES (CAST(3.14159265 AS NUMERIC(18, 8)));
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value NUMERIC(10, 2));
INSERT INTO dest SELECT CAST(value AS NUMERIC(10, 2)) FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value FLOAT64);
INSERT INTO data VALUES (1e308), (1e308), (1e308);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, required STRING NOT NULL);
INSERT INTO data (id) VALUES (1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (2), (3), (1), (4);
DROP TABLE IF EXISTS outer_t;
CREATE TABLE outer_t (id INT64, num_value INT64);
INSERT INTO outer_t VALUES (1, 10);
DROP TABLE IF EXISTS inner_t;
CREATE TABLE inner_t (id INT64, str_value STRING);
INSERT INTO inner_t VALUES (1, 'text');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, DATE '2024-01-01');
DROP TABLE IF EXISTS evolving;
CREATE TABLE evolving (id INT64, name STRING);
INSERT INTO evolving VALUES (1, 'test');
ALTER TABLE evolving ADD COLUMN age INT64 DEFAULT 0;
ALTER TABLE evolving ADD COLUMN email STRING;
INSERT INTO evolving (id, name, age, email) VALUES (2, 'new', 25, 'test@example.com');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, name STRING);
INSERT INTO source VALUES (1, 'Alice');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
ALTER TABLE dest ADD COLUMN name STRING;
INSERT INTO dest SELECT id, name FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, nullable_col STRING);
INSERT INTO source VALUES (1, NULL), (2, NULL), (3, NULL);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, nullable_col STRING);
INSERT INTO dest SELECT id, nullable_col FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, a NUMERIC(10, 2), b NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.5, NULL);
DROP TABLE IF EXISTS result;
CREATE TABLE result (id INT64, sum NUMERIC(10, 2));
INSERT INTO result SELECT id, a + b FROM data;
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, NULL), (3, 20), (4, NULL);

SELECT COUNT(*) FROM dest;
SELECT COUNT(*) FROM data;
SELECT value FROM data WHERE id = 1;
SELECT id, value FROM data;
SELECT id, value, id FROM data;
SELECT name FROM outer_table WHERE EXISTS (SELECT 1 FROM non_existent_table);
SELECT EXTRACT(INVALID_PART FROM event_date) as part, SUM(amount) \ FROM events \ GROUP BY part;
SELECT COUNT(*) FROM dest;
SELECT COUNT(*) FROM summary;
SELECT value FROM dest;
SELECT SUM(value) as total FROM data;
SELECT id FROM outer_t WHERE num_value = ANY (SELECT str_value FROM inner_t);
SELECT EXTRACT(MILLISECOND FROM event_date) FROM events;
SELECT age FROM evolving WHERE id = 1;
SELECT COUNT(*) FROM data;
SELECT id, name FROM dest;
SELECT COUNT(*) FROM dest WHERE nullable_col IS NULL;
SELECT sum FROM result;
SELECT DATE_ADD(event_date, INTERVAL 7 DAY) as future_date FROM events;
SELECT COUNT(*) as count_all, COUNT(value) as count_non_null, SUM(value) as sum FROM data;

-- ============================================================================
-- Test: test_failed_insert_select_does_not_corrupt_destination
-- Source: p1_features_error_handling_stress_tdd.rs:155
-- ============================================================================
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, value STRING);
INSERT INTO source VALUES (1, 'valid');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64 PRIMARY KEY, value STRING);
INSERT INTO dest VALUES (1, 'existing');
INSERT INTO dest SELECT id, value FROM source;
INSERT INTO dest VALUES (2, 'new');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY, value INT64);
INSERT INTO data VALUES (1, 100);
INSERT INTO data VALUES \ (2, 200), \ (3, 300), \ (4, 400), \ (5, 500), \ (1, 600);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY, value STRING);
INSERT INTO data VALUES (1, 'test');
ALTER TABLE data ADD COLUMN id INT64;
DROP TABLE IF EXISTS outer_table;
CREATE TABLE outer_table (id INT64, name STRING);
INSERT INTO outer_table VALUES (1, 'Alice');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE, amount FLOAT64);
INSERT INTO events VALUES (1, DATE '2024-01-01', 100.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (1), (2), (3);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (1, 2, 3), (4, 5, 6);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result FLOAT64);
INSERT INTO dest \ SELECT CAST(((a + b) * c) / CAST(a AS FLOAT64) + SQRT(CAST(b * c AS FLOAT64)) AS FLOAT64) \ FROM source;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64, amount FLOAT64);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (customer_id INT64, name STRING, region STRING);
DROP TABLE IF EXISTS regions;
CREATE TABLE regions (region STRING, tax_rate FLOAT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (customer_name STRING, total_with_tax FLOAT64);
INSERT INTO orders VALUES (1, 1, 100.0), (2, 1, 150.0), (3, 2, 200.0);
INSERT INTO customers VALUES (1, 'Alice', 'East'), (2, 'Bob', 'West');
INSERT INTO regions VALUES ('East', 0.05), ('West', 0.08);
INSERT INTO summary \ SELECT c.name, SUM(o.amount * (1 + r.tax_rate)) \ FROM orders o \ JOIN customers c ON o.customer_id = c.customer_id \ JOIN regions r ON c.region = r.region \ GROUP BY c.name;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, text_value STRING);
INSERT INTO source VALUES (1, 'not_a_number');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, numeric_value INT64);
INSERT INTO dest SELECT id, text_value FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value NUMERIC(18, 8));
INSERT INTO source VALUES (CAST(3.14159265 AS NUMERIC(18, 8)));
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value NUMERIC(10, 2));
INSERT INTO dest SELECT CAST(value AS NUMERIC(10, 2)) FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value FLOAT64);
INSERT INTO data VALUES (1e308), (1e308), (1e308);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, required STRING NOT NULL);
INSERT INTO data (id) VALUES (1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (2), (3), (1), (4);
DROP TABLE IF EXISTS outer_t;
CREATE TABLE outer_t (id INT64, num_value INT64);
INSERT INTO outer_t VALUES (1, 10);
DROP TABLE IF EXISTS inner_t;
CREATE TABLE inner_t (id INT64, str_value STRING);
INSERT INTO inner_t VALUES (1, 'text');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, DATE '2024-01-01');
DROP TABLE IF EXISTS evolving;
CREATE TABLE evolving (id INT64, name STRING);
INSERT INTO evolving VALUES (1, 'test');
ALTER TABLE evolving ADD COLUMN age INT64 DEFAULT 0;
ALTER TABLE evolving ADD COLUMN email STRING;
INSERT INTO evolving (id, name, age, email) VALUES (2, 'new', 25, 'test@example.com');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, name STRING);
INSERT INTO source VALUES (1, 'Alice');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
ALTER TABLE dest ADD COLUMN name STRING;
INSERT INTO dest SELECT id, name FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, nullable_col STRING);
INSERT INTO source VALUES (1, NULL), (2, NULL), (3, NULL);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, nullable_col STRING);
INSERT INTO dest SELECT id, nullable_col FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, a NUMERIC(10, 2), b NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.5, NULL);
DROP TABLE IF EXISTS result;
CREATE TABLE result (id INT64, sum NUMERIC(10, 2));
INSERT INTO result SELECT id, a + b FROM data;
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, NULL), (3, 20), (4, NULL);

SELECT COUNT(*) FROM dest;
SELECT COUNT(*) FROM data;
SELECT value FROM data WHERE id = 1;
SELECT id, value FROM data;
SELECT id, value, id FROM data;
SELECT name FROM outer_table WHERE EXISTS (SELECT 1 FROM non_existent_table);
SELECT EXTRACT(INVALID_PART FROM event_date) as part, SUM(amount) \ FROM events \ GROUP BY part;
SELECT COUNT(*) FROM dest;
SELECT COUNT(*) FROM summary;
SELECT value FROM dest;
SELECT SUM(value) as total FROM data;
SELECT id FROM outer_t WHERE num_value = ANY (SELECT str_value FROM inner_t);
SELECT EXTRACT(MILLISECOND FROM event_date) FROM events;
SELECT age FROM evolving WHERE id = 1;
SELECT COUNT(*) FROM data;
SELECT id, name FROM dest;
SELECT COUNT(*) FROM dest WHERE nullable_col IS NULL;
SELECT sum FROM result;
SELECT DATE_ADD(event_date, INTERVAL 7 DAY) as future_date FROM events;
SELECT COUNT(*) as count_all, COUNT(value) as count_non_null, SUM(value) as sum FROM data;

-- ============================================================================
-- Test: test_multi_row_insert_failure_midway_maintains_atomicity
-- Source: p1_features_error_handling_stress_tdd.rs:193
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY, value INT64);
INSERT INTO data VALUES (1, 100);
INSERT INTO data VALUES \ (2, 200), \ (3, 300), \ (4, 400), \ (5, 500), \ (1, 600);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY, value STRING);
INSERT INTO data VALUES (1, 'test');
ALTER TABLE data ADD COLUMN id INT64;
DROP TABLE IF EXISTS outer_table;
CREATE TABLE outer_table (id INT64, name STRING);
INSERT INTO outer_table VALUES (1, 'Alice');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE, amount FLOAT64);
INSERT INTO events VALUES (1, DATE '2024-01-01', 100.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (1), (2), (3);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (1, 2, 3), (4, 5, 6);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result FLOAT64);
INSERT INTO dest \ SELECT CAST(((a + b) * c) / CAST(a AS FLOAT64) + SQRT(CAST(b * c AS FLOAT64)) AS FLOAT64) \ FROM source;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64, amount FLOAT64);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (customer_id INT64, name STRING, region STRING);
DROP TABLE IF EXISTS regions;
CREATE TABLE regions (region STRING, tax_rate FLOAT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (customer_name STRING, total_with_tax FLOAT64);
INSERT INTO orders VALUES (1, 1, 100.0), (2, 1, 150.0), (3, 2, 200.0);
INSERT INTO customers VALUES (1, 'Alice', 'East'), (2, 'Bob', 'West');
INSERT INTO regions VALUES ('East', 0.05), ('West', 0.08);
INSERT INTO summary \ SELECT c.name, SUM(o.amount * (1 + r.tax_rate)) \ FROM orders o \ JOIN customers c ON o.customer_id = c.customer_id \ JOIN regions r ON c.region = r.region \ GROUP BY c.name;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, text_value STRING);
INSERT INTO source VALUES (1, 'not_a_number');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, numeric_value INT64);
INSERT INTO dest SELECT id, text_value FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value NUMERIC(18, 8));
INSERT INTO source VALUES (CAST(3.14159265 AS NUMERIC(18, 8)));
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value NUMERIC(10, 2));
INSERT INTO dest SELECT CAST(value AS NUMERIC(10, 2)) FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value FLOAT64);
INSERT INTO data VALUES (1e308), (1e308), (1e308);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, required STRING NOT NULL);
INSERT INTO data (id) VALUES (1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (2), (3), (1), (4);
DROP TABLE IF EXISTS outer_t;
CREATE TABLE outer_t (id INT64, num_value INT64);
INSERT INTO outer_t VALUES (1, 10);
DROP TABLE IF EXISTS inner_t;
CREATE TABLE inner_t (id INT64, str_value STRING);
INSERT INTO inner_t VALUES (1, 'text');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, DATE '2024-01-01');
DROP TABLE IF EXISTS evolving;
CREATE TABLE evolving (id INT64, name STRING);
INSERT INTO evolving VALUES (1, 'test');
ALTER TABLE evolving ADD COLUMN age INT64 DEFAULT 0;
ALTER TABLE evolving ADD COLUMN email STRING;
INSERT INTO evolving (id, name, age, email) VALUES (2, 'new', 25, 'test@example.com');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, name STRING);
INSERT INTO source VALUES (1, 'Alice');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
ALTER TABLE dest ADD COLUMN name STRING;
INSERT INTO dest SELECT id, name FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, nullable_col STRING);
INSERT INTO source VALUES (1, NULL), (2, NULL), (3, NULL);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, nullable_col STRING);
INSERT INTO dest SELECT id, nullable_col FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, a NUMERIC(10, 2), b NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.5, NULL);
DROP TABLE IF EXISTS result;
CREATE TABLE result (id INT64, sum NUMERIC(10, 2));
INSERT INTO result SELECT id, a + b FROM data;
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, NULL), (3, 20), (4, NULL);

SELECT COUNT(*) FROM data;
SELECT value FROM data WHERE id = 1;
SELECT id, value FROM data;
SELECT id, value, id FROM data;
SELECT name FROM outer_table WHERE EXISTS (SELECT 1 FROM non_existent_table);
SELECT EXTRACT(INVALID_PART FROM event_date) as part, SUM(amount) \ FROM events \ GROUP BY part;
SELECT COUNT(*) FROM dest;
SELECT COUNT(*) FROM summary;
SELECT value FROM dest;
SELECT SUM(value) as total FROM data;
SELECT id FROM outer_t WHERE num_value = ANY (SELECT str_value FROM inner_t);
SELECT EXTRACT(MILLISECOND FROM event_date) FROM events;
SELECT age FROM evolving WHERE id = 1;
SELECT COUNT(*) FROM data;
SELECT id, name FROM dest;
SELECT COUNT(*) FROM dest WHERE nullable_col IS NULL;
SELECT sum FROM result;
SELECT DATE_ADD(event_date, INTERVAL 7 DAY) as future_date FROM events;
SELECT COUNT(*) as count_all, COUNT(value) as count_non_null, SUM(value) as sum FROM data;

-- ============================================================================
-- Test: test_alter_table_failure_does_not_corrupt_schema
-- Source: p1_features_error_handling_stress_tdd.rs:235
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY, value STRING);
INSERT INTO data VALUES (1, 'test');
ALTER TABLE data ADD COLUMN id INT64;
DROP TABLE IF EXISTS outer_table;
CREATE TABLE outer_table (id INT64, name STRING);
INSERT INTO outer_table VALUES (1, 'Alice');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE, amount FLOAT64);
INSERT INTO events VALUES (1, DATE '2024-01-01', 100.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (1), (2), (3);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (1, 2, 3), (4, 5, 6);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result FLOAT64);
INSERT INTO dest \ SELECT CAST(((a + b) * c) / CAST(a AS FLOAT64) + SQRT(CAST(b * c AS FLOAT64)) AS FLOAT64) \ FROM source;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64, amount FLOAT64);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (customer_id INT64, name STRING, region STRING);
DROP TABLE IF EXISTS regions;
CREATE TABLE regions (region STRING, tax_rate FLOAT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (customer_name STRING, total_with_tax FLOAT64);
INSERT INTO orders VALUES (1, 1, 100.0), (2, 1, 150.0), (3, 2, 200.0);
INSERT INTO customers VALUES (1, 'Alice', 'East'), (2, 'Bob', 'West');
INSERT INTO regions VALUES ('East', 0.05), ('West', 0.08);
INSERT INTO summary \ SELECT c.name, SUM(o.amount * (1 + r.tax_rate)) \ FROM orders o \ JOIN customers c ON o.customer_id = c.customer_id \ JOIN regions r ON c.region = r.region \ GROUP BY c.name;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, text_value STRING);
INSERT INTO source VALUES (1, 'not_a_number');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, numeric_value INT64);
INSERT INTO dest SELECT id, text_value FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value NUMERIC(18, 8));
INSERT INTO source VALUES (CAST(3.14159265 AS NUMERIC(18, 8)));
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value NUMERIC(10, 2));
INSERT INTO dest SELECT CAST(value AS NUMERIC(10, 2)) FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value FLOAT64);
INSERT INTO data VALUES (1e308), (1e308), (1e308);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, required STRING NOT NULL);
INSERT INTO data (id) VALUES (1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (2), (3), (1), (4);
DROP TABLE IF EXISTS outer_t;
CREATE TABLE outer_t (id INT64, num_value INT64);
INSERT INTO outer_t VALUES (1, 10);
DROP TABLE IF EXISTS inner_t;
CREATE TABLE inner_t (id INT64, str_value STRING);
INSERT INTO inner_t VALUES (1, 'text');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, DATE '2024-01-01');
DROP TABLE IF EXISTS evolving;
CREATE TABLE evolving (id INT64, name STRING);
INSERT INTO evolving VALUES (1, 'test');
ALTER TABLE evolving ADD COLUMN age INT64 DEFAULT 0;
ALTER TABLE evolving ADD COLUMN email STRING;
INSERT INTO evolving (id, name, age, email) VALUES (2, 'new', 25, 'test@example.com');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, name STRING);
INSERT INTO source VALUES (1, 'Alice');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
ALTER TABLE dest ADD COLUMN name STRING;
INSERT INTO dest SELECT id, name FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, nullable_col STRING);
INSERT INTO source VALUES (1, NULL), (2, NULL), (3, NULL);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, nullable_col STRING);
INSERT INTO dest SELECT id, nullable_col FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, a NUMERIC(10, 2), b NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.5, NULL);
DROP TABLE IF EXISTS result;
CREATE TABLE result (id INT64, sum NUMERIC(10, 2));
INSERT INTO result SELECT id, a + b FROM data;
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, NULL), (3, 20), (4, NULL);

SELECT id, value FROM data;
SELECT id, value, id FROM data;
SELECT name FROM outer_table WHERE EXISTS (SELECT 1 FROM non_existent_table);
SELECT EXTRACT(INVALID_PART FROM event_date) as part, SUM(amount) \ FROM events \ GROUP BY part;
SELECT COUNT(*) FROM dest;
SELECT COUNT(*) FROM summary;
SELECT value FROM dest;
SELECT SUM(value) as total FROM data;
SELECT id FROM outer_t WHERE num_value = ANY (SELECT str_value FROM inner_t);
SELECT EXTRACT(MILLISECOND FROM event_date) FROM events;
SELECT age FROM evolving WHERE id = 1;
SELECT COUNT(*) FROM data;
SELECT id, name FROM dest;
SELECT COUNT(*) FROM dest WHERE nullable_col IS NULL;
SELECT sum FROM result;
SELECT DATE_ADD(event_date, INTERVAL 7 DAY) as future_date FROM events;
SELECT COUNT(*) as count_all, COUNT(value) as count_non_null, SUM(value) as sum FROM data;

-- ============================================================================
-- Test: test_subquery_error_propagates_correctly
-- Source: p1_features_error_handling_stress_tdd.rs:260
-- ============================================================================
DROP TABLE IF EXISTS outer_table;
CREATE TABLE outer_table (id INT64, name STRING);
INSERT INTO outer_table VALUES (1, 'Alice');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE, amount FLOAT64);
INSERT INTO events VALUES (1, DATE '2024-01-01', 100.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (1), (2), (3);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (1, 2, 3), (4, 5, 6);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result FLOAT64);
INSERT INTO dest \ SELECT CAST(((a + b) * c) / CAST(a AS FLOAT64) + SQRT(CAST(b * c AS FLOAT64)) AS FLOAT64) \ FROM source;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64, amount FLOAT64);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (customer_id INT64, name STRING, region STRING);
DROP TABLE IF EXISTS regions;
CREATE TABLE regions (region STRING, tax_rate FLOAT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (customer_name STRING, total_with_tax FLOAT64);
INSERT INTO orders VALUES (1, 1, 100.0), (2, 1, 150.0), (3, 2, 200.0);
INSERT INTO customers VALUES (1, 'Alice', 'East'), (2, 'Bob', 'West');
INSERT INTO regions VALUES ('East', 0.05), ('West', 0.08);
INSERT INTO summary \ SELECT c.name, SUM(o.amount * (1 + r.tax_rate)) \ FROM orders o \ JOIN customers c ON o.customer_id = c.customer_id \ JOIN regions r ON c.region = r.region \ GROUP BY c.name;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, text_value STRING);
INSERT INTO source VALUES (1, 'not_a_number');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, numeric_value INT64);
INSERT INTO dest SELECT id, text_value FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value NUMERIC(18, 8));
INSERT INTO source VALUES (CAST(3.14159265 AS NUMERIC(18, 8)));
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value NUMERIC(10, 2));
INSERT INTO dest SELECT CAST(value AS NUMERIC(10, 2)) FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value FLOAT64);
INSERT INTO data VALUES (1e308), (1e308), (1e308);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, required STRING NOT NULL);
INSERT INTO data (id) VALUES (1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (2), (3), (1), (4);
DROP TABLE IF EXISTS outer_t;
CREATE TABLE outer_t (id INT64, num_value INT64);
INSERT INTO outer_t VALUES (1, 10);
DROP TABLE IF EXISTS inner_t;
CREATE TABLE inner_t (id INT64, str_value STRING);
INSERT INTO inner_t VALUES (1, 'text');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, DATE '2024-01-01');
DROP TABLE IF EXISTS evolving;
CREATE TABLE evolving (id INT64, name STRING);
INSERT INTO evolving VALUES (1, 'test');
ALTER TABLE evolving ADD COLUMN age INT64 DEFAULT 0;
ALTER TABLE evolving ADD COLUMN email STRING;
INSERT INTO evolving (id, name, age, email) VALUES (2, 'new', 25, 'test@example.com');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, name STRING);
INSERT INTO source VALUES (1, 'Alice');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
ALTER TABLE dest ADD COLUMN name STRING;
INSERT INTO dest SELECT id, name FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, nullable_col STRING);
INSERT INTO source VALUES (1, NULL), (2, NULL), (3, NULL);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, nullable_col STRING);
INSERT INTO dest SELECT id, nullable_col FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, a NUMERIC(10, 2), b NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.5, NULL);
DROP TABLE IF EXISTS result;
CREATE TABLE result (id INT64, sum NUMERIC(10, 2));
INSERT INTO result SELECT id, a + b FROM data;
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, NULL), (3, 20), (4, NULL);

SELECT name FROM outer_table WHERE EXISTS (SELECT 1 FROM non_existent_table);
SELECT EXTRACT(INVALID_PART FROM event_date) as part, SUM(amount) \ FROM events \ GROUP BY part;
SELECT COUNT(*) FROM dest;
SELECT COUNT(*) FROM summary;
SELECT value FROM dest;
SELECT SUM(value) as total FROM data;
SELECT id FROM outer_t WHERE num_value = ANY (SELECT str_value FROM inner_t);
SELECT EXTRACT(MILLISECOND FROM event_date) FROM events;
SELECT age FROM evolving WHERE id = 1;
SELECT COUNT(*) FROM data;
SELECT id, name FROM dest;
SELECT COUNT(*) FROM dest WHERE nullable_col IS NULL;
SELECT sum FROM result;
SELECT DATE_ADD(event_date, INTERVAL 7 DAY) as future_date FROM events;
SELECT COUNT(*) as count_all, COUNT(value) as count_non_null, SUM(value) as sum FROM data;

-- ============================================================================
-- Test: test_date_function_error_in_aggregate_context
-- Source: p1_features_error_handling_stress_tdd.rs:290
-- ============================================================================
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE, amount FLOAT64);
INSERT INTO events VALUES (1, DATE '2024-01-01', 100.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (1), (2), (3);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (1, 2, 3), (4, 5, 6);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result FLOAT64);
INSERT INTO dest \ SELECT CAST(((a + b) * c) / CAST(a AS FLOAT64) + SQRT(CAST(b * c AS FLOAT64)) AS FLOAT64) \ FROM source;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64, amount FLOAT64);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (customer_id INT64, name STRING, region STRING);
DROP TABLE IF EXISTS regions;
CREATE TABLE regions (region STRING, tax_rate FLOAT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (customer_name STRING, total_with_tax FLOAT64);
INSERT INTO orders VALUES (1, 1, 100.0), (2, 1, 150.0), (3, 2, 200.0);
INSERT INTO customers VALUES (1, 'Alice', 'East'), (2, 'Bob', 'West');
INSERT INTO regions VALUES ('East', 0.05), ('West', 0.08);
INSERT INTO summary \ SELECT c.name, SUM(o.amount * (1 + r.tax_rate)) \ FROM orders o \ JOIN customers c ON o.customer_id = c.customer_id \ JOIN regions r ON c.region = r.region \ GROUP BY c.name;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, text_value STRING);
INSERT INTO source VALUES (1, 'not_a_number');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, numeric_value INT64);
INSERT INTO dest SELECT id, text_value FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value NUMERIC(18, 8));
INSERT INTO source VALUES (CAST(3.14159265 AS NUMERIC(18, 8)));
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value NUMERIC(10, 2));
INSERT INTO dest SELECT CAST(value AS NUMERIC(10, 2)) FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value FLOAT64);
INSERT INTO data VALUES (1e308), (1e308), (1e308);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, required STRING NOT NULL);
INSERT INTO data (id) VALUES (1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (2), (3), (1), (4);
DROP TABLE IF EXISTS outer_t;
CREATE TABLE outer_t (id INT64, num_value INT64);
INSERT INTO outer_t VALUES (1, 10);
DROP TABLE IF EXISTS inner_t;
CREATE TABLE inner_t (id INT64, str_value STRING);
INSERT INTO inner_t VALUES (1, 'text');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, DATE '2024-01-01');
DROP TABLE IF EXISTS evolving;
CREATE TABLE evolving (id INT64, name STRING);
INSERT INTO evolving VALUES (1, 'test');
ALTER TABLE evolving ADD COLUMN age INT64 DEFAULT 0;
ALTER TABLE evolving ADD COLUMN email STRING;
INSERT INTO evolving (id, name, age, email) VALUES (2, 'new', 25, 'test@example.com');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, name STRING);
INSERT INTO source VALUES (1, 'Alice');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
ALTER TABLE dest ADD COLUMN name STRING;
INSERT INTO dest SELECT id, name FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, nullable_col STRING);
INSERT INTO source VALUES (1, NULL), (2, NULL), (3, NULL);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, nullable_col STRING);
INSERT INTO dest SELECT id, nullable_col FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, a NUMERIC(10, 2), b NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.5, NULL);
DROP TABLE IF EXISTS result;
CREATE TABLE result (id INT64, sum NUMERIC(10, 2));
INSERT INTO result SELECT id, a + b FROM data;
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, NULL), (3, 20), (4, NULL);

SELECT EXTRACT(INVALID_PART FROM event_date) as part, SUM(amount) \ FROM events \ GROUP BY part;
SELECT COUNT(*) FROM dest;
SELECT COUNT(*) FROM summary;
SELECT value FROM dest;
SELECT SUM(value) as total FROM data;
SELECT id FROM outer_t WHERE num_value = ANY (SELECT str_value FROM inner_t);
SELECT EXTRACT(MILLISECOND FROM event_date) FROM events;
SELECT age FROM evolving WHERE id = 1;
SELECT COUNT(*) FROM data;
SELECT id, name FROM dest;
SELECT COUNT(*) FROM dest WHERE nullable_col IS NULL;
SELECT sum FROM result;
SELECT DATE_ADD(event_date, INTERVAL 7 DAY) as future_date FROM events;
SELECT COUNT(*) as count_all, COUNT(value) as count_non_null, SUM(value) as sum FROM data;

-- ============================================================================
-- Test: test_deeply_nested_subqueries
-- Source: p1_features_error_handling_stress_tdd.rs:323
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (1), (2), (3);
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (1, 2, 3), (4, 5, 6);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result FLOAT64);
INSERT INTO dest \ SELECT CAST(((a + b) * c) / CAST(a AS FLOAT64) + SQRT(CAST(b * c AS FLOAT64)) AS FLOAT64) \ FROM source;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64, amount FLOAT64);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (customer_id INT64, name STRING, region STRING);
DROP TABLE IF EXISTS regions;
CREATE TABLE regions (region STRING, tax_rate FLOAT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (customer_name STRING, total_with_tax FLOAT64);
INSERT INTO orders VALUES (1, 1, 100.0), (2, 1, 150.0), (3, 2, 200.0);
INSERT INTO customers VALUES (1, 'Alice', 'East'), (2, 'Bob', 'West');
INSERT INTO regions VALUES ('East', 0.05), ('West', 0.08);
INSERT INTO summary \ SELECT c.name, SUM(o.amount * (1 + r.tax_rate)) \ FROM orders o \ JOIN customers c ON o.customer_id = c.customer_id \ JOIN regions r ON c.region = r.region \ GROUP BY c.name;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, text_value STRING);
INSERT INTO source VALUES (1, 'not_a_number');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, numeric_value INT64);
INSERT INTO dest SELECT id, text_value FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value NUMERIC(18, 8));
INSERT INTO source VALUES (CAST(3.14159265 AS NUMERIC(18, 8)));
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value NUMERIC(10, 2));
INSERT INTO dest SELECT CAST(value AS NUMERIC(10, 2)) FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value FLOAT64);
INSERT INTO data VALUES (1e308), (1e308), (1e308);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, required STRING NOT NULL);
INSERT INTO data (id) VALUES (1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (2), (3), (1), (4);
DROP TABLE IF EXISTS outer_t;
CREATE TABLE outer_t (id INT64, num_value INT64);
INSERT INTO outer_t VALUES (1, 10);
DROP TABLE IF EXISTS inner_t;
CREATE TABLE inner_t (id INT64, str_value STRING);
INSERT INTO inner_t VALUES (1, 'text');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, DATE '2024-01-01');
DROP TABLE IF EXISTS evolving;
CREATE TABLE evolving (id INT64, name STRING);
INSERT INTO evolving VALUES (1, 'test');
ALTER TABLE evolving ADD COLUMN age INT64 DEFAULT 0;
ALTER TABLE evolving ADD COLUMN email STRING;
INSERT INTO evolving (id, name, age, email) VALUES (2, 'new', 25, 'test@example.com');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, name STRING);
INSERT INTO source VALUES (1, 'Alice');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
ALTER TABLE dest ADD COLUMN name STRING;
INSERT INTO dest SELECT id, name FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, nullable_col STRING);
INSERT INTO source VALUES (1, NULL), (2, NULL), (3, NULL);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, nullable_col STRING);
INSERT INTO dest SELECT id, nullable_col FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, a NUMERIC(10, 2), b NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.5, NULL);
DROP TABLE IF EXISTS result;
CREATE TABLE result (id INT64, sum NUMERIC(10, 2));
INSERT INTO result SELECT id, a + b FROM data;
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, NULL), (3, 20), (4, NULL);

SELECT COUNT(*) FROM dest;
SELECT COUNT(*) FROM summary;
SELECT value FROM dest;
SELECT SUM(value) as total FROM data;
SELECT id FROM outer_t WHERE num_value = ANY (SELECT str_value FROM inner_t);
SELECT EXTRACT(MILLISECOND FROM event_date) FROM events;
SELECT age FROM evolving WHERE id = 1;
SELECT COUNT(*) FROM data;
SELECT id, name FROM dest;
SELECT COUNT(*) FROM dest WHERE nullable_col IS NULL;
SELECT sum FROM result;
SELECT DATE_ADD(event_date, INTERVAL 7 DAY) as future_date FROM events;
SELECT COUNT(*) as count_all, COUNT(value) as count_non_null, SUM(value) as sum FROM data;

-- ============================================================================
-- Test: test_complex_expression_in_insert_select
-- Source: p1_features_error_handling_stress_tdd.rs:372
-- ============================================================================
DROP TABLE IF EXISTS source;
CREATE TABLE source (a INT64, b INT64, c INT64);
INSERT INTO source VALUES (1, 2, 3), (4, 5, 6);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (result FLOAT64);
INSERT INTO dest \ SELECT CAST(((a + b) * c) / CAST(a AS FLOAT64) + SQRT(CAST(b * c AS FLOAT64)) AS FLOAT64) \ FROM source;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64, amount FLOAT64);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (customer_id INT64, name STRING, region STRING);
DROP TABLE IF EXISTS regions;
CREATE TABLE regions (region STRING, tax_rate FLOAT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (customer_name STRING, total_with_tax FLOAT64);
INSERT INTO orders VALUES (1, 1, 100.0), (2, 1, 150.0), (3, 2, 200.0);
INSERT INTO customers VALUES (1, 'Alice', 'East'), (2, 'Bob', 'West');
INSERT INTO regions VALUES ('East', 0.05), ('West', 0.08);
INSERT INTO summary \ SELECT c.name, SUM(o.amount * (1 + r.tax_rate)) \ FROM orders o \ JOIN customers c ON o.customer_id = c.customer_id \ JOIN regions r ON c.region = r.region \ GROUP BY c.name;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, text_value STRING);
INSERT INTO source VALUES (1, 'not_a_number');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, numeric_value INT64);
INSERT INTO dest SELECT id, text_value FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value NUMERIC(18, 8));
INSERT INTO source VALUES (CAST(3.14159265 AS NUMERIC(18, 8)));
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value NUMERIC(10, 2));
INSERT INTO dest SELECT CAST(value AS NUMERIC(10, 2)) FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value FLOAT64);
INSERT INTO data VALUES (1e308), (1e308), (1e308);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, required STRING NOT NULL);
INSERT INTO data (id) VALUES (1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (2), (3), (1), (4);
DROP TABLE IF EXISTS outer_t;
CREATE TABLE outer_t (id INT64, num_value INT64);
INSERT INTO outer_t VALUES (1, 10);
DROP TABLE IF EXISTS inner_t;
CREATE TABLE inner_t (id INT64, str_value STRING);
INSERT INTO inner_t VALUES (1, 'text');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, DATE '2024-01-01');
DROP TABLE IF EXISTS evolving;
CREATE TABLE evolving (id INT64, name STRING);
INSERT INTO evolving VALUES (1, 'test');
ALTER TABLE evolving ADD COLUMN age INT64 DEFAULT 0;
ALTER TABLE evolving ADD COLUMN email STRING;
INSERT INTO evolving (id, name, age, email) VALUES (2, 'new', 25, 'test@example.com');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, name STRING);
INSERT INTO source VALUES (1, 'Alice');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
ALTER TABLE dest ADD COLUMN name STRING;
INSERT INTO dest SELECT id, name FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, nullable_col STRING);
INSERT INTO source VALUES (1, NULL), (2, NULL), (3, NULL);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, nullable_col STRING);
INSERT INTO dest SELECT id, nullable_col FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, a NUMERIC(10, 2), b NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.5, NULL);
DROP TABLE IF EXISTS result;
CREATE TABLE result (id INT64, sum NUMERIC(10, 2));
INSERT INTO result SELECT id, a + b FROM data;
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, NULL), (3, 20), (4, NULL);

SELECT COUNT(*) FROM dest;
SELECT COUNT(*) FROM summary;
SELECT value FROM dest;
SELECT SUM(value) as total FROM data;
SELECT id FROM outer_t WHERE num_value = ANY (SELECT str_value FROM inner_t);
SELECT EXTRACT(MILLISECOND FROM event_date) FROM events;
SELECT age FROM evolving WHERE id = 1;
SELECT COUNT(*) FROM data;
SELECT id, name FROM dest;
SELECT COUNT(*) FROM dest WHERE nullable_col IS NULL;
SELECT sum FROM result;
SELECT DATE_ADD(event_date, INTERVAL 7 DAY) as future_date FROM events;
SELECT COUNT(*) as count_all, COUNT(value) as count_non_null, SUM(value) as sum FROM data;

-- ============================================================================
-- Test: test_insert_select_with_multiple_joins_and_aggregations
-- Source: p1_features_error_handling_stress_tdd.rs:407
-- ============================================================================
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64, amount FLOAT64);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (customer_id INT64, name STRING, region STRING);
DROP TABLE IF EXISTS regions;
CREATE TABLE regions (region STRING, tax_rate FLOAT64);
DROP TABLE IF EXISTS summary;
CREATE TABLE summary (customer_name STRING, total_with_tax FLOAT64);
INSERT INTO orders VALUES (1, 1, 100.0), (2, 1, 150.0), (3, 2, 200.0);
INSERT INTO customers VALUES (1, 'Alice', 'East'), (2, 'Bob', 'West');
INSERT INTO regions VALUES ('East', 0.05), ('West', 0.08);
INSERT INTO summary \ SELECT c.name, SUM(o.amount * (1 + r.tax_rate)) \ FROM orders o \ JOIN customers c ON o.customer_id = c.customer_id \ JOIN regions r ON c.region = r.region \ GROUP BY c.name;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, text_value STRING);
INSERT INTO source VALUES (1, 'not_a_number');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, numeric_value INT64);
INSERT INTO dest SELECT id, text_value FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (value NUMERIC(18, 8));
INSERT INTO source VALUES (CAST(3.14159265 AS NUMERIC(18, 8)));
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (value NUMERIC(10, 2));
INSERT INTO dest SELECT CAST(value AS NUMERIC(10, 2)) FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (value FLOAT64);
INSERT INTO data VALUES (1e308), (1e308), (1e308);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, required STRING NOT NULL);
INSERT INTO data (id) VALUES (1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (2), (3), (1), (4);
DROP TABLE IF EXISTS outer_t;
CREATE TABLE outer_t (id INT64, num_value INT64);
INSERT INTO outer_t VALUES (1, 10);
DROP TABLE IF EXISTS inner_t;
CREATE TABLE inner_t (id INT64, str_value STRING);
INSERT INTO inner_t VALUES (1, 'text');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, DATE '2024-01-01');
DROP TABLE IF EXISTS evolving;
CREATE TABLE evolving (id INT64, name STRING);
INSERT INTO evolving VALUES (1, 'test');
ALTER TABLE evolving ADD COLUMN age INT64 DEFAULT 0;
ALTER TABLE evolving ADD COLUMN email STRING;
INSERT INTO evolving (id, name, age, email) VALUES (2, 'new', 25, 'test@example.com');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64 PRIMARY KEY);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (1);
INSERT INTO data VALUES (2);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, name STRING);
INSERT INTO source VALUES (1, 'Alice');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64);
ALTER TABLE dest ADD COLUMN name STRING;
INSERT INTO dest SELECT id, name FROM source;
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, nullable_col STRING);
INSERT INTO source VALUES (1, NULL), (2, NULL), (3, NULL);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, nullable_col STRING);
INSERT INTO dest SELECT id, nullable_col FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, a NUMERIC(10, 2), b NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.5, NULL);
DROP TABLE IF EXISTS result;
CREATE TABLE result (id INT64, sum NUMERIC(10, 2));
INSERT INTO result SELECT id, a + b FROM data;
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, NULL), (3, 20), (4, NULL);

SELECT COUNT(*) FROM summary;
SELECT value FROM dest;
SELECT SUM(value) as total FROM data;
SELECT id FROM outer_t WHERE num_value = ANY (SELECT str_value FROM inner_t);
SELECT EXTRACT(MILLISECOND FROM event_date) FROM events;
SELECT age FROM evolving WHERE id = 1;
SELECT COUNT(*) FROM data;
SELECT id, name FROM dest;
SELECT COUNT(*) FROM dest WHERE nullable_col IS NULL;
SELECT sum FROM result;
SELECT DATE_ADD(event_date, INTERVAL 7 DAY) as future_date FROM events;
SELECT COUNT(*) as count_all, COUNT(value) as count_non_null, SUM(value) as sum FROM data;

-- ============================================================================
-- Test: test_insert_select_violates_primary_key
-- Source: p1_features_integration_comprehensive_tdd.rs:31
-- ============================================================================
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, name STRING);
INSERT INTO source VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64 PRIMARY KEY, name STRING);
INSERT INTO dest VALUES (1, 'Existing');
INSERT INTO dest SELECT id, name FROM source;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64 PRIMARY KEY, email STRING UNIQUE);
INSERT INTO users VALUES (1, 'alice@example.com');
INSERT INTO users VALUES \ (2, 'bob@example.com'), \ (3, 'charlie@example.com'), \ (1, 'duplicate@example.com');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, name STRING);
INSERT INTO source VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (\ id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ status STRING DEFAULT 'active', \ created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP());
INSERT INTO dest (id, name) SELECT id, name FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, required STRING NOT NULL, optional STRING);
INSERT INTO data VALUES \ (1, 'valid', 'present'), \ (2, NULL, 'invalid'), \ (3, 'also_valid', NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, email STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, email STRING UNIQUE);
INSERT INTO dest SELECT id, email FROM source;
INSERT INTO dest SELECT id, email FROM source;
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (id INT64, name STRING);
INSERT INTO customers VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64);
INSERT INTO orders VALUES (101, NULL), (102, NULL);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (id INT64, name STRING);
INSERT INTO customers VALUES (1, 'Alice'), (NULL, 'Bob');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64);
INSERT INTO orders VALUES (101, 1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (5), (10), (15);
DROP TABLE IF EXISTS thresholds;
CREATE TABLE thresholds (threshold INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (5), (10), (15);
DROP TABLE IF EXISTS thresholds;
CREATE TABLE thresholds (threshold INT64);
INSERT INTO thresholds VALUES (3), (NULL), (7);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING, category_id INT64);
INSERT INTO products VALUES (1, 'Widget', 10), (2, 'Gadget', 20);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, name STRING, parent_id INT64);
INSERT INTO categories VALUES (10, 'Electronics', NULL), (20, 'Toys', NULL);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, product_id INT64);
INSERT INTO orders VALUES (101, 1);
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, DATE '2024-01-15'), (2, NULL);
DROP TABLE IF EXISTS dates;
CREATE TABLE dates (id INT64, d DATE);
INSERT INTO dates VALUES \ (1, DATE '0001-01-01'), \ (2, DATE '9999-12-31'), \ (3, DATE '2000-02-29');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, start_time TIMESTAMP, end_time TIMESTAMP);
INSERT INTO events VALUES \ (1, TIMESTAMP '2024-03-10 01:00:00', TIMESTAMP '2024-03-10 03:00:00');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, sale_date DATE, amount FLOAT64);
INSERT INTO sales VALUES \ (1, DATE '2024-01-15', 100.0), \ (2, DATE '2024-01-20', 150.0), \ (3, DATE '2024-02-05', 200.0);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP());
INSERT INTO logs (id) VALUES (1), (2), (3);
DROP TABLE IF EXISTS financial;
CREATE TABLE financial (id INT64, amount_numeric NUMERIC(18, 2), amount_float FLOAT64);
INSERT INTO financial VALUES (1, 0.1, 0.1);
INSERT INTO financial VALUES (2, 0.2, 0.2);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, numerator NUMERIC(10, 2), denominator NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.00, 3.00);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value NUMERIC(5, 2));
INSERT INTO data VALUES (1, 12345.67);
DROP TABLE IF EXISTS transactions;
CREATE TABLE transactions (id INT64, amount NUMERIC(18, 2));
INSERT INTO transactions VALUES \ (1, 100.50), (2, 200.75), (3, 150.25);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, price_a NUMERIC(10, 2), price_b NUMERIC(10, 4));
INSERT INTO prices VALUES (1, 10.50, 10.5000);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, str_value STRING);
INSERT INTO data VALUES \ (1, '  123  '), \ (2, '456'), \ (3, '789\ ');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, date_str STRING);
INSERT INTO data VALUES (1, 'not-a-date');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, int_col INT64, float_col FLOAT64);
INSERT INTO data VALUES (1, 10, 10.5), (2, 20, 20.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, nullable_str STRING);
INSERT INTO data VALUES (1, NULL);
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT COUNT(*) FROM dest;
SELECT COUNT(*) FROM users;
SELECT id, name, status FROM dest ORDER BY id;
SELECT COUNT(*) FROM data;
SELECT COUNT(*) FROM dest;
SELECT name FROM customers WHERE EXISTS (SELECT 1 FROM orders);
SELECT name FROM customers c \ WHERE NOT EXISTS (SELECT 1 FROM orders o WHERE o.customer_id = c.id);
SELECT value FROM data WHERE value > ANY (SELECT threshold FROM thresholds);
SELECT value FROM data WHERE value > ALL (SELECT threshold FROM thresholds);
SELECT p.name FROM products p \ WHERE EXISTS (\ SELECT 1 FROM categories c \ WHERE c.id = p.category_id \ AND EXISTS (\ SELECT 1 FROM orders o WHERE o.product_id = p.id\ )\ );
SELECT id, DATE_ADD(event_date, INTERVAL 7 DAY) as future_date FROM events ORDER BY id;
SELECT id, EXTRACT(YEAR FROM d) as year, EXTRACT(MONTH FROM d) as month FROM dates ORDER BY id;
SELECT TIMESTAMP_DIFF(end_time, start_time, HOUR) as hour_diff FROM events;
SELECT DATE_TRUNC(sale_date, MONTH) as month, SUM(amount) as total \ FROM sales \ GROUP BY DATE_TRUNC(sale_date, MONTH) \ ORDER BY month;
SELECT COUNT(DISTINCT ts) as distinct_timestamps FROM logs;
SELECT \ SUM(amount_numeric) as numeric_sum, \ SUM(amount_float) as float_sum \ FROM financial;
SELECT numerator / denominator as quotient FROM data;
SELECT \ SUM(amount) as total, \ AVG(amount) as average, \ MIN(amount) as minimum, \ MAX(amount) as maximum \ FROM transactions;
SELECT id FROM prices WHERE price_a = price_b;
SELECT id, CAST(str_value AS INT64) as int_value FROM data ORDER BY id;
SELECT CAST(date_str AS DATE) FROM data;
SELECT id FROM data WHERE int_col < float_col ORDER BY id;
SELECT CAST(CAST(123 AS STRING) AS FLOAT64) as result;
SELECT \ CAST(nullable_str AS INT64) as as_int, \ CAST(nullable_str AS FLOAT64) as as_float, \ CAST(nullable_str AS DATE) as as_date \ FROM data;
SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_multi_row_insert_partial_constraint_violation
-- Source: p1_features_integration_comprehensive_tdd.rs:77
-- ============================================================================
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64 PRIMARY KEY, email STRING UNIQUE);
INSERT INTO users VALUES (1, 'alice@example.com');
INSERT INTO users VALUES \ (2, 'bob@example.com'), \ (3, 'charlie@example.com'), \ (1, 'duplicate@example.com');
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, name STRING);
INSERT INTO source VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (\ id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ status STRING DEFAULT 'active', \ created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP());
INSERT INTO dest (id, name) SELECT id, name FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, required STRING NOT NULL, optional STRING);
INSERT INTO data VALUES \ (1, 'valid', 'present'), \ (2, NULL, 'invalid'), \ (3, 'also_valid', NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, email STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, email STRING UNIQUE);
INSERT INTO dest SELECT id, email FROM source;
INSERT INTO dest SELECT id, email FROM source;
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (id INT64, name STRING);
INSERT INTO customers VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64);
INSERT INTO orders VALUES (101, NULL), (102, NULL);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (id INT64, name STRING);
INSERT INTO customers VALUES (1, 'Alice'), (NULL, 'Bob');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64);
INSERT INTO orders VALUES (101, 1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (5), (10), (15);
DROP TABLE IF EXISTS thresholds;
CREATE TABLE thresholds (threshold INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (5), (10), (15);
DROP TABLE IF EXISTS thresholds;
CREATE TABLE thresholds (threshold INT64);
INSERT INTO thresholds VALUES (3), (NULL), (7);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING, category_id INT64);
INSERT INTO products VALUES (1, 'Widget', 10), (2, 'Gadget', 20);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, name STRING, parent_id INT64);
INSERT INTO categories VALUES (10, 'Electronics', NULL), (20, 'Toys', NULL);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, product_id INT64);
INSERT INTO orders VALUES (101, 1);
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, DATE '2024-01-15'), (2, NULL);
DROP TABLE IF EXISTS dates;
CREATE TABLE dates (id INT64, d DATE);
INSERT INTO dates VALUES \ (1, DATE '0001-01-01'), \ (2, DATE '9999-12-31'), \ (3, DATE '2000-02-29');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, start_time TIMESTAMP, end_time TIMESTAMP);
INSERT INTO events VALUES \ (1, TIMESTAMP '2024-03-10 01:00:00', TIMESTAMP '2024-03-10 03:00:00');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, sale_date DATE, amount FLOAT64);
INSERT INTO sales VALUES \ (1, DATE '2024-01-15', 100.0), \ (2, DATE '2024-01-20', 150.0), \ (3, DATE '2024-02-05', 200.0);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP());
INSERT INTO logs (id) VALUES (1), (2), (3);
DROP TABLE IF EXISTS financial;
CREATE TABLE financial (id INT64, amount_numeric NUMERIC(18, 2), amount_float FLOAT64);
INSERT INTO financial VALUES (1, 0.1, 0.1);
INSERT INTO financial VALUES (2, 0.2, 0.2);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, numerator NUMERIC(10, 2), denominator NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.00, 3.00);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value NUMERIC(5, 2));
INSERT INTO data VALUES (1, 12345.67);
DROP TABLE IF EXISTS transactions;
CREATE TABLE transactions (id INT64, amount NUMERIC(18, 2));
INSERT INTO transactions VALUES \ (1, 100.50), (2, 200.75), (3, 150.25);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, price_a NUMERIC(10, 2), price_b NUMERIC(10, 4));
INSERT INTO prices VALUES (1, 10.50, 10.5000);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, str_value STRING);
INSERT INTO data VALUES \ (1, '  123  '), \ (2, '456'), \ (3, '789\ ');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, date_str STRING);
INSERT INTO data VALUES (1, 'not-a-date');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, int_col INT64, float_col FLOAT64);
INSERT INTO data VALUES (1, 10, 10.5), (2, 20, 20.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, nullable_str STRING);
INSERT INTO data VALUES (1, NULL);
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT COUNT(*) FROM users;
SELECT id, name, status FROM dest ORDER BY id;
SELECT COUNT(*) FROM data;
SELECT COUNT(*) FROM dest;
SELECT name FROM customers WHERE EXISTS (SELECT 1 FROM orders);
SELECT name FROM customers c \ WHERE NOT EXISTS (SELECT 1 FROM orders o WHERE o.customer_id = c.id);
SELECT value FROM data WHERE value > ANY (SELECT threshold FROM thresholds);
SELECT value FROM data WHERE value > ALL (SELECT threshold FROM thresholds);
SELECT p.name FROM products p \ WHERE EXISTS (\ SELECT 1 FROM categories c \ WHERE c.id = p.category_id \ AND EXISTS (\ SELECT 1 FROM orders o WHERE o.product_id = p.id\ )\ );
SELECT id, DATE_ADD(event_date, INTERVAL 7 DAY) as future_date FROM events ORDER BY id;
SELECT id, EXTRACT(YEAR FROM d) as year, EXTRACT(MONTH FROM d) as month FROM dates ORDER BY id;
SELECT TIMESTAMP_DIFF(end_time, start_time, HOUR) as hour_diff FROM events;
SELECT DATE_TRUNC(sale_date, MONTH) as month, SUM(amount) as total \ FROM sales \ GROUP BY DATE_TRUNC(sale_date, MONTH) \ ORDER BY month;
SELECT COUNT(DISTINCT ts) as distinct_timestamps FROM logs;
SELECT \ SUM(amount_numeric) as numeric_sum, \ SUM(amount_float) as float_sum \ FROM financial;
SELECT numerator / denominator as quotient FROM data;
SELECT \ SUM(amount) as total, \ AVG(amount) as average, \ MIN(amount) as minimum, \ MAX(amount) as maximum \ FROM transactions;
SELECT id FROM prices WHERE price_a = price_b;
SELECT id, CAST(str_value AS INT64) as int_value FROM data ORDER BY id;
SELECT CAST(date_str AS DATE) FROM data;
SELECT id FROM data WHERE int_col < float_col ORDER BY id;
SELECT CAST(CAST(123 AS STRING) AS FLOAT64) as result;
SELECT \ CAST(nullable_str AS INT64) as as_int, \ CAST(nullable_str AS FLOAT64) as as_float, \ CAST(nullable_str AS DATE) as as_date \ FROM data;
SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_insert_select_with_default_values_and_constraints
-- Source: p1_features_integration_comprehensive_tdd.rs:110
-- ============================================================================
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, name STRING);
INSERT INTO source VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (\ id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ status STRING DEFAULT 'active', \ created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP());
INSERT INTO dest (id, name) SELECT id, name FROM source;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, required STRING NOT NULL, optional STRING);
INSERT INTO data VALUES \ (1, 'valid', 'present'), \ (2, NULL, 'invalid'), \ (3, 'also_valid', NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, email STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, email STRING UNIQUE);
INSERT INTO dest SELECT id, email FROM source;
INSERT INTO dest SELECT id, email FROM source;
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (id INT64, name STRING);
INSERT INTO customers VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64);
INSERT INTO orders VALUES (101, NULL), (102, NULL);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (id INT64, name STRING);
INSERT INTO customers VALUES (1, 'Alice'), (NULL, 'Bob');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64);
INSERT INTO orders VALUES (101, 1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (5), (10), (15);
DROP TABLE IF EXISTS thresholds;
CREATE TABLE thresholds (threshold INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (5), (10), (15);
DROP TABLE IF EXISTS thresholds;
CREATE TABLE thresholds (threshold INT64);
INSERT INTO thresholds VALUES (3), (NULL), (7);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING, category_id INT64);
INSERT INTO products VALUES (1, 'Widget', 10), (2, 'Gadget', 20);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, name STRING, parent_id INT64);
INSERT INTO categories VALUES (10, 'Electronics', NULL), (20, 'Toys', NULL);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, product_id INT64);
INSERT INTO orders VALUES (101, 1);
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, DATE '2024-01-15'), (2, NULL);
DROP TABLE IF EXISTS dates;
CREATE TABLE dates (id INT64, d DATE);
INSERT INTO dates VALUES \ (1, DATE '0001-01-01'), \ (2, DATE '9999-12-31'), \ (3, DATE '2000-02-29');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, start_time TIMESTAMP, end_time TIMESTAMP);
INSERT INTO events VALUES \ (1, TIMESTAMP '2024-03-10 01:00:00', TIMESTAMP '2024-03-10 03:00:00');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, sale_date DATE, amount FLOAT64);
INSERT INTO sales VALUES \ (1, DATE '2024-01-15', 100.0), \ (2, DATE '2024-01-20', 150.0), \ (3, DATE '2024-02-05', 200.0);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP());
INSERT INTO logs (id) VALUES (1), (2), (3);
DROP TABLE IF EXISTS financial;
CREATE TABLE financial (id INT64, amount_numeric NUMERIC(18, 2), amount_float FLOAT64);
INSERT INTO financial VALUES (1, 0.1, 0.1);
INSERT INTO financial VALUES (2, 0.2, 0.2);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, numerator NUMERIC(10, 2), denominator NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.00, 3.00);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value NUMERIC(5, 2));
INSERT INTO data VALUES (1, 12345.67);
DROP TABLE IF EXISTS transactions;
CREATE TABLE transactions (id INT64, amount NUMERIC(18, 2));
INSERT INTO transactions VALUES \ (1, 100.50), (2, 200.75), (3, 150.25);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, price_a NUMERIC(10, 2), price_b NUMERIC(10, 4));
INSERT INTO prices VALUES (1, 10.50, 10.5000);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, str_value STRING);
INSERT INTO data VALUES \ (1, '  123  '), \ (2, '456'), \ (3, '789\ ');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, date_str STRING);
INSERT INTO data VALUES (1, 'not-a-date');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, int_col INT64, float_col FLOAT64);
INSERT INTO data VALUES (1, 10, 10.5), (2, 20, 20.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, nullable_str STRING);
INSERT INTO data VALUES (1, NULL);
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT id, name, status FROM dest ORDER BY id;
SELECT COUNT(*) FROM data;
SELECT COUNT(*) FROM dest;
SELECT name FROM customers WHERE EXISTS (SELECT 1 FROM orders);
SELECT name FROM customers c \ WHERE NOT EXISTS (SELECT 1 FROM orders o WHERE o.customer_id = c.id);
SELECT value FROM data WHERE value > ANY (SELECT threshold FROM thresholds);
SELECT value FROM data WHERE value > ALL (SELECT threshold FROM thresholds);
SELECT p.name FROM products p \ WHERE EXISTS (\ SELECT 1 FROM categories c \ WHERE c.id = p.category_id \ AND EXISTS (\ SELECT 1 FROM orders o WHERE o.product_id = p.id\ )\ );
SELECT id, DATE_ADD(event_date, INTERVAL 7 DAY) as future_date FROM events ORDER BY id;
SELECT id, EXTRACT(YEAR FROM d) as year, EXTRACT(MONTH FROM d) as month FROM dates ORDER BY id;
SELECT TIMESTAMP_DIFF(end_time, start_time, HOUR) as hour_diff FROM events;
SELECT DATE_TRUNC(sale_date, MONTH) as month, SUM(amount) as total \ FROM sales \ GROUP BY DATE_TRUNC(sale_date, MONTH) \ ORDER BY month;
SELECT COUNT(DISTINCT ts) as distinct_timestamps FROM logs;
SELECT \ SUM(amount_numeric) as numeric_sum, \ SUM(amount_float) as float_sum \ FROM financial;
SELECT numerator / denominator as quotient FROM data;
SELECT \ SUM(amount) as total, \ AVG(amount) as average, \ MIN(amount) as minimum, \ MAX(amount) as maximum \ FROM transactions;
SELECT id FROM prices WHERE price_a = price_b;
SELECT id, CAST(str_value AS INT64) as int_value FROM data ORDER BY id;
SELECT CAST(date_str AS DATE) FROM data;
SELECT id FROM data WHERE int_col < float_col ORDER BY id;
SELECT CAST(CAST(123 AS STRING) AS FLOAT64) as result;
SELECT \ CAST(nullable_str AS INT64) as as_int, \ CAST(nullable_str AS FLOAT64) as as_float, \ CAST(nullable_str AS DATE) as as_date \ FROM data;
SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_multi_row_insert_with_null_and_not_null_constraint
-- Source: p1_features_integration_comprehensive_tdd.rs:148
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, required STRING NOT NULL, optional STRING);
INSERT INTO data VALUES \ (1, 'valid', 'present'), \ (2, NULL, 'invalid'), \ (3, 'also_valid', NULL);
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, email STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, email STRING UNIQUE);
INSERT INTO dest SELECT id, email FROM source;
INSERT INTO dest SELECT id, email FROM source;
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (id INT64, name STRING);
INSERT INTO customers VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64);
INSERT INTO orders VALUES (101, NULL), (102, NULL);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (id INT64, name STRING);
INSERT INTO customers VALUES (1, 'Alice'), (NULL, 'Bob');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64);
INSERT INTO orders VALUES (101, 1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (5), (10), (15);
DROP TABLE IF EXISTS thresholds;
CREATE TABLE thresholds (threshold INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (5), (10), (15);
DROP TABLE IF EXISTS thresholds;
CREATE TABLE thresholds (threshold INT64);
INSERT INTO thresholds VALUES (3), (NULL), (7);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING, category_id INT64);
INSERT INTO products VALUES (1, 'Widget', 10), (2, 'Gadget', 20);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, name STRING, parent_id INT64);
INSERT INTO categories VALUES (10, 'Electronics', NULL), (20, 'Toys', NULL);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, product_id INT64);
INSERT INTO orders VALUES (101, 1);
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, DATE '2024-01-15'), (2, NULL);
DROP TABLE IF EXISTS dates;
CREATE TABLE dates (id INT64, d DATE);
INSERT INTO dates VALUES \ (1, DATE '0001-01-01'), \ (2, DATE '9999-12-31'), \ (3, DATE '2000-02-29');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, start_time TIMESTAMP, end_time TIMESTAMP);
INSERT INTO events VALUES \ (1, TIMESTAMP '2024-03-10 01:00:00', TIMESTAMP '2024-03-10 03:00:00');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, sale_date DATE, amount FLOAT64);
INSERT INTO sales VALUES \ (1, DATE '2024-01-15', 100.0), \ (2, DATE '2024-01-20', 150.0), \ (3, DATE '2024-02-05', 200.0);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP());
INSERT INTO logs (id) VALUES (1), (2), (3);
DROP TABLE IF EXISTS financial;
CREATE TABLE financial (id INT64, amount_numeric NUMERIC(18, 2), amount_float FLOAT64);
INSERT INTO financial VALUES (1, 0.1, 0.1);
INSERT INTO financial VALUES (2, 0.2, 0.2);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, numerator NUMERIC(10, 2), denominator NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.00, 3.00);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value NUMERIC(5, 2));
INSERT INTO data VALUES (1, 12345.67);
DROP TABLE IF EXISTS transactions;
CREATE TABLE transactions (id INT64, amount NUMERIC(18, 2));
INSERT INTO transactions VALUES \ (1, 100.50), (2, 200.75), (3, 150.25);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, price_a NUMERIC(10, 2), price_b NUMERIC(10, 4));
INSERT INTO prices VALUES (1, 10.50, 10.5000);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, str_value STRING);
INSERT INTO data VALUES \ (1, '  123  '), \ (2, '456'), \ (3, '789\ ');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, date_str STRING);
INSERT INTO data VALUES (1, 'not-a-date');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, int_col INT64, float_col FLOAT64);
INSERT INTO data VALUES (1, 10, 10.5), (2, 20, 20.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, nullable_str STRING);
INSERT INTO data VALUES (1, NULL);
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT COUNT(*) FROM data;
SELECT COUNT(*) FROM dest;
SELECT name FROM customers WHERE EXISTS (SELECT 1 FROM orders);
SELECT name FROM customers c \ WHERE NOT EXISTS (SELECT 1 FROM orders o WHERE o.customer_id = c.id);
SELECT value FROM data WHERE value > ANY (SELECT threshold FROM thresholds);
SELECT value FROM data WHERE value > ALL (SELECT threshold FROM thresholds);
SELECT p.name FROM products p \ WHERE EXISTS (\ SELECT 1 FROM categories c \ WHERE c.id = p.category_id \ AND EXISTS (\ SELECT 1 FROM orders o WHERE o.product_id = p.id\ )\ );
SELECT id, DATE_ADD(event_date, INTERVAL 7 DAY) as future_date FROM events ORDER BY id;
SELECT id, EXTRACT(YEAR FROM d) as year, EXTRACT(MONTH FROM d) as month FROM dates ORDER BY id;
SELECT TIMESTAMP_DIFF(end_time, start_time, HOUR) as hour_diff FROM events;
SELECT DATE_TRUNC(sale_date, MONTH) as month, SUM(amount) as total \ FROM sales \ GROUP BY DATE_TRUNC(sale_date, MONTH) \ ORDER BY month;
SELECT COUNT(DISTINCT ts) as distinct_timestamps FROM logs;
SELECT \ SUM(amount_numeric) as numeric_sum, \ SUM(amount_float) as float_sum \ FROM financial;
SELECT numerator / denominator as quotient FROM data;
SELECT \ SUM(amount) as total, \ AVG(amount) as average, \ MIN(amount) as minimum, \ MAX(amount) as maximum \ FROM transactions;
SELECT id FROM prices WHERE price_a = price_b;
SELECT id, CAST(str_value AS INT64) as int_value FROM data ORDER BY id;
SELECT CAST(date_str AS DATE) FROM data;
SELECT id FROM data WHERE int_col < float_col ORDER BY id;
SELECT CAST(CAST(123 AS STRING) AS FLOAT64) as result;
SELECT \ CAST(nullable_str AS INT64) as as_int, \ CAST(nullable_str AS FLOAT64) as as_float, \ CAST(nullable_str AS DATE) as as_date \ FROM data;
SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_insert_select_large_dataset_with_unique_constraint
-- Source: p1_features_integration_comprehensive_tdd.rs:178
-- ============================================================================
DROP TABLE IF EXISTS source;
CREATE TABLE source (id INT64, email STRING);
DROP TABLE IF EXISTS dest;
CREATE TABLE dest (id INT64, email STRING UNIQUE);
INSERT INTO dest SELECT id, email FROM source;
INSERT INTO dest SELECT id, email FROM source;
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (id INT64, name STRING);
INSERT INTO customers VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64);
INSERT INTO orders VALUES (101, NULL), (102, NULL);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (id INT64, name STRING);
INSERT INTO customers VALUES (1, 'Alice'), (NULL, 'Bob');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64);
INSERT INTO orders VALUES (101, 1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (5), (10), (15);
DROP TABLE IF EXISTS thresholds;
CREATE TABLE thresholds (threshold INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (5), (10), (15);
DROP TABLE IF EXISTS thresholds;
CREATE TABLE thresholds (threshold INT64);
INSERT INTO thresholds VALUES (3), (NULL), (7);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING, category_id INT64);
INSERT INTO products VALUES (1, 'Widget', 10), (2, 'Gadget', 20);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, name STRING, parent_id INT64);
INSERT INTO categories VALUES (10, 'Electronics', NULL), (20, 'Toys', NULL);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, product_id INT64);
INSERT INTO orders VALUES (101, 1);
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, DATE '2024-01-15'), (2, NULL);
DROP TABLE IF EXISTS dates;
CREATE TABLE dates (id INT64, d DATE);
INSERT INTO dates VALUES \ (1, DATE '0001-01-01'), \ (2, DATE '9999-12-31'), \ (3, DATE '2000-02-29');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, start_time TIMESTAMP, end_time TIMESTAMP);
INSERT INTO events VALUES \ (1, TIMESTAMP '2024-03-10 01:00:00', TIMESTAMP '2024-03-10 03:00:00');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, sale_date DATE, amount FLOAT64);
INSERT INTO sales VALUES \ (1, DATE '2024-01-15', 100.0), \ (2, DATE '2024-01-20', 150.0), \ (3, DATE '2024-02-05', 200.0);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP());
INSERT INTO logs (id) VALUES (1), (2), (3);
DROP TABLE IF EXISTS financial;
CREATE TABLE financial (id INT64, amount_numeric NUMERIC(18, 2), amount_float FLOAT64);
INSERT INTO financial VALUES (1, 0.1, 0.1);
INSERT INTO financial VALUES (2, 0.2, 0.2);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, numerator NUMERIC(10, 2), denominator NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.00, 3.00);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value NUMERIC(5, 2));
INSERT INTO data VALUES (1, 12345.67);
DROP TABLE IF EXISTS transactions;
CREATE TABLE transactions (id INT64, amount NUMERIC(18, 2));
INSERT INTO transactions VALUES \ (1, 100.50), (2, 200.75), (3, 150.25);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, price_a NUMERIC(10, 2), price_b NUMERIC(10, 4));
INSERT INTO prices VALUES (1, 10.50, 10.5000);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, str_value STRING);
INSERT INTO data VALUES \ (1, '  123  '), \ (2, '456'), \ (3, '789\ ');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, date_str STRING);
INSERT INTO data VALUES (1, 'not-a-date');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, int_col INT64, float_col FLOAT64);
INSERT INTO data VALUES (1, 10, 10.5), (2, 20, 20.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, nullable_str STRING);
INSERT INTO data VALUES (1, NULL);
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT COUNT(*) FROM dest;
SELECT name FROM customers WHERE EXISTS (SELECT 1 FROM orders);
SELECT name FROM customers c \ WHERE NOT EXISTS (SELECT 1 FROM orders o WHERE o.customer_id = c.id);
SELECT value FROM data WHERE value > ANY (SELECT threshold FROM thresholds);
SELECT value FROM data WHERE value > ALL (SELECT threshold FROM thresholds);
SELECT p.name FROM products p \ WHERE EXISTS (\ SELECT 1 FROM categories c \ WHERE c.id = p.category_id \ AND EXISTS (\ SELECT 1 FROM orders o WHERE o.product_id = p.id\ )\ );
SELECT id, DATE_ADD(event_date, INTERVAL 7 DAY) as future_date FROM events ORDER BY id;
SELECT id, EXTRACT(YEAR FROM d) as year, EXTRACT(MONTH FROM d) as month FROM dates ORDER BY id;
SELECT TIMESTAMP_DIFF(end_time, start_time, HOUR) as hour_diff FROM events;
SELECT DATE_TRUNC(sale_date, MONTH) as month, SUM(amount) as total \ FROM sales \ GROUP BY DATE_TRUNC(sale_date, MONTH) \ ORDER BY month;
SELECT COUNT(DISTINCT ts) as distinct_timestamps FROM logs;
SELECT \ SUM(amount_numeric) as numeric_sum, \ SUM(amount_float) as float_sum \ FROM financial;
SELECT numerator / denominator as quotient FROM data;
SELECT \ SUM(amount) as total, \ AVG(amount) as average, \ MIN(amount) as minimum, \ MAX(amount) as maximum \ FROM transactions;
SELECT id FROM prices WHERE price_a = price_b;
SELECT id, CAST(str_value AS INT64) as int_value FROM data ORDER BY id;
SELECT CAST(date_str AS DATE) FROM data;
SELECT id FROM data WHERE int_col < float_col ORDER BY id;
SELECT CAST(CAST(123 AS STRING) AS FLOAT64) as result;
SELECT \ CAST(nullable_str AS INT64) as as_int, \ CAST(nullable_str AS FLOAT64) as as_float, \ CAST(nullable_str AS DATE) as as_date \ FROM data;
SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_exists_with_all_null_subquery
-- Source: p1_features_integration_comprehensive_tdd.rs:220
-- ============================================================================
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (id INT64, name STRING);
INSERT INTO customers VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64);
INSERT INTO orders VALUES (101, NULL), (102, NULL);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (id INT64, name STRING);
INSERT INTO customers VALUES (1, 'Alice'), (NULL, 'Bob');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64);
INSERT INTO orders VALUES (101, 1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (5), (10), (15);
DROP TABLE IF EXISTS thresholds;
CREATE TABLE thresholds (threshold INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (5), (10), (15);
DROP TABLE IF EXISTS thresholds;
CREATE TABLE thresholds (threshold INT64);
INSERT INTO thresholds VALUES (3), (NULL), (7);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING, category_id INT64);
INSERT INTO products VALUES (1, 'Widget', 10), (2, 'Gadget', 20);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, name STRING, parent_id INT64);
INSERT INTO categories VALUES (10, 'Electronics', NULL), (20, 'Toys', NULL);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, product_id INT64);
INSERT INTO orders VALUES (101, 1);
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, DATE '2024-01-15'), (2, NULL);
DROP TABLE IF EXISTS dates;
CREATE TABLE dates (id INT64, d DATE);
INSERT INTO dates VALUES \ (1, DATE '0001-01-01'), \ (2, DATE '9999-12-31'), \ (3, DATE '2000-02-29');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, start_time TIMESTAMP, end_time TIMESTAMP);
INSERT INTO events VALUES \ (1, TIMESTAMP '2024-03-10 01:00:00', TIMESTAMP '2024-03-10 03:00:00');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, sale_date DATE, amount FLOAT64);
INSERT INTO sales VALUES \ (1, DATE '2024-01-15', 100.0), \ (2, DATE '2024-01-20', 150.0), \ (3, DATE '2024-02-05', 200.0);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP());
INSERT INTO logs (id) VALUES (1), (2), (3);
DROP TABLE IF EXISTS financial;
CREATE TABLE financial (id INT64, amount_numeric NUMERIC(18, 2), amount_float FLOAT64);
INSERT INTO financial VALUES (1, 0.1, 0.1);
INSERT INTO financial VALUES (2, 0.2, 0.2);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, numerator NUMERIC(10, 2), denominator NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.00, 3.00);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value NUMERIC(5, 2));
INSERT INTO data VALUES (1, 12345.67);
DROP TABLE IF EXISTS transactions;
CREATE TABLE transactions (id INT64, amount NUMERIC(18, 2));
INSERT INTO transactions VALUES \ (1, 100.50), (2, 200.75), (3, 150.25);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, price_a NUMERIC(10, 2), price_b NUMERIC(10, 4));
INSERT INTO prices VALUES (1, 10.50, 10.5000);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, str_value STRING);
INSERT INTO data VALUES \ (1, '  123  '), \ (2, '456'), \ (3, '789\ ');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, date_str STRING);
INSERT INTO data VALUES (1, 'not-a-date');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, int_col INT64, float_col FLOAT64);
INSERT INTO data VALUES (1, 10, 10.5), (2, 20, 20.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, nullable_str STRING);
INSERT INTO data VALUES (1, NULL);
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT name FROM customers WHERE EXISTS (SELECT 1 FROM orders);
SELECT name FROM customers c \ WHERE NOT EXISTS (SELECT 1 FROM orders o WHERE o.customer_id = c.id);
SELECT value FROM data WHERE value > ANY (SELECT threshold FROM thresholds);
SELECT value FROM data WHERE value > ALL (SELECT threshold FROM thresholds);
SELECT p.name FROM products p \ WHERE EXISTS (\ SELECT 1 FROM categories c \ WHERE c.id = p.category_id \ AND EXISTS (\ SELECT 1 FROM orders o WHERE o.product_id = p.id\ )\ );
SELECT id, DATE_ADD(event_date, INTERVAL 7 DAY) as future_date FROM events ORDER BY id;
SELECT id, EXTRACT(YEAR FROM d) as year, EXTRACT(MONTH FROM d) as month FROM dates ORDER BY id;
SELECT TIMESTAMP_DIFF(end_time, start_time, HOUR) as hour_diff FROM events;
SELECT DATE_TRUNC(sale_date, MONTH) as month, SUM(amount) as total \ FROM sales \ GROUP BY DATE_TRUNC(sale_date, MONTH) \ ORDER BY month;
SELECT COUNT(DISTINCT ts) as distinct_timestamps FROM logs;
SELECT \ SUM(amount_numeric) as numeric_sum, \ SUM(amount_float) as float_sum \ FROM financial;
SELECT numerator / denominator as quotient FROM data;
SELECT \ SUM(amount) as total, \ AVG(amount) as average, \ MIN(amount) as minimum, \ MAX(amount) as maximum \ FROM transactions;
SELECT id FROM prices WHERE price_a = price_b;
SELECT id, CAST(str_value AS INT64) as int_value FROM data ORDER BY id;
SELECT CAST(date_str AS DATE) FROM data;
SELECT id FROM data WHERE int_col < float_col ORDER BY id;
SELECT CAST(CAST(123 AS STRING) AS FLOAT64) as result;
SELECT \ CAST(nullable_str AS INT64) as as_int, \ CAST(nullable_str AS FLOAT64) as as_float, \ CAST(nullable_str AS DATE) as as_date \ FROM data;
SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_not_exists_with_null_correlation
-- Source: p1_features_integration_comprehensive_tdd.rs:250
-- ============================================================================
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (id INT64, name STRING);
INSERT INTO customers VALUES (1, 'Alice'), (NULL, 'Bob');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (order_id INT64, customer_id INT64);
INSERT INTO orders VALUES (101, 1);
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (5), (10), (15);
DROP TABLE IF EXISTS thresholds;
CREATE TABLE thresholds (threshold INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (5), (10), (15);
DROP TABLE IF EXISTS thresholds;
CREATE TABLE thresholds (threshold INT64);
INSERT INTO thresholds VALUES (3), (NULL), (7);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING, category_id INT64);
INSERT INTO products VALUES (1, 'Widget', 10), (2, 'Gadget', 20);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, name STRING, parent_id INT64);
INSERT INTO categories VALUES (10, 'Electronics', NULL), (20, 'Toys', NULL);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, product_id INT64);
INSERT INTO orders VALUES (101, 1);
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, DATE '2024-01-15'), (2, NULL);
DROP TABLE IF EXISTS dates;
CREATE TABLE dates (id INT64, d DATE);
INSERT INTO dates VALUES \ (1, DATE '0001-01-01'), \ (2, DATE '9999-12-31'), \ (3, DATE '2000-02-29');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, start_time TIMESTAMP, end_time TIMESTAMP);
INSERT INTO events VALUES \ (1, TIMESTAMP '2024-03-10 01:00:00', TIMESTAMP '2024-03-10 03:00:00');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, sale_date DATE, amount FLOAT64);
INSERT INTO sales VALUES \ (1, DATE '2024-01-15', 100.0), \ (2, DATE '2024-01-20', 150.0), \ (3, DATE '2024-02-05', 200.0);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP());
INSERT INTO logs (id) VALUES (1), (2), (3);
DROP TABLE IF EXISTS financial;
CREATE TABLE financial (id INT64, amount_numeric NUMERIC(18, 2), amount_float FLOAT64);
INSERT INTO financial VALUES (1, 0.1, 0.1);
INSERT INTO financial VALUES (2, 0.2, 0.2);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, numerator NUMERIC(10, 2), denominator NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.00, 3.00);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value NUMERIC(5, 2));
INSERT INTO data VALUES (1, 12345.67);
DROP TABLE IF EXISTS transactions;
CREATE TABLE transactions (id INT64, amount NUMERIC(18, 2));
INSERT INTO transactions VALUES \ (1, 100.50), (2, 200.75), (3, 150.25);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, price_a NUMERIC(10, 2), price_b NUMERIC(10, 4));
INSERT INTO prices VALUES (1, 10.50, 10.5000);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, str_value STRING);
INSERT INTO data VALUES \ (1, '  123  '), \ (2, '456'), \ (3, '789\ ');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, date_str STRING);
INSERT INTO data VALUES (1, 'not-a-date');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, int_col INT64, float_col FLOAT64);
INSERT INTO data VALUES (1, 10, 10.5), (2, 20, 20.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, nullable_str STRING);
INSERT INTO data VALUES (1, NULL);
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT name FROM customers c \ WHERE NOT EXISTS (SELECT 1 FROM orders o WHERE o.customer_id = c.id);
SELECT value FROM data WHERE value > ANY (SELECT threshold FROM thresholds);
SELECT value FROM data WHERE value > ALL (SELECT threshold FROM thresholds);
SELECT p.name FROM products p \ WHERE EXISTS (\ SELECT 1 FROM categories c \ WHERE c.id = p.category_id \ AND EXISTS (\ SELECT 1 FROM orders o WHERE o.product_id = p.id\ )\ );
SELECT id, DATE_ADD(event_date, INTERVAL 7 DAY) as future_date FROM events ORDER BY id;
SELECT id, EXTRACT(YEAR FROM d) as year, EXTRACT(MONTH FROM d) as month FROM dates ORDER BY id;
SELECT TIMESTAMP_DIFF(end_time, start_time, HOUR) as hour_diff FROM events;
SELECT DATE_TRUNC(sale_date, MONTH) as month, SUM(amount) as total \ FROM sales \ GROUP BY DATE_TRUNC(sale_date, MONTH) \ ORDER BY month;
SELECT COUNT(DISTINCT ts) as distinct_timestamps FROM logs;
SELECT \ SUM(amount_numeric) as numeric_sum, \ SUM(amount_float) as float_sum \ FROM financial;
SELECT numerator / denominator as quotient FROM data;
SELECT \ SUM(amount) as total, \ AVG(amount) as average, \ MIN(amount) as minimum, \ MAX(amount) as maximum \ FROM transactions;
SELECT id FROM prices WHERE price_a = price_b;
SELECT id, CAST(str_value AS INT64) as int_value FROM data ORDER BY id;
SELECT CAST(date_str AS DATE) FROM data;
SELECT id FROM data WHERE int_col < float_col ORDER BY id;
SELECT CAST(CAST(123 AS STRING) AS FLOAT64) as result;
SELECT \ CAST(nullable_str AS INT64) as as_int, \ CAST(nullable_str AS FLOAT64) as as_float, \ CAST(nullable_str AS DATE) as as_date \ FROM data;
SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_any_operator_with_empty_subquery
-- Source: p1_features_integration_comprehensive_tdd.rs:285
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (5), (10), (15);
DROP TABLE IF EXISTS thresholds;
CREATE TABLE thresholds (threshold INT64);
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (5), (10), (15);
DROP TABLE IF EXISTS thresholds;
CREATE TABLE thresholds (threshold INT64);
INSERT INTO thresholds VALUES (3), (NULL), (7);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING, category_id INT64);
INSERT INTO products VALUES (1, 'Widget', 10), (2, 'Gadget', 20);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, name STRING, parent_id INT64);
INSERT INTO categories VALUES (10, 'Electronics', NULL), (20, 'Toys', NULL);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, product_id INT64);
INSERT INTO orders VALUES (101, 1);
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, DATE '2024-01-15'), (2, NULL);
DROP TABLE IF EXISTS dates;
CREATE TABLE dates (id INT64, d DATE);
INSERT INTO dates VALUES \ (1, DATE '0001-01-01'), \ (2, DATE '9999-12-31'), \ (3, DATE '2000-02-29');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, start_time TIMESTAMP, end_time TIMESTAMP);
INSERT INTO events VALUES \ (1, TIMESTAMP '2024-03-10 01:00:00', TIMESTAMP '2024-03-10 03:00:00');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, sale_date DATE, amount FLOAT64);
INSERT INTO sales VALUES \ (1, DATE '2024-01-15', 100.0), \ (2, DATE '2024-01-20', 150.0), \ (3, DATE '2024-02-05', 200.0);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP());
INSERT INTO logs (id) VALUES (1), (2), (3);
DROP TABLE IF EXISTS financial;
CREATE TABLE financial (id INT64, amount_numeric NUMERIC(18, 2), amount_float FLOAT64);
INSERT INTO financial VALUES (1, 0.1, 0.1);
INSERT INTO financial VALUES (2, 0.2, 0.2);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, numerator NUMERIC(10, 2), denominator NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.00, 3.00);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value NUMERIC(5, 2));
INSERT INTO data VALUES (1, 12345.67);
DROP TABLE IF EXISTS transactions;
CREATE TABLE transactions (id INT64, amount NUMERIC(18, 2));
INSERT INTO transactions VALUES \ (1, 100.50), (2, 200.75), (3, 150.25);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, price_a NUMERIC(10, 2), price_b NUMERIC(10, 4));
INSERT INTO prices VALUES (1, 10.50, 10.5000);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, str_value STRING);
INSERT INTO data VALUES \ (1, '  123  '), \ (2, '456'), \ (3, '789\ ');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, date_str STRING);
INSERT INTO data VALUES (1, 'not-a-date');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, int_col INT64, float_col FLOAT64);
INSERT INTO data VALUES (1, 10, 10.5), (2, 20, 20.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, nullable_str STRING);
INSERT INTO data VALUES (1, NULL);
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT value FROM data WHERE value > ANY (SELECT threshold FROM thresholds);
SELECT value FROM data WHERE value > ALL (SELECT threshold FROM thresholds);
SELECT p.name FROM products p \ WHERE EXISTS (\ SELECT 1 FROM categories c \ WHERE c.id = p.category_id \ AND EXISTS (\ SELECT 1 FROM orders o WHERE o.product_id = p.id\ )\ );
SELECT id, DATE_ADD(event_date, INTERVAL 7 DAY) as future_date FROM events ORDER BY id;
SELECT id, EXTRACT(YEAR FROM d) as year, EXTRACT(MONTH FROM d) as month FROM dates ORDER BY id;
SELECT TIMESTAMP_DIFF(end_time, start_time, HOUR) as hour_diff FROM events;
SELECT DATE_TRUNC(sale_date, MONTH) as month, SUM(amount) as total \ FROM sales \ GROUP BY DATE_TRUNC(sale_date, MONTH) \ ORDER BY month;
SELECT COUNT(DISTINCT ts) as distinct_timestamps FROM logs;
SELECT \ SUM(amount_numeric) as numeric_sum, \ SUM(amount_float) as float_sum \ FROM financial;
SELECT numerator / denominator as quotient FROM data;
SELECT \ SUM(amount) as total, \ AVG(amount) as average, \ MIN(amount) as minimum, \ MAX(amount) as maximum \ FROM transactions;
SELECT id FROM prices WHERE price_a = price_b;
SELECT id, CAST(str_value AS INT64) as int_value FROM data ORDER BY id;
SELECT CAST(date_str AS DATE) FROM data;
SELECT id FROM data WHERE int_col < float_col ORDER BY id;
SELECT CAST(CAST(123 AS STRING) AS FLOAT64) as result;
SELECT \ CAST(nullable_str AS INT64) as as_int, \ CAST(nullable_str AS FLOAT64) as as_float, \ CAST(nullable_str AS DATE) as as_date \ FROM data;
SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_all_operator_with_null_values
-- Source: p1_features_integration_comprehensive_tdd.rs:313
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (value INT64);
INSERT INTO data VALUES (5), (10), (15);
DROP TABLE IF EXISTS thresholds;
CREATE TABLE thresholds (threshold INT64);
INSERT INTO thresholds VALUES (3), (NULL), (7);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING, category_id INT64);
INSERT INTO products VALUES (1, 'Widget', 10), (2, 'Gadget', 20);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, name STRING, parent_id INT64);
INSERT INTO categories VALUES (10, 'Electronics', NULL), (20, 'Toys', NULL);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, product_id INT64);
INSERT INTO orders VALUES (101, 1);
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, DATE '2024-01-15'), (2, NULL);
DROP TABLE IF EXISTS dates;
CREATE TABLE dates (id INT64, d DATE);
INSERT INTO dates VALUES \ (1, DATE '0001-01-01'), \ (2, DATE '9999-12-31'), \ (3, DATE '2000-02-29');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, start_time TIMESTAMP, end_time TIMESTAMP);
INSERT INTO events VALUES \ (1, TIMESTAMP '2024-03-10 01:00:00', TIMESTAMP '2024-03-10 03:00:00');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, sale_date DATE, amount FLOAT64);
INSERT INTO sales VALUES \ (1, DATE '2024-01-15', 100.0), \ (2, DATE '2024-01-20', 150.0), \ (3, DATE '2024-02-05', 200.0);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP());
INSERT INTO logs (id) VALUES (1), (2), (3);
DROP TABLE IF EXISTS financial;
CREATE TABLE financial (id INT64, amount_numeric NUMERIC(18, 2), amount_float FLOAT64);
INSERT INTO financial VALUES (1, 0.1, 0.1);
INSERT INTO financial VALUES (2, 0.2, 0.2);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, numerator NUMERIC(10, 2), denominator NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.00, 3.00);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value NUMERIC(5, 2));
INSERT INTO data VALUES (1, 12345.67);
DROP TABLE IF EXISTS transactions;
CREATE TABLE transactions (id INT64, amount NUMERIC(18, 2));
INSERT INTO transactions VALUES \ (1, 100.50), (2, 200.75), (3, 150.25);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, price_a NUMERIC(10, 2), price_b NUMERIC(10, 4));
INSERT INTO prices VALUES (1, 10.50, 10.5000);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, str_value STRING);
INSERT INTO data VALUES \ (1, '  123  '), \ (2, '456'), \ (3, '789\ ');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, date_str STRING);
INSERT INTO data VALUES (1, 'not-a-date');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, int_col INT64, float_col FLOAT64);
INSERT INTO data VALUES (1, 10, 10.5), (2, 20, 20.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, nullable_str STRING);
INSERT INTO data VALUES (1, NULL);
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT value FROM data WHERE value > ALL (SELECT threshold FROM thresholds);
SELECT p.name FROM products p \ WHERE EXISTS (\ SELECT 1 FROM categories c \ WHERE c.id = p.category_id \ AND EXISTS (\ SELECT 1 FROM orders o WHERE o.product_id = p.id\ )\ );
SELECT id, DATE_ADD(event_date, INTERVAL 7 DAY) as future_date FROM events ORDER BY id;
SELECT id, EXTRACT(YEAR FROM d) as year, EXTRACT(MONTH FROM d) as month FROM dates ORDER BY id;
SELECT TIMESTAMP_DIFF(end_time, start_time, HOUR) as hour_diff FROM events;
SELECT DATE_TRUNC(sale_date, MONTH) as month, SUM(amount) as total \ FROM sales \ GROUP BY DATE_TRUNC(sale_date, MONTH) \ ORDER BY month;
SELECT COUNT(DISTINCT ts) as distinct_timestamps FROM logs;
SELECT \ SUM(amount_numeric) as numeric_sum, \ SUM(amount_float) as float_sum \ FROM financial;
SELECT numerator / denominator as quotient FROM data;
SELECT \ SUM(amount) as total, \ AVG(amount) as average, \ MIN(amount) as minimum, \ MAX(amount) as maximum \ FROM transactions;
SELECT id FROM prices WHERE price_a = price_b;
SELECT id, CAST(str_value AS INT64) as int_value FROM data ORDER BY id;
SELECT CAST(date_str AS DATE) FROM data;
SELECT id FROM data WHERE int_col < float_col ORDER BY id;
SELECT CAST(CAST(123 AS STRING) AS FLOAT64) as result;
SELECT \ CAST(nullable_str AS INT64) as as_int, \ CAST(nullable_str AS FLOAT64) as as_float, \ CAST(nullable_str AS DATE) as as_date \ FROM data;
SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_nested_exists_with_correlated_subqueries
-- Source: p1_features_integration_comprehensive_tdd.rs:345
-- ============================================================================
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING, category_id INT64);
INSERT INTO products VALUES (1, 'Widget', 10), (2, 'Gadget', 20);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, name STRING, parent_id INT64);
INSERT INTO categories VALUES (10, 'Electronics', NULL), (20, 'Toys', NULL);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, product_id INT64);
INSERT INTO orders VALUES (101, 1);
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, DATE '2024-01-15'), (2, NULL);
DROP TABLE IF EXISTS dates;
CREATE TABLE dates (id INT64, d DATE);
INSERT INTO dates VALUES \ (1, DATE '0001-01-01'), \ (2, DATE '9999-12-31'), \ (3, DATE '2000-02-29');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, start_time TIMESTAMP, end_time TIMESTAMP);
INSERT INTO events VALUES \ (1, TIMESTAMP '2024-03-10 01:00:00', TIMESTAMP '2024-03-10 03:00:00');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, sale_date DATE, amount FLOAT64);
INSERT INTO sales VALUES \ (1, DATE '2024-01-15', 100.0), \ (2, DATE '2024-01-20', 150.0), \ (3, DATE '2024-02-05', 200.0);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP());
INSERT INTO logs (id) VALUES (1), (2), (3);
DROP TABLE IF EXISTS financial;
CREATE TABLE financial (id INT64, amount_numeric NUMERIC(18, 2), amount_float FLOAT64);
INSERT INTO financial VALUES (1, 0.1, 0.1);
INSERT INTO financial VALUES (2, 0.2, 0.2);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, numerator NUMERIC(10, 2), denominator NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.00, 3.00);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value NUMERIC(5, 2));
INSERT INTO data VALUES (1, 12345.67);
DROP TABLE IF EXISTS transactions;
CREATE TABLE transactions (id INT64, amount NUMERIC(18, 2));
INSERT INTO transactions VALUES \ (1, 100.50), (2, 200.75), (3, 150.25);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, price_a NUMERIC(10, 2), price_b NUMERIC(10, 4));
INSERT INTO prices VALUES (1, 10.50, 10.5000);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, str_value STRING);
INSERT INTO data VALUES \ (1, '  123  '), \ (2, '456'), \ (3, '789\ ');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, date_str STRING);
INSERT INTO data VALUES (1, 'not-a-date');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, int_col INT64, float_col FLOAT64);
INSERT INTO data VALUES (1, 10, 10.5), (2, 20, 20.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, nullable_str STRING);
INSERT INTO data VALUES (1, NULL);
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT p.name FROM products p \ WHERE EXISTS (\ SELECT 1 FROM categories c \ WHERE c.id = p.category_id \ AND EXISTS (\ SELECT 1 FROM orders o WHERE o.product_id = p.id\ )\ );
SELECT id, DATE_ADD(event_date, INTERVAL 7 DAY) as future_date FROM events ORDER BY id;
SELECT id, EXTRACT(YEAR FROM d) as year, EXTRACT(MONTH FROM d) as month FROM dates ORDER BY id;
SELECT TIMESTAMP_DIFF(end_time, start_time, HOUR) as hour_diff FROM events;
SELECT DATE_TRUNC(sale_date, MONTH) as month, SUM(amount) as total \ FROM sales \ GROUP BY DATE_TRUNC(sale_date, MONTH) \ ORDER BY month;
SELECT COUNT(DISTINCT ts) as distinct_timestamps FROM logs;
SELECT \ SUM(amount_numeric) as numeric_sum, \ SUM(amount_float) as float_sum \ FROM financial;
SELECT numerator / denominator as quotient FROM data;
SELECT \ SUM(amount) as total, \ AVG(amount) as average, \ MIN(amount) as minimum, \ MAX(amount) as maximum \ FROM transactions;
SELECT id FROM prices WHERE price_a = price_b;
SELECT id, CAST(str_value AS INT64) as int_value FROM data ORDER BY id;
SELECT CAST(date_str AS DATE) FROM data;
SELECT id FROM data WHERE int_col < float_col ORDER BY id;
SELECT CAST(CAST(123 AS STRING) AS FLOAT64) as result;
SELECT \ CAST(nullable_str AS INT64) as as_int, \ CAST(nullable_str AS FLOAT64) as as_float, \ CAST(nullable_str AS DATE) as as_date \ FROM data;
SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_date_arithmetic_with_null_values
-- Source: p1_features_integration_comprehensive_tdd.rs:396
-- ============================================================================
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, event_date DATE);
INSERT INTO events VALUES (1, DATE '2024-01-15'), (2, NULL);
DROP TABLE IF EXISTS dates;
CREATE TABLE dates (id INT64, d DATE);
INSERT INTO dates VALUES \ (1, DATE '0001-01-01'), \ (2, DATE '9999-12-31'), \ (3, DATE '2000-02-29');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, start_time TIMESTAMP, end_time TIMESTAMP);
INSERT INTO events VALUES \ (1, TIMESTAMP '2024-03-10 01:00:00', TIMESTAMP '2024-03-10 03:00:00');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, sale_date DATE, amount FLOAT64);
INSERT INTO sales VALUES \ (1, DATE '2024-01-15', 100.0), \ (2, DATE '2024-01-20', 150.0), \ (3, DATE '2024-02-05', 200.0);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP());
INSERT INTO logs (id) VALUES (1), (2), (3);
DROP TABLE IF EXISTS financial;
CREATE TABLE financial (id INT64, amount_numeric NUMERIC(18, 2), amount_float FLOAT64);
INSERT INTO financial VALUES (1, 0.1, 0.1);
INSERT INTO financial VALUES (2, 0.2, 0.2);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, numerator NUMERIC(10, 2), denominator NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.00, 3.00);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value NUMERIC(5, 2));
INSERT INTO data VALUES (1, 12345.67);
DROP TABLE IF EXISTS transactions;
CREATE TABLE transactions (id INT64, amount NUMERIC(18, 2));
INSERT INTO transactions VALUES \ (1, 100.50), (2, 200.75), (3, 150.25);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, price_a NUMERIC(10, 2), price_b NUMERIC(10, 4));
INSERT INTO prices VALUES (1, 10.50, 10.5000);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, str_value STRING);
INSERT INTO data VALUES \ (1, '  123  '), \ (2, '456'), \ (3, '789\ ');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, date_str STRING);
INSERT INTO data VALUES (1, 'not-a-date');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, int_col INT64, float_col FLOAT64);
INSERT INTO data VALUES (1, 10, 10.5), (2, 20, 20.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, nullable_str STRING);
INSERT INTO data VALUES (1, NULL);
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT id, DATE_ADD(event_date, INTERVAL 7 DAY) as future_date FROM events ORDER BY id;
SELECT id, EXTRACT(YEAR FROM d) as year, EXTRACT(MONTH FROM d) as month FROM dates ORDER BY id;
SELECT TIMESTAMP_DIFF(end_time, start_time, HOUR) as hour_diff FROM events;
SELECT DATE_TRUNC(sale_date, MONTH) as month, SUM(amount) as total \ FROM sales \ GROUP BY DATE_TRUNC(sale_date, MONTH) \ ORDER BY month;
SELECT COUNT(DISTINCT ts) as distinct_timestamps FROM logs;
SELECT \ SUM(amount_numeric) as numeric_sum, \ SUM(amount_float) as float_sum \ FROM financial;
SELECT numerator / denominator as quotient FROM data;
SELECT \ SUM(amount) as total, \ AVG(amount) as average, \ MIN(amount) as minimum, \ MAX(amount) as maximum \ FROM transactions;
SELECT id FROM prices WHERE price_a = price_b;
SELECT id, CAST(str_value AS INT64) as int_value FROM data ORDER BY id;
SELECT CAST(date_str AS DATE) FROM data;
SELECT id FROM data WHERE int_col < float_col ORDER BY id;
SELECT CAST(CAST(123 AS STRING) AS FLOAT64) as result;
SELECT \ CAST(nullable_str AS INT64) as as_int, \ CAST(nullable_str AS FLOAT64) as as_float, \ CAST(nullable_str AS DATE) as as_date \ FROM data;
SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_extract_from_boundary_dates
-- Source: p1_features_integration_comprehensive_tdd.rs:428
-- ============================================================================
DROP TABLE IF EXISTS dates;
CREATE TABLE dates (id INT64, d DATE);
INSERT INTO dates VALUES \ (1, DATE '0001-01-01'), \ (2, DATE '9999-12-31'), \ (3, DATE '2000-02-29');
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, start_time TIMESTAMP, end_time TIMESTAMP);
INSERT INTO events VALUES \ (1, TIMESTAMP '2024-03-10 01:00:00', TIMESTAMP '2024-03-10 03:00:00');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, sale_date DATE, amount FLOAT64);
INSERT INTO sales VALUES \ (1, DATE '2024-01-15', 100.0), \ (2, DATE '2024-01-20', 150.0), \ (3, DATE '2024-02-05', 200.0);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP());
INSERT INTO logs (id) VALUES (1), (2), (3);
DROP TABLE IF EXISTS financial;
CREATE TABLE financial (id INT64, amount_numeric NUMERIC(18, 2), amount_float FLOAT64);
INSERT INTO financial VALUES (1, 0.1, 0.1);
INSERT INTO financial VALUES (2, 0.2, 0.2);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, numerator NUMERIC(10, 2), denominator NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.00, 3.00);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value NUMERIC(5, 2));
INSERT INTO data VALUES (1, 12345.67);
DROP TABLE IF EXISTS transactions;
CREATE TABLE transactions (id INT64, amount NUMERIC(18, 2));
INSERT INTO transactions VALUES \ (1, 100.50), (2, 200.75), (3, 150.25);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, price_a NUMERIC(10, 2), price_b NUMERIC(10, 4));
INSERT INTO prices VALUES (1, 10.50, 10.5000);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, str_value STRING);
INSERT INTO data VALUES \ (1, '  123  '), \ (2, '456'), \ (3, '789\ ');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, date_str STRING);
INSERT INTO data VALUES (1, 'not-a-date');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, int_col INT64, float_col FLOAT64);
INSERT INTO data VALUES (1, 10, 10.5), (2, 20, 20.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, nullable_str STRING);
INSERT INTO data VALUES (1, NULL);
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT id, EXTRACT(YEAR FROM d) as year, EXTRACT(MONTH FROM d) as month FROM dates ORDER BY id;
SELECT TIMESTAMP_DIFF(end_time, start_time, HOUR) as hour_diff FROM events;
SELECT DATE_TRUNC(sale_date, MONTH) as month, SUM(amount) as total \ FROM sales \ GROUP BY DATE_TRUNC(sale_date, MONTH) \ ORDER BY month;
SELECT COUNT(DISTINCT ts) as distinct_timestamps FROM logs;
SELECT \ SUM(amount_numeric) as numeric_sum, \ SUM(amount_float) as float_sum \ FROM financial;
SELECT numerator / denominator as quotient FROM data;
SELECT \ SUM(amount) as total, \ AVG(amount) as average, \ MIN(amount) as minimum, \ MAX(amount) as maximum \ FROM transactions;
SELECT id FROM prices WHERE price_a = price_b;
SELECT id, CAST(str_value AS INT64) as int_value FROM data ORDER BY id;
SELECT CAST(date_str AS DATE) FROM data;
SELECT id FROM data WHERE int_col < float_col ORDER BY id;
SELECT CAST(CAST(123 AS STRING) AS FLOAT64) as result;
SELECT \ CAST(nullable_str AS INT64) as as_int, \ CAST(nullable_str AS FLOAT64) as as_float, \ CAST(nullable_str AS DATE) as as_date \ FROM data;
SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_timestamp_diff_across_dst_boundary
-- Source: p1_features_integration_comprehensive_tdd.rs:470
-- ============================================================================
DROP TABLE IF EXISTS events;
CREATE TABLE events (id INT64, start_time TIMESTAMP, end_time TIMESTAMP);
INSERT INTO events VALUES \ (1, TIMESTAMP '2024-03-10 01:00:00', TIMESTAMP '2024-03-10 03:00:00');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, sale_date DATE, amount FLOAT64);
INSERT INTO sales VALUES \ (1, DATE '2024-01-15', 100.0), \ (2, DATE '2024-01-20', 150.0), \ (3, DATE '2024-02-05', 200.0);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP());
INSERT INTO logs (id) VALUES (1), (2), (3);
DROP TABLE IF EXISTS financial;
CREATE TABLE financial (id INT64, amount_numeric NUMERIC(18, 2), amount_float FLOAT64);
INSERT INTO financial VALUES (1, 0.1, 0.1);
INSERT INTO financial VALUES (2, 0.2, 0.2);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, numerator NUMERIC(10, 2), denominator NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.00, 3.00);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value NUMERIC(5, 2));
INSERT INTO data VALUES (1, 12345.67);
DROP TABLE IF EXISTS transactions;
CREATE TABLE transactions (id INT64, amount NUMERIC(18, 2));
INSERT INTO transactions VALUES \ (1, 100.50), (2, 200.75), (3, 150.25);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, price_a NUMERIC(10, 2), price_b NUMERIC(10, 4));
INSERT INTO prices VALUES (1, 10.50, 10.5000);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, str_value STRING);
INSERT INTO data VALUES \ (1, '  123  '), \ (2, '456'), \ (3, '789\ ');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, date_str STRING);
INSERT INTO data VALUES (1, 'not-a-date');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, int_col INT64, float_col FLOAT64);
INSERT INTO data VALUES (1, 10, 10.5), (2, 20, 20.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, nullable_str STRING);
INSERT INTO data VALUES (1, NULL);
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT TIMESTAMP_DIFF(end_time, start_time, HOUR) as hour_diff FROM events;
SELECT DATE_TRUNC(sale_date, MONTH) as month, SUM(amount) as total \ FROM sales \ GROUP BY DATE_TRUNC(sale_date, MONTH) \ ORDER BY month;
SELECT COUNT(DISTINCT ts) as distinct_timestamps FROM logs;
SELECT \ SUM(amount_numeric) as numeric_sum, \ SUM(amount_float) as float_sum \ FROM financial;
SELECT numerator / denominator as quotient FROM data;
SELECT \ SUM(amount) as total, \ AVG(amount) as average, \ MIN(amount) as minimum, \ MAX(amount) as maximum \ FROM transactions;
SELECT id FROM prices WHERE price_a = price_b;
SELECT id, CAST(str_value AS INT64) as int_value FROM data ORDER BY id;
SELECT CAST(date_str AS DATE) FROM data;
SELECT id FROM data WHERE int_col < float_col ORDER BY id;
SELECT CAST(CAST(123 AS STRING) AS FLOAT64) as result;
SELECT \ CAST(nullable_str AS INT64) as as_int, \ CAST(nullable_str AS FLOAT64) as as_float, \ CAST(nullable_str AS DATE) as as_date \ FROM data;
SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_date_truncate_with_aggregation
-- Source: p1_features_integration_comprehensive_tdd.rs:495
-- ============================================================================
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, sale_date DATE, amount FLOAT64);
INSERT INTO sales VALUES \ (1, DATE '2024-01-15', 100.0), \ (2, DATE '2024-01-20', 150.0), \ (3, DATE '2024-02-05', 200.0);
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP());
INSERT INTO logs (id) VALUES (1), (2), (3);
DROP TABLE IF EXISTS financial;
CREATE TABLE financial (id INT64, amount_numeric NUMERIC(18, 2), amount_float FLOAT64);
INSERT INTO financial VALUES (1, 0.1, 0.1);
INSERT INTO financial VALUES (2, 0.2, 0.2);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, numerator NUMERIC(10, 2), denominator NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.00, 3.00);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value NUMERIC(5, 2));
INSERT INTO data VALUES (1, 12345.67);
DROP TABLE IF EXISTS transactions;
CREATE TABLE transactions (id INT64, amount NUMERIC(18, 2));
INSERT INTO transactions VALUES \ (1, 100.50), (2, 200.75), (3, 150.25);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, price_a NUMERIC(10, 2), price_b NUMERIC(10, 4));
INSERT INTO prices VALUES (1, 10.50, 10.5000);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, str_value STRING);
INSERT INTO data VALUES \ (1, '  123  '), \ (2, '456'), \ (3, '789\ ');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, date_str STRING);
INSERT INTO data VALUES (1, 'not-a-date');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, int_col INT64, float_col FLOAT64);
INSERT INTO data VALUES (1, 10, 10.5), (2, 20, 20.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, nullable_str STRING);
INSERT INTO data VALUES (1, NULL);
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT DATE_TRUNC(sale_date, MONTH) as month, SUM(amount) as total \ FROM sales \ GROUP BY DATE_TRUNC(sale_date, MONTH) \ ORDER BY month;
SELECT COUNT(DISTINCT ts) as distinct_timestamps FROM logs;
SELECT \ SUM(amount_numeric) as numeric_sum, \ SUM(amount_float) as float_sum \ FROM financial;
SELECT numerator / denominator as quotient FROM data;
SELECT \ SUM(amount) as total, \ AVG(amount) as average, \ MIN(amount) as minimum, \ MAX(amount) as maximum \ FROM transactions;
SELECT id FROM prices WHERE price_a = price_b;
SELECT id, CAST(str_value AS INT64) as int_value FROM data ORDER BY id;
SELECT CAST(date_str AS DATE) FROM data;
SELECT id FROM data WHERE int_col < float_col ORDER BY id;
SELECT CAST(CAST(123 AS STRING) AS FLOAT64) as result;
SELECT \ CAST(nullable_str AS INT64) as as_int, \ CAST(nullable_str AS FLOAT64) as as_float, \ CAST(nullable_str AS DATE) as as_date \ FROM data;
SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_current_timestamp_consistency_in_query
-- Source: p1_features_integration_comprehensive_tdd.rs:530
-- ============================================================================
DROP TABLE IF EXISTS logs;
CREATE TABLE logs (id INT64, ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP());
INSERT INTO logs (id) VALUES (1), (2), (3);
DROP TABLE IF EXISTS financial;
CREATE TABLE financial (id INT64, amount_numeric NUMERIC(18, 2), amount_float FLOAT64);
INSERT INTO financial VALUES (1, 0.1, 0.1);
INSERT INTO financial VALUES (2, 0.2, 0.2);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, numerator NUMERIC(10, 2), denominator NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.00, 3.00);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value NUMERIC(5, 2));
INSERT INTO data VALUES (1, 12345.67);
DROP TABLE IF EXISTS transactions;
CREATE TABLE transactions (id INT64, amount NUMERIC(18, 2));
INSERT INTO transactions VALUES \ (1, 100.50), (2, 200.75), (3, 150.25);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, price_a NUMERIC(10, 2), price_b NUMERIC(10, 4));
INSERT INTO prices VALUES (1, 10.50, 10.5000);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, str_value STRING);
INSERT INTO data VALUES \ (1, '  123  '), \ (2, '456'), \ (3, '789\ ');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, date_str STRING);
INSERT INTO data VALUES (1, 'not-a-date');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, int_col INT64, float_col FLOAT64);
INSERT INTO data VALUES (1, 10, 10.5), (2, 20, 20.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, nullable_str STRING);
INSERT INTO data VALUES (1, NULL);
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT COUNT(DISTINCT ts) as distinct_timestamps FROM logs;
SELECT \ SUM(amount_numeric) as numeric_sum, \ SUM(amount_float) as float_sum \ FROM financial;
SELECT numerator / denominator as quotient FROM data;
SELECT \ SUM(amount) as total, \ AVG(amount) as average, \ MIN(amount) as minimum, \ MAX(amount) as maximum \ FROM transactions;
SELECT id FROM prices WHERE price_a = price_b;
SELECT id, CAST(str_value AS INT64) as int_value FROM data ORDER BY id;
SELECT CAST(date_str AS DATE) FROM data;
SELECT id FROM data WHERE int_col < float_col ORDER BY id;
SELECT CAST(CAST(123 AS STRING) AS FLOAT64) as result;
SELECT \ CAST(nullable_str AS INT64) as as_int, \ CAST(nullable_str AS FLOAT64) as as_float, \ CAST(nullable_str AS DATE) as as_date \ FROM data;
SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_numeric_exact_precision_vs_float64
-- Source: p1_features_integration_comprehensive_tdd.rs:561
-- ============================================================================
DROP TABLE IF EXISTS financial;
CREATE TABLE financial (id INT64, amount_numeric NUMERIC(18, 2), amount_float FLOAT64);
INSERT INTO financial VALUES (1, 0.1, 0.1);
INSERT INTO financial VALUES (2, 0.2, 0.2);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, numerator NUMERIC(10, 2), denominator NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.00, 3.00);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value NUMERIC(5, 2));
INSERT INTO data VALUES (1, 12345.67);
DROP TABLE IF EXISTS transactions;
CREATE TABLE transactions (id INT64, amount NUMERIC(18, 2));
INSERT INTO transactions VALUES \ (1, 100.50), (2, 200.75), (3, 150.25);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, price_a NUMERIC(10, 2), price_b NUMERIC(10, 4));
INSERT INTO prices VALUES (1, 10.50, 10.5000);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, str_value STRING);
INSERT INTO data VALUES \ (1, '  123  '), \ (2, '456'), \ (3, '789\ ');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, date_str STRING);
INSERT INTO data VALUES (1, 'not-a-date');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, int_col INT64, float_col FLOAT64);
INSERT INTO data VALUES (1, 10, 10.5), (2, 20, 20.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, nullable_str STRING);
INSERT INTO data VALUES (1, NULL);
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT \ SUM(amount_numeric) as numeric_sum, \ SUM(amount_float) as float_sum \ FROM financial;
SELECT numerator / denominator as quotient FROM data;
SELECT \ SUM(amount) as total, \ AVG(amount) as average, \ MIN(amount) as minimum, \ MAX(amount) as maximum \ FROM transactions;
SELECT id FROM prices WHERE price_a = price_b;
SELECT id, CAST(str_value AS INT64) as int_value FROM data ORDER BY id;
SELECT CAST(date_str AS DATE) FROM data;
SELECT id FROM data WHERE int_col < float_col ORDER BY id;
SELECT CAST(CAST(123 AS STRING) AS FLOAT64) as result;
SELECT \ CAST(nullable_str AS INT64) as as_int, \ CAST(nullable_str AS FLOAT64) as as_float, \ CAST(nullable_str AS DATE) as as_date \ FROM data;
SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_numeric_division_scale_preservation
-- Source: p1_features_integration_comprehensive_tdd.rs:590
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, numerator NUMERIC(10, 2), denominator NUMERIC(10, 2));
INSERT INTO data VALUES (1, 10.00, 3.00);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value NUMERIC(5, 2));
INSERT INTO data VALUES (1, 12345.67);
DROP TABLE IF EXISTS transactions;
CREATE TABLE transactions (id INT64, amount NUMERIC(18, 2));
INSERT INTO transactions VALUES \ (1, 100.50), (2, 200.75), (3, 150.25);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, price_a NUMERIC(10, 2), price_b NUMERIC(10, 4));
INSERT INTO prices VALUES (1, 10.50, 10.5000);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, str_value STRING);
INSERT INTO data VALUES \ (1, '  123  '), \ (2, '456'), \ (3, '789\ ');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, date_str STRING);
INSERT INTO data VALUES (1, 'not-a-date');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, int_col INT64, float_col FLOAT64);
INSERT INTO data VALUES (1, 10, 10.5), (2, 20, 20.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, nullable_str STRING);
INSERT INTO data VALUES (1, NULL);
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT numerator / denominator as quotient FROM data;
SELECT \ SUM(amount) as total, \ AVG(amount) as average, \ MIN(amount) as minimum, \ MAX(amount) as maximum \ FROM transactions;
SELECT id FROM prices WHERE price_a = price_b;
SELECT id, CAST(str_value AS INT64) as int_value FROM data ORDER BY id;
SELECT CAST(date_str AS DATE) FROM data;
SELECT id FROM data WHERE int_col < float_col ORDER BY id;
SELECT CAST(CAST(123 AS STRING) AS FLOAT64) as result;
SELECT \ CAST(nullable_str AS INT64) as as_int, \ CAST(nullable_str AS FLOAT64) as as_float, \ CAST(nullable_str AS DATE) as as_date \ FROM data;
SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_numeric_overflow_detection
-- Source: p1_features_integration_comprehensive_tdd.rs:612
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value NUMERIC(5, 2));
INSERT INTO data VALUES (1, 12345.67);
DROP TABLE IF EXISTS transactions;
CREATE TABLE transactions (id INT64, amount NUMERIC(18, 2));
INSERT INTO transactions VALUES \ (1, 100.50), (2, 200.75), (3, 150.25);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, price_a NUMERIC(10, 2), price_b NUMERIC(10, 4));
INSERT INTO prices VALUES (1, 10.50, 10.5000);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, str_value STRING);
INSERT INTO data VALUES \ (1, '  123  '), \ (2, '456'), \ (3, '789\ ');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, date_str STRING);
INSERT INTO data VALUES (1, 'not-a-date');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, int_col INT64, float_col FLOAT64);
INSERT INTO data VALUES (1, 10, 10.5), (2, 20, 20.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, nullable_str STRING);
INSERT INTO data VALUES (1, NULL);
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT \ SUM(amount) as total, \ AVG(amount) as average, \ MIN(amount) as minimum, \ MAX(amount) as maximum \ FROM transactions;
SELECT id FROM prices WHERE price_a = price_b;
SELECT id, CAST(str_value AS INT64) as int_value FROM data ORDER BY id;
SELECT CAST(date_str AS DATE) FROM data;
SELECT id FROM data WHERE int_col < float_col ORDER BY id;
SELECT CAST(CAST(123 AS STRING) AS FLOAT64) as result;
SELECT \ CAST(nullable_str AS INT64) as as_int, \ CAST(nullable_str AS FLOAT64) as as_float, \ CAST(nullable_str AS DATE) as as_date \ FROM data;
SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_numeric_with_aggregation_functions
-- Source: p1_features_integration_comprehensive_tdd.rs:637
-- ============================================================================
DROP TABLE IF EXISTS transactions;
CREATE TABLE transactions (id INT64, amount NUMERIC(18, 2));
INSERT INTO transactions VALUES \ (1, 100.50), (2, 200.75), (3, 150.25);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, price_a NUMERIC(10, 2), price_b NUMERIC(10, 4));
INSERT INTO prices VALUES (1, 10.50, 10.5000);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, str_value STRING);
INSERT INTO data VALUES \ (1, '  123  '), \ (2, '456'), \ (3, '789\ ');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, date_str STRING);
INSERT INTO data VALUES (1, 'not-a-date');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, int_col INT64, float_col FLOAT64);
INSERT INTO data VALUES (1, 10, 10.5), (2, 20, 20.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, nullable_str STRING);
INSERT INTO data VALUES (1, NULL);
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT \ SUM(amount) as total, \ AVG(amount) as average, \ MIN(amount) as minimum, \ MAX(amount) as maximum \ FROM transactions;
SELECT id FROM prices WHERE price_a = price_b;
SELECT id, CAST(str_value AS INT64) as int_value FROM data ORDER BY id;
SELECT CAST(date_str AS DATE) FROM data;
SELECT id FROM data WHERE int_col < float_col ORDER BY id;
SELECT CAST(CAST(123 AS STRING) AS FLOAT64) as result;
SELECT \ CAST(nullable_str AS INT64) as as_int, \ CAST(nullable_str AS FLOAT64) as as_float, \ CAST(nullable_str AS DATE) as as_date \ FROM data;
SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_numeric_comparison_with_different_scales
-- Source: p1_features_integration_comprehensive_tdd.rs:666
-- ============================================================================
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, price_a NUMERIC(10, 2), price_b NUMERIC(10, 4));
INSERT INTO prices VALUES (1, 10.50, 10.5000);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, str_value STRING);
INSERT INTO data VALUES \ (1, '  123  '), \ (2, '456'), \ (3, '789\ ');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, date_str STRING);
INSERT INTO data VALUES (1, 'not-a-date');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, int_col INT64, float_col FLOAT64);
INSERT INTO data VALUES (1, 10, 10.5), (2, 20, 20.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, nullable_str STRING);
INSERT INTO data VALUES (1, NULL);
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT id FROM prices WHERE price_a = price_b;
SELECT id, CAST(str_value AS INT64) as int_value FROM data ORDER BY id;
SELECT CAST(date_str AS DATE) FROM data;
SELECT id FROM data WHERE int_col < float_col ORDER BY id;
SELECT CAST(CAST(123 AS STRING) AS FLOAT64) as result;
SELECT \ CAST(nullable_str AS INT64) as as_int, \ CAST(nullable_str AS FLOAT64) as as_float, \ CAST(nullable_str AS DATE) as as_date \ FROM data;
SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_cast_string_to_int64_with_whitespace
-- Source: p1_features_integration_comprehensive_tdd.rs:695
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, str_value STRING);
INSERT INTO data VALUES \ (1, '  123  '), \ (2, '456'), \ (3, '789\ ');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, date_str STRING);
INSERT INTO data VALUES (1, 'not-a-date');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, int_col INT64, float_col FLOAT64);
INSERT INTO data VALUES (1, 10, 10.5), (2, 20, 20.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, nullable_str STRING);
INSERT INTO data VALUES (1, NULL);
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT id, CAST(str_value AS INT64) as int_value FROM data ORDER BY id;
SELECT CAST(date_str AS DATE) FROM data;
SELECT id FROM data WHERE int_col < float_col ORDER BY id;
SELECT CAST(CAST(123 AS STRING) AS FLOAT64) as result;
SELECT \ CAST(nullable_str AS INT64) as as_int, \ CAST(nullable_str AS FLOAT64) as as_float, \ CAST(nullable_str AS DATE) as as_date \ FROM data;
SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_cast_invalid_string_to_date_error_handling
-- Source: p1_features_integration_comprehensive_tdd.rs:725
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, date_str STRING);
INSERT INTO data VALUES (1, 'not-a-date');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, int_col INT64, float_col FLOAT64);
INSERT INTO data VALUES (1, 10, 10.5), (2, 20, 20.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, nullable_str STRING);
INSERT INTO data VALUES (1, NULL);
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT CAST(date_str AS DATE) FROM data;
SELECT id FROM data WHERE int_col < float_col ORDER BY id;
SELECT CAST(CAST(123 AS STRING) AS FLOAT64) as result;
SELECT \ CAST(nullable_str AS INT64) as as_int, \ CAST(nullable_str AS FLOAT64) as as_float, \ CAST(nullable_str AS DATE) as as_date \ FROM data;
SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_implicit_type_coercion_in_comparisons
-- Source: p1_features_integration_comprehensive_tdd.rs:748
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, int_col INT64, float_col FLOAT64);
INSERT INTO data VALUES (1, 10, 10.5), (2, 20, 20.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, nullable_str STRING);
INSERT INTO data VALUES (1, NULL);
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT id FROM data WHERE int_col < float_col ORDER BY id;
SELECT CAST(CAST(123 AS STRING) AS FLOAT64) as result;
SELECT \ CAST(nullable_str AS INT64) as as_int, \ CAST(nullable_str AS FLOAT64) as as_float, \ CAST(nullable_str AS DATE) as as_date \ FROM data;
SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_cast_chain_multiple_types
-- Source: p1_features_integration_comprehensive_tdd.rs:773
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, nullable_str STRING);
INSERT INTO data VALUES (1, NULL);
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT CAST(CAST(123 AS STRING) AS FLOAT64) as result;
SELECT \ CAST(nullable_str AS INT64) as as_int, \ CAST(nullable_str AS FLOAT64) as as_float, \ CAST(nullable_str AS DATE) as as_date \ FROM data;
SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_cast_null_values
-- Source: p1_features_integration_comprehensive_tdd.rs:791
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, nullable_str STRING);
INSERT INTO data VALUES (1, NULL);
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT \ CAST(nullable_str AS INT64) as as_int, \ CAST(nullable_str AS FLOAT64) as as_float, \ CAST(nullable_str AS DATE) as as_date \ FROM data;
SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_alter_table_add_column_to_large_table
-- Source: p1_features_integration_comprehensive_tdd.rs:828
-- ============================================================================
DROP TABLE IF EXISTS large_table;
CREATE TABLE large_table (id INT64, value STRING);
ALTER TABLE large_table ADD COLUMN new_col INT64 DEFAULT 0;
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT new_col FROM large_table LIMIT 1;
SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_alter_table_drop_column_with_index
-- Source: p1_features_integration_comprehensive_tdd.rs:862
-- ============================================================================
DROP TABLE IF EXISTS indexed_table;
CREATE TABLE indexed_table (id INT64, name STRING, email STRING);
CREATE INDEX idx_email ON indexed_table(email);
ALTER TABLE indexed_table DROP COLUMN email;
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT * FROM indexed_table;
SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_alter_table_rename_column_updates_queries
-- Source: p1_features_integration_comprehensive_tdd.rs:893
-- ============================================================================
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, user_name STRING);
INSERT INTO users VALUES (1, 'Alice');
ALTER TABLE users RENAME COLUMN user_name TO username;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT user_name FROM users;
SELECT username FROM users;
SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_alter_table_add_not_null_to_nullable_column_with_nulls
-- Source: p1_features_integration_comprehensive_tdd.rs:921
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, optional_col STRING);
INSERT INTO data VALUES (1, 'present'), (2, NULL);
ALTER TABLE data ALTER COLUMN optional_col SET NOT NULL;
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_alter_table_change_column_type_with_incompatible_data
-- Source: p1_features_integration_comprehensive_tdd.rs:947
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'not_a_number');
ALTER TABLE data ALTER COLUMN value TYPE INT64;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_complex_query_with_all_p1_features
-- Source: p1_features_integration_comprehensive_tdd.rs:971
-- ============================================================================
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (\ order_id INT64 PRIMARY KEY, \ customer_id INT64 NOT NULL, \ order_date DATE, \ total_amount NUMERIC(18, 2), \ status STRING DEFAULT 'pending');
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (\ customer_id INT64 PRIMARY KEY, \ name STRING NOT NULL, \ signup_date DATE);
INSERT INTO customers VALUES \ (1, 'Alice', DATE '2024-01-01'), \ (2, 'Bob', DATE '2024-02-01');
INSERT INTO orders (order_id, customer_id, order_date, total_amount) \ SELECT customer_id, customer_id, DATE_ADD(signup_date, INTERVAL 7 DAY), CAST(customer_id * 100 AS NUMERIC(18, 2)) \ FROM customers;
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (dept_id INT64 PRIMARY KEY, dept_name STRING NOT NULL);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (emp_id INT64 PRIMARY KEY, name STRING NOT NULL, dept_id INT64);
DROP TABLE IF EXISTS salaries;
CREATE TABLE salaries (emp_id INT64, amount NUMERIC(18, 2), payment_date DATE);
INSERT INTO departments VALUES (1, 'Engineering'), (2, 'Sales');
INSERT INTO employees VALUES (101, 'Alice', 1), (102, 'Bob', 2);
INSERT INTO salaries \ SELECT e.emp_id, CAST(5000.00 AS NUMERIC(18, 2)), CURRENT_DATE() \ FROM employees e \ JOIN departments d ON e.dept_id = d.dept_id \ WHERE d.dept_name = 'Engineering';
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (account_id INT64 PRIMARY KEY, balance NUMERIC(18, 2));
INSERT INTO accounts VALUES (1, 1000.00);
INSERT INTO accounts VALUES \ (2, 500.00), \ (3, 750.00), \ (1, 250.00);

SELECT \ c.name, \ COUNT(o.order_id) as order_count, \ SUM(o.total_amount) as total_spent, \ EXTRACT(MONTH FROM c.signup_date) as signup_month \ FROM customers c \ WHERE EXISTS (\ SELECT 1 FROM orders o \ WHERE o.customer_id = c.customer_id \ AND o.total_amount > CAST(50.00 AS NUMERIC(18, 2))\ ) \ GROUP BY c.name, c.signup_date \ ORDER BY total_spent DESC;
SELECT COUNT(*) FROM salaries;
SELECT COUNT(*) FROM accounts;

-- ============================================================================
-- Test: test_similar_to_basic_wildcard_percent
-- Source: similar_to_operator_comprehensive_tdd.rs:65
-- ============================================================================
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew'), (4, 'Charlie');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Al'), (2, 'Bob'), (3, 'Jo'), (4, 'Alice');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Charlie'), (4, 'David');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Charlie'), (4, 'David');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Charlie'), (4, 'David');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'a'), (2, 'aa'), (3, 'aaa'), (4, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'aa'), (4, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'color'), (2, 'colour'), (3, 'colors');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'a'), (2, 'aa'), (3, 'aaa'), (4, 'aaaa');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'a'), (2, 'aa'), (3, 'aaa'), (4, 'aaaa'), (5, 'aaaaa');
DROP TABLE IF EXISTS contacts;
CREATE TABLE contacts (id INT64, email STRING);
INSERT INTO contacts VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid'), (4, 'charlie@domain.net');
DROP TABLE IF EXISTS contacts;
CREATE TABLE contacts (id INT64, phone STRING);
INSERT INTO contacts VALUES (1, '123-456-7890'), (2, '555-1234'), (3, '9876543210'), (4, '111-222-3333');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'catfish'), (2, 'dogfish'), (3, 'goldfish'), (4, 'cat');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew'), (4, 'Charlie');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice'), (4, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL), (3, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, '100%'), (2, '50%'), (3, '100');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, email STRING);
INSERT INTO users VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
DROP TABLE IF EXISTS patterns;
CREATE TABLE patterns (id INT64, pattern STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew');
INSERT INTO patterns VALUES (1, 'A%');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, region STRING, amount INT64);
INSERT INTO sales VALUES (1, 'East', 100), (2, 'East', 200), (3, 'West', 150), (4, 'North', 180);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test123'), (2, 'test'), (3, 'test12');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);

SELECT name FROM users WHERE name SIMILAR TO 'A%' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO '___' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'Alice|Bob|Charlie' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO '[ABC]%' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO '[^AB]%' ORDER BY name;
SELECT value FROM data WHERE value SIMILAR TO 'a*' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'a+' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'colou?r' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'a{3}' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'a{2,4}' ORDER BY value;
SELECT email FROM contacts WHERE email SIMILAR TO '%@%.%' ORDER BY email;
SELECT phone FROM contacts WHERE phone SIMILAR TO '[0-9]{3}-[0-9]{3}-[0-9]{4}' ORDER BY phone;
SELECT value FROM data WHERE value SIMILAR TO '(cat|dog)fish' ORDER BY value;
SELECT name FROM users WHERE name NOT SIMILAR TO 'A%' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'Alice';
SELECT name FROM users WHERE name SIMILAR TO '[Aa][Ll][Ii][Cc][Ee]' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'A%';
SELECT name FROM users WHERE name SIMILAR TO NULL;
SELECT name, (name SIMILAR TO 'A%') IS NULL as is_null FROM users ORDER BY id;
SELECT value FROM data WHERE value SIMILAR TO '%\%' ESCAPE '\';
SELECT email, CASE WHEN email SIMILAR TO '%@%.%' THEN 'Valid' ELSE 'Invalid' END as status FROM users ORDER BY id;
SELECT u.name FROM users u JOIN patterns p ON u.name SIMILAR TO p.pattern ORDER BY u.name;
SELECT region, SUM(amount) as total FROM sales GROUP BY region HAVING region SIMILAR TO 'E%|W%' ORDER BY region;
SELECT value FROM data WHERE value SIMILAR TO '';
SELECT value FROM data WHERE value SIMILAR TO 'A%';
SELECT value FROM data WHERE value SIMILAR TO '[invalid';
SELECT value FROM data WHERE value SIMILAR TO 'test[0-9]+' ORDER BY value;
SELECT COUNT(*) FROM data WHERE value SIMILAR TO 'value[0-9]+';

-- ============================================================================
-- Test: test_similar_to_basic_wildcard_underscore
-- Source: similar_to_operator_comprehensive_tdd.rs:93
-- ============================================================================
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Al'), (2, 'Bob'), (3, 'Jo'), (4, 'Alice');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Charlie'), (4, 'David');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Charlie'), (4, 'David');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Charlie'), (4, 'David');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'a'), (2, 'aa'), (3, 'aaa'), (4, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'aa'), (4, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'color'), (2, 'colour'), (3, 'colors');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'a'), (2, 'aa'), (3, 'aaa'), (4, 'aaaa');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'a'), (2, 'aa'), (3, 'aaa'), (4, 'aaaa'), (5, 'aaaaa');
DROP TABLE IF EXISTS contacts;
CREATE TABLE contacts (id INT64, email STRING);
INSERT INTO contacts VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid'), (4, 'charlie@domain.net');
DROP TABLE IF EXISTS contacts;
CREATE TABLE contacts (id INT64, phone STRING);
INSERT INTO contacts VALUES (1, '123-456-7890'), (2, '555-1234'), (3, '9876543210'), (4, '111-222-3333');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'catfish'), (2, 'dogfish'), (3, 'goldfish'), (4, 'cat');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew'), (4, 'Charlie');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice'), (4, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL), (3, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, '100%'), (2, '50%'), (3, '100');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, email STRING);
INSERT INTO users VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
DROP TABLE IF EXISTS patterns;
CREATE TABLE patterns (id INT64, pattern STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew');
INSERT INTO patterns VALUES (1, 'A%');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, region STRING, amount INT64);
INSERT INTO sales VALUES (1, 'East', 100), (2, 'East', 200), (3, 'West', 150), (4, 'North', 180);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test123'), (2, 'test'), (3, 'test12');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);

SELECT name FROM users WHERE name SIMILAR TO '___' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'Alice|Bob|Charlie' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO '[ABC]%' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO '[^AB]%' ORDER BY name;
SELECT value FROM data WHERE value SIMILAR TO 'a*' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'a+' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'colou?r' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'a{3}' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'a{2,4}' ORDER BY value;
SELECT email FROM contacts WHERE email SIMILAR TO '%@%.%' ORDER BY email;
SELECT phone FROM contacts WHERE phone SIMILAR TO '[0-9]{3}-[0-9]{3}-[0-9]{4}' ORDER BY phone;
SELECT value FROM data WHERE value SIMILAR TO '(cat|dog)fish' ORDER BY value;
SELECT name FROM users WHERE name NOT SIMILAR TO 'A%' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'Alice';
SELECT name FROM users WHERE name SIMILAR TO '[Aa][Ll][Ii][Cc][Ee]' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'A%';
SELECT name FROM users WHERE name SIMILAR TO NULL;
SELECT name, (name SIMILAR TO 'A%') IS NULL as is_null FROM users ORDER BY id;
SELECT value FROM data WHERE value SIMILAR TO '%\%' ESCAPE '\';
SELECT email, CASE WHEN email SIMILAR TO '%@%.%' THEN 'Valid' ELSE 'Invalid' END as status FROM users ORDER BY id;
SELECT u.name FROM users u JOIN patterns p ON u.name SIMILAR TO p.pattern ORDER BY u.name;
SELECT region, SUM(amount) as total FROM sales GROUP BY region HAVING region SIMILAR TO 'E%|W%' ORDER BY region;
SELECT value FROM data WHERE value SIMILAR TO '';
SELECT value FROM data WHERE value SIMILAR TO 'A%';
SELECT value FROM data WHERE value SIMILAR TO '[invalid';
SELECT value FROM data WHERE value SIMILAR TO 'test[0-9]+' ORDER BY value;
SELECT COUNT(*) FROM data WHERE value SIMILAR TO 'value[0-9]+';

-- ============================================================================
-- Test: test_similar_to_alternation
-- Source: similar_to_operator_comprehensive_tdd.rs:118
-- ============================================================================
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Charlie'), (4, 'David');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Charlie'), (4, 'David');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Charlie'), (4, 'David');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'a'), (2, 'aa'), (3, 'aaa'), (4, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'aa'), (4, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'color'), (2, 'colour'), (3, 'colors');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'a'), (2, 'aa'), (3, 'aaa'), (4, 'aaaa');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'a'), (2, 'aa'), (3, 'aaa'), (4, 'aaaa'), (5, 'aaaaa');
DROP TABLE IF EXISTS contacts;
CREATE TABLE contacts (id INT64, email STRING);
INSERT INTO contacts VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid'), (4, 'charlie@domain.net');
DROP TABLE IF EXISTS contacts;
CREATE TABLE contacts (id INT64, phone STRING);
INSERT INTO contacts VALUES (1, '123-456-7890'), (2, '555-1234'), (3, '9876543210'), (4, '111-222-3333');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'catfish'), (2, 'dogfish'), (3, 'goldfish'), (4, 'cat');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew'), (4, 'Charlie');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice'), (4, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL), (3, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, '100%'), (2, '50%'), (3, '100');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, email STRING);
INSERT INTO users VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
DROP TABLE IF EXISTS patterns;
CREATE TABLE patterns (id INT64, pattern STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew');
INSERT INTO patterns VALUES (1, 'A%');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, region STRING, amount INT64);
INSERT INTO sales VALUES (1, 'East', 100), (2, 'East', 200), (3, 'West', 150), (4, 'North', 180);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test123'), (2, 'test'), (3, 'test12');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);

SELECT name FROM users WHERE name SIMILAR TO 'Alice|Bob|Charlie' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO '[ABC]%' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO '[^AB]%' ORDER BY name;
SELECT value FROM data WHERE value SIMILAR TO 'a*' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'a+' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'colou?r' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'a{3}' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'a{2,4}' ORDER BY value;
SELECT email FROM contacts WHERE email SIMILAR TO '%@%.%' ORDER BY email;
SELECT phone FROM contacts WHERE phone SIMILAR TO '[0-9]{3}-[0-9]{3}-[0-9]{4}' ORDER BY phone;
SELECT value FROM data WHERE value SIMILAR TO '(cat|dog)fish' ORDER BY value;
SELECT name FROM users WHERE name NOT SIMILAR TO 'A%' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'Alice';
SELECT name FROM users WHERE name SIMILAR TO '[Aa][Ll][Ii][Cc][Ee]' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'A%';
SELECT name FROM users WHERE name SIMILAR TO NULL;
SELECT name, (name SIMILAR TO 'A%') IS NULL as is_null FROM users ORDER BY id;
SELECT value FROM data WHERE value SIMILAR TO '%\%' ESCAPE '\';
SELECT email, CASE WHEN email SIMILAR TO '%@%.%' THEN 'Valid' ELSE 'Invalid' END as status FROM users ORDER BY id;
SELECT u.name FROM users u JOIN patterns p ON u.name SIMILAR TO p.pattern ORDER BY u.name;
SELECT region, SUM(amount) as total FROM sales GROUP BY region HAVING region SIMILAR TO 'E%|W%' ORDER BY region;
SELECT value FROM data WHERE value SIMILAR TO '';
SELECT value FROM data WHERE value SIMILAR TO 'A%';
SELECT value FROM data WHERE value SIMILAR TO '[invalid';
SELECT value FROM data WHERE value SIMILAR TO 'test[0-9]+' ORDER BY value;
SELECT COUNT(*) FROM data WHERE value SIMILAR TO 'value[0-9]+';

-- ============================================================================
-- Test: test_similar_to_character_class
-- Source: similar_to_operator_comprehensive_tdd.rs:144
-- ============================================================================
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Charlie'), (4, 'David');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Charlie'), (4, 'David');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'a'), (2, 'aa'), (3, 'aaa'), (4, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'aa'), (4, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'color'), (2, 'colour'), (3, 'colors');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'a'), (2, 'aa'), (3, 'aaa'), (4, 'aaaa');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'a'), (2, 'aa'), (3, 'aaa'), (4, 'aaaa'), (5, 'aaaaa');
DROP TABLE IF EXISTS contacts;
CREATE TABLE contacts (id INT64, email STRING);
INSERT INTO contacts VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid'), (4, 'charlie@domain.net');
DROP TABLE IF EXISTS contacts;
CREATE TABLE contacts (id INT64, phone STRING);
INSERT INTO contacts VALUES (1, '123-456-7890'), (2, '555-1234'), (3, '9876543210'), (4, '111-222-3333');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'catfish'), (2, 'dogfish'), (3, 'goldfish'), (4, 'cat');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew'), (4, 'Charlie');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice'), (4, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL), (3, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, '100%'), (2, '50%'), (3, '100');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, email STRING);
INSERT INTO users VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
DROP TABLE IF EXISTS patterns;
CREATE TABLE patterns (id INT64, pattern STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew');
INSERT INTO patterns VALUES (1, 'A%');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, region STRING, amount INT64);
INSERT INTO sales VALUES (1, 'East', 100), (2, 'East', 200), (3, 'West', 150), (4, 'North', 180);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test123'), (2, 'test'), (3, 'test12');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);

SELECT name FROM users WHERE name SIMILAR TO '[ABC]%' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO '[^AB]%' ORDER BY name;
SELECT value FROM data WHERE value SIMILAR TO 'a*' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'a+' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'colou?r' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'a{3}' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'a{2,4}' ORDER BY value;
SELECT email FROM contacts WHERE email SIMILAR TO '%@%.%' ORDER BY email;
SELECT phone FROM contacts WHERE phone SIMILAR TO '[0-9]{3}-[0-9]{3}-[0-9]{4}' ORDER BY phone;
SELECT value FROM data WHERE value SIMILAR TO '(cat|dog)fish' ORDER BY value;
SELECT name FROM users WHERE name NOT SIMILAR TO 'A%' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'Alice';
SELECT name FROM users WHERE name SIMILAR TO '[Aa][Ll][Ii][Cc][Ee]' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'A%';
SELECT name FROM users WHERE name SIMILAR TO NULL;
SELECT name, (name SIMILAR TO 'A%') IS NULL as is_null FROM users ORDER BY id;
SELECT value FROM data WHERE value SIMILAR TO '%\%' ESCAPE '\';
SELECT email, CASE WHEN email SIMILAR TO '%@%.%' THEN 'Valid' ELSE 'Invalid' END as status FROM users ORDER BY id;
SELECT u.name FROM users u JOIN patterns p ON u.name SIMILAR TO p.pattern ORDER BY u.name;
SELECT region, SUM(amount) as total FROM sales GROUP BY region HAVING region SIMILAR TO 'E%|W%' ORDER BY region;
SELECT value FROM data WHERE value SIMILAR TO '';
SELECT value FROM data WHERE value SIMILAR TO 'A%';
SELECT value FROM data WHERE value SIMILAR TO '[invalid';
SELECT value FROM data WHERE value SIMILAR TO 'test[0-9]+' ORDER BY value;
SELECT COUNT(*) FROM data WHERE value SIMILAR TO 'value[0-9]+';

-- ============================================================================
-- Test: test_similar_to_negated_character_class
-- Source: similar_to_operator_comprehensive_tdd.rs:172
-- ============================================================================
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Charlie'), (4, 'David');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'a'), (2, 'aa'), (3, 'aaa'), (4, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'aa'), (4, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'color'), (2, 'colour'), (3, 'colors');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'a'), (2, 'aa'), (3, 'aaa'), (4, 'aaaa');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'a'), (2, 'aa'), (3, 'aaa'), (4, 'aaaa'), (5, 'aaaaa');
DROP TABLE IF EXISTS contacts;
CREATE TABLE contacts (id INT64, email STRING);
INSERT INTO contacts VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid'), (4, 'charlie@domain.net');
DROP TABLE IF EXISTS contacts;
CREATE TABLE contacts (id INT64, phone STRING);
INSERT INTO contacts VALUES (1, '123-456-7890'), (2, '555-1234'), (3, '9876543210'), (4, '111-222-3333');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'catfish'), (2, 'dogfish'), (3, 'goldfish'), (4, 'cat');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew'), (4, 'Charlie');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice'), (4, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL), (3, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, '100%'), (2, '50%'), (3, '100');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, email STRING);
INSERT INTO users VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
DROP TABLE IF EXISTS patterns;
CREATE TABLE patterns (id INT64, pattern STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew');
INSERT INTO patterns VALUES (1, 'A%');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, region STRING, amount INT64);
INSERT INTO sales VALUES (1, 'East', 100), (2, 'East', 200), (3, 'West', 150), (4, 'North', 180);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test123'), (2, 'test'), (3, 'test12');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);

SELECT name FROM users WHERE name SIMILAR TO '[^AB]%' ORDER BY name;
SELECT value FROM data WHERE value SIMILAR TO 'a*' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'a+' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'colou?r' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'a{3}' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'a{2,4}' ORDER BY value;
SELECT email FROM contacts WHERE email SIMILAR TO '%@%.%' ORDER BY email;
SELECT phone FROM contacts WHERE phone SIMILAR TO '[0-9]{3}-[0-9]{3}-[0-9]{4}' ORDER BY phone;
SELECT value FROM data WHERE value SIMILAR TO '(cat|dog)fish' ORDER BY value;
SELECT name FROM users WHERE name NOT SIMILAR TO 'A%' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'Alice';
SELECT name FROM users WHERE name SIMILAR TO '[Aa][Ll][Ii][Cc][Ee]' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'A%';
SELECT name FROM users WHERE name SIMILAR TO NULL;
SELECT name, (name SIMILAR TO 'A%') IS NULL as is_null FROM users ORDER BY id;
SELECT value FROM data WHERE value SIMILAR TO '%\%' ESCAPE '\';
SELECT email, CASE WHEN email SIMILAR TO '%@%.%' THEN 'Valid' ELSE 'Invalid' END as status FROM users ORDER BY id;
SELECT u.name FROM users u JOIN patterns p ON u.name SIMILAR TO p.pattern ORDER BY u.name;
SELECT region, SUM(amount) as total FROM sales GROUP BY region HAVING region SIMILAR TO 'E%|W%' ORDER BY region;
SELECT value FROM data WHERE value SIMILAR TO '';
SELECT value FROM data WHERE value SIMILAR TO 'A%';
SELECT value FROM data WHERE value SIMILAR TO '[invalid';
SELECT value FROM data WHERE value SIMILAR TO 'test[0-9]+' ORDER BY value;
SELECT COUNT(*) FROM data WHERE value SIMILAR TO 'value[0-9]+';

-- ============================================================================
-- Test: test_similar_to_asterisk_quantifier
-- Source: similar_to_operator_comprehensive_tdd.rs:200
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'a'), (2, 'aa'), (3, 'aaa'), (4, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'aa'), (4, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'color'), (2, 'colour'), (3, 'colors');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'a'), (2, 'aa'), (3, 'aaa'), (4, 'aaaa');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'a'), (2, 'aa'), (3, 'aaa'), (4, 'aaaa'), (5, 'aaaaa');
DROP TABLE IF EXISTS contacts;
CREATE TABLE contacts (id INT64, email STRING);
INSERT INTO contacts VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid'), (4, 'charlie@domain.net');
DROP TABLE IF EXISTS contacts;
CREATE TABLE contacts (id INT64, phone STRING);
INSERT INTO contacts VALUES (1, '123-456-7890'), (2, '555-1234'), (3, '9876543210'), (4, '111-222-3333');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'catfish'), (2, 'dogfish'), (3, 'goldfish'), (4, 'cat');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew'), (4, 'Charlie');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice'), (4, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL), (3, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, '100%'), (2, '50%'), (3, '100');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, email STRING);
INSERT INTO users VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
DROP TABLE IF EXISTS patterns;
CREATE TABLE patterns (id INT64, pattern STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew');
INSERT INTO patterns VALUES (1, 'A%');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, region STRING, amount INT64);
INSERT INTO sales VALUES (1, 'East', 100), (2, 'East', 200), (3, 'West', 150), (4, 'North', 180);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test123'), (2, 'test'), (3, 'test12');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);

SELECT value FROM data WHERE value SIMILAR TO 'a*' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'a+' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'colou?r' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'a{3}' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'a{2,4}' ORDER BY value;
SELECT email FROM contacts WHERE email SIMILAR TO '%@%.%' ORDER BY email;
SELECT phone FROM contacts WHERE phone SIMILAR TO '[0-9]{3}-[0-9]{3}-[0-9]{4}' ORDER BY phone;
SELECT value FROM data WHERE value SIMILAR TO '(cat|dog)fish' ORDER BY value;
SELECT name FROM users WHERE name NOT SIMILAR TO 'A%' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'Alice';
SELECT name FROM users WHERE name SIMILAR TO '[Aa][Ll][Ii][Cc][Ee]' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'A%';
SELECT name FROM users WHERE name SIMILAR TO NULL;
SELECT name, (name SIMILAR TO 'A%') IS NULL as is_null FROM users ORDER BY id;
SELECT value FROM data WHERE value SIMILAR TO '%\%' ESCAPE '\';
SELECT email, CASE WHEN email SIMILAR TO '%@%.%' THEN 'Valid' ELSE 'Invalid' END as status FROM users ORDER BY id;
SELECT u.name FROM users u JOIN patterns p ON u.name SIMILAR TO p.pattern ORDER BY u.name;
SELECT region, SUM(amount) as total FROM sales GROUP BY region HAVING region SIMILAR TO 'E%|W%' ORDER BY region;
SELECT value FROM data WHERE value SIMILAR TO '';
SELECT value FROM data WHERE value SIMILAR TO 'A%';
SELECT value FROM data WHERE value SIMILAR TO '[invalid';
SELECT value FROM data WHERE value SIMILAR TO 'test[0-9]+' ORDER BY value;
SELECT COUNT(*) FROM data WHERE value SIMILAR TO 'value[0-9]+';

-- ============================================================================
-- Test: test_similar_to_plus_quantifier
-- Source: similar_to_operator_comprehensive_tdd.rs:222
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'aa'), (4, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'color'), (2, 'colour'), (3, 'colors');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'a'), (2, 'aa'), (3, 'aaa'), (4, 'aaaa');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'a'), (2, 'aa'), (3, 'aaa'), (4, 'aaaa'), (5, 'aaaaa');
DROP TABLE IF EXISTS contacts;
CREATE TABLE contacts (id INT64, email STRING);
INSERT INTO contacts VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid'), (4, 'charlie@domain.net');
DROP TABLE IF EXISTS contacts;
CREATE TABLE contacts (id INT64, phone STRING);
INSERT INTO contacts VALUES (1, '123-456-7890'), (2, '555-1234'), (3, '9876543210'), (4, '111-222-3333');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'catfish'), (2, 'dogfish'), (3, 'goldfish'), (4, 'cat');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew'), (4, 'Charlie');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice'), (4, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL), (3, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, '100%'), (2, '50%'), (3, '100');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, email STRING);
INSERT INTO users VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
DROP TABLE IF EXISTS patterns;
CREATE TABLE patterns (id INT64, pattern STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew');
INSERT INTO patterns VALUES (1, 'A%');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, region STRING, amount INT64);
INSERT INTO sales VALUES (1, 'East', 100), (2, 'East', 200), (3, 'West', 150), (4, 'North', 180);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test123'), (2, 'test'), (3, 'test12');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);

SELECT value FROM data WHERE value SIMILAR TO 'a+' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'colou?r' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'a{3}' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'a{2,4}' ORDER BY value;
SELECT email FROM contacts WHERE email SIMILAR TO '%@%.%' ORDER BY email;
SELECT phone FROM contacts WHERE phone SIMILAR TO '[0-9]{3}-[0-9]{3}-[0-9]{4}' ORDER BY phone;
SELECT value FROM data WHERE value SIMILAR TO '(cat|dog)fish' ORDER BY value;
SELECT name FROM users WHERE name NOT SIMILAR TO 'A%' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'Alice';
SELECT name FROM users WHERE name SIMILAR TO '[Aa][Ll][Ii][Cc][Ee]' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'A%';
SELECT name FROM users WHERE name SIMILAR TO NULL;
SELECT name, (name SIMILAR TO 'A%') IS NULL as is_null FROM users ORDER BY id;
SELECT value FROM data WHERE value SIMILAR TO '%\%' ESCAPE '\';
SELECT email, CASE WHEN email SIMILAR TO '%@%.%' THEN 'Valid' ELSE 'Invalid' END as status FROM users ORDER BY id;
SELECT u.name FROM users u JOIN patterns p ON u.name SIMILAR TO p.pattern ORDER BY u.name;
SELECT region, SUM(amount) as total FROM sales GROUP BY region HAVING region SIMILAR TO 'E%|W%' ORDER BY region;
SELECT value FROM data WHERE value SIMILAR TO '';
SELECT value FROM data WHERE value SIMILAR TO 'A%';
SELECT value FROM data WHERE value SIMILAR TO '[invalid';
SELECT value FROM data WHERE value SIMILAR TO 'test[0-9]+' ORDER BY value;
SELECT COUNT(*) FROM data WHERE value SIMILAR TO 'value[0-9]+';

-- ============================================================================
-- Test: test_similar_to_question_quantifier
-- Source: similar_to_operator_comprehensive_tdd.rs:248
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'color'), (2, 'colour'), (3, 'colors');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'a'), (2, 'aa'), (3, 'aaa'), (4, 'aaaa');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'a'), (2, 'aa'), (3, 'aaa'), (4, 'aaaa'), (5, 'aaaaa');
DROP TABLE IF EXISTS contacts;
CREATE TABLE contacts (id INT64, email STRING);
INSERT INTO contacts VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid'), (4, 'charlie@domain.net');
DROP TABLE IF EXISTS contacts;
CREATE TABLE contacts (id INT64, phone STRING);
INSERT INTO contacts VALUES (1, '123-456-7890'), (2, '555-1234'), (3, '9876543210'), (4, '111-222-3333');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'catfish'), (2, 'dogfish'), (3, 'goldfish'), (4, 'cat');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew'), (4, 'Charlie');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice'), (4, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL), (3, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, '100%'), (2, '50%'), (3, '100');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, email STRING);
INSERT INTO users VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
DROP TABLE IF EXISTS patterns;
CREATE TABLE patterns (id INT64, pattern STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew');
INSERT INTO patterns VALUES (1, 'A%');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, region STRING, amount INT64);
INSERT INTO sales VALUES (1, 'East', 100), (2, 'East', 200), (3, 'West', 150), (4, 'North', 180);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test123'), (2, 'test'), (3, 'test12');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);

SELECT value FROM data WHERE value SIMILAR TO 'colou?r' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'a{3}' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'a{2,4}' ORDER BY value;
SELECT email FROM contacts WHERE email SIMILAR TO '%@%.%' ORDER BY email;
SELECT phone FROM contacts WHERE phone SIMILAR TO '[0-9]{3}-[0-9]{3}-[0-9]{4}' ORDER BY phone;
SELECT value FROM data WHERE value SIMILAR TO '(cat|dog)fish' ORDER BY value;
SELECT name FROM users WHERE name NOT SIMILAR TO 'A%' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'Alice';
SELECT name FROM users WHERE name SIMILAR TO '[Aa][Ll][Ii][Cc][Ee]' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'A%';
SELECT name FROM users WHERE name SIMILAR TO NULL;
SELECT name, (name SIMILAR TO 'A%') IS NULL as is_null FROM users ORDER BY id;
SELECT value FROM data WHERE value SIMILAR TO '%\%' ESCAPE '\';
SELECT email, CASE WHEN email SIMILAR TO '%@%.%' THEN 'Valid' ELSE 'Invalid' END as status FROM users ORDER BY id;
SELECT u.name FROM users u JOIN patterns p ON u.name SIMILAR TO p.pattern ORDER BY u.name;
SELECT region, SUM(amount) as total FROM sales GROUP BY region HAVING region SIMILAR TO 'E%|W%' ORDER BY region;
SELECT value FROM data WHERE value SIMILAR TO '';
SELECT value FROM data WHERE value SIMILAR TO 'A%';
SELECT value FROM data WHERE value SIMILAR TO '[invalid';
SELECT value FROM data WHERE value SIMILAR TO 'test[0-9]+' ORDER BY value;
SELECT COUNT(*) FROM data WHERE value SIMILAR TO 'value[0-9]+';

-- ============================================================================
-- Test: test_similar_to_exact_repetition
-- Source: similar_to_operator_comprehensive_tdd.rs:270
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'a'), (2, 'aa'), (3, 'aaa'), (4, 'aaaa');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'a'), (2, 'aa'), (3, 'aaa'), (4, 'aaaa'), (5, 'aaaaa');
DROP TABLE IF EXISTS contacts;
CREATE TABLE contacts (id INT64, email STRING);
INSERT INTO contacts VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid'), (4, 'charlie@domain.net');
DROP TABLE IF EXISTS contacts;
CREATE TABLE contacts (id INT64, phone STRING);
INSERT INTO contacts VALUES (1, '123-456-7890'), (2, '555-1234'), (3, '9876543210'), (4, '111-222-3333');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'catfish'), (2, 'dogfish'), (3, 'goldfish'), (4, 'cat');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew'), (4, 'Charlie');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice'), (4, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL), (3, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, '100%'), (2, '50%'), (3, '100');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, email STRING);
INSERT INTO users VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
DROP TABLE IF EXISTS patterns;
CREATE TABLE patterns (id INT64, pattern STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew');
INSERT INTO patterns VALUES (1, 'A%');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, region STRING, amount INT64);
INSERT INTO sales VALUES (1, 'East', 100), (2, 'East', 200), (3, 'West', 150), (4, 'North', 180);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test123'), (2, 'test'), (3, 'test12');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);

SELECT value FROM data WHERE value SIMILAR TO 'a{3}' ORDER BY value;
SELECT value FROM data WHERE value SIMILAR TO 'a{2,4}' ORDER BY value;
SELECT email FROM contacts WHERE email SIMILAR TO '%@%.%' ORDER BY email;
SELECT phone FROM contacts WHERE phone SIMILAR TO '[0-9]{3}-[0-9]{3}-[0-9]{4}' ORDER BY phone;
SELECT value FROM data WHERE value SIMILAR TO '(cat|dog)fish' ORDER BY value;
SELECT name FROM users WHERE name NOT SIMILAR TO 'A%' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'Alice';
SELECT name FROM users WHERE name SIMILAR TO '[Aa][Ll][Ii][Cc][Ee]' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'A%';
SELECT name FROM users WHERE name SIMILAR TO NULL;
SELECT name, (name SIMILAR TO 'A%') IS NULL as is_null FROM users ORDER BY id;
SELECT value FROM data WHERE value SIMILAR TO '%\%' ESCAPE '\';
SELECT email, CASE WHEN email SIMILAR TO '%@%.%' THEN 'Valid' ELSE 'Invalid' END as status FROM users ORDER BY id;
SELECT u.name FROM users u JOIN patterns p ON u.name SIMILAR TO p.pattern ORDER BY u.name;
SELECT region, SUM(amount) as total FROM sales GROUP BY region HAVING region SIMILAR TO 'E%|W%' ORDER BY region;
SELECT value FROM data WHERE value SIMILAR TO '';
SELECT value FROM data WHERE value SIMILAR TO 'A%';
SELECT value FROM data WHERE value SIMILAR TO '[invalid';
SELECT value FROM data WHERE value SIMILAR TO 'test[0-9]+' ORDER BY value;
SELECT COUNT(*) FROM data WHERE value SIMILAR TO 'value[0-9]+';

-- ============================================================================
-- Test: test_similar_to_range_repetition
-- Source: similar_to_operator_comprehensive_tdd.rs:292
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'a'), (2, 'aa'), (3, 'aaa'), (4, 'aaaa'), (5, 'aaaaa');
DROP TABLE IF EXISTS contacts;
CREATE TABLE contacts (id INT64, email STRING);
INSERT INTO contacts VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid'), (4, 'charlie@domain.net');
DROP TABLE IF EXISTS contacts;
CREATE TABLE contacts (id INT64, phone STRING);
INSERT INTO contacts VALUES (1, '123-456-7890'), (2, '555-1234'), (3, '9876543210'), (4, '111-222-3333');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'catfish'), (2, 'dogfish'), (3, 'goldfish'), (4, 'cat');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew'), (4, 'Charlie');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice'), (4, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL), (3, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, '100%'), (2, '50%'), (3, '100');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, email STRING);
INSERT INTO users VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
DROP TABLE IF EXISTS patterns;
CREATE TABLE patterns (id INT64, pattern STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew');
INSERT INTO patterns VALUES (1, 'A%');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, region STRING, amount INT64);
INSERT INTO sales VALUES (1, 'East', 100), (2, 'East', 200), (3, 'West', 150), (4, 'North', 180);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test123'), (2, 'test'), (3, 'test12');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);

SELECT value FROM data WHERE value SIMILAR TO 'a{2,4}' ORDER BY value;
SELECT email FROM contacts WHERE email SIMILAR TO '%@%.%' ORDER BY email;
SELECT phone FROM contacts WHERE phone SIMILAR TO '[0-9]{3}-[0-9]{3}-[0-9]{4}' ORDER BY phone;
SELECT value FROM data WHERE value SIMILAR TO '(cat|dog)fish' ORDER BY value;
SELECT name FROM users WHERE name NOT SIMILAR TO 'A%' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'Alice';
SELECT name FROM users WHERE name SIMILAR TO '[Aa][Ll][Ii][Cc][Ee]' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'A%';
SELECT name FROM users WHERE name SIMILAR TO NULL;
SELECT name, (name SIMILAR TO 'A%') IS NULL as is_null FROM users ORDER BY id;
SELECT value FROM data WHERE value SIMILAR TO '%\%' ESCAPE '\';
SELECT email, CASE WHEN email SIMILAR TO '%@%.%' THEN 'Valid' ELSE 'Invalid' END as status FROM users ORDER BY id;
SELECT u.name FROM users u JOIN patterns p ON u.name SIMILAR TO p.pattern ORDER BY u.name;
SELECT region, SUM(amount) as total FROM sales GROUP BY region HAVING region SIMILAR TO 'E%|W%' ORDER BY region;
SELECT value FROM data WHERE value SIMILAR TO '';
SELECT value FROM data WHERE value SIMILAR TO 'A%';
SELECT value FROM data WHERE value SIMILAR TO '[invalid';
SELECT value FROM data WHERE value SIMILAR TO 'test[0-9]+' ORDER BY value;
SELECT COUNT(*) FROM data WHERE value SIMILAR TO 'value[0-9]+';

-- ============================================================================
-- Test: test_similar_to_email_pattern
-- Source: similar_to_operator_comprehensive_tdd.rs:320
-- ============================================================================
DROP TABLE IF EXISTS contacts;
CREATE TABLE contacts (id INT64, email STRING);
INSERT INTO contacts VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid'), (4, 'charlie@domain.net');
DROP TABLE IF EXISTS contacts;
CREATE TABLE contacts (id INT64, phone STRING);
INSERT INTO contacts VALUES (1, '123-456-7890'), (2, '555-1234'), (3, '9876543210'), (4, '111-222-3333');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'catfish'), (2, 'dogfish'), (3, 'goldfish'), (4, 'cat');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew'), (4, 'Charlie');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice'), (4, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL), (3, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, '100%'), (2, '50%'), (3, '100');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, email STRING);
INSERT INTO users VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
DROP TABLE IF EXISTS patterns;
CREATE TABLE patterns (id INT64, pattern STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew');
INSERT INTO patterns VALUES (1, 'A%');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, region STRING, amount INT64);
INSERT INTO sales VALUES (1, 'East', 100), (2, 'East', 200), (3, 'West', 150), (4, 'North', 180);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test123'), (2, 'test'), (3, 'test12');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);

SELECT email FROM contacts WHERE email SIMILAR TO '%@%.%' ORDER BY email;
SELECT phone FROM contacts WHERE phone SIMILAR TO '[0-9]{3}-[0-9]{3}-[0-9]{4}' ORDER BY phone;
SELECT value FROM data WHERE value SIMILAR TO '(cat|dog)fish' ORDER BY value;
SELECT name FROM users WHERE name NOT SIMILAR TO 'A%' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'Alice';
SELECT name FROM users WHERE name SIMILAR TO '[Aa][Ll][Ii][Cc][Ee]' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'A%';
SELECT name FROM users WHERE name SIMILAR TO NULL;
SELECT name, (name SIMILAR TO 'A%') IS NULL as is_null FROM users ORDER BY id;
SELECT value FROM data WHERE value SIMILAR TO '%\%' ESCAPE '\';
SELECT email, CASE WHEN email SIMILAR TO '%@%.%' THEN 'Valid' ELSE 'Invalid' END as status FROM users ORDER BY id;
SELECT u.name FROM users u JOIN patterns p ON u.name SIMILAR TO p.pattern ORDER BY u.name;
SELECT region, SUM(amount) as total FROM sales GROUP BY region HAVING region SIMILAR TO 'E%|W%' ORDER BY region;
SELECT value FROM data WHERE value SIMILAR TO '';
SELECT value FROM data WHERE value SIMILAR TO 'A%';
SELECT value FROM data WHERE value SIMILAR TO '[invalid';
SELECT value FROM data WHERE value SIMILAR TO 'test[0-9]+' ORDER BY value;
SELECT COUNT(*) FROM data WHERE value SIMILAR TO 'value[0-9]+';

-- ============================================================================
-- Test: test_similar_to_phone_pattern
-- Source: similar_to_operator_comprehensive_tdd.rs:342
-- ============================================================================
DROP TABLE IF EXISTS contacts;
CREATE TABLE contacts (id INT64, phone STRING);
INSERT INTO contacts VALUES (1, '123-456-7890'), (2, '555-1234'), (3, '9876543210'), (4, '111-222-3333');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'catfish'), (2, 'dogfish'), (3, 'goldfish'), (4, 'cat');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew'), (4, 'Charlie');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice'), (4, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL), (3, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, '100%'), (2, '50%'), (3, '100');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, email STRING);
INSERT INTO users VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
DROP TABLE IF EXISTS patterns;
CREATE TABLE patterns (id INT64, pattern STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew');
INSERT INTO patterns VALUES (1, 'A%');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, region STRING, amount INT64);
INSERT INTO sales VALUES (1, 'East', 100), (2, 'East', 200), (3, 'West', 150), (4, 'North', 180);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test123'), (2, 'test'), (3, 'test12');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);

SELECT phone FROM contacts WHERE phone SIMILAR TO '[0-9]{3}-[0-9]{3}-[0-9]{4}' ORDER BY phone;
SELECT value FROM data WHERE value SIMILAR TO '(cat|dog)fish' ORDER BY value;
SELECT name FROM users WHERE name NOT SIMILAR TO 'A%' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'Alice';
SELECT name FROM users WHERE name SIMILAR TO '[Aa][Ll][Ii][Cc][Ee]' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'A%';
SELECT name FROM users WHERE name SIMILAR TO NULL;
SELECT name, (name SIMILAR TO 'A%') IS NULL as is_null FROM users ORDER BY id;
SELECT value FROM data WHERE value SIMILAR TO '%\%' ESCAPE '\';
SELECT email, CASE WHEN email SIMILAR TO '%@%.%' THEN 'Valid' ELSE 'Invalid' END as status FROM users ORDER BY id;
SELECT u.name FROM users u JOIN patterns p ON u.name SIMILAR TO p.pattern ORDER BY u.name;
SELECT region, SUM(amount) as total FROM sales GROUP BY region HAVING region SIMILAR TO 'E%|W%' ORDER BY region;
SELECT value FROM data WHERE value SIMILAR TO '';
SELECT value FROM data WHERE value SIMILAR TO 'A%';
SELECT value FROM data WHERE value SIMILAR TO '[invalid';
SELECT value FROM data WHERE value SIMILAR TO 'test[0-9]+' ORDER BY value;
SELECT COUNT(*) FROM data WHERE value SIMILAR TO 'value[0-9]+';

-- ============================================================================
-- Test: test_similar_to_grouping
-- Source: similar_to_operator_comprehensive_tdd.rs:364
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'catfish'), (2, 'dogfish'), (3, 'goldfish'), (4, 'cat');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew'), (4, 'Charlie');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice'), (4, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL), (3, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, '100%'), (2, '50%'), (3, '100');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, email STRING);
INSERT INTO users VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
DROP TABLE IF EXISTS patterns;
CREATE TABLE patterns (id INT64, pattern STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew');
INSERT INTO patterns VALUES (1, 'A%');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, region STRING, amount INT64);
INSERT INTO sales VALUES (1, 'East', 100), (2, 'East', 200), (3, 'West', 150), (4, 'North', 180);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test123'), (2, 'test'), (3, 'test12');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);

SELECT value FROM data WHERE value SIMILAR TO '(cat|dog)fish' ORDER BY value;
SELECT name FROM users WHERE name NOT SIMILAR TO 'A%' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'Alice';
SELECT name FROM users WHERE name SIMILAR TO '[Aa][Ll][Ii][Cc][Ee]' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'A%';
SELECT name FROM users WHERE name SIMILAR TO NULL;
SELECT name, (name SIMILAR TO 'A%') IS NULL as is_null FROM users ORDER BY id;
SELECT value FROM data WHERE value SIMILAR TO '%\%' ESCAPE '\';
SELECT email, CASE WHEN email SIMILAR TO '%@%.%' THEN 'Valid' ELSE 'Invalid' END as status FROM users ORDER BY id;
SELECT u.name FROM users u JOIN patterns p ON u.name SIMILAR TO p.pattern ORDER BY u.name;
SELECT region, SUM(amount) as total FROM sales GROUP BY region HAVING region SIMILAR TO 'E%|W%' ORDER BY region;
SELECT value FROM data WHERE value SIMILAR TO '';
SELECT value FROM data WHERE value SIMILAR TO 'A%';
SELECT value FROM data WHERE value SIMILAR TO '[invalid';
SELECT value FROM data WHERE value SIMILAR TO 'test[0-9]+' ORDER BY value;
SELECT COUNT(*) FROM data WHERE value SIMILAR TO 'value[0-9]+';

-- ============================================================================
-- Test: test_not_similar_to
-- Source: similar_to_operator_comprehensive_tdd.rs:392
-- ============================================================================
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew'), (4, 'Charlie');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice'), (4, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL), (3, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, '100%'), (2, '50%'), (3, '100');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, email STRING);
INSERT INTO users VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
DROP TABLE IF EXISTS patterns;
CREATE TABLE patterns (id INT64, pattern STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew');
INSERT INTO patterns VALUES (1, 'A%');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, region STRING, amount INT64);
INSERT INTO sales VALUES (1, 'East', 100), (2, 'East', 200), (3, 'West', 150), (4, 'North', 180);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test123'), (2, 'test'), (3, 'test12');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);

SELECT name FROM users WHERE name NOT SIMILAR TO 'A%' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'Alice';
SELECT name FROM users WHERE name SIMILAR TO '[Aa][Ll][Ii][Cc][Ee]' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'A%';
SELECT name FROM users WHERE name SIMILAR TO NULL;
SELECT name, (name SIMILAR TO 'A%') IS NULL as is_null FROM users ORDER BY id;
SELECT value FROM data WHERE value SIMILAR TO '%\%' ESCAPE '\';
SELECT email, CASE WHEN email SIMILAR TO '%@%.%' THEN 'Valid' ELSE 'Invalid' END as status FROM users ORDER BY id;
SELECT u.name FROM users u JOIN patterns p ON u.name SIMILAR TO p.pattern ORDER BY u.name;
SELECT region, SUM(amount) as total FROM sales GROUP BY region HAVING region SIMILAR TO 'E%|W%' ORDER BY region;
SELECT value FROM data WHERE value SIMILAR TO '';
SELECT value FROM data WHERE value SIMILAR TO 'A%';
SELECT value FROM data WHERE value SIMILAR TO '[invalid';
SELECT value FROM data WHERE value SIMILAR TO 'test[0-9]+' ORDER BY value;
SELECT COUNT(*) FROM data WHERE value SIMILAR TO 'value[0-9]+';

-- ============================================================================
-- Test: test_similar_to_case_sensitive
-- Source: similar_to_operator_comprehensive_tdd.rs:420
-- ============================================================================
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice'), (4, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL), (3, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, '100%'), (2, '50%'), (3, '100');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, email STRING);
INSERT INTO users VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
DROP TABLE IF EXISTS patterns;
CREATE TABLE patterns (id INT64, pattern STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew');
INSERT INTO patterns VALUES (1, 'A%');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, region STRING, amount INT64);
INSERT INTO sales VALUES (1, 'East', 100), (2, 'East', 200), (3, 'West', 150), (4, 'North', 180);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test123'), (2, 'test'), (3, 'test12');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);

SELECT name FROM users WHERE name SIMILAR TO 'Alice';
SELECT name FROM users WHERE name SIMILAR TO '[Aa][Ll][Ii][Cc][Ee]' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'A%';
SELECT name FROM users WHERE name SIMILAR TO NULL;
SELECT name, (name SIMILAR TO 'A%') IS NULL as is_null FROM users ORDER BY id;
SELECT value FROM data WHERE value SIMILAR TO '%\%' ESCAPE '\';
SELECT email, CASE WHEN email SIMILAR TO '%@%.%' THEN 'Valid' ELSE 'Invalid' END as status FROM users ORDER BY id;
SELECT u.name FROM users u JOIN patterns p ON u.name SIMILAR TO p.pattern ORDER BY u.name;
SELECT region, SUM(amount) as total FROM sales GROUP BY region HAVING region SIMILAR TO 'E%|W%' ORDER BY region;
SELECT value FROM data WHERE value SIMILAR TO '';
SELECT value FROM data WHERE value SIMILAR TO 'A%';
SELECT value FROM data WHERE value SIMILAR TO '[invalid';
SELECT value FROM data WHERE value SIMILAR TO 'test[0-9]+' ORDER BY value;
SELECT COUNT(*) FROM data WHERE value SIMILAR TO 'value[0-9]+';

-- ============================================================================
-- Test: test_similar_to_case_insensitive_workaround
-- Source: similar_to_operator_comprehensive_tdd.rs:442
-- ============================================================================
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'ALICE'), (2, 'alice'), (3, 'Alice'), (4, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL), (3, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, '100%'), (2, '50%'), (3, '100');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, email STRING);
INSERT INTO users VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
DROP TABLE IF EXISTS patterns;
CREATE TABLE patterns (id INT64, pattern STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew');
INSERT INTO patterns VALUES (1, 'A%');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, region STRING, amount INT64);
INSERT INTO sales VALUES (1, 'East', 100), (2, 'East', 200), (3, 'West', 150), (4, 'North', 180);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test123'), (2, 'test'), (3, 'test12');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);

SELECT name FROM users WHERE name SIMILAR TO '[Aa][Ll][Ii][Cc][Ee]' ORDER BY name;
SELECT name FROM users WHERE name SIMILAR TO 'A%';
SELECT name FROM users WHERE name SIMILAR TO NULL;
SELECT name, (name SIMILAR TO 'A%') IS NULL as is_null FROM users ORDER BY id;
SELECT value FROM data WHERE value SIMILAR TO '%\%' ESCAPE '\';
SELECT email, CASE WHEN email SIMILAR TO '%@%.%' THEN 'Valid' ELSE 'Invalid' END as status FROM users ORDER BY id;
SELECT u.name FROM users u JOIN patterns p ON u.name SIMILAR TO p.pattern ORDER BY u.name;
SELECT region, SUM(amount) as total FROM sales GROUP BY region HAVING region SIMILAR TO 'E%|W%' ORDER BY region;
SELECT value FROM data WHERE value SIMILAR TO '';
SELECT value FROM data WHERE value SIMILAR TO 'A%';
SELECT value FROM data WHERE value SIMILAR TO '[invalid';
SELECT value FROM data WHERE value SIMILAR TO 'test[0-9]+' ORDER BY value;
SELECT COUNT(*) FROM data WHERE value SIMILAR TO 'value[0-9]+';

-- ============================================================================
-- Test: test_similar_to_with_null_value
-- Source: similar_to_operator_comprehensive_tdd.rs:476
-- ============================================================================
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL), (3, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, '100%'), (2, '50%'), (3, '100');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, email STRING);
INSERT INTO users VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
DROP TABLE IF EXISTS patterns;
CREATE TABLE patterns (id INT64, pattern STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew');
INSERT INTO patterns VALUES (1, 'A%');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, region STRING, amount INT64);
INSERT INTO sales VALUES (1, 'East', 100), (2, 'East', 200), (3, 'West', 150), (4, 'North', 180);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test123'), (2, 'test'), (3, 'test12');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);

SELECT name FROM users WHERE name SIMILAR TO 'A%';
SELECT name FROM users WHERE name SIMILAR TO NULL;
SELECT name, (name SIMILAR TO 'A%') IS NULL as is_null FROM users ORDER BY id;
SELECT value FROM data WHERE value SIMILAR TO '%\%' ESCAPE '\';
SELECT email, CASE WHEN email SIMILAR TO '%@%.%' THEN 'Valid' ELSE 'Invalid' END as status FROM users ORDER BY id;
SELECT u.name FROM users u JOIN patterns p ON u.name SIMILAR TO p.pattern ORDER BY u.name;
SELECT region, SUM(amount) as total FROM sales GROUP BY region HAVING region SIMILAR TO 'E%|W%' ORDER BY region;
SELECT value FROM data WHERE value SIMILAR TO '';
SELECT value FROM data WHERE value SIMILAR TO 'A%';
SELECT value FROM data WHERE value SIMILAR TO '[invalid';
SELECT value FROM data WHERE value SIMILAR TO 'test[0-9]+' ORDER BY value;
SELECT COUNT(*) FROM data WHERE value SIMILAR TO 'value[0-9]+';

-- ============================================================================
-- Test: test_similar_to_with_null_pattern
-- Source: similar_to_operator_comprehensive_tdd.rs:498
-- ============================================================================
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, '100%'), (2, '50%'), (3, '100');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, email STRING);
INSERT INTO users VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
DROP TABLE IF EXISTS patterns;
CREATE TABLE patterns (id INT64, pattern STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew');
INSERT INTO patterns VALUES (1, 'A%');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, region STRING, amount INT64);
INSERT INTO sales VALUES (1, 'East', 100), (2, 'East', 200), (3, 'West', 150), (4, 'North', 180);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test123'), (2, 'test'), (3, 'test12');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);

SELECT name FROM users WHERE name SIMILAR TO NULL;
SELECT name, (name SIMILAR TO 'A%') IS NULL as is_null FROM users ORDER BY id;
SELECT value FROM data WHERE value SIMILAR TO '%\%' ESCAPE '\';
SELECT email, CASE WHEN email SIMILAR TO '%@%.%' THEN 'Valid' ELSE 'Invalid' END as status FROM users ORDER BY id;
SELECT u.name FROM users u JOIN patterns p ON u.name SIMILAR TO p.pattern ORDER BY u.name;
SELECT region, SUM(amount) as total FROM sales GROUP BY region HAVING region SIMILAR TO 'E%|W%' ORDER BY region;
SELECT value FROM data WHERE value SIMILAR TO '';
SELECT value FROM data WHERE value SIMILAR TO 'A%';
SELECT value FROM data WHERE value SIMILAR TO '[invalid';
SELECT value FROM data WHERE value SIMILAR TO 'test[0-9]+' ORDER BY value;
SELECT COUNT(*) FROM data WHERE value SIMILAR TO 'value[0-9]+';

-- ============================================================================
-- Test: test_similar_to_is_null_check
-- Source: similar_to_operator_comprehensive_tdd.rs:524
-- ============================================================================
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, NULL);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, '100%'), (2, '50%'), (3, '100');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, email STRING);
INSERT INTO users VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
DROP TABLE IF EXISTS patterns;
CREATE TABLE patterns (id INT64, pattern STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew');
INSERT INTO patterns VALUES (1, 'A%');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, region STRING, amount INT64);
INSERT INTO sales VALUES (1, 'East', 100), (2, 'East', 200), (3, 'West', 150), (4, 'North', 180);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test123'), (2, 'test'), (3, 'test12');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);

SELECT name, (name SIMILAR TO 'A%') IS NULL as is_null FROM users ORDER BY id;
SELECT value FROM data WHERE value SIMILAR TO '%\%' ESCAPE '\';
SELECT email, CASE WHEN email SIMILAR TO '%@%.%' THEN 'Valid' ELSE 'Invalid' END as status FROM users ORDER BY id;
SELECT u.name FROM users u JOIN patterns p ON u.name SIMILAR TO p.pattern ORDER BY u.name;
SELECT region, SUM(amount) as total FROM sales GROUP BY region HAVING region SIMILAR TO 'E%|W%' ORDER BY region;
SELECT value FROM data WHERE value SIMILAR TO '';
SELECT value FROM data WHERE value SIMILAR TO 'A%';
SELECT value FROM data WHERE value SIMILAR TO '[invalid';
SELECT value FROM data WHERE value SIMILAR TO 'test[0-9]+' ORDER BY value;
SELECT COUNT(*) FROM data WHERE value SIMILAR TO 'value[0-9]+';

-- ============================================================================
-- Test: test_similar_to_escape_special_characters
-- Source: similar_to_operator_comprehensive_tdd.rs:556
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, '100%'), (2, '50%'), (3, '100');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, email STRING);
INSERT INTO users VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
DROP TABLE IF EXISTS patterns;
CREATE TABLE patterns (id INT64, pattern STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew');
INSERT INTO patterns VALUES (1, 'A%');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, region STRING, amount INT64);
INSERT INTO sales VALUES (1, 'East', 100), (2, 'East', 200), (3, 'West', 150), (4, 'North', 180);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test123'), (2, 'test'), (3, 'test12');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);

SELECT value FROM data WHERE value SIMILAR TO '%\%' ESCAPE '\';
SELECT email, CASE WHEN email SIMILAR TO '%@%.%' THEN 'Valid' ELSE 'Invalid' END as status FROM users ORDER BY id;
SELECT u.name FROM users u JOIN patterns p ON u.name SIMILAR TO p.pattern ORDER BY u.name;
SELECT region, SUM(amount) as total FROM sales GROUP BY region HAVING region SIMILAR TO 'E%|W%' ORDER BY region;
SELECT value FROM data WHERE value SIMILAR TO '';
SELECT value FROM data WHERE value SIMILAR TO 'A%';
SELECT value FROM data WHERE value SIMILAR TO '[invalid';
SELECT value FROM data WHERE value SIMILAR TO 'test[0-9]+' ORDER BY value;
SELECT COUNT(*) FROM data WHERE value SIMILAR TO 'value[0-9]+';

-- ============================================================================
-- Test: test_similar_to_in_case_expression
-- Source: similar_to_operator_comprehensive_tdd.rs:586
-- ============================================================================
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, email STRING);
INSERT INTO users VALUES (1, 'alice@example.com'), (2, 'bob@test.org'), (3, 'invalid');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
DROP TABLE IF EXISTS patterns;
CREATE TABLE patterns (id INT64, pattern STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew');
INSERT INTO patterns VALUES (1, 'A%');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, region STRING, amount INT64);
INSERT INTO sales VALUES (1, 'East', 100), (2, 'East', 200), (3, 'West', 150), (4, 'North', 180);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test123'), (2, 'test'), (3, 'test12');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);

SELECT email, CASE WHEN email SIMILAR TO '%@%.%' THEN 'Valid' ELSE 'Invalid' END as status FROM users ORDER BY id;
SELECT u.name FROM users u JOIN patterns p ON u.name SIMILAR TO p.pattern ORDER BY u.name;
SELECT region, SUM(amount) as total FROM sales GROUP BY region HAVING region SIMILAR TO 'E%|W%' ORDER BY region;
SELECT value FROM data WHERE value SIMILAR TO '';
SELECT value FROM data WHERE value SIMILAR TO 'A%';
SELECT value FROM data WHERE value SIMILAR TO '[invalid';
SELECT value FROM data WHERE value SIMILAR TO 'test[0-9]+' ORDER BY value;
SELECT COUNT(*) FROM data WHERE value SIMILAR TO 'value[0-9]+';

-- ============================================================================
-- Test: test_similar_to_with_joins
-- Source: similar_to_operator_comprehensive_tdd.rs:613
-- ============================================================================
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, name STRING);
DROP TABLE IF EXISTS patterns;
CREATE TABLE patterns (id INT64, pattern STRING);
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Andrew');
INSERT INTO patterns VALUES (1, 'A%');
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (id INT64, region STRING, amount INT64);
INSERT INTO sales VALUES (1, 'East', 100), (2, 'East', 200), (3, 'West', 150), (4, 'North', 180);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, ''), (2, 'a'), (3, 'b');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);
INSERT INTO data VALUES (1, 'test123'), (2, 'test'), (3, 'test12');
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value STRING);

SELECT u.name FROM users u JOIN patterns p ON u.name SIMILAR TO p.pattern ORDER BY u.name;
SELECT region, SUM(amount) as total FROM sales GROUP BY region HAVING region SIMILAR TO 'E%|W%' ORDER BY region;
SELECT value FROM data WHERE value SIMILAR TO '';
SELECT value FROM data WHERE value SIMILAR TO 'A%';
SELECT value FROM data WHERE value SIMILAR TO '[invalid';
SELECT value FROM data WHERE value SIMILAR TO 'test[0-9]+' ORDER BY value;
SELECT COUNT(*) FROM data WHERE value SIMILAR TO 'value[0-9]+';

-- ============================================================================
-- Test: test_update_multiple_columns_different_sources
-- Source: update_enhancements_advanced_tdd.rs:673
-- ============================================================================
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, salary FLOAT64, bonus FLOAT64, total FLOAT64);
DROP TABLE IF EXISTS sal_adj;
CREATE TABLE sal_adj (emp_id INT64, new_sal FLOAT64);
DROP TABLE IF EXISTS bon_adj;
CREATE TABLE bon_adj (emp_id INT64, new_bon FLOAT64);
INSERT INTO employees VALUES (1, 50000.0, 5000.0, 0.0);
INSERT INTO sal_adj VALUES (1, 55000.0);
INSERT INTO bon_adj VALUES (1, 6000.0);
DROP TABLE IF EXISTS numbers;
CREATE TABLE numbers (n INT64, doubled INT64);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, customer_id INT64, total FLOAT64, status STRING);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (id INT64, tier STRING, lifetime_value FLOAT64);
DROP TABLE IF EXISTS tier_config;
CREATE TABLE tier_config (tier STRING, discount FLOAT64, min_value FLOAT64);
INSERT INTO orders VALUES (1, 1, 1000.0, 'pending'), (2, 2, 500.0, 'pending');
INSERT INTO customers VALUES (1, 'Gold', 5000.0), (2, 'Silver', 2000.0);
INSERT INTO tier_config VALUES ('Gold', 0.15, 3000.0), ('Silver', 0.05, 1000.0);

UPDATE employees e SET salary = (SELECT new_sal FROM sal_adj WHERE emp_id = e.id), bonus = (SELECT new_bon FROM bon_adj WHERE emp_id = e.id), total = salary + bonus;
SELECT salary, bonus, total FROM employees WHERE id = 1;
UPDATE numbers SET doubled = n * 2;
SELECT n, doubled FROM numbers WHERE n IN (0, 100, 9999);
UPDATE orders o SET total = total * (1.0 - t.discount), status = 'processed' FROM customers c JOIN tier_config t ON c.tier = t.tier WHERE o.customer_id = c.id AND c.lifetime_value >= t.min_value AND o.status = 'pending' RETURNING o.id, o.total, o.status;

-- ============================================================================
-- Test: test_update_large_batch
-- Source: update_enhancements_advanced_tdd.rs:708
-- ============================================================================
DROP TABLE IF EXISTS numbers;
CREATE TABLE numbers (n INT64, doubled INT64);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, customer_id INT64, total FLOAT64, status STRING);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (id INT64, tier STRING, lifetime_value FLOAT64);
DROP TABLE IF EXISTS tier_config;
CREATE TABLE tier_config (tier STRING, discount FLOAT64, min_value FLOAT64);
INSERT INTO orders VALUES (1, 1, 1000.0, 'pending'), (2, 2, 500.0, 'pending');
INSERT INTO customers VALUES (1, 'Gold', 5000.0), (2, 'Silver', 2000.0);
INSERT INTO tier_config VALUES ('Gold', 0.15, 3000.0), ('Silver', 0.05, 1000.0);

UPDATE numbers SET doubled = n * 2;
SELECT n, doubled FROM numbers WHERE n IN (0, 100, 9999);
UPDATE orders o SET total = total * (1.0 - t.discount), status = 'processed' FROM customers c JOIN tier_config t ON c.tier = t.tier WHERE o.customer_id = c.id AND c.lifetime_value >= t.min_value AND o.status = 'pending' RETURNING o.id, o.total, o.status;

-- ============================================================================
-- Test: test_update_complex_integration
-- Source: update_enhancements_advanced_tdd.rs:732
-- ============================================================================
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, customer_id INT64, total FLOAT64, status STRING);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (id INT64, tier STRING, lifetime_value FLOAT64);
DROP TABLE IF EXISTS tier_config;
CREATE TABLE tier_config (tier STRING, discount FLOAT64, min_value FLOAT64);
INSERT INTO orders VALUES (1, 1, 1000.0, 'pending'), (2, 2, 500.0, 'pending');
INSERT INTO customers VALUES (1, 'Gold', 5000.0), (2, 'Silver', 2000.0);
INSERT INTO tier_config VALUES ('Gold', 0.15, 3000.0), ('Silver', 0.05, 1000.0);

UPDATE orders o SET total = total * (1.0 - t.discount), status = 'processed' FROM customers c JOIN tier_config t ON c.tier = t.tier WHERE o.customer_id = c.id AND c.lifetime_value >= t.min_value AND o.status = 'pending' RETURNING o.id, o.total, o.status;

-- ============================================================================
-- Test: test_update_with_inner_join
-- Source: update_enhancements_tdd.rs:26
-- ============================================================================
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, name STRING, salary FLOAT64, dept_id INT64);
DROP TABLE IF EXISTS departments;
CREATE TABLE departments (id INT64, bonus_percent FLOAT64);
INSERT INTO employees VALUES (1, 'Alice', 50000, 10), (2, 'Bob', 60000, 20), (3, 'Charlie', 55000, 10);
INSERT INTO departments VALUES (10, 0.10), (20, 0.15);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, name STRING, manager_id INT64, title STRING);
INSERT INTO employees VALUES (1, 'Alice', NULL, 'IC'), (2, 'Bob', 1, 'IC'), (3, 'Charlie', 1, 'IC');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, customer_id INT64, total FLOAT64);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (id INT64, tier_id INT64);
DROP TABLE IF EXISTS tiers;
CREATE TABLE tiers (id INT64, discount FLOAT64);
INSERT INTO orders VALUES (1, 100, 1000.0), (2, 101, 500.0);
INSERT INTO customers VALUES (100, 1), (101, 2);
INSERT INTO tiers VALUES (1, 0.10), (2, 0.20);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64, category_id INT64);
DROP TABLE IF EXISTS price_adjustments;
CREATE TABLE price_adjustments (category_id INT64, multiplier FLOAT64);
INSERT INTO products VALUES (1, 100.0, 10), (2, 200.0, 20), (3, 150.0, 10);
INSERT INTO price_adjustments VALUES (10, 1.1), (20, 0.9);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category STRING, price FLOAT64);
INSERT INTO items VALUES (1, 'A', 100), (2, 'B', 200), (3, 'A', 150);
DROP TABLE IF EXISTS inventory;
CREATE TABLE inventory (id INT64, item STRING, quantity INT64);
INSERT INTO inventory VALUES (1, 'Widget', 100), (2, 'Gadget', 50);
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (id INT64, name STRING, balance FLOAT64);
INSERT INTO accounts VALUES (1, 'Alice', 1000.0), (2, 'Bob', 500.0);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, old_price FLOAT64, new_price FLOAT64);
INSERT INTO prices VALUES (1, 100.0, 0.0), (2, 200.0, 0.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64, value INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64, value INT64);
INSERT INTO table1 VALUES (1, 10), (2, 20);
INSERT INTO table2 VALUES (1, 100), (2, 200);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, name STRING, salary FLOAT64);
DROP TABLE IF EXISTS salary_adjustments;
CREATE TABLE salary_adjustments (adjustment FLOAT64);
INSERT INTO employees VALUES (1, 'Alice', 50000), (2, 'Bob', 60000);
INSERT INTO salary_adjustments VALUES (5000);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept_id INT64, salary FLOAT64);
DROP TABLE IF EXISTS dept_budgets;
CREATE TABLE dept_budgets (dept_id INT64, avg_salary FLOAT64);
INSERT INTO employees VALUES (1, 10, 45000), (2, 10, 55000), (3, 20, 60000);
INSERT INTO dept_budgets VALUES (10, 0), (20, 0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING, min_price FLOAT64, max_price FLOAT64);
DROP TABLE IF EXISTS price_history;
CREATE TABLE price_history (product_id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 'Widget', 0, 0);
INSERT INTO price_history VALUES (1, 100), (1, 150), (1, 120);
DROP TABLE IF EXISTS measurements;
CREATE TABLE measurements (id INT64, celsius FLOAT64, fahrenheit FLOAT64);
INSERT INTO measurements VALUES (1, 0, 0), (2, 100, 0);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, status STRING, priority STRING);
INSERT INTO orders VALUES (1, 'pending', ''), (2, 'shipped', ''), (3, 'delivered', '');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, first_name STRING, last_name STRING, full_name STRING);
INSERT INTO users VALUES (1, 'John', 'Doe', '');
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category_id INT64, price FLOAT64);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, markup FLOAT64);
INSERT INTO items VALUES (1, 10, 100), (2, NULL, 100), (3, 20, 100);
INSERT INTO categories VALUES (10, 1.1), (20, 1.2);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 10);

UPDATE employees e INNER JOIN departments d ON e.dept_id = d.id SET e.salary = e.salary * (1 + d.bonus_percent);
SELECT name, salary FROM employees ORDER BY id;
UPDATE employees e LEFT JOIN employees m ON e.manager_id = m.id SET e.title = 'Senior IC' WHERE m.id IS NOT NULL;
SELECT name, title FROM employees ORDER BY id;
UPDATE orders o JOIN customers c ON o.customer_id = c.id JOIN tiers t ON c.tier_id = t.id SET o.total = o.total * (1 - t.discount);
SELECT total FROM orders ORDER BY id;
UPDATE products SET price = price * pa.multiplier FROM price_adjustments pa WHERE products.category_id = pa.category_id;
SELECT price FROM products ORDER BY id;
UPDATE items SET price = avg_prices.avg_price FROM (SELECT category, AVG(price) as avg_price FROM items GROUP BY category) avg_prices WHERE items.category = avg_prices.category;
SELECT price FROM items WHERE category = 'A';
UPDATE inventory SET quantity = quantity + 10 WHERE quantity < 75 RETURNING *;
UPDATE accounts SET balance = balance * 1.05 RETURNING id, balance;
UPDATE prices SET new_price = old_price * 1.1 RETURNING id, new_price - old_price AS increase;
UPDATE data SET value = value + 1 WHERE value > 1000 RETURNING *;
UPDATE table1, table2 SET table1.value = table1.value + 5, table2.value = table2.value + 50 WHERE table1.id = table2.id;
SELECT value FROM table1 ORDER BY id;
SELECT value FROM table2 ORDER BY id;
UPDATE employees SET salary = salary + (SELECT adjustment FROM salary_adjustments LIMIT 1);
SELECT salary FROM employees ORDER BY id;
UPDATE dept_budgets SET avg_salary = ( SELECT AVG(salary) FROM employees WHERE employees.dept_id = dept_budgets.dept_id );
SELECT avg_salary FROM dept_budgets ORDER BY dept_id;
UPDATE products SET min_price = (SELECT MIN(price) FROM price_history WHERE product_id = products.id), max_price = (SELECT MAX(price) FROM price_history WHERE product_id = products.id);
SELECT min_price, max_price FROM products WHERE id = 1;
UPDATE measurements SET fahrenheit = (celsius * 9.0 / 5.0) + 32.0;
SELECT fahrenheit FROM measurements ORDER BY id;
UPDATE orders SET priority = CASE WHEN status = 'pending' THEN 'high' WHEN status = 'shipped' THEN 'medium' ELSE 'low' END;
SELECT priority FROM orders ORDER BY id;
UPDATE users SET full_name = first_name || ' ' || last_name;
SELECT full_name FROM users WHERE id = 1;
UPDATE items i LEFT JOIN categories c ON i.category_id = c.id SET i.price = COALESCE(i.price * c.markup, i.price);
SELECT price FROM items ORDER BY id;
UPDATE data SET value = value + 1 WHERE id > 1000;
SELECT value FROM data ORDER BY id;
UPDATE nonexistent_table SET value = 1;
UPDATE test SET nonexistent_column = 1;
UPDATE test SET value = 'not a number';

-- ============================================================================
-- Test: test_update_with_left_join
-- Source: update_enhancements_tdd.rs:67
-- ============================================================================
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, name STRING, manager_id INT64, title STRING);
INSERT INTO employees VALUES (1, 'Alice', NULL, 'IC'), (2, 'Bob', 1, 'IC'), (3, 'Charlie', 1, 'IC');
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, customer_id INT64, total FLOAT64);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (id INT64, tier_id INT64);
DROP TABLE IF EXISTS tiers;
CREATE TABLE tiers (id INT64, discount FLOAT64);
INSERT INTO orders VALUES (1, 100, 1000.0), (2, 101, 500.0);
INSERT INTO customers VALUES (100, 1), (101, 2);
INSERT INTO tiers VALUES (1, 0.10), (2, 0.20);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64, category_id INT64);
DROP TABLE IF EXISTS price_adjustments;
CREATE TABLE price_adjustments (category_id INT64, multiplier FLOAT64);
INSERT INTO products VALUES (1, 100.0, 10), (2, 200.0, 20), (3, 150.0, 10);
INSERT INTO price_adjustments VALUES (10, 1.1), (20, 0.9);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category STRING, price FLOAT64);
INSERT INTO items VALUES (1, 'A', 100), (2, 'B', 200), (3, 'A', 150);
DROP TABLE IF EXISTS inventory;
CREATE TABLE inventory (id INT64, item STRING, quantity INT64);
INSERT INTO inventory VALUES (1, 'Widget', 100), (2, 'Gadget', 50);
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (id INT64, name STRING, balance FLOAT64);
INSERT INTO accounts VALUES (1, 'Alice', 1000.0), (2, 'Bob', 500.0);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, old_price FLOAT64, new_price FLOAT64);
INSERT INTO prices VALUES (1, 100.0, 0.0), (2, 200.0, 0.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64, value INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64, value INT64);
INSERT INTO table1 VALUES (1, 10), (2, 20);
INSERT INTO table2 VALUES (1, 100), (2, 200);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, name STRING, salary FLOAT64);
DROP TABLE IF EXISTS salary_adjustments;
CREATE TABLE salary_adjustments (adjustment FLOAT64);
INSERT INTO employees VALUES (1, 'Alice', 50000), (2, 'Bob', 60000);
INSERT INTO salary_adjustments VALUES (5000);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept_id INT64, salary FLOAT64);
DROP TABLE IF EXISTS dept_budgets;
CREATE TABLE dept_budgets (dept_id INT64, avg_salary FLOAT64);
INSERT INTO employees VALUES (1, 10, 45000), (2, 10, 55000), (3, 20, 60000);
INSERT INTO dept_budgets VALUES (10, 0), (20, 0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING, min_price FLOAT64, max_price FLOAT64);
DROP TABLE IF EXISTS price_history;
CREATE TABLE price_history (product_id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 'Widget', 0, 0);
INSERT INTO price_history VALUES (1, 100), (1, 150), (1, 120);
DROP TABLE IF EXISTS measurements;
CREATE TABLE measurements (id INT64, celsius FLOAT64, fahrenheit FLOAT64);
INSERT INTO measurements VALUES (1, 0, 0), (2, 100, 0);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, status STRING, priority STRING);
INSERT INTO orders VALUES (1, 'pending', ''), (2, 'shipped', ''), (3, 'delivered', '');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, first_name STRING, last_name STRING, full_name STRING);
INSERT INTO users VALUES (1, 'John', 'Doe', '');
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category_id INT64, price FLOAT64);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, markup FLOAT64);
INSERT INTO items VALUES (1, 10, 100), (2, NULL, 100), (3, 20, 100);
INSERT INTO categories VALUES (10, 1.1), (20, 1.2);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 10);

UPDATE employees e LEFT JOIN employees m ON e.manager_id = m.id SET e.title = 'Senior IC' WHERE m.id IS NOT NULL;
SELECT name, title FROM employees ORDER BY id;
UPDATE orders o JOIN customers c ON o.customer_id = c.id JOIN tiers t ON c.tier_id = t.id SET o.total = o.total * (1 - t.discount);
SELECT total FROM orders ORDER BY id;
UPDATE products SET price = price * pa.multiplier FROM price_adjustments pa WHERE products.category_id = pa.category_id;
SELECT price FROM products ORDER BY id;
UPDATE items SET price = avg_prices.avg_price FROM (SELECT category, AVG(price) as avg_price FROM items GROUP BY category) avg_prices WHERE items.category = avg_prices.category;
SELECT price FROM items WHERE category = 'A';
UPDATE inventory SET quantity = quantity + 10 WHERE quantity < 75 RETURNING *;
UPDATE accounts SET balance = balance * 1.05 RETURNING id, balance;
UPDATE prices SET new_price = old_price * 1.1 RETURNING id, new_price - old_price AS increase;
UPDATE data SET value = value + 1 WHERE value > 1000 RETURNING *;
UPDATE table1, table2 SET table1.value = table1.value + 5, table2.value = table2.value + 50 WHERE table1.id = table2.id;
SELECT value FROM table1 ORDER BY id;
SELECT value FROM table2 ORDER BY id;
UPDATE employees SET salary = salary + (SELECT adjustment FROM salary_adjustments LIMIT 1);
SELECT salary FROM employees ORDER BY id;
UPDATE dept_budgets SET avg_salary = ( SELECT AVG(salary) FROM employees WHERE employees.dept_id = dept_budgets.dept_id );
SELECT avg_salary FROM dept_budgets ORDER BY dept_id;
UPDATE products SET min_price = (SELECT MIN(price) FROM price_history WHERE product_id = products.id), max_price = (SELECT MAX(price) FROM price_history WHERE product_id = products.id);
SELECT min_price, max_price FROM products WHERE id = 1;
UPDATE measurements SET fahrenheit = (celsius * 9.0 / 5.0) + 32.0;
SELECT fahrenheit FROM measurements ORDER BY id;
UPDATE orders SET priority = CASE WHEN status = 'pending' THEN 'high' WHEN status = 'shipped' THEN 'medium' ELSE 'low' END;
SELECT priority FROM orders ORDER BY id;
UPDATE users SET full_name = first_name || ' ' || last_name;
SELECT full_name FROM users WHERE id = 1;
UPDATE items i LEFT JOIN categories c ON i.category_id = c.id SET i.price = COALESCE(i.price * c.markup, i.price);
SELECT price FROM items ORDER BY id;
UPDATE data SET value = value + 1 WHERE id > 1000;
SELECT value FROM data ORDER BY id;
UPDATE nonexistent_table SET value = 1;
UPDATE test SET nonexistent_column = 1;
UPDATE test SET value = 'not a number';

-- ============================================================================
-- Test: test_update_with_multiple_joins
-- Source: update_enhancements_tdd.rs:98
-- ============================================================================
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, customer_id INT64, total FLOAT64);
DROP TABLE IF EXISTS customers;
CREATE TABLE customers (id INT64, tier_id INT64);
DROP TABLE IF EXISTS tiers;
CREATE TABLE tiers (id INT64, discount FLOAT64);
INSERT INTO orders VALUES (1, 100, 1000.0), (2, 101, 500.0);
INSERT INTO customers VALUES (100, 1), (101, 2);
INSERT INTO tiers VALUES (1, 0.10), (2, 0.20);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64, category_id INT64);
DROP TABLE IF EXISTS price_adjustments;
CREATE TABLE price_adjustments (category_id INT64, multiplier FLOAT64);
INSERT INTO products VALUES (1, 100.0, 10), (2, 200.0, 20), (3, 150.0, 10);
INSERT INTO price_adjustments VALUES (10, 1.1), (20, 0.9);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category STRING, price FLOAT64);
INSERT INTO items VALUES (1, 'A', 100), (2, 'B', 200), (3, 'A', 150);
DROP TABLE IF EXISTS inventory;
CREATE TABLE inventory (id INT64, item STRING, quantity INT64);
INSERT INTO inventory VALUES (1, 'Widget', 100), (2, 'Gadget', 50);
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (id INT64, name STRING, balance FLOAT64);
INSERT INTO accounts VALUES (1, 'Alice', 1000.0), (2, 'Bob', 500.0);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, old_price FLOAT64, new_price FLOAT64);
INSERT INTO prices VALUES (1, 100.0, 0.0), (2, 200.0, 0.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64, value INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64, value INT64);
INSERT INTO table1 VALUES (1, 10), (2, 20);
INSERT INTO table2 VALUES (1, 100), (2, 200);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, name STRING, salary FLOAT64);
DROP TABLE IF EXISTS salary_adjustments;
CREATE TABLE salary_adjustments (adjustment FLOAT64);
INSERT INTO employees VALUES (1, 'Alice', 50000), (2, 'Bob', 60000);
INSERT INTO salary_adjustments VALUES (5000);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept_id INT64, salary FLOAT64);
DROP TABLE IF EXISTS dept_budgets;
CREATE TABLE dept_budgets (dept_id INT64, avg_salary FLOAT64);
INSERT INTO employees VALUES (1, 10, 45000), (2, 10, 55000), (3, 20, 60000);
INSERT INTO dept_budgets VALUES (10, 0), (20, 0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING, min_price FLOAT64, max_price FLOAT64);
DROP TABLE IF EXISTS price_history;
CREATE TABLE price_history (product_id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 'Widget', 0, 0);
INSERT INTO price_history VALUES (1, 100), (1, 150), (1, 120);
DROP TABLE IF EXISTS measurements;
CREATE TABLE measurements (id INT64, celsius FLOAT64, fahrenheit FLOAT64);
INSERT INTO measurements VALUES (1, 0, 0), (2, 100, 0);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, status STRING, priority STRING);
INSERT INTO orders VALUES (1, 'pending', ''), (2, 'shipped', ''), (3, 'delivered', '');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, first_name STRING, last_name STRING, full_name STRING);
INSERT INTO users VALUES (1, 'John', 'Doe', '');
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category_id INT64, price FLOAT64);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, markup FLOAT64);
INSERT INTO items VALUES (1, 10, 100), (2, NULL, 100), (3, 20, 100);
INSERT INTO categories VALUES (10, 1.1), (20, 1.2);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 10);

UPDATE orders o JOIN customers c ON o.customer_id = c.id JOIN tiers t ON c.tier_id = t.id SET o.total = o.total * (1 - t.discount);
SELECT total FROM orders ORDER BY id;
UPDATE products SET price = price * pa.multiplier FROM price_adjustments pa WHERE products.category_id = pa.category_id;
SELECT price FROM products ORDER BY id;
UPDATE items SET price = avg_prices.avg_price FROM (SELECT category, AVG(price) as avg_price FROM items GROUP BY category) avg_prices WHERE items.category = avg_prices.category;
SELECT price FROM items WHERE category = 'A';
UPDATE inventory SET quantity = quantity + 10 WHERE quantity < 75 RETURNING *;
UPDATE accounts SET balance = balance * 1.05 RETURNING id, balance;
UPDATE prices SET new_price = old_price * 1.1 RETURNING id, new_price - old_price AS increase;
UPDATE data SET value = value + 1 WHERE value > 1000 RETURNING *;
UPDATE table1, table2 SET table1.value = table1.value + 5, table2.value = table2.value + 50 WHERE table1.id = table2.id;
SELECT value FROM table1 ORDER BY id;
SELECT value FROM table2 ORDER BY id;
UPDATE employees SET salary = salary + (SELECT adjustment FROM salary_adjustments LIMIT 1);
SELECT salary FROM employees ORDER BY id;
UPDATE dept_budgets SET avg_salary = ( SELECT AVG(salary) FROM employees WHERE employees.dept_id = dept_budgets.dept_id );
SELECT avg_salary FROM dept_budgets ORDER BY dept_id;
UPDATE products SET min_price = (SELECT MIN(price) FROM price_history WHERE product_id = products.id), max_price = (SELECT MAX(price) FROM price_history WHERE product_id = products.id);
SELECT min_price, max_price FROM products WHERE id = 1;
UPDATE measurements SET fahrenheit = (celsius * 9.0 / 5.0) + 32.0;
SELECT fahrenheit FROM measurements ORDER BY id;
UPDATE orders SET priority = CASE WHEN status = 'pending' THEN 'high' WHEN status = 'shipped' THEN 'medium' ELSE 'low' END;
SELECT priority FROM orders ORDER BY id;
UPDATE users SET full_name = first_name || ' ' || last_name;
SELECT full_name FROM users WHERE id = 1;
UPDATE items i LEFT JOIN categories c ON i.category_id = c.id SET i.price = COALESCE(i.price * c.markup, i.price);
SELECT price FROM items ORDER BY id;
UPDATE data SET value = value + 1 WHERE id > 1000;
SELECT value FROM data ORDER BY id;
UPDATE nonexistent_table SET value = 1;
UPDATE test SET nonexistent_column = 1;
UPDATE test SET value = 'not a number';

-- ============================================================================
-- Test: test_update_from_basic
-- Source: update_enhancements_tdd.rs:145
-- ============================================================================
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, price FLOAT64, category_id INT64);
DROP TABLE IF EXISTS price_adjustments;
CREATE TABLE price_adjustments (category_id INT64, multiplier FLOAT64);
INSERT INTO products VALUES (1, 100.0, 10), (2, 200.0, 20), (3, 150.0, 10);
INSERT INTO price_adjustments VALUES (10, 1.1), (20, 0.9);
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category STRING, price FLOAT64);
INSERT INTO items VALUES (1, 'A', 100), (2, 'B', 200), (3, 'A', 150);
DROP TABLE IF EXISTS inventory;
CREATE TABLE inventory (id INT64, item STRING, quantity INT64);
INSERT INTO inventory VALUES (1, 'Widget', 100), (2, 'Gadget', 50);
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (id INT64, name STRING, balance FLOAT64);
INSERT INTO accounts VALUES (1, 'Alice', 1000.0), (2, 'Bob', 500.0);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, old_price FLOAT64, new_price FLOAT64);
INSERT INTO prices VALUES (1, 100.0, 0.0), (2, 200.0, 0.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64, value INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64, value INT64);
INSERT INTO table1 VALUES (1, 10), (2, 20);
INSERT INTO table2 VALUES (1, 100), (2, 200);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, name STRING, salary FLOAT64);
DROP TABLE IF EXISTS salary_adjustments;
CREATE TABLE salary_adjustments (adjustment FLOAT64);
INSERT INTO employees VALUES (1, 'Alice', 50000), (2, 'Bob', 60000);
INSERT INTO salary_adjustments VALUES (5000);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept_id INT64, salary FLOAT64);
DROP TABLE IF EXISTS dept_budgets;
CREATE TABLE dept_budgets (dept_id INT64, avg_salary FLOAT64);
INSERT INTO employees VALUES (1, 10, 45000), (2, 10, 55000), (3, 20, 60000);
INSERT INTO dept_budgets VALUES (10, 0), (20, 0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING, min_price FLOAT64, max_price FLOAT64);
DROP TABLE IF EXISTS price_history;
CREATE TABLE price_history (product_id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 'Widget', 0, 0);
INSERT INTO price_history VALUES (1, 100), (1, 150), (1, 120);
DROP TABLE IF EXISTS measurements;
CREATE TABLE measurements (id INT64, celsius FLOAT64, fahrenheit FLOAT64);
INSERT INTO measurements VALUES (1, 0, 0), (2, 100, 0);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, status STRING, priority STRING);
INSERT INTO orders VALUES (1, 'pending', ''), (2, 'shipped', ''), (3, 'delivered', '');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, first_name STRING, last_name STRING, full_name STRING);
INSERT INTO users VALUES (1, 'John', 'Doe', '');
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category_id INT64, price FLOAT64);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, markup FLOAT64);
INSERT INTO items VALUES (1, 10, 100), (2, NULL, 100), (3, 20, 100);
INSERT INTO categories VALUES (10, 1.1), (20, 1.2);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 10);

UPDATE products SET price = price * pa.multiplier FROM price_adjustments pa WHERE products.category_id = pa.category_id;
SELECT price FROM products ORDER BY id;
UPDATE items SET price = avg_prices.avg_price FROM (SELECT category, AVG(price) as avg_price FROM items GROUP BY category) avg_prices WHERE items.category = avg_prices.category;
SELECT price FROM items WHERE category = 'A';
UPDATE inventory SET quantity = quantity + 10 WHERE quantity < 75 RETURNING *;
UPDATE accounts SET balance = balance * 1.05 RETURNING id, balance;
UPDATE prices SET new_price = old_price * 1.1 RETURNING id, new_price - old_price AS increase;
UPDATE data SET value = value + 1 WHERE value > 1000 RETURNING *;
UPDATE table1, table2 SET table1.value = table1.value + 5, table2.value = table2.value + 50 WHERE table1.id = table2.id;
SELECT value FROM table1 ORDER BY id;
SELECT value FROM table2 ORDER BY id;
UPDATE employees SET salary = salary + (SELECT adjustment FROM salary_adjustments LIMIT 1);
SELECT salary FROM employees ORDER BY id;
UPDATE dept_budgets SET avg_salary = ( SELECT AVG(salary) FROM employees WHERE employees.dept_id = dept_budgets.dept_id );
SELECT avg_salary FROM dept_budgets ORDER BY dept_id;
UPDATE products SET min_price = (SELECT MIN(price) FROM price_history WHERE product_id = products.id), max_price = (SELECT MAX(price) FROM price_history WHERE product_id = products.id);
SELECT min_price, max_price FROM products WHERE id = 1;
UPDATE measurements SET fahrenheit = (celsius * 9.0 / 5.0) + 32.0;
SELECT fahrenheit FROM measurements ORDER BY id;
UPDATE orders SET priority = CASE WHEN status = 'pending' THEN 'high' WHEN status = 'shipped' THEN 'medium' ELSE 'low' END;
SELECT priority FROM orders ORDER BY id;
UPDATE users SET full_name = first_name || ' ' || last_name;
SELECT full_name FROM users WHERE id = 1;
UPDATE items i LEFT JOIN categories c ON i.category_id = c.id SET i.price = COALESCE(i.price * c.markup, i.price);
SELECT price FROM items ORDER BY id;
UPDATE data SET value = value + 1 WHERE id > 1000;
SELECT value FROM data ORDER BY id;
UPDATE nonexistent_table SET value = 1;
UPDATE test SET nonexistent_column = 1;
UPDATE test SET value = 'not a number';

-- ============================================================================
-- Test: test_update_from_with_subquery
-- Source: update_enhancements_tdd.rs:183
-- ============================================================================
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category STRING, price FLOAT64);
INSERT INTO items VALUES (1, 'A', 100), (2, 'B', 200), (3, 'A', 150);
DROP TABLE IF EXISTS inventory;
CREATE TABLE inventory (id INT64, item STRING, quantity INT64);
INSERT INTO inventory VALUES (1, 'Widget', 100), (2, 'Gadget', 50);
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (id INT64, name STRING, balance FLOAT64);
INSERT INTO accounts VALUES (1, 'Alice', 1000.0), (2, 'Bob', 500.0);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, old_price FLOAT64, new_price FLOAT64);
INSERT INTO prices VALUES (1, 100.0, 0.0), (2, 200.0, 0.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64, value INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64, value INT64);
INSERT INTO table1 VALUES (1, 10), (2, 20);
INSERT INTO table2 VALUES (1, 100), (2, 200);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, name STRING, salary FLOAT64);
DROP TABLE IF EXISTS salary_adjustments;
CREATE TABLE salary_adjustments (adjustment FLOAT64);
INSERT INTO employees VALUES (1, 'Alice', 50000), (2, 'Bob', 60000);
INSERT INTO salary_adjustments VALUES (5000);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept_id INT64, salary FLOAT64);
DROP TABLE IF EXISTS dept_budgets;
CREATE TABLE dept_budgets (dept_id INT64, avg_salary FLOAT64);
INSERT INTO employees VALUES (1, 10, 45000), (2, 10, 55000), (3, 20, 60000);
INSERT INTO dept_budgets VALUES (10, 0), (20, 0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING, min_price FLOAT64, max_price FLOAT64);
DROP TABLE IF EXISTS price_history;
CREATE TABLE price_history (product_id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 'Widget', 0, 0);
INSERT INTO price_history VALUES (1, 100), (1, 150), (1, 120);
DROP TABLE IF EXISTS measurements;
CREATE TABLE measurements (id INT64, celsius FLOAT64, fahrenheit FLOAT64);
INSERT INTO measurements VALUES (1, 0, 0), (2, 100, 0);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, status STRING, priority STRING);
INSERT INTO orders VALUES (1, 'pending', ''), (2, 'shipped', ''), (3, 'delivered', '');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, first_name STRING, last_name STRING, full_name STRING);
INSERT INTO users VALUES (1, 'John', 'Doe', '');
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category_id INT64, price FLOAT64);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, markup FLOAT64);
INSERT INTO items VALUES (1, 10, 100), (2, NULL, 100), (3, 20, 100);
INSERT INTO categories VALUES (10, 1.1), (20, 1.2);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 10);

UPDATE items SET price = avg_prices.avg_price FROM (SELECT category, AVG(price) as avg_price FROM items GROUP BY category) avg_prices WHERE items.category = avg_prices.category;
SELECT price FROM items WHERE category = 'A';
UPDATE inventory SET quantity = quantity + 10 WHERE quantity < 75 RETURNING *;
UPDATE accounts SET balance = balance * 1.05 RETURNING id, balance;
UPDATE prices SET new_price = old_price * 1.1 RETURNING id, new_price - old_price AS increase;
UPDATE data SET value = value + 1 WHERE value > 1000 RETURNING *;
UPDATE table1, table2 SET table1.value = table1.value + 5, table2.value = table2.value + 50 WHERE table1.id = table2.id;
SELECT value FROM table1 ORDER BY id;
SELECT value FROM table2 ORDER BY id;
UPDATE employees SET salary = salary + (SELECT adjustment FROM salary_adjustments LIMIT 1);
SELECT salary FROM employees ORDER BY id;
UPDATE dept_budgets SET avg_salary = ( SELECT AVG(salary) FROM employees WHERE employees.dept_id = dept_budgets.dept_id );
SELECT avg_salary FROM dept_budgets ORDER BY dept_id;
UPDATE products SET min_price = (SELECT MIN(price) FROM price_history WHERE product_id = products.id), max_price = (SELECT MAX(price) FROM price_history WHERE product_id = products.id);
SELECT min_price, max_price FROM products WHERE id = 1;
UPDATE measurements SET fahrenheit = (celsius * 9.0 / 5.0) + 32.0;
SELECT fahrenheit FROM measurements ORDER BY id;
UPDATE orders SET priority = CASE WHEN status = 'pending' THEN 'high' WHEN status = 'shipped' THEN 'medium' ELSE 'low' END;
SELECT priority FROM orders ORDER BY id;
UPDATE users SET full_name = first_name || ' ' || last_name;
SELECT full_name FROM users WHERE id = 1;
UPDATE items i LEFT JOIN categories c ON i.category_id = c.id SET i.price = COALESCE(i.price * c.markup, i.price);
SELECT price FROM items ORDER BY id;
UPDATE data SET value = value + 1 WHERE id > 1000;
SELECT value FROM data ORDER BY id;
UPDATE nonexistent_table SET value = 1;
UPDATE test SET nonexistent_column = 1;
UPDATE test SET value = 'not a number';

-- ============================================================================
-- Test: test_update_returning_all
-- Source: update_enhancements_tdd.rs:217
-- ============================================================================
DROP TABLE IF EXISTS inventory;
CREATE TABLE inventory (id INT64, item STRING, quantity INT64);
INSERT INTO inventory VALUES (1, 'Widget', 100), (2, 'Gadget', 50);
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (id INT64, name STRING, balance FLOAT64);
INSERT INTO accounts VALUES (1, 'Alice', 1000.0), (2, 'Bob', 500.0);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, old_price FLOAT64, new_price FLOAT64);
INSERT INTO prices VALUES (1, 100.0, 0.0), (2, 200.0, 0.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64, value INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64, value INT64);
INSERT INTO table1 VALUES (1, 10), (2, 20);
INSERT INTO table2 VALUES (1, 100), (2, 200);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, name STRING, salary FLOAT64);
DROP TABLE IF EXISTS salary_adjustments;
CREATE TABLE salary_adjustments (adjustment FLOAT64);
INSERT INTO employees VALUES (1, 'Alice', 50000), (2, 'Bob', 60000);
INSERT INTO salary_adjustments VALUES (5000);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept_id INT64, salary FLOAT64);
DROP TABLE IF EXISTS dept_budgets;
CREATE TABLE dept_budgets (dept_id INT64, avg_salary FLOAT64);
INSERT INTO employees VALUES (1, 10, 45000), (2, 10, 55000), (3, 20, 60000);
INSERT INTO dept_budgets VALUES (10, 0), (20, 0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING, min_price FLOAT64, max_price FLOAT64);
DROP TABLE IF EXISTS price_history;
CREATE TABLE price_history (product_id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 'Widget', 0, 0);
INSERT INTO price_history VALUES (1, 100), (1, 150), (1, 120);
DROP TABLE IF EXISTS measurements;
CREATE TABLE measurements (id INT64, celsius FLOAT64, fahrenheit FLOAT64);
INSERT INTO measurements VALUES (1, 0, 0), (2, 100, 0);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, status STRING, priority STRING);
INSERT INTO orders VALUES (1, 'pending', ''), (2, 'shipped', ''), (3, 'delivered', '');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, first_name STRING, last_name STRING, full_name STRING);
INSERT INTO users VALUES (1, 'John', 'Doe', '');
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category_id INT64, price FLOAT64);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, markup FLOAT64);
INSERT INTO items VALUES (1, 10, 100), (2, NULL, 100), (3, 20, 100);
INSERT INTO categories VALUES (10, 1.1), (20, 1.2);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 10);

UPDATE inventory SET quantity = quantity + 10 WHERE quantity < 75 RETURNING *;
UPDATE accounts SET balance = balance * 1.05 RETURNING id, balance;
UPDATE prices SET new_price = old_price * 1.1 RETURNING id, new_price - old_price AS increase;
UPDATE data SET value = value + 1 WHERE value > 1000 RETURNING *;
UPDATE table1, table2 SET table1.value = table1.value + 5, table2.value = table2.value + 50 WHERE table1.id = table2.id;
SELECT value FROM table1 ORDER BY id;
SELECT value FROM table2 ORDER BY id;
UPDATE employees SET salary = salary + (SELECT adjustment FROM salary_adjustments LIMIT 1);
SELECT salary FROM employees ORDER BY id;
UPDATE dept_budgets SET avg_salary = ( SELECT AVG(salary) FROM employees WHERE employees.dept_id = dept_budgets.dept_id );
SELECT avg_salary FROM dept_budgets ORDER BY dept_id;
UPDATE products SET min_price = (SELECT MIN(price) FROM price_history WHERE product_id = products.id), max_price = (SELECT MAX(price) FROM price_history WHERE product_id = products.id);
SELECT min_price, max_price FROM products WHERE id = 1;
UPDATE measurements SET fahrenheit = (celsius * 9.0 / 5.0) + 32.0;
SELECT fahrenheit FROM measurements ORDER BY id;
UPDATE orders SET priority = CASE WHEN status = 'pending' THEN 'high' WHEN status = 'shipped' THEN 'medium' ELSE 'low' END;
SELECT priority FROM orders ORDER BY id;
UPDATE users SET full_name = first_name || ' ' || last_name;
SELECT full_name FROM users WHERE id = 1;
UPDATE items i LEFT JOIN categories c ON i.category_id = c.id SET i.price = COALESCE(i.price * c.markup, i.price);
SELECT price FROM items ORDER BY id;
UPDATE data SET value = value + 1 WHERE id > 1000;
SELECT value FROM data ORDER BY id;
UPDATE nonexistent_table SET value = 1;
UPDATE test SET nonexistent_column = 1;
UPDATE test SET value = 'not a number';

-- ============================================================================
-- Test: test_update_returning_specific_columns
-- Source: update_enhancements_tdd.rs:248
-- ============================================================================
DROP TABLE IF EXISTS accounts;
CREATE TABLE accounts (id INT64, name STRING, balance FLOAT64);
INSERT INTO accounts VALUES (1, 'Alice', 1000.0), (2, 'Bob', 500.0);
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, old_price FLOAT64, new_price FLOAT64);
INSERT INTO prices VALUES (1, 100.0, 0.0), (2, 200.0, 0.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64, value INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64, value INT64);
INSERT INTO table1 VALUES (1, 10), (2, 20);
INSERT INTO table2 VALUES (1, 100), (2, 200);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, name STRING, salary FLOAT64);
DROP TABLE IF EXISTS salary_adjustments;
CREATE TABLE salary_adjustments (adjustment FLOAT64);
INSERT INTO employees VALUES (1, 'Alice', 50000), (2, 'Bob', 60000);
INSERT INTO salary_adjustments VALUES (5000);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept_id INT64, salary FLOAT64);
DROP TABLE IF EXISTS dept_budgets;
CREATE TABLE dept_budgets (dept_id INT64, avg_salary FLOAT64);
INSERT INTO employees VALUES (1, 10, 45000), (2, 10, 55000), (3, 20, 60000);
INSERT INTO dept_budgets VALUES (10, 0), (20, 0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING, min_price FLOAT64, max_price FLOAT64);
DROP TABLE IF EXISTS price_history;
CREATE TABLE price_history (product_id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 'Widget', 0, 0);
INSERT INTO price_history VALUES (1, 100), (1, 150), (1, 120);
DROP TABLE IF EXISTS measurements;
CREATE TABLE measurements (id INT64, celsius FLOAT64, fahrenheit FLOAT64);
INSERT INTO measurements VALUES (1, 0, 0), (2, 100, 0);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, status STRING, priority STRING);
INSERT INTO orders VALUES (1, 'pending', ''), (2, 'shipped', ''), (3, 'delivered', '');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, first_name STRING, last_name STRING, full_name STRING);
INSERT INTO users VALUES (1, 'John', 'Doe', '');
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category_id INT64, price FLOAT64);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, markup FLOAT64);
INSERT INTO items VALUES (1, 10, 100), (2, NULL, 100), (3, 20, 100);
INSERT INTO categories VALUES (10, 1.1), (20, 1.2);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 10);

UPDATE accounts SET balance = balance * 1.05 RETURNING id, balance;
UPDATE prices SET new_price = old_price * 1.1 RETURNING id, new_price - old_price AS increase;
UPDATE data SET value = value + 1 WHERE value > 1000 RETURNING *;
UPDATE table1, table2 SET table1.value = table1.value + 5, table2.value = table2.value + 50 WHERE table1.id = table2.id;
SELECT value FROM table1 ORDER BY id;
SELECT value FROM table2 ORDER BY id;
UPDATE employees SET salary = salary + (SELECT adjustment FROM salary_adjustments LIMIT 1);
SELECT salary FROM employees ORDER BY id;
UPDATE dept_budgets SET avg_salary = ( SELECT AVG(salary) FROM employees WHERE employees.dept_id = dept_budgets.dept_id );
SELECT avg_salary FROM dept_budgets ORDER BY dept_id;
UPDATE products SET min_price = (SELECT MIN(price) FROM price_history WHERE product_id = products.id), max_price = (SELECT MAX(price) FROM price_history WHERE product_id = products.id);
SELECT min_price, max_price FROM products WHERE id = 1;
UPDATE measurements SET fahrenheit = (celsius * 9.0 / 5.0) + 32.0;
SELECT fahrenheit FROM measurements ORDER BY id;
UPDATE orders SET priority = CASE WHEN status = 'pending' THEN 'high' WHEN status = 'shipped' THEN 'medium' ELSE 'low' END;
SELECT priority FROM orders ORDER BY id;
UPDATE users SET full_name = first_name || ' ' || last_name;
SELECT full_name FROM users WHERE id = 1;
UPDATE items i LEFT JOIN categories c ON i.category_id = c.id SET i.price = COALESCE(i.price * c.markup, i.price);
SELECT price FROM items ORDER BY id;
UPDATE data SET value = value + 1 WHERE id > 1000;
SELECT value FROM data ORDER BY id;
UPDATE nonexistent_table SET value = 1;
UPDATE test SET nonexistent_column = 1;
UPDATE test SET value = 'not a number';

-- ============================================================================
-- Test: test_update_returning_computed_expression
-- Source: update_enhancements_tdd.rs:275
-- ============================================================================
DROP TABLE IF EXISTS prices;
CREATE TABLE prices (id INT64, old_price FLOAT64, new_price FLOAT64);
INSERT INTO prices VALUES (1, 100.0, 0.0), (2, 200.0, 0.0);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64, value INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64, value INT64);
INSERT INTO table1 VALUES (1, 10), (2, 20);
INSERT INTO table2 VALUES (1, 100), (2, 200);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, name STRING, salary FLOAT64);
DROP TABLE IF EXISTS salary_adjustments;
CREATE TABLE salary_adjustments (adjustment FLOAT64);
INSERT INTO employees VALUES (1, 'Alice', 50000), (2, 'Bob', 60000);
INSERT INTO salary_adjustments VALUES (5000);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept_id INT64, salary FLOAT64);
DROP TABLE IF EXISTS dept_budgets;
CREATE TABLE dept_budgets (dept_id INT64, avg_salary FLOAT64);
INSERT INTO employees VALUES (1, 10, 45000), (2, 10, 55000), (3, 20, 60000);
INSERT INTO dept_budgets VALUES (10, 0), (20, 0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING, min_price FLOAT64, max_price FLOAT64);
DROP TABLE IF EXISTS price_history;
CREATE TABLE price_history (product_id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 'Widget', 0, 0);
INSERT INTO price_history VALUES (1, 100), (1, 150), (1, 120);
DROP TABLE IF EXISTS measurements;
CREATE TABLE measurements (id INT64, celsius FLOAT64, fahrenheit FLOAT64);
INSERT INTO measurements VALUES (1, 0, 0), (2, 100, 0);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, status STRING, priority STRING);
INSERT INTO orders VALUES (1, 'pending', ''), (2, 'shipped', ''), (3, 'delivered', '');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, first_name STRING, last_name STRING, full_name STRING);
INSERT INTO users VALUES (1, 'John', 'Doe', '');
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category_id INT64, price FLOAT64);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, markup FLOAT64);
INSERT INTO items VALUES (1, 10, 100), (2, NULL, 100), (3, 20, 100);
INSERT INTO categories VALUES (10, 1.1), (20, 1.2);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 10);

UPDATE prices SET new_price = old_price * 1.1 RETURNING id, new_price - old_price AS increase;
UPDATE data SET value = value + 1 WHERE value > 1000 RETURNING *;
UPDATE table1, table2 SET table1.value = table1.value + 5, table2.value = table2.value + 50 WHERE table1.id = table2.id;
SELECT value FROM table1 ORDER BY id;
SELECT value FROM table2 ORDER BY id;
UPDATE employees SET salary = salary + (SELECT adjustment FROM salary_adjustments LIMIT 1);
SELECT salary FROM employees ORDER BY id;
UPDATE dept_budgets SET avg_salary = ( SELECT AVG(salary) FROM employees WHERE employees.dept_id = dept_budgets.dept_id );
SELECT avg_salary FROM dept_budgets ORDER BY dept_id;
UPDATE products SET min_price = (SELECT MIN(price) FROM price_history WHERE product_id = products.id), max_price = (SELECT MAX(price) FROM price_history WHERE product_id = products.id);
SELECT min_price, max_price FROM products WHERE id = 1;
UPDATE measurements SET fahrenheit = (celsius * 9.0 / 5.0) + 32.0;
SELECT fahrenheit FROM measurements ORDER BY id;
UPDATE orders SET priority = CASE WHEN status = 'pending' THEN 'high' WHEN status = 'shipped' THEN 'medium' ELSE 'low' END;
SELECT priority FROM orders ORDER BY id;
UPDATE users SET full_name = first_name || ' ' || last_name;
SELECT full_name FROM users WHERE id = 1;
UPDATE items i LEFT JOIN categories c ON i.category_id = c.id SET i.price = COALESCE(i.price * c.markup, i.price);
SELECT price FROM items ORDER BY id;
UPDATE data SET value = value + 1 WHERE id > 1000;
SELECT value FROM data ORDER BY id;
UPDATE nonexistent_table SET value = 1;
UPDATE test SET nonexistent_column = 1;
UPDATE test SET value = 'not a number';

-- ============================================================================
-- Test: test_update_returning_no_rows_updated
-- Source: update_enhancements_tdd.rs:299
-- ============================================================================
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id INT64, value INT64);
DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id INT64, value INT64);
INSERT INTO table1 VALUES (1, 10), (2, 20);
INSERT INTO table2 VALUES (1, 100), (2, 200);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, name STRING, salary FLOAT64);
DROP TABLE IF EXISTS salary_adjustments;
CREATE TABLE salary_adjustments (adjustment FLOAT64);
INSERT INTO employees VALUES (1, 'Alice', 50000), (2, 'Bob', 60000);
INSERT INTO salary_adjustments VALUES (5000);
DROP TABLE IF EXISTS employees;
CREATE TABLE employees (id INT64, dept_id INT64, salary FLOAT64);
DROP TABLE IF EXISTS dept_budgets;
CREATE TABLE dept_budgets (dept_id INT64, avg_salary FLOAT64);
INSERT INTO employees VALUES (1, 10, 45000), (2, 10, 55000), (3, 20, 60000);
INSERT INTO dept_budgets VALUES (10, 0), (20, 0);
DROP TABLE IF EXISTS products;
CREATE TABLE products (id INT64, name STRING, min_price FLOAT64, max_price FLOAT64);
DROP TABLE IF EXISTS price_history;
CREATE TABLE price_history (product_id INT64, price FLOAT64);
INSERT INTO products VALUES (1, 'Widget', 0, 0);
INSERT INTO price_history VALUES (1, 100), (1, 150), (1, 120);
DROP TABLE IF EXISTS measurements;
CREATE TABLE measurements (id INT64, celsius FLOAT64, fahrenheit FLOAT64);
INSERT INTO measurements VALUES (1, 0, 0), (2, 100, 0);
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (id INT64, status STRING, priority STRING);
INSERT INTO orders VALUES (1, 'pending', ''), (2, 'shipped', ''), (3, 'delivered', '');
DROP TABLE IF EXISTS users;
CREATE TABLE users (id INT64, first_name STRING, last_name STRING, full_name STRING);
INSERT INTO users VALUES (1, 'John', 'Doe', '');
DROP TABLE IF EXISTS items;
CREATE TABLE items (id INT64, category_id INT64, price FLOAT64);
DROP TABLE IF EXISTS categories;
CREATE TABLE categories (id INT64, markup FLOAT64);
INSERT INTO items VALUES (1, 10, 100), (2, NULL, 100), (3, 20, 100);
INSERT INTO categories VALUES (10, 1.1), (20, 1.2);
DROP TABLE IF EXISTS data;
CREATE TABLE data (id INT64, value INT64);
INSERT INTO data VALUES (1, 10), (2, 20);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64);
DROP TABLE IF EXISTS test;
CREATE TABLE test (id INT64, value INT64);
INSERT INTO test VALUES (1, 10);

UPDATE data SET value = value + 1 WHERE value > 1000 RETURNING *;
UPDATE table1, table2 SET table1.value = table1.value + 5, table2.value = table2.value + 50 WHERE table1.id = table2.id;
SELECT value FROM table1 ORDER BY id;
SELECT value FROM table2 ORDER BY id;
UPDATE employees SET salary = salary + (SELECT adjustment FROM salary_adjustments LIMIT 1);
SELECT salary FROM employees ORDER BY id;
UPDATE dept_budgets SET avg_salary = ( SELECT AVG(salary) FROM employees WHERE employees.dept_id = dept_budgets.dept_id );
SELECT avg_salary FROM dept_budgets ORDER BY dept_id;
UPDATE products SET min_price = (SELECT MIN(price) FROM price_history WHERE product_id = products.id), max_price = (SELECT MAX(price) FROM price_history WHERE product_id = products.id);
SELECT min_price, max_price FROM products WHERE id = 1;
UPDATE measurements SET fahrenheit = (celsius * 9.0 / 5.0) + 32.0;
SELECT fahrenheit FROM measurements ORDER BY id;
UPDATE orders SET priority = CASE WHEN status = 'pending' THEN 'high' WHEN status = 'shipped' THEN 'medium' ELSE 'low' END;
SELECT priority FROM orders ORDER BY id;
UPDATE users SET full_name = first_name || ' ' || last_name;
SELECT full_name FROM users WHERE id = 1;
UPDATE items i LEFT JOIN categories c ON i.category_id = c.id SET i.price = COALESCE(i.price * c.markup, i.price);
SELECT price FROM items ORDER BY id;
UPDATE data SET value = value + 1 WHERE id > 1000;
SELECT value FROM data ORDER BY id;
UPDATE nonexistent_table SET value = 1;
UPDATE test SET nonexistent_column = 1;
UPDATE test SET value = 'not a number';
